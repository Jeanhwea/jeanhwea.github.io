#+TITLE: pip 包管理工具
#+AUTHOR: Jinghui Hu
#+EMAIL: hujinghui@buaa.edu.cn
#+DATE: <2018-10-08 Mon 11:04:00>
#+HTML_LINK_UP: ../readme.html
#+HTML_LINK_HOME: ../index.html
#+TAGS: python pip package


* Pip 介绍
  [[https://pypi.org/project/pip/][pip]] 是 python 的包管理工具，在国内可以替换 [[https://mirrors.tuna.tsinghua.edu.cn/help/pypi/][清华 pypi 镜像]] 下载源来加快下载速度。
  pip 工具在 Windows 和 Unix 环境下的配置文件位置如下

  - Windows: =~/pip/pip.ini=
  - Mac & Linux: =~/.pip/pip.conf=

  需要配置项的内容如下：
  #+BEGIN_SRC conf
    [global]
    index-url = https://pypi.tuna.tsinghua.edu.cn/simple

    [list]
    format = columns
  #+END_SRC

  也可以用如下的命令直接设置
  #+BEGIN_SRC sh
    pip install pip -U
    pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
  #+END_SRC

* 常用命令
  - ~pip install -U <package>~ : 升级包
  - ~pip install <package>~ : 安装包
    + ~name~ : 最新版本
    + ~name==1.0.3~ : 制定版本
    + ~name>=1.0.3~ : 最小版本
  - ~pip uninstall <package>~ : 卸载包
  - ~pip search <package>~ : 搜索包
  - ~pip show <package>~ : 显示安装包信息

** 列出当前所有包
   #+BEGIN_SRC sh
     ~ $ pip list
     Package                Version
     ---------------------- ----------
     appnope                0.1.0
     autopep8               1.4.3
     backcall               0.1.0
     certifi                2018.11.29
     chardet                3.0.4
     cycler                 0.10.0
     flake8                 3.6.0
     get                    2018.11.19
     idna                   2.8
     ipdb                   0.12
     ipython                7.6.0
   #+END_SRC

** 更新所有包到最新版本
   #+BEGIN_SRC sh
     pip freeze --local | grep -v '^\-e' | cut -d = -f 1  | xargs -n1 pip install -U
   #+END_SRC

** 批量导出/安装包 =requirements.txt=
   在 Python 项目中通常有一个 =requirements.txt= 文件，该文件记录项目所需的包和相
   应的版本号。
   #+BEGIN_SRC sh
     pip freeze > requirements.txt
     pip install -r requirements.txt
   #+END_SRC

** 离线下载/安装 wheel 包
*** 下载 wheel 包
   将 =requirements.txt= 中的所有依赖的 wheel 包下载到 wheels 文件夹中
   #+BEGIN_SRC sh
     pip download -r requirements.txt -d wheels
   #+END_SRC

*** 安装 wheel 包
   将 wheels 文件夹中的包安装到环境中
   #+BEGIN_SRC sh
     pip install -r requirements.txt --no-index --find-link=wheels
   #+END_SRC

*** 最佳实践
   一般可以将下载的 wheel 包放在摆渡机的 =~/Downloads/wheels= 文件夹中
   #+BEGIN_SRC sh
     # download and save packages to ~/Downloads/wheels
     pip download -d ~/Downloads/wheels <name>

     # upload packages to remote machine
     rsync -av ~/Downloads/wheels/ user@host:~/Downloads/wheels

     # install on remote machine
     pip install --no-index --find-link=~/Downloads/wheels <name>
   #+END_SRC

* 虚拟环境
** 建立虚拟环境
   #+BEGIN_SRC shell
     mkdir ~/.venv && cd ~/.venv

     # 安装 virtualenv 依赖
     pip install virtualenv

     # 新建虚拟环境
     virtualenv dev --python=python3
     # 另外一种建虚拟环境的方式
     python3 -m virtualenv dev
   #+END_SRC

** 激活/取消虚拟环境
   #+BEGIN_SRC shell
     # 激活虚拟环境
     source path/to/bin/activate

     # 取消虚拟环境
     deactivate
   #+END_SRC
