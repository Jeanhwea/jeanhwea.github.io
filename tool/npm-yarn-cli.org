#+TITLE: npm 和 yarn - NodeJs 包管理工具
#+AUTHOR: Jinghui Hu
#+EMAIL: hujinghui@buaa.edu.cn
#+DATE: <2018-10-08 Mon 11:04:00>
#+HTML_LINK_UP: ../readme.html
#+HTML_LINK_HOME: ../index.html
#+TAGS: npm yarn taobao


* npm 和 yarn

  [[https://www.npmjs.com/][npm]] 是 nodejs 默认的包管理工具，[[http://www.yarnpkg.com][yarn]] 是 npm 的一个改进版，它缓存存了每个下载过
  的包,所以再次使用时无需重复下载。

** Ubuntu 上安装 npm 和 yarn
   #+BEGIN_SRC sh
     sudo apt-get install nodejs
     sudo apt-get install npm
   #+END_SRC

   升级 npm 命令如下：
   #+BEGIN_SRC sh
     sudo npm install npm -g
   #+END_SRC

   升级 node.js 命令如下：
   #+BEGIN_SRC sh
     npm install -g n
     # 升级 nodejs 到最新版
     n latest
     # 升级 nodejs 到最新稳定版
     n stable
     # 安装 v10.11.0 版本的 node
     n 10.11.0
   #+END_SRC

** 使用淘宝镜像源
  npm 和 yarn 在配置国内 [[https://npm.taobao.org/][淘宝镜像源]] 的时候需要配置以下文件：
  #+BEGIN_SRC conf
    # ~/.npmrc
    registry=https://registry.npm.taobao.org
    disturl=https://npm.taobao.org/dist
  #+END_SRC
  #+BEGIN_SRC conf
    # ~/.yarnrc
    registry "https://registry.npm.taobao.org"
  #+END_SRC

  或者直接使用配置命令来设置源
  #+BEGIN_SRC sh
    npm config set registry https://registry.npm.taobao.org
    npm config set disturl https://npm.taobao.org/dist
    yarn config set registry https://registry.npm.taobao.org
  #+END_SRC

  查看设置的配置项
  #+BEGIN_SRC sh
    npm config ls -l
    yarn config list
  #+END_SRC


  一些包需要添加淘宝 [[https://npm.taobao.org/mirrors][加速器]]
  #+BEGIN_SRC sh
    export NVM_NODEJS_ORG_MIRROR=http://npm.taobao.org/mirrors/node
    export SASS_BINARY_SITE=http://npm.taobao.org/mirrors/node-sass
    export ELECTRON_MIRROR=http://npm.taobao.org/mirrors/electron/
    export SQLITE3_BINARY_SITE=http://npm.taobao.org/mirrors/sqlite3
  #+END_SRC

** 全局安装
   配置本地仓库的存储路径
   #+BEGIN_SRC sh
     mkdir -p ~/.npm/node_modules
     npm config set prefix=~/.npm/node_modules

     echo 'export PATH=$HOME/.npm/node_modules/bin:$PATH' >> ~/.bashrc
   #+END_SRC

* 常用命令
  npm 和 yarn 都有相似功能的命令 ，官方文档很详细，请参考 [[https://docs.npmjs.com/][npm cli]] 和 [[https://yarnpkg.com/en/docs/cli/][yarn cli]]。

** 下载项目包
   根据 =package.json= 文件中的引用记录将镜像源中的包下载到本地 =node_modules=
   文件夹中。
   #+BEGIN_SRC sh
     npm install
     yarn install
   #+END_SRC

** 全局安装包
   将一些命令行工具安装到全局包仓库中
   #+BEGIN_SRC sh
     npm install -g package-name
     yarn global add package-name
   #+END_SRC

** 安装项目模块
   给当前项目添加一个包，并将引用信息添加的 =package.json= 文件中。
   #+BEGIN_SRC sh
     npm install --save package-name
     npm install --save-dev package-name
     yarn add package-name
     yarn add package-name@1.2.3 # 制定安装版本
     yarn add --dev package-name
   #+END_SRC

** 卸载项目模块
   卸载将当前项目中的制定模块，并且更新 =package.json= 文件中的相关信息。
   #+BEGIN_SRC sh
     npm uninstall package-name
     npm uninstall package-name --save-dev
     yarn remove package-name
     yarn remove package-name --dev
   #+END_SRC

** 升级项目模块
   基于 =package.json= 和 =yarn.lock= 中的信息来升级一个特点项目模块。
   #+BEGIN_SRC sh
     npm update package-name
     npm upgrade package-name # upgrade is an alias of update
     yarn upgrade package-name
     yarn upgrade --latest package-name
   #+END_SRC
