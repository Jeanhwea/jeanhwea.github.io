<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-03-15 Sun 22:29 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Spring Framework</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Jinghui Hu" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="styles/readtheorg/css/readtheorg.css"/>
<script type="text/javascript" src="styles/lib/js/jquery.min.js"></script>
<script type="text/javascript" src="styles/lib/js/bootstrap.min.js"></script>
<script type="text/javascript" src="styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="../readme.html"> UP </a>
 |
 <a accesskey="H" href="../index.html"> HOME </a>
</div><div id="content">
<h1 class="title">Spring Framework</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org5974a48">1. 简介</a></li>
<li><a href="#org0d7d9bc">2. Spring 的技术点和优点</a></li>
<li><a href="#orgb53264f">3. IoC (Inversion of Control)</a></li>
<li><a href="#org020ce77">4. 创建 Spring 项目</a></li>
<li><a href="#org67d6cd2">5. 容器 Container 和 Bean</a></li>
<li><a href="#orge862569">6. 资源 Resource</a></li>
<li><a href="#orgbdfc167">7. 面向切面编程 AOP</a></li>
<li><a href="#org32586a7">8. 事务 <code>@Transactional</code></a>
<ul>
<li><a href="#org40111b3">8.1. <code>@Transactional</code></a></li>
<li><a href="#org2c2ba64">8.2. <code>TransactionTemplate</code></a></li>
</ul>
</li>
<li><a href="#org6aba798">9. 测试</a></li>
<li><a href="#orgf06c356">10. Spring MVC</a>
<ul>
<li><a href="#orgedc049c">10.1. 简介</a></li>
<li><a href="#orgeb4c8a2">10.2. 核心组件</a></li>
<li><a href="#orgb13c59b">10.3. Servlet 配置</a></li>
<li><a href="#org148664e">10.4. 控制器</a></li>
</ul>
</li>
<li><a href="#org0cc4366">11. HTTP 请求映射</a></li>
<li><a href="#org61e872e">12. 响应函数参数和返回值</a></li>
<li><a href="#org9817e62">13. 跨越 CORS <code>@CrossOrigin</code></a></li>
<li><a href="#org4200ecc">14. MVC 配置 <code>@EnableWebMvc</code></a>
<ul>
<li><a href="#org9a8c588">14.1. 类型转换配置</a></li>
<li><a href="#org90f2dd9">14.2. 静态资源配置</a></li>
</ul>
</li>
<li><a href="#orga3c133e">15. 异步请求</a>
<ul>
<li><a href="#org02985da">15.1. DeferredResult</a></li>
<li><a href="#org54483e5">15.2. Callable</a></li>
</ul>
</li>
<li><a href="#org816bdd2">16. 远端过程调用</a></li>
<li><a href="#org2830ba9">17. 客户端请求 RestTemplate</a>
<ul>
<li><a href="#orgae8557f">17.1. 初始化</a></li>
<li><a href="#orga2d3772">17.2. UriComponents 构造 URI 对象</a></li>
<li><a href="#org0ff543a">17.3. URI 编码</a></li>
<li><a href="#org998021a">17.4. URI</a></li>
<li><a href="#org9a37237">17.5. 请求头</a></li>
<li><a href="#org3b44e2a">17.6. 请求体</a></li>
<li><a href="#org5c8456a">17.7. Jackson JSON</a></li>
<li><a href="#org3379e1a">17.8. Multipart</a></li>
</ul>
</li>
<li><a href="#org277f4d9">18. 发送邮件 Email</a></li>
<li><a href="#org83dfbd3">19. 执行任务和任务调度</a></li>
<li><a href="#org3ac94fb">20. 缓存 Cache</a>
<ul>
<li><a href="#orga523177">20.1. 开启缓存</a></li>
<li><a href="#orgd93a273">20.2. <code>@Cacheable</code></a></li>
<li><a href="#orgaf3d32a">20.3. 其它注解</a></li>
</ul>
</li>
<li><a href="#orgcbfbca4">21. 参考链接</a></li>
</ul>
</div>
</div>


<div id="outline-container-org5974a48" class="outline-2">
<h2 id="org5974a48"><span class="section-number-2">1</span> 简介</h2>
<div class="outline-text-2" id="text-1">
<p>
<a href="https://spring.io/projects/spring-framework">Spring Framework</a> 是一个开源框架，是为了解决企业应用程序开发复杂性而创建的。框
架的主要优势之一就是其分层架构，分层架构允许您选择使用哪一个组件，同时为 J2EE
应用程序开发提供集成的框架。
</p>


<div class="figure">
<p><img src="../static/image/2019/07/spring-projects.png" alt="spring-projects.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org0d7d9bc" class="outline-2">
<h2 id="org0d7d9bc"><span class="section-number-2">2</span> Spring 的技术点和优点</h2>
<div class="outline-text-2" id="text-2">
<p>
作为 Java Web 开发的龙头老大， Spring 的优点是不需要打广告了，Spring
Framework 官网上给出了一下技术要点
</p>

<ol class="org-ol">
<li>核心技术：依赖注入，事件，资源，i18n，验证，数据绑定，类型转换，SpEL，AOP</li>
<li>测试：模拟对象，TestContext 框架，Spring MVC 测试，WebTestClient</li>
<li>数据访问：事务，DAO 支持，JDBC，ORM，编组 XML</li>
<li><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc">Spring MVC</a> 和 SpringWebFlux Web 框架</li>
<li>整合：远程处理，JMS，JCA，JMX，电子邮件，任务，调度，缓存</li>
<li>语言：Kotlin，Groovy，动态语言</li>
</ol>

<div class="figure">
<p><img src="../static/image/2019/08/springmvc-documentation.png" alt="springmvc-documentation.png" />
</p>
</div>

<p>
Spring 的技术点很多，被很多人在工作中应用。这显然是离不开 Spring 团队优秀的设
计，以下是 Spring Framework 的几个比较突出的优点：
</p>
<ol class="org-ol">
<li>轻量级：Spring 在大小和透明性方面绝对属于轻量级的，基础版本的 Spring 框架
大约只有 2MB</li>
<li>控制反转(IoC)：Spring 使用控制反转技术实现了松耦合。依赖被注入到对象，而不
是创建或寻找依赖对象</li>
<li>面向切面编程(AOP)： Spring 支持面向切面编程，同时把应用的业务逻辑与系统的
服务分离开来</li>
<li>容器：Spring 包含并管理应用程序对象的配置及生命周期</li>
<li>MVC 框架：Spring 的 Web 框架是一个设计优良的 Web MVC 框架，很好的取代了一
些 Web 框架</li>
<li>事务管理：Spring 对下至本地业务上至全局业务(JAT)提供了统一的事务管理接口</li>
<li>异常处理：Spring 提供一个方便的 API 将特定技术的异常(由 JDBC, Hibernate,或
JDO 抛出)转化为一致的、Unchecked 异常</li>
</ol>
</div>
</div>

<div id="outline-container-orgb53264f" class="outline-2">
<h2 id="orgb53264f"><span class="section-number-2">3</span> IoC (Inversion of Control)</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>IoC 也被称为 DI (dependency injection)，是实现 bean 的依赖关系，即在初始化
一个 IoC 容器时，先将其依赖的容器一并初始化，并注入的新的容器中。</li>
<li>IoC 的好处是可以自动管理 Java 类的示例，提升开发速度</li>
<li>Spring 管类的实例叫 Bean，Spring 提供了一系列方法来管理 Bean，其中包括：
<ul class="org-ul">
<li>BeanFactory Bean 的工厂，ApplicationContext 应用运行的上下文。注意：
ApplicationContext 和 BeanFactory 都能实例化 Bean，但是一般尽量使用
ApplicationContext，因为 ApplicationContext 还额外提供了一些其他功能，如：
继承生命周期管理，BeanPostProcessor 自动注册，BeanFactoryPostProcessor 等</li>
<li>还有一些 XML 配置类的解析，XML 配置相当于 Spring 构建 Bean 的蓝图，早期
Spring 都用 XML 来配置类，但是由于太复杂，现在已经被 Java 的注解所代替</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org020ce77" class="outline-2">
<h2 id="org020ce77"><span class="section-number-2">4</span> 创建 Spring 项目</h2>
<div class="outline-text-2" id="text-4">
<p>
创建一个 Maven 项目项目工程
</p>
<div class="org-src-container">
<pre class="src src-sh">mvn archetype:generate <span style="color: #2aa198;">\</span>
    -DarchetypeArtifactId=maven-archetype-quickstart <span style="color: #2aa198;">\</span>
    -DinteractiveMode=false -DgroupId=io.github.jeanhwea -DartifactId=mapp
</pre>
</div>

<p>
添加 <code>spring-context</code> 的项目依赖到 <code>pom.xml</code> 文件中
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #b58900;">dependency</span>&gt;
  &lt;<span style="color: #b58900;">groupId</span>&gt;org.springframework&lt;/<span style="color: #b58900;">groupId</span>&gt;
  &lt;<span style="color: #b58900;">artifactId</span>&gt;spring-context&lt;/<span style="color: #b58900;">artifactId</span>&gt;
  &lt;<span style="color: #b58900;">version</span>&gt;5.2.4.RELEASE&lt;/<span style="color: #b58900;">version</span>&gt;
&lt;/<span style="color: #b58900;">dependency</span>&gt;
</pre>
</div>

<p>
使用命令行的方式运行主类
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">mvn</span> <span style="color: #6c71c4;">exec</span>:java -Dexec.mainClass=<span style="color: #2aa198;">"io.github.jeanhwea.App"</span> -Dexec.classpathScope=runtime
</pre>
</div>
</div>
</div>

<div id="outline-container-org67d6cd2" class="outline-2">
<h2 id="org67d6cd2"><span class="section-number-2">5</span> 容器 Container 和 Bean</h2>
<div class="outline-text-2" id="text-5">
<p>
Spring Framework 提供了管理 Bean 的接口 ApplicationContext，也就是说 Bean 的
初始化都是在 ApplicationContext 的实现中处理的，比如：
ClassPathXmlApplicationContext 和 FileSystemXmlApplicationContext 都对
ApplicationContext 进行实现，这些 ApplicationContext 是装在 Bean 的，所以被称
为容器。
</p>

<p>
Bean 其实是一种 Java 的对象，在 Spring 中，Bean 除了普通定义的 Java 代码以外，
还需要一些其他的元信息，例如：定义的 XML，或者 <code>@Component</code> 注解。所以 Spring
中的对象和普通 Java 对象是不一样的，为了体现 Spring 的高贵性，就将 Spring 中
的对象称为 Bean。Bean 的 XML 配置非常恶心且繁琐，不需要记的，用的时候去<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/core.html#beans-basics">官网</a>上
查就行。
</p>

<p>
关于 Bean 的使用需要掌握以下几个要点
</p>
<ul class="org-ul">
<li>Bean Class, Name, Alias, Constructor arguments, Properties</li>
<li>Bean Scope: singlenton, prototype, request, session, application,
websocket</li>
<li>Reference: <code>ref</code> / <code>refid</code></li>
<li>Collections <code>&lt;list/&gt;</code>, <code>&lt;set/&gt;</code>, <code>&lt;map/&gt;</code></li>
<li>Autowiring: <code>no</code>, <code>byName</code>, <code>byType</code>, constructor</li>
<li><code>*Aware</code> Interfaces: ApplicationContextAware, ResourceLoaderAware,
BeanFactoryAware</li>
<li>Bean Definition Inheritance: <code>&lt;parent/&gt;</code></li>
<li>Lazy initialization mode</li>
<li>Initialization method</li>
<li>Initialization/Destruction method</li>
<li>Annotation: <code>@Required</code>, <code>@Autowired</code></li>
</ul>
</div>
</div>

<div id="outline-container-orge862569" class="outline-2">
<h2 id="orge862569"><span class="section-number-2">6</span> 资源 Resource</h2>
<div class="outline-text-2" id="text-6">
<p>
Spring 秉承着一切皆资源，将可以被访问的东西都囊括在 Resource 接口中。并提供了
以下一些实现，用户可以直接通过 URL 来获取: <code>classpath:config.xml</code>,
<code>file:///data/config.xml</code>, <code>http://myservice/logo.png</code>, <code>/path/to/file.txt</code>
</p>
<ul class="org-ul">
<li>UrlResource</li>
<li>ClassPathResource</li>
<li>FileSystemResource</li>
<li>ServletContextResource</li>
<li>InputStreamResource</li>
<li>ByteArrayResource</li>
</ul>
</div>
</div>

<div id="outline-container-orgbdfc167" class="outline-2">
<h2 id="orgbdfc167"><span class="section-number-2">7</span> 面向切面编程 AOP</h2>
<div class="outline-text-2" id="text-7">
<p>
AOP 框架创建的对象，代理就是目标对象的加强。Spring 中的 AOP 代理可以使 JDK 动态代理，
也可以是 CGLIB 代理，前者基于接口，后者基于子类。
</p>
<ul class="org-ul">
<li>Aspect 通常是一个类，里面可以定义切入点和通知</li>
<li>Join Point 程序执行过程中明确的点，一般是方法的调用</li>
<li>Advice 在特定的切入点上执行的增强处理</li>
<li>Pointcut 带有通知的连接点，在程序中主要体现为书写切入点表达式</li>
</ul>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #859900;">package</span> com.xyz.<span style="color: #268bd2;">someapp</span>;

<span style="color: #859900;">import</span> <span style="color: #268bd2;">org</span>.<span style="color: #268bd2;">aspectj</span>.<span style="color: #268bd2;">lang</span>.<span style="color: #268bd2;">annotation</span>.<span style="color: #268bd2;">Aspect</span>;
<span style="color: #859900;">import</span> <span style="color: #268bd2;">org</span>.<span style="color: #268bd2;">aspectj</span>.<span style="color: #268bd2;">lang</span>.<span style="color: #268bd2;">annotation</span>.<span style="color: #268bd2;">Pointcut</span>;

<span style="color: #268bd2;">@Aspect</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">SystemArchitecture</span> <span style="color: #8d5649;">{</span>

    /
     * A join point is in the web layer <span style="color: #859900;">if</span> the method is defined
     * in a type in the com.xyz.someapp.web <span style="color: #859900;">package</span> <span style="color: #268bd2;">or</span> any sub-<span style="color: #859900;">package</span>
     * under that.
     /
    <span style="color: #268bd2;">@Pointcut</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"within(com.xyz.someapp.web..)"</span><span style="color: #d8241f;">)</span>
    <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> inWebLayer<span style="color: #d8241f;">()</span> <span style="color: #d8241f;">{}</span>

    /
     * A join point is in the service layer <span style="color: #859900;">if</span> the method is defined
     * in a type in the com.xyz.someapp.service <span style="color: #859900;">package</span> <span style="color: #268bd2;">or</span> any sub-<span style="color: #859900;">package</span>
     * under that.
     /
    <span style="color: #268bd2;">@Pointcut</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"within(com.xyz.someapp.service..)"</span><span style="color: #d8241f;">)</span>
    <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> inServiceLayer<span style="color: #d8241f;">()</span> <span style="color: #d8241f;">{}</span>

    /
     * A join point is in the data access layer <span style="color: #859900;">if</span> the method is defined
     * in a type in the com.xyz.someapp.dao <span style="color: #859900;">package</span> <span style="color: #268bd2;">or</span> any sub-<span style="color: #859900;">package</span>
     * under that.
     /
    <span style="color: #268bd2;">@Pointcut</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"within(com.xyz.someapp.dao..)"</span><span style="color: #d8241f;">)</span>
    <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> inDataAccessLayer<span style="color: #d8241f;">()</span> <span style="color: #d8241f;">{}</span>

    /
     * A business service is the execution of any method defined on a service
     * <span style="color: #859900;">interface</span>. This definition assumes that interfaces are placed in the
     * <span style="color: #2aa198;">"service"</span> <span style="color: #859900;">package</span>, and that implementation types are <span style="color: #268bd2;">in</span> <span style="color: #b58900;">sub</span>-<span style="color: #268bd2;">packages</span>.
     *
     * If you group service interfaces by functional area <span style="color: #d8241f;">(</span><span style="color: #859900;">for</span> example,
     * in packages com.xyz.someapp.abc.service and com.xyz.someapp.def.service<span style="color: #d8241f;">)</span> then
     * the pointcut expression <span style="color: #2aa198;">"execution(* com.xyz.someapp..service..(..))"</span>
     * could be used <span style="color: #268bd2;">instead</span>.
     *
     * Alternatively, you can write the expression <span style="color: #268bd2;">using</span> <span style="color: #6c71c4;">the</span> <span style="color: #dc322f; font-weight: bold;">'</span>bean<span style="color: #dc322f; font-weight: bold;">'</span>
     * PCD, <span style="color: #268bd2;">like</span> <span style="color: #b58900;">so</span> <span style="color: #2aa198;">"bean(Service)"</span>. <span style="color: #d8241f;">(</span>This assumes that <span style="color: #268bd2;">you</span> <span style="color: #6c71c4;">have</span>
     * named your Spring service beans in a consistent fashion.<span style="color: #d8241f;">)</span>
     */
    <span style="color: #268bd2;">@Pointcut</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"execution( com.xyz.someapp..service..(..))"</span><span style="color: #d8241f;">)</span>
    <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> businessService<span style="color: #d8241f;">()</span> <span style="color: #d8241f;">{}</span>

    <span style="color: #93a1a1; font-style: italic;">/*</span>
<span style="color: #93a1a1; font-style: italic;">     * A data access operation is the execution of any method defined on a</span>
<span style="color: #93a1a1; font-style: italic;">     * dao interface. This definition assumes that interfaces are placed in the</span>
<span style="color: #93a1a1; font-style: italic;">     * "dao" package, and that implementation types are in sub-packages.</span>
<span style="color: #93a1a1; font-style: italic;">     */</span>
    <span style="color: #268bd2;">@Pointcut</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"execution( com.xyz.someapp.dao..(..))"</span><span style="color: #d8241f;">)</span>
    <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">dataAccessOperation</span><span style="color: #d8241f;">()</span> <span style="color: #d8241f;">{}</span>

<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org32586a7" class="outline-2">
<h2 id="org32586a7"><span class="section-number-2">8</span> 事务 <code>@Transactional</code></h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-org40111b3" class="outline-3">
<h3 id="org40111b3"><span class="section-number-3">8.1</span> <code>@Transactional</code></h3>
<div class="outline-text-3" id="text-8-1">
<p>
事务不仅仅是 Spring 特有的特性，在数据库并发中普遍存在，具体事务的特性我在
<a href="../database/oracle.html">Oracle</a> 中事务一节中有详细地讨论，这里着重记录 Spring 中 <code>@Transactional</code> 标注的使
用
</p>

<p>
在 Spring 中，事务使用操作的相关讨论出现在 <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html">Data Access</a> 一节中，
<code>@Transactional</code> 开启一个事务，例如下面的 FooService 开启了事务管理，虽然
Spring 也支持 XML 方式配置事务，但是比较麻烦，尽量避免使用
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@Transactional</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">DefaultFooService</span> <span style="color: #859900;">implements</span> <span style="color: #268bd2;">FooService</span> <span style="color: #8d5649;">{</span>

  <span style="color: #268bd2;">Foo</span> <span style="color: #b58900;">getFoo</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">fooName</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>
  <span style="color: #268bd2;">Foo</span> <span style="color: #b58900;">getFoo</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">fooName</span>, <span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">barName</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>
  <span style="color: #268bd2;">void</span> <span style="color: #b58900;">insertFoo</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">Foo</span> <span style="color: #6c71c4;">foo</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>
  <span style="color: #268bd2;">void</span> <span style="color: #b58900;">updateFoo</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">Foo</span> <span style="color: #6c71c4;">foo</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>

<span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
事务显然有很多属性可以配置，例如：是否只读，是否传播，隔离级别，超时的时长，
以及为何中异常回滚，因为属性多，所以需移步官网文档 <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#transaction-declarative-attransactional-settings">Transactional Settings</a>
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@Transactional</span><span style="color: #8d5649;">(</span>readOnly = <span style="color: #268bd2;">true</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">DefaultFooService</span> <span style="color: #859900;">implements</span> <span style="color: #268bd2;">FooService</span> <span style="color: #8d5649;">{</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">Foo</span> <span style="color: #b58900;">getFoo</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">fooName</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>

  <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">these settings have precedence for this method</span>
  <span style="color: #268bd2;">@Transactional</span><span style="color: #d8241f;">(</span>readOnly = <span style="color: #268bd2;">false</span>, propagation = <span style="color: #268bd2;">Propagation</span>.REQUIRES_NEW<span style="color: #d8241f;">)</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">updateFoo</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">Foo</span> <span style="color: #6c71c4;">foo</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
在 Spring 中，事务包含一个传播方式，大体上有如下几种：
</p>
<ul class="org-ul">
<li><code>PROPAGATION_REQUIRED</code> 所有方法串在一个事务中执行</li>
<li><code>PROPAGATION_REQUIRES_NEW</code> 每次进入子方法时，新开一个事务</li>
<li><code>PROPAGATION_NESTED</code> 所有方法串在一个事务中，但是进入子方法时记录保存点
(Save Point)</li>
</ul>

<p>
Spring 也支持多事务管理员角色的注解，使用方法参考下面例子
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">TransactionalService</span> <span style="color: #8d5649;">{</span>

  <span style="color: #268bd2;">@Transactional</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"order"</span><span style="color: #d8241f;">)</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">setSomething</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">name</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>

  <span style="color: #268bd2;">@Transactional</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"account"</span><span style="color: #d8241f;">)</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">doSomething</span><span style="color: #d8241f;">()</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
也可以自己定制的方式定义属于业务逻辑的事务管理注解，参考如下的例子
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@Target</span><span style="color: #8d5649;">(</span><span style="color: #d8241f;">{</span><span style="color: #268bd2;">ElementType</span>.METHOD, <span style="color: #268bd2;">ElementType</span>.TYPE<span style="color: #d8241f;">}</span><span style="color: #8d5649;">)</span>
<span style="color: #268bd2;">@Retention</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">RetentionPolicy</span>.<span style="color: #268bd2;">RUNTIME</span><span style="color: #8d5649;">)</span>
<span style="color: #268bd2;">@Transactional</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"order"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">@interface</span> <span style="color: #268bd2;">OrderTx</span> <span style="color: #8d5649;">{</span>
<span style="color: #8d5649;">}</span>

<span style="color: #268bd2;">@Target</span><span style="color: #8d5649;">(</span><span style="color: #d8241f;">{</span><span style="color: #268bd2;">ElementType</span>.METHOD, <span style="color: #268bd2;">ElementType</span>.TYPE<span style="color: #d8241f;">}</span><span style="color: #8d5649;">)</span>
<span style="color: #268bd2;">@Retention</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">RetentionPolicy</span>.<span style="color: #268bd2;">RUNTIME</span><span style="color: #8d5649;">)</span>
<span style="color: #268bd2;">@Transactional</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"account"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">@interface</span> <span style="color: #268bd2;">AccountTx</span> <span style="color: #8d5649;">{</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">TransactionalService</span> <span style="color: #8d5649;">{</span>
  <span style="color: #268bd2;">@OrderTx</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">setSomething</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">name</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>
  <span style="color: #268bd2;">@AccountTx</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">doSomething</span><span style="color: #d8241f;">()</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2c2ba64" class="outline-3">
<h3 id="org2c2ba64"><span class="section-number-3">8.2</span> <code>TransactionTemplate</code></h3>
<div class="outline-text-3" id="text-8-2">
<p>
Spring 实现了 TransactionTemplate 模版类，也可以很方便的操纵事务相关的业务
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">SimpleService</span> <span style="color: #859900;">implements</span> <span style="color: #268bd2;">Service</span> <span style="color: #8d5649;">{</span>

  <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">single TransactionTemplate shared amongst all methods in this instance</span>
  <span style="color: #859900;">private</span> <span style="color: #859900;">final</span> <span style="color: #268bd2;">TransactionTemplate</span> <span style="color: #6c71c4;">transactionTemplate</span>;

  <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">use constructor-injection to supply the PlatformTransactionManager</span>
  <span style="color: #859900;">public</span> <span style="color: #b58900;">SimpleService</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">PlatformTransactionManager</span> <span style="color: #6c71c4;">transactionManager</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span>
    <span style="color: #859900;">this</span>.transactionTemplate = <span style="color: #859900;">new</span> <span style="color: #268bd2;">TransactionTemplate</span><span style="color: #9564bf;">(</span>transactionManager<span style="color: #9564bf;">)</span>;
  <span style="color: #d8241f;">}</span>

  <span style="color: #859900;">public</span> <span style="color: #268bd2;">Object</span> <span style="color: #b58900;">someServiceMethod</span><span style="color: #d8241f;">()</span> <span style="color: #d8241f;">{</span>
    <span style="color: #859900;">return</span> transactionTemplate.execute<span style="color: #9564bf;">(</span><span style="color: #859900;">new</span> <span style="color: #268bd2;">TransactionCallback</span><span style="color: #24a222;">()</span> <span style="color: #24a222;">{</span>
        <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">the code in this method executes in a transactional context</span>
        <span style="color: #859900;">public</span> <span style="color: #268bd2;">Object</span> <span style="color: #b58900;">doInTransaction</span><span style="color: #ff7f00;">(</span><span style="color: #268bd2;">TransactionStatus</span> <span style="color: #6c71c4;">status</span><span style="color: #ff7f00;">)</span> <span style="color: #ff7f00;">{</span>
          updateOperation1<span style="color: #1776b6;">()</span>;
          <span style="color: #859900;">return</span> resultOfUpdateOperation2<span style="color: #1776b6;">()</span>;
        <span style="color: #ff7f00;">}</span>
      <span style="color: #24a222;">}</span><span style="color: #9564bf;">)</span>;
  <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6aba798" class="outline-2">
<h2 id="org6aba798"><span class="section-number-2">9</span> 测试</h2>
<div class="outline-text-2" id="text-9">
<p>
Spring 框架的一个特色就是提供测试 <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/testing.html">Spring Testing</a> 的功能，对于日常工作测试，主
要了解 <code>@Transactional</code>, <code>@Rollback</code> 以及 <code>@Commit</code> 这样三个注解功能。Spring
测试时默认开启事务，如果测试中修改或删除了数据，在测试后要求修改回来。
</p>
</div>
</div>
<div id="outline-container-orgf06c356" class="outline-2">
<h2 id="orgf06c356"><span class="section-number-2">10</span> Spring MVC</h2>
<div class="outline-text-2" id="text-10">
</div>
<div id="outline-container-orgedc049c" class="outline-3">
<h3 id="orgedc049c"><span class="section-number-3">10.1</span> 简介</h3>
<div class="outline-text-3" id="text-10-1">
<p>
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc">Spring MVC</a> 是 Spring Web MVC 通用叫法，由于 <code>spring-webmvc</code> 包的缘故，之前才被
称为 Spring Web MVC。 他提供了开发 MVC 页面的框架，它期初是建立在 Servlet API 基
础上。 我一般讲 Spring MVC 项目组织成如下结构：
</p>


<div class="figure">
<p><img src="../static/image/2019/07/spring-mvc-module.png" alt="spring-mvc-module.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgeb4c8a2" class="outline-3">
<h3 id="orgeb4c8a2"><span class="section-number-3">10.2</span> 核心组件</h3>
<div class="outline-text-3" id="text-10-2">
<p>
Spring MVC 是对通用 Servlet 的一个代理，其实现的 DispatcherServlet 提供对请
求预处理的共享算法。WebApplicationContext 是 ApplicationContext 的子类，他除
了继承 Spring 的 IoC 功能以外，提供了许多对 Web 操作的功能。
</p>
</div>
</div>

<div id="outline-container-orgb13c59b" class="outline-3">
<h3 id="orgb13c59b"><span class="section-number-3">10.3</span> Servlet 配置</h3>
<div class="outline-text-3" id="text-10-3">
<p>
Spring MVC 提供了配置 Servlet 的方法。实现 WebApplicationinitializer 接口的
类都可以在 Web 应用程序启动时被加载。具体操作如下：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #859900;">import</span> <span style="color: #268bd2;">org</span>.<span style="color: #268bd2;">springframework</span>.<span style="color: #268bd2;">web</span>.<span style="color: #268bd2;">WebApplicationInitializer</span>;
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">MyWebApplicationInitializer</span> <span style="color: #859900;">implements</span> <span style="color: #268bd2;">WebApplicationInitializer</span> <span style="color: #8d5649;">{</span>
  <span style="color: #268bd2;">@Override</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">onStartup</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">ServletContext</span> <span style="color: #6c71c4;">container</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span>
    <span style="color: #268bd2;">XmlWebApplicationContext</span> <span style="color: #6c71c4;">appContext</span> = <span style="color: #859900;">new</span> <span style="color: #268bd2;">XmlWebApplicationContext</span><span style="color: #9564bf;">()</span>;
    appContext.setConfigLocation<span style="color: #9564bf;">(</span><span style="color: #2aa198;">"/WEB-INF/spring/dispatcher-config.xml"</span><span style="color: #9564bf;">)</span>;

    <span style="color: #268bd2;">ServletRegistration</span>.<span style="color: #268bd2;">Dynamic</span> <span style="color: #6c71c4;">registration</span> =
      container.addServlet<span style="color: #9564bf;">(</span><span style="color: #2aa198;">"dispatcher"</span>, <span style="color: #859900;">new</span> <span style="color: #268bd2;">DispatcherServlet</span><span style="color: #24a222;">(</span>appContext<span style="color: #24a222;">)</span><span style="color: #9564bf;">)</span>;
    registration.setLoadOnStartup<span style="color: #9564bf;">(</span>1<span style="color: #9564bf;">)</span>;
    registration.addMapping<span style="color: #9564bf;">(</span><span style="color: #2aa198;">"/"</span><span style="color: #9564bf;">)</span>;
  <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org148664e" class="outline-3">
<h3 id="org148664e"><span class="section-number-3">10.4</span> 控制器</h3>
<div class="outline-text-3" id="text-10-4">
<p>
Spring MVC 默认使用 <code>@Controller</code> 来表示控制器，如果后台开发的大部分返回
Json 的话，我们可以使用 <code>@RestController</code> 来注解，他相当于 <code>@Controller</code> 和
<code>@ResponseBody</code> 这两个的组合。
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@Controller</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">HelloController</span> <span style="color: #8d5649;">{</span>

  <span style="color: #268bd2;">@GetMapping</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"/hello"</span><span style="color: #d8241f;">)</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">String</span> <span style="color: #b58900;">handle</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">Model</span> <span style="color: #6c71c4;">model</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span>
    model.addAttribute<span style="color: #9564bf;">(</span><span style="color: #2aa198;">"message"</span>, <span style="color: #2aa198;">"Hello World!"</span><span style="color: #9564bf;">)</span>;
    <span style="color: #859900;">return</span> <span style="color: #2aa198;">"index"</span>;
  <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0cc4366" class="outline-2">
<h2 id="org0cc4366"><span class="section-number-2">11</span> HTTP 请求映射</h2>
<div class="outline-text-2" id="text-11">
<p>
通常，可以通过二级路由的方法管理控制器类，详见如下例子：
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@RestController</span>
<span style="color: #268bd2;">@RequestMapping</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/persons"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">class</span> <span style="color: #268bd2;">PersonController</span> <span style="color: #8d5649;">{</span>

  <span style="color: #268bd2;">@GetMapping</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"/{id}"</span><span style="color: #d8241f;">)</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">Person</span> <span style="color: #b58900;">getPerson</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">@PathVariable</span> <span style="color: #268bd2;">Long</span> <span style="color: #6c71c4;">id</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>

  <span style="color: #268bd2;">@PostMapping</span>
  <span style="color: #268bd2;">@ResponseStatus</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">HttpStatus</span>.<span style="color: #268bd2;">CREATED</span><span style="color: #d8241f;">)</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">add</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">@RequestBody</span> <span style="color: #268bd2;">Person</span> <span style="color: #6c71c4;">person</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>

<span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
路径参数中包含如下三种通配符：
</p>
<ul class="org-ul">
<li><code>?</code> 匹配一个字符</li>
<li><code>*</code> 匹配零个或多个路径中的字符</li>
<li><code>**</code> 匹配零个或多个路径</li>
</ul>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@GetMapping</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/owners/{ownerId}/pets/{petId}"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">Pet</span> <span style="color: #b58900;">findPet</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">@PathVariable</span> <span style="color: #268bd2;">Long</span> <span style="color: #6c71c4;">ownerId</span>, <span style="color: #268bd2;">@PathVariable</span> <span style="color: #268bd2;">Long</span> <span style="color: #6c71c4;">petId</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #8d5649;">}</span>

<span style="color: #268bd2;">@GetMapping</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/pets/{petId}"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">Pet</span> <span style="color: #b58900;">findPet</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">@PathVariable</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"petId"</span><span style="color: #d8241f;">)</span> <span style="color: #268bd2;">id</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #8d5649;">}</span>

<span style="color: #268bd2;">@GetMapping</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/{name:[a-z-]+}-{version:\\d\\.\\d\\.\\d}{ext:\\.[a-z]+}"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">handle</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">@PathVariable</span> <span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">version</span>, <span style="color: #268bd2;">@PathVariable</span> <span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">ext</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #8d5649;">}</span>

<span style="color: #268bd2;">@GetMapping</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/pets/{petId}"</span><span style="color: #8d5649;">)</span>
<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">same as</span>
<span style="color: #268bd2;">@RequestMapping</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/pets/{petId}"</span>, method=<span style="color: #268bd2;">HttpMethod</span>.GET<span style="color: #8d5649;">)</span>
</pre>
</div>

<p>
匹配 Content-Type 字段的值，将控制器局限到对应的类型的文件处理
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@PostMapping</span><span style="color: #8d5649;">(</span>path = <span style="color: #2aa198;">"/pets"</span>, consumes = <span style="color: #2aa198;">"application/json"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">addPet</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">@RequestBody</span> <span style="color: #268bd2;">Pet</span> <span style="color: #6c71c4;">pet</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #8d5649;">}</span>

<span style="color: #268bd2;">@PostMapping</span><span style="color: #8d5649;">(</span>path = <span style="color: #2aa198;">"/pets"</span>, consumes = <span style="color: #2aa198;">"!text/plain"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">addPet</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">@RequestBody</span> <span style="color: #268bd2;">Pet</span> <span style="color: #6c71c4;">pet</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
返回多媒体类型的流，参考 Accept 请求头
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@GetMapping</span><span style="color: #8d5649;">(</span>path = <span style="color: #2aa198;">"/pets/{petId}"</span>, produces = <span style="color: #2aa198;">"application/json"</span><span style="color: #8d5649;">)</span>
<span style="color: #268bd2;">@ResponseBody</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">Pet</span> <span style="color: #b58900;">getPet</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">@PathVariable</span> <span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">petId</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
根据请求的添加来部分匹配
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@GetMapping</span><span style="color: #8d5649;">(</span>path = <span style="color: #2aa198;">"/pets/{petId}"</span>, params = <span style="color: #2aa198;">"myParam=myValue"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">findPet</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">@PathVariable</span> <span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">petId</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #8d5649;">}</span>

<span style="color: #268bd2;">@GetMapping</span><span style="color: #8d5649;">(</span>path = <span style="color: #2aa198;">"/pets"</span>, headers = <span style="color: #2aa198;">"myHeader=myValue"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">findPet</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">@PathVariable</span> <span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">petId</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span><span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
还可以通过以下的方式来动态注册请求 URL 到处理方法
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@Configuration</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">MyConfig</span> <span style="color: #8d5649;">{</span>

  <span style="color: #268bd2;">@Autowired</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">setHandlerMapping</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">RequestMappingHandlerMapping</span> <span style="color: #6c71c4;">mapping</span>, <span style="color: #268bd2;">UserHandler</span> <span style="color: #6c71c4;">handler</span><span style="color: #d8241f;">)</span>
    <span style="color: #859900;">throws</span> <span style="color: #268bd2;">NoSuchMethodException</span> <span style="color: #d8241f;">{</span>

    <span style="color: #268bd2;">RequestMappingInfo</span> <span style="color: #6c71c4;">info</span> = RequestMappingInfo
      .paths<span style="color: #9564bf;">(</span><span style="color: #2aa198;">"/user/{id}"</span><span style="color: #9564bf;">)</span>.methods<span style="color: #9564bf;">(</span><span style="color: #268bd2;">RequestMethod</span>.GET<span style="color: #9564bf;">)</span>.build<span style="color: #9564bf;">()</span>;

    <span style="color: #268bd2;">Method</span> <span style="color: #6c71c4;">method</span> = UserHandler.<span style="color: #859900;">class</span>.getMethod<span style="color: #9564bf;">(</span><span style="color: #2aa198;">"getUser"</span>, Long.<span style="color: #859900;">class</span><span style="color: #9564bf;">)</span>;

    mapping.registerMapping<span style="color: #9564bf;">(</span>info, handler, method<span style="color: #9564bf;">)</span>;
  <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org61e872e" class="outline-2">
<h2 id="org61e872e"><span class="section-number-2">12</span> 响应函数参数和返回值</h2>
<div class="outline-text-2" id="text-12">
<p>
<a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html#mvc-ann-methods">Method Handler</a> 包括方法参数和返回值注解。其中请求的方法输入参数包括：
常用注解 <code>@RequestParam</code>, <code>@RequestHeader</code>, <code>@RequestBody</code> 。还包括一些类
<code>javax.servlet.ServletRequest</code>, <code>javax.servlet.ServletResponse</code>, <code>HttpMethod</code>
</p>

<p>
返回值也支持好多种注解已经类，列表等： <code>@ResponseBody</code>, <code>HttpEntity&lt;B&gt;</code>
</p>

<p>
矩阵变量
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">GET /pets/42;q=11;r=22</span>
<span style="color: #268bd2;">@GetMapping</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/pets/{petId}"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">findPet</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">@PathVariable</span> <span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">petId</span>, <span style="color: #268bd2;">@MatrixVariable</span> <span style="color: #268bd2;">int</span> <span style="color: #6c71c4;">q</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span>
  <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">petId == 42</span>
  <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">q == 11</span>
<span style="color: #8d5649;">}</span>

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">GET /owners/42;q=11/pets/21;q=22</span>
<span style="color: #268bd2;">@GetMapping</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/owners/{ownerId}/pets/{petId}"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">findPet</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">@MatrixVariable</span><span style="color: #d8241f;">(</span>name=<span style="color: #2aa198;">"q"</span>, pathVar=<span style="color: #2aa198;">"ownerId"</span><span style="color: #d8241f;">)</span> <span style="color: #268bd2;">int</span> <span style="color: #6c71c4;">q1</span>,
               <span style="color: #268bd2;">@MatrixVariable</span><span style="color: #d8241f;">(</span>name=<span style="color: #2aa198;">"q"</span>, pathVar=<span style="color: #2aa198;">"petId"</span><span style="color: #d8241f;">)</span> <span style="color: #268bd2;">int</span> <span style="color: #6c71c4;">q2</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span>
  <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">q1 == 11</span>
  <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">q2 == 22</span>
<span style="color: #8d5649;">}</span>

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">GET /pets/42</span>
<span style="color: #268bd2;">@GetMapping</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/pets/{petId}"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">findPet</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">@MatrixVariable</span><span style="color: #d8241f;">(</span>required=<span style="color: #268bd2;">false</span>, defaultValue=<span style="color: #2aa198;">"1"</span><span style="color: #d8241f;">)</span> <span style="color: #268bd2;">int</span> <span style="color: #6c71c4;">q</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span>
  <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">q == 1</span>
<span style="color: #8d5649;">}</span>

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">GET /owners/42;q=11;r=12/pets/21;q=22;s=23</span>
<span style="color: #268bd2;">@GetMapping</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/owners/{ownerId}/pets/{petId}"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">findPet</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">@MatrixVariable</span> <span style="color: #268bd2;">MultiValueMap</span><span style="color: #d8241f;">&lt;</span><span style="color: #268bd2;">String</span>, <span style="color: #268bd2;">String</span><span style="color: #d8241f;">&gt;</span> <span style="color: #6c71c4;">matrixVars</span>,
               <span style="color: #268bd2;">@MatrixVariable</span><span style="color: #d8241f;">(</span>pathVar=<span style="color: #2aa198;">"petId"</span><span style="color: #d8241f;">)</span> <span style="color: #268bd2;">MultiValueMap</span><span style="color: #d8241f;">&lt;</span><span style="color: #268bd2;">String</span>, <span style="color: #268bd2;">String</span><span style="color: #d8241f;">&gt;</span> <span style="color: #6c71c4;">petMatrixVars</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span>
  <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">matrixVars: ["q" : [11,22], "r" : 12, "s" : 23]</span>
  <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">petMatrixVars: ["q" : 22, "s" : 23]</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
请求参数
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@Controller</span>
<span style="color: #268bd2;">@RequestMapping</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/pets"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">EditPetForm</span> <span style="color: #8d5649;">{</span>
  <span style="color: #268bd2;">@GetMapping</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">String</span> <span style="color: #b58900;">setupForm</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">@RequestParam</span><span style="color: #9564bf;">(</span><span style="color: #2aa198;">"petId"</span><span style="color: #9564bf;">)</span> <span style="color: #268bd2;">int</span> <span style="color: #6c71c4;">petId</span>, <span style="color: #268bd2;">Model</span> <span style="color: #6c71c4;">model</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span>
    <span style="color: #268bd2;">Pet</span> <span style="color: #6c71c4;">pet</span> = <span style="color: #859900;">this</span>.clinic.loadPet<span style="color: #9564bf;">(</span>petId<span style="color: #9564bf;">)</span>;
    model.addAttribute<span style="color: #9564bf;">(</span><span style="color: #2aa198;">"pet"</span>, pet<span style="color: #9564bf;">)</span>;
    <span style="color: #859900;">return</span> <span style="color: #2aa198;">"petForm"</span>;
  <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
请求头参数
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@GetMapping</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/demo"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">handle</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">@RequestHeader</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"Accept-Encoding"</span><span style="color: #d8241f;">)</span> <span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">encoding</span>,
              <span style="color: #268bd2;">@RequestHeader</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"Keep-Alive"</span><span style="color: #d8241f;">)</span> <span style="color: #268bd2;">long</span> <span style="color: #6c71c4;">keepAlive</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
Cookie 值
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@GetMapping</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/demo"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">handle</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">@CookieValue</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"JSESSIONID"</span><span style="color: #d8241f;">)</span> <span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">cookie</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
上传文件
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@Controller</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">FileUploadController</span> <span style="color: #8d5649;">{</span>

  <span style="color: #268bd2;">@PostMapping</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"/form"</span><span style="color: #d8241f;">)</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">String</span> <span style="color: #b58900;">handleFormUpload</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">@RequestParam</span><span style="color: #9564bf;">(</span><span style="color: #2aa198;">"name"</span><span style="color: #9564bf;">)</span> <span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">name</span>,
                            <span style="color: #268bd2;">@RequestParam</span><span style="color: #9564bf;">(</span><span style="color: #2aa198;">"file"</span><span style="color: #9564bf;">)</span> <span style="color: #268bd2;">MultipartFile</span> <span style="color: #6c71c4;">file</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span>
    <span style="color: #859900;">if</span> <span style="color: #9564bf;">(</span><span style="color: #268bd2;">!</span>file.isEmpty<span style="color: #24a222;">()</span><span style="color: #9564bf;">)</span> <span style="color: #9564bf;">{</span>
      <span style="color: #268bd2;">byte</span><span style="color: #24a222;">[]</span> <span style="color: #6c71c4;">bytes</span> = file.getBytes<span style="color: #24a222;">()</span>;
      <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">store the bytes somewhere</span>
      <span style="color: #859900;">return</span> <span style="color: #2aa198;">"redirect:uploadSuccess"</span>;
    <span style="color: #9564bf;">}</span>
    <span style="color: #859900;">return</span> <span style="color: #2aa198;">"redirect:uploadFailure"</span>;
  <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
异常处理
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@Controller</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">SimpleController</span> <span style="color: #8d5649;">{</span>
  <span style="color: #268bd2;">@ExceptionHandler</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">ResponseEntity</span><span style="color: #d8241f;">&lt;</span><span style="color: #268bd2;">String</span><span style="color: #d8241f;">&gt;</span> <span style="color: #b58900;">handle01</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">IOException</span> <span style="color: #6c71c4;">ex</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>

  <span style="color: #268bd2;">@ExceptionHandler</span><span style="color: #d8241f;">(</span><span style="color: #9564bf;">{</span>FileSystemException.<span style="color: #859900;">class</span>, RemoteException.<span style="color: #859900;">class</span><span style="color: #9564bf;">}</span><span style="color: #d8241f;">)</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">ResponseEntity</span><span style="color: #d8241f;">&lt;</span><span style="color: #268bd2;">String</span><span style="color: #d8241f;">&gt;</span> <span style="color: #b58900;">handle02</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">IOException</span> <span style="color: #6c71c4;">ex</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>

  <span style="color: #268bd2;">@ExceptionHandler</span><span style="color: #d8241f;">(</span><span style="color: #9564bf;">{</span>FileSystemException.<span style="color: #859900;">class</span>, RemoteException.<span style="color: #859900;">class</span><span style="color: #9564bf;">}</span><span style="color: #d8241f;">)</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">ResponseEntity</span><span style="color: #d8241f;">&lt;</span><span style="color: #268bd2;">String</span><span style="color: #d8241f;">&gt;</span> <span style="color: #b58900;">handle</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">Exception</span> <span style="color: #6c71c4;">ex</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
全局控制器异常处理，在 RESTFul API 设计中需要优雅的异常处理方式，Spring 建议
可以通过 <code>@ExceptionHandler</code> 和 <code>ResponseEntity</code> 来将返回消息方法返回体中，并
在 <code>@ControllerAdvice</code> 中集中处理。在定义异常实体类时，可以继承
<code>ResponseEntityExceptionHandler</code> 类。
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">Target all Controllers annotated with @RestController</span>
<span style="color: #268bd2;">@ControllerAdvice</span><span style="color: #8d5649;">(</span>annotations = RestController.<span style="color: #859900;">class</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">ExampleAdvice1</span> <span style="color: #8d5649;">{}</span>

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">Target all Controllers within specific packages</span>
<span style="color: #268bd2;">@ControllerAdvice</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"org.example.controllers"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">ExampleAdvice2</span> <span style="color: #8d5649;">{}</span>

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">Target all Controllers assignable to specific classes</span>
<span style="color: #268bd2;">@ControllerAdvice</span><span style="color: #8d5649;">(</span>assignableTypes = <span style="color: #d8241f;">{</span>ControllerInterface.<span style="color: #859900;">class</span>, AbstractController.<span style="color: #859900;">class</span><span style="color: #d8241f;">}</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">ExampleAdvice3</span> <span style="color: #8d5649;">{}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9817e62" class="outline-2">
<h2 id="org9817e62"><span class="section-number-2">13</span> 跨越 CORS <code>@CrossOrigin</code></h2>
<div class="outline-text-2" id="text-13">
<p>
<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">CORS</a> 在 MDN 中有详细的介绍，下面只展示 Spring 中如何配置 CORS。允许单个 URL 和处
理函数跨越可以直接使用 <code>@CrossOrigin</code> 来解决
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@RestController</span>
<span style="color: #268bd2;">@RequestMapping</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/account"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">AccountController</span> <span style="color: #8d5649;">{</span>

  <span style="color: #268bd2;">@CrossOrigin</span>
  <span style="color: #268bd2;">@GetMapping</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"/{id}"</span><span style="color: #d8241f;">)</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">Account</span> <span style="color: #b58900;">retrieve</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">@PathVariable</span> <span style="color: #268bd2;">Long</span> <span style="color: #6c71c4;">id</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>

  <span style="color: #268bd2;">@DeleteMapping</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"/{id}"</span><span style="color: #d8241f;">)</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">remove</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">@PathVariable</span> <span style="color: #268bd2;">Long</span> <span style="color: #6c71c4;">id</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
允许类跨域将注解写类头上
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@CrossOrigin</span><span style="color: #8d5649;">(</span>origins = <span style="color: #2aa198;">"https://domain2.com"</span>, maxAge = 3600<span style="color: #8d5649;">)</span>
<span style="color: #268bd2;">@RestController</span>
<span style="color: #268bd2;">@RequestMapping</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/account"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">AccountController</span> <span style="color: #8d5649;">{</span>

  <span style="color: #268bd2;">@GetMapping</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"/{id}"</span><span style="color: #d8241f;">)</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">Account</span> <span style="color: #b58900;">retrieve</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">@PathVariable</span> <span style="color: #268bd2;">Long</span> <span style="color: #6c71c4;">id</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>

  <span style="color: #268bd2;">@DeleteMapping</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"/{id}"</span><span style="color: #d8241f;">)</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">remove</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">@PathVariable</span> <span style="color: #268bd2;">Long</span> <span style="color: #6c71c4;">id</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
或者混合注解方法
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@CrossOrigin</span><span style="color: #8d5649;">(</span>maxAge = 3600<span style="color: #8d5649;">)</span>
<span style="color: #268bd2;">@RestController</span>
<span style="color: #268bd2;">@RequestMapping</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/account"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">AccountController</span> <span style="color: #8d5649;">{</span>

  <span style="color: #268bd2;">@CrossOrigin</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"https://domain2.com"</span><span style="color: #d8241f;">)</span>
  <span style="color: #268bd2;">@GetMapping</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"/{id}"</span><span style="color: #d8241f;">)</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">Account</span> <span style="color: #b58900;">retrieve</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">@PathVariable</span> <span style="color: #268bd2;">Long</span> <span style="color: #6c71c4;">id</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>

  <span style="color: #268bd2;">@DeleteMapping</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"/{id}"</span><span style="color: #d8241f;">)</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">remove</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">@PathVariable</span> <span style="color: #268bd2;">Long</span> <span style="color: #6c71c4;">id</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
允许全栈跨域需要实现配置类
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@Configuration</span>
<span style="color: #268bd2;">@EnableWebMvc</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">WebConfig</span> <span style="color: #859900;">implements</span> <span style="color: #268bd2;">WebMvcConfigurer</span> <span style="color: #8d5649;">{</span>

  <span style="color: #268bd2;">@Override</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">addCorsMappings</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">CorsRegistry</span> <span style="color: #6c71c4;">registry</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span>

    registry.addMapping<span style="color: #9564bf;">(</span><span style="color: #2aa198;">"/api/**"</span><span style="color: #9564bf;">)</span>
      .allowedOrigins<span style="color: #9564bf;">(</span><span style="color: #2aa198;">"https://domain2.com"</span><span style="color: #9564bf;">)</span>
      .allowedMethods<span style="color: #9564bf;">(</span><span style="color: #2aa198;">"PUT"</span>, <span style="color: #2aa198;">"DELETE"</span><span style="color: #9564bf;">)</span>
      .allowedHeaders<span style="color: #9564bf;">(</span><span style="color: #2aa198;">"header1"</span>, <span style="color: #2aa198;">"header2"</span>, <span style="color: #2aa198;">"header3"</span><span style="color: #9564bf;">)</span>
      .exposedHeaders<span style="color: #9564bf;">(</span><span style="color: #2aa198;">"header1"</span>, <span style="color: #2aa198;">"header2"</span><span style="color: #9564bf;">)</span>
      .allowCredentials<span style="color: #9564bf;">(</span><span style="color: #268bd2;">true</span><span style="color: #9564bf;">)</span>.maxAge<span style="color: #9564bf;">(</span>3600<span style="color: #9564bf;">)</span>;

    <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">Add more mappings...</span>
  <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4200ecc" class="outline-2">
<h2 id="org4200ecc"><span class="section-number-2">14</span> MVC 配置 <code>@EnableWebMvc</code></h2>
<div class="outline-text-2" id="text-14">
</div>
<div id="outline-container-org9a8c588" class="outline-3">
<h3 id="org9a8c588"><span class="section-number-3">14.1</span> 类型转换配置</h3>
<div class="outline-text-3" id="text-14-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@Configuration</span>
<span style="color: #268bd2;">@EnableWebMvc</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">WebConfig</span> <span style="color: #859900;">implements</span> <span style="color: #268bd2;">WebMvcConfigurer</span> <span style="color: #8d5649;">{</span>

  <span style="color: #268bd2;">@Override</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">addFormatters</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">FormatterRegistry</span> <span style="color: #6c71c4;">registry</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span>
    <span style="color: #268bd2;">DateTimeFormatterRegistrar</span> <span style="color: #6c71c4;">registrar</span> = <span style="color: #859900;">new</span> <span style="color: #268bd2;">DateTimeFormatterRegistrar</span><span style="color: #9564bf;">()</span>;
    registrar.setUseIsoFormat<span style="color: #9564bf;">(</span><span style="color: #268bd2;">true</span><span style="color: #9564bf;">)</span>;
    registrar.registerFormatters<span style="color: #9564bf;">(</span>registry<span style="color: #9564bf;">)</span>;
  <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org90f2dd9" class="outline-3">
<h3 id="org90f2dd9"><span class="section-number-3">14.2</span> 静态资源配置</h3>
<div class="outline-text-3" id="text-14-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@Configuration</span>
<span style="color: #268bd2;">@EnableWebMvc</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">WebConfig</span> <span style="color: #859900;">implements</span> <span style="color: #268bd2;">WebMvcConfigurer</span> <span style="color: #8d5649;">{</span>

  <span style="color: #268bd2;">@Override</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">addResourceHandlers</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">ResourceHandlerRegistry</span> <span style="color: #6c71c4;">registry</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span>
    registry.addResourceHandler<span style="color: #9564bf;">(</span><span style="color: #2aa198;">"/resources/**"</span><span style="color: #9564bf;">)</span>
      .addResourceLocations<span style="color: #9564bf;">(</span><span style="color: #2aa198;">"/public"</span>, <span style="color: #2aa198;">"classpath:/static/"</span><span style="color: #9564bf;">)</span>
      .setCachePeriod<span style="color: #9564bf;">(</span>31556926<span style="color: #9564bf;">)</span>;
  <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orga3c133e" class="outline-2">
<h2 id="orga3c133e"><span class="section-number-2">15</span> 异步请求</h2>
<div class="outline-text-2" id="text-15">
</div>
<div id="outline-container-org02985da" class="outline-3">
<h3 id="org02985da"><span class="section-number-3">15.1</span> DeferredResult</h3>
<div class="outline-text-3" id="text-15-1">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@GetMapping</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/quotes"</span><span style="color: #8d5649;">)</span>
<span style="color: #268bd2;">@ResponseBody</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">DeferredResult</span><span style="color: #8d5649;">&lt;</span><span style="color: #268bd2;">String</span><span style="color: #8d5649;">&gt;</span> <span style="color: #b58900;">quotes</span><span style="color: #8d5649;">()</span> <span style="color: #8d5649;">{</span>
  <span style="color: #268bd2;">DeferredResult</span><span style="color: #d8241f;">&lt;</span><span style="color: #268bd2;">String</span><span style="color: #d8241f;">&gt;</span> <span style="color: #6c71c4;">deferredResult</span> = <span style="color: #859900;">new</span> <span style="color: #268bd2;">DeferredResult</span><span style="color: #d8241f;">&lt;</span><span style="color: #268bd2;">String</span><span style="color: #d8241f;">&gt;()</span>;
  <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">Save the deferredResult somewhere..</span>
  <span style="color: #859900;">return</span> deferredResult;
<span style="color: #8d5649;">}</span>

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">From some other thread...</span>
deferredResult.setResult<span style="color: #8d5649;">(</span>result<span style="color: #8d5649;">)</span>;
</pre>
</div>
</div>
</div>
<div id="outline-container-org54483e5" class="outline-3">
<h3 id="org54483e5"><span class="section-number-3">15.2</span> Callable</h3>
<div class="outline-text-3" id="text-15-2">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@PostMapping</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">Callable</span><span style="color: #8d5649;">&lt;</span><span style="color: #268bd2;">String</span><span style="color: #8d5649;">&gt;</span> <span style="color: #b58900;">processUpload</span><span style="color: #8d5649;">(</span><span style="color: #859900;">final</span> <span style="color: #268bd2;">MultipartFile</span> <span style="color: #6c71c4;">file</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span>

  <span style="color: #859900;">return</span> <span style="color: #859900;">new</span> <span style="color: #268bd2;">Callable</span><span style="color: #d8241f;">&lt;</span><span style="color: #268bd2;">String</span><span style="color: #d8241f;">&gt;()</span> <span style="color: #d8241f;">{</span>
    <span style="color: #859900;">public</span> <span style="color: #268bd2;">String</span> <span style="color: #b58900;">call</span><span style="color: #9564bf;">()</span> <span style="color: #859900;">throws</span> <span style="color: #268bd2;">Exception</span> <span style="color: #9564bf;">{</span>
      <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">...</span>
      <span style="color: #859900;">return</span> <span style="color: #2aa198;">"someView"</span>;
    <span style="color: #9564bf;">}</span>
  <span style="color: #d8241f;">}</span>;
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org816bdd2" class="outline-2">
<h2 id="org816bdd2"><span class="section-number-2">16</span> 远端过程调用</h2>
<div class="outline-text-2" id="text-16">
<p>
Spring 集成了许多常用的远端过程调用的方法，在选取的时候需要根据各自的优缺点来
权衡
</p>
<ul class="org-ul">
<li>RMI 一般比较快，但是只适合 Java 之间的调用</li>
<li>HTTP invoker</li>
<li>Hessian 这是工业界调用比较有名的一种远端过程调用的协议</li>
<li>JMS (Java Message Service) 具体使用方法参考官方文档 <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#jms">doc</a></li>
<li>JMX (Java Management Extensions) 是一个为应用程序植入管理功能的框架。用户可
以在任何 Java 应用程序中使用这些代理和服务实现管理</li>
</ul>
</div>
</div>
<div id="outline-container-org2830ba9" class="outline-2">
<h2 id="org2830ba9"><span class="section-number-2">17</span> 客户端请求 RestTemplate</h2>
<div class="outline-text-2" id="text-17">
<p>
Spring 提供了两种 Rest 客户端来进行客户端请求， RestTemplate 和 WebClient。在
日常工作中使用 RestTemplate 比较多，具体可查阅集成一节中的详细叙述 <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#rest-client-access">endpoints</a>
</p>
<ul class="org-ul">
<li>RestTemplate 是 Spring 自带的调用客户端，支持自带的模板类和同步的 HTTP 调用</li>
<li>WebClient 处理异步调用</li>
</ul>
</div>
<div id="outline-container-orgae8557f" class="outline-3">
<h3 id="orgae8557f"><span class="section-number-3">17.1</span> 初始化</h3>
<div class="outline-text-3" id="text-17-1">
<p>
直接使用 Apache HttpComponents 来作为 Spring 的代理来初始化一个 RestTemplate
对象
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">RestTemplate</span> <span style="color: #6c71c4;">template</span> = <span style="color: #859900;">new</span> <span style="color: #268bd2;">RestTemplate</span><span style="color: #8d5649;">(</span><span style="color: #859900;">new</span> <span style="color: #268bd2;">HttpComponentsClientHttpRequestFactory</span><span style="color: #d8241f;">()</span><span style="color: #8d5649;">)</span>;
</pre>
</div>

<p>
新建 RestTemplate 对象，并设置超时为 3 秒
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">HttpComponentsClientHttpRequestFactory</span> <span style="color: #6c71c4;">factory</span> = <span style="color: #859900;">new</span> <span style="color: #268bd2;">HttpComponentsClientHttpRequestFactory</span><span style="color: #8d5649;">()</span>;
factory.setConnectTimeout<span style="color: #8d5649;">(</span>3000<span style="color: #8d5649;">)</span>;
<span style="color: #268bd2;">RestTemplate</span> <span style="color: #6c71c4;">template</span> = <span style="color: #859900;">new</span> <span style="color: #268bd2;">RestTemplate</span><span style="color: #8d5649;">(</span>factory<span style="color: #8d5649;">)</span>;
</pre>
</div>
</div>
</div>
<div id="outline-container-orga2d3772" class="outline-3">
<h3 id="orga2d3772"><span class="section-number-3">17.2</span> UriComponents 构造 URI 对象</h3>
<div class="outline-text-3" id="text-17-2">
<p>
UriComponentsBuilder 可以新建一个 UriComponents 的实例，示例程序如下
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">URI</span> <span style="color: #6c71c4;">uri</span> = UriComponentsBuilder
  .fromUriString<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"https://example.com/hotels/{hotel}"</span><span style="color: #8d5649;">)</span>
  .queryParam<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"q"</span>, <span style="color: #2aa198;">"{q}"</span><span style="color: #8d5649;">)</span>
  .encode<span style="color: #8d5649;">()</span>
  .buildAndExpand<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"Westin"</span>, <span style="color: #2aa198;">"123"</span><span style="color: #8d5649;">)</span>
  .toUri<span style="color: #8d5649;">()</span>;

<span style="color: #268bd2;">URI</span> <span style="color: #6c71c4;">uri</span> = UriComponentsBuilder
  .fromUriString<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"https://example.com/hotels/{hotel}"</span><span style="color: #8d5649;">)</span>
  .queryParam<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"q"</span>, <span style="color: #2aa198;">"{q}"</span><span style="color: #8d5649;">)</span>
  .build<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"Westin"</span>, <span style="color: #2aa198;">"123"</span><span style="color: #8d5649;">)</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org0ff543a" class="outline-3">
<h3 id="org0ff543a"><span class="section-number-3">17.3</span> URI 编码</h3>
<div class="outline-text-3" id="text-17-3">
<p>
Spring 的 UriComponentsBuilder 自带 encode 方法，方便对 URL 编码
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">URI</span> <span style="color: #6c71c4;">uri</span> = UriComponentsBuilder.fromPath<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/hotel list/{city}"</span><span style="color: #8d5649;">)</span>
  .queryParam<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"q"</span>, <span style="color: #2aa198;">"{q}"</span><span style="color: #8d5649;">)</span>
  .encode<span style="color: #8d5649;">()</span>
  .buildAndExpand<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"New York"</span>, <span style="color: #2aa198;">"foo+bar"</span><span style="color: #8d5649;">)</span>
  .toUri<span style="color: #8d5649;">()</span>;
<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">Result is "/hotel%20list/New%20York?q=foo%2Bbar"</span>

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">queryParam &#21487;&#20197;&#22788;&#29702; query string</span>
<span style="color: #268bd2;">URI</span> <span style="color: #6c71c4;">uri</span> = UriComponentsBuilder.fromPath<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/hotel list/{city}"</span><span style="color: #8d5649;">)</span>
  .queryParam<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"q"</span>, <span style="color: #2aa198;">"{q}"</span><span style="color: #8d5649;">)</span>
  .build<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"New York"</span>, <span style="color: #2aa198;">"foo+bar"</span><span style="color: #8d5649;">)</span>;

<span style="color: #268bd2;">URI</span> <span style="color: #6c71c4;">uri</span> = UriComponentsBuilder.fromPath<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"/hotel list/{city}?q={q}"</span><span style="color: #8d5649;">)</span>
  .build<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"New York"</span>, <span style="color: #2aa198;">"foo+bar"</span><span style="color: #8d5649;">)</span>;

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">&#20256;&#36882; Map&lt;String, Object&gt; params &#23545;&#35937;&#30340; query string</span>
<span style="color: #268bd2;">UriComponentsBuilder</span> <span style="color: #6c71c4;">builder</span> = UriComponentsBuilder.fromHttpUrl<span style="color: #8d5649;">(</span>uriTemplate<span style="color: #8d5649;">)</span>;
params.forEach<span style="color: #8d5649;">(</span><span style="color: #d8241f;">(</span>k, v<span style="color: #d8241f;">)</span> -&gt; <span style="color: #d8241f;">{</span> builder.queryParam<span style="color: #9564bf;">(</span>k, <span style="color: #2aa198;">"{"</span> + k + <span style="color: #2aa198;">"}"</span><span style="color: #9564bf;">)</span>; <span style="color: #d8241f;">}</span><span style="color: #8d5649;">)</span>;
builder.encode<span style="color: #8d5649;">()</span>.buildAndExpand<span style="color: #8d5649;">(</span>params<span style="color: #8d5649;">)</span>.toUri<span style="color: #8d5649;">()</span>; <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">&#33719;&#21462;&#21040; URI</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org998021a" class="outline-3">
<h3 id="org998021a"><span class="section-number-3">17.4</span> URI</h3>
<div class="outline-text-3" id="text-17-4">
<p>
restTemplate 支持多种请求模式，例如 GET 请求可以使用下面的方式来出来发送
HTTP 请求来获取数据
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">&#30452;&#25509;&#20256;&#36882;&#21442;&#25968;</span>
<span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">result</span> = restTemplate.getForObject<span style="color: #8d5649;">(</span>
    <span style="color: #2aa198;">"https://example.com/hotels/{hotel}/bookings/{booking}"</span>, String.<span style="color: #859900;">class</span>, <span style="color: #2aa198;">"42"</span>, <span style="color: #2aa198;">"21"</span><span style="color: #8d5649;">)</span>;
<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">&#25226;&#21442;&#25968;&#23553;&#35013;&#22312; Map &#23545;&#35937;&#20013;</span>
<span style="color: #268bd2;">Map</span><span style="color: #8d5649;">&lt;</span><span style="color: #268bd2;">String</span>, <span style="color: #268bd2;">String</span><span style="color: #8d5649;">&gt;</span> <span style="color: #6c71c4;">vars</span> = Collections.singletonMap<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"hotel"</span>, <span style="color: #2aa198;">"42"</span><span style="color: #8d5649;">)</span>;
<span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">result</span> = restTemplate.getForObject<span style="color: #8d5649;">(</span>
    <span style="color: #2aa198;">"https://example.com/hotels/{hotel}/rooms/{hotel}"</span>, String.<span style="color: #859900;">class</span>, vars<span style="color: #8d5649;">)</span>;
<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">&#33258;&#21160;&#32534;&#30721;&#31354;&#26684;</span>
restTemplate.getForObject<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"https://example.com/hotel list"</span>, String.<span style="color: #859900;">class</span><span style="color: #8d5649;">)</span>;
<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">Results in request to "https://example.com/hotel%20list"</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org9a37237" class="outline-3">
<h3 id="org9a37237"><span class="section-number-3">17.5</span> 请求头</h3>
<div class="outline-text-3" id="text-17-5">
<p>
使用 <code>exchange()</code> 可以在请求中添加请求头，参考如下示例
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">uriTemplate</span> = <span style="color: #2aa198;">"https://example.com/hotels/{hotel}"</span>;
<span style="color: #268bd2;">URI</span> <span style="color: #6c71c4;">uri</span> = UriComponentsBuilder.fromUriString<span style="color: #8d5649;">(</span>uriTemplate<span style="color: #8d5649;">)</span>.build<span style="color: #8d5649;">(</span>42<span style="color: #8d5649;">)</span>;

<span style="color: #268bd2;">RequestEntity</span><span style="color: #8d5649;">&lt;</span><span style="color: #268bd2;">Void</span><span style="color: #8d5649;">&gt;</span> <span style="color: #6c71c4;">requestEntity</span> = RequestEntity.get<span style="color: #8d5649;">(</span>uri<span style="color: #8d5649;">)</span>
    .header<span style="color: #8d5649;">(</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"MyRequestHeader"</span>, <span style="color: #2aa198;">"MyValue"</span><span style="color: #d8241f;">)</span>
    .build<span style="color: #d8241f;">()</span>;

<span style="color: #268bd2;">ResponseEntity</span><span style="color: #d8241f;">&lt;</span><span style="color: #268bd2;">String</span><span style="color: #d8241f;">&gt;</span> <span style="color: #6c71c4;">response</span> = template.exchange<span style="color: #d8241f;">(</span>requestEntity, String.<span style="color: #859900;">class</span><span style="color: #d8241f;">)</span>;

<span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">responseHeader</span> = response.getHeaders<span style="color: #d8241f;">()</span>.getFirst<span style="color: #d8241f;">(</span><span style="color: #2aa198;">"MyResponseHeader"</span><span style="color: #d8241f;">)</span>;
<span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">body</span> = response.getBody<span style="color: #d8241f;">()</span>;
</pre>
</div>
</div>
</div>
<div id="outline-container-org3b44e2a" class="outline-3">
<h3 id="org3b44e2a"><span class="section-number-3">17.6</span> 请求体</h3>
<div class="outline-text-3" id="text-17-6">
<p>
直接传递第一个参数作为请求体，在 POST 请求中，输入对象直接被序列化成请求体
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">URI</span> <span style="color: #6c71c4;">location</span> = template.postForLocation<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"https://example.com/people"</span>, person<span style="color: #8d5649;">)</span>;
</pre>
</div>

<p>
在 GET 请求中，请求返回的消息体会被反序列化成对应对象
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">Person</span> <span style="color: #6c71c4;">person</span> = restTemplate.getForObject<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"https://example.com/people/{id}"</span>, Person.<span style="color: #859900;">class</span>, 42<span style="color: #8d5649;">)</span>;
</pre>
</div>
</div>
</div>
<div id="outline-container-org5c8456a" class="outline-3">
<h3 id="org5c8456a"><span class="section-number-3">17.7</span> Jackson JSON</h3>
<div class="outline-text-3" id="text-17-7">
<p>
有时候需要修改一下默认请求的序列化方式，例如我们序列化用户是不希望将用户的密
码暴露出来，可以通过下面的方式实现
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">MappingJacksonValue</span> <span style="color: #6c71c4;">value</span> = <span style="color: #859900;">new</span> <span style="color: #268bd2;">MappingJacksonValue</span><span style="color: #8d5649;">(</span><span style="color: #859900;">new</span> <span style="color: #268bd2;">User</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"eric"</span>, <span style="color: #2aa198;">"7!jd#h23"</span><span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>;
value.setSerializationView<span style="color: #8d5649;">(</span><span style="color: #268bd2;">User</span>.WithoutPasswordView.<span style="color: #859900;">class</span><span style="color: #8d5649;">)</span>;
<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">&#26500;&#36896;&#35831;&#27714;&#23454;&#20307;</span>
<span style="color: #268bd2;">RequestEntity</span><span style="color: #8d5649;">&lt;</span><span style="color: #268bd2;">MappingJacksonValue</span><span style="color: #8d5649;">&gt;</span> <span style="color: #6c71c4;">requestEntity</span> =
    RequestEntity.post<span style="color: #8d5649;">(</span><span style="color: #859900;">new</span> <span style="color: #268bd2;">URI</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"https://example.com/user"</span><span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>.body<span style="color: #8d5649;">(</span>value<span style="color: #8d5649;">)</span>;
<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">&#21457;&#36865;&#35831;&#27714;&#65292;&#33719;&#21462;&#22238;&#22797;</span>
<span style="color: #268bd2;">ResponseEntity</span><span style="color: #8d5649;">&lt;</span><span style="color: #268bd2;">String</span><span style="color: #8d5649;">&gt;</span> <span style="color: #6c71c4;">response</span> = template.exchange<span style="color: #8d5649;">(</span>requestEntity, String.<span style="color: #859900;">class</span><span style="color: #8d5649;">)</span>;
</pre>
</div>
</div>
</div>
<div id="outline-container-org3379e1a" class="outline-3">
<h3 id="org3379e1a"><span class="section-number-3">17.8</span> Multipart</h3>
<div class="outline-text-3" id="text-17-8">
<p>
Spring 还提供了发送多部分请求的方法，使用 <code>MultiValueMap</code> 对象可以构造请求参数
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">MultiValueMap</span><span style="color: #8d5649;">&lt;</span><span style="color: #268bd2;">String</span>, <span style="color: #268bd2;">Object</span><span style="color: #8d5649;">&gt;</span> <span style="color: #6c71c4;">parts</span> = <span style="color: #859900;">new</span> <span style="color: #268bd2;">LinkedMultiValueMap</span><span style="color: #8d5649;">&lt;&gt;()</span>;
<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">&#26500;&#36896;&#35831;&#27714;&#30340;&#22810;&#37096;&#20998;&#30340;&#35831;&#27714;&#21442;&#25968;</span>
parts.add<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"fieldPart"</span>, <span style="color: #2aa198;">"fieldValue"</span><span style="color: #8d5649;">)</span>;
parts.add<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"filePart"</span>, <span style="color: #859900;">new</span> <span style="color: #268bd2;">FileSystemResource</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"...logo.png"</span><span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>;
parts.add<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"jsonPart"</span>, <span style="color: #859900;">new</span> <span style="color: #268bd2;">Person</span><span style="color: #d8241f;">(</span><span style="color: #2aa198;">"Jason"</span><span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>;
<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">&#26500;&#36896;&#35831;&#27714;&#22836;&#21644;&#28155;&#21152;&#21478;&#22806;&#30340;&#21442;&#25968;</span>
<span style="color: #268bd2;">HttpHeaders</span> <span style="color: #6c71c4;">headers</span> = <span style="color: #859900;">new</span> <span style="color: #268bd2;">HttpHeaders</span><span style="color: #8d5649;">()</span>;
headers.setContentType<span style="color: #8d5649;">(</span><span style="color: #268bd2;">MediaType</span>.APPLICATION_XML<span style="color: #8d5649;">)</span>;
parts.add<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"xmlPart"</span>, <span style="color: #859900;">new</span> <span style="color: #268bd2;">HttpEntity</span><span style="color: #d8241f;">&lt;&gt;(</span>myBean, headers<span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>;
</pre>
</div>
<p>
一旦多部分的请求参数构造好了，就可以使用如下方法来发送请求
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">MultiValueMap</span><span style="color: #8d5649;">&lt;</span><span style="color: #268bd2;">String</span>, <span style="color: #268bd2;">Object</span><span style="color: #8d5649;">&gt;</span> <span style="color: #6c71c4;">parts</span> = ...;
template.postForObject<span style="color: #8d5649;">(</span><span style="color: #2aa198;">"https://example.com/upload"</span>, parts, Void.<span style="color: #859900;">class</span><span style="color: #8d5649;">)</span>;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org277f4d9" class="outline-2">
<h2 id="org277f4d9"><span class="section-number-2">18</span> 发送邮件 Email</h2>
<div class="outline-text-2" id="text-18">
<p>
在发送邮件前，先准备业务中涉及到邮件的接口，例如定义好订单接口
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #859900;">public</span> <span style="color: #859900;">interface</span> <span style="color: #268bd2;">OrderManager</span> <span style="color: #8d5649;">{</span>
  <span style="color: #268bd2;">void</span> <span style="color: #b58900;">placeOrder</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">Order</span> <span style="color: #6c71c4;">order</span><span style="color: #d8241f;">)</span>;
<span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
通过 Spring 提供的方法发送简单 Email 示例如下
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #859900;">import</span> <span style="color: #268bd2;">org</span>.<span style="color: #268bd2;">springframework</span>.<span style="color: #268bd2;">mail</span>.<span style="color: #268bd2;">MailException</span>;
<span style="color: #859900;">import</span> <span style="color: #268bd2;">org</span>.<span style="color: #268bd2;">springframework</span>.<span style="color: #268bd2;">mail</span>.<span style="color: #268bd2;">MailSender</span>;
<span style="color: #859900;">import</span> <span style="color: #268bd2;">org</span>.<span style="color: #268bd2;">springframework</span>.<span style="color: #268bd2;">mail</span>.<span style="color: #268bd2;">SimpleMailMessage</span>;

<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">SimpleOrderManager</span> <span style="color: #859900;">implements</span> <span style="color: #268bd2;">OrderManager</span> <span style="color: #8d5649;">{</span>

  <span style="color: #859900;">private</span> <span style="color: #268bd2;">MailSender</span> <span style="color: #6c71c4;">mailSender</span>;
  <span style="color: #859900;">private</span> <span style="color: #268bd2;">SimpleMailMessage</span> <span style="color: #6c71c4;">templateMessage</span>;

  <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">setMailSender</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">MailSender</span> <span style="color: #6c71c4;">mailSender</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span>
    <span style="color: #859900;">this</span>.mailSender = mailSender;
  <span style="color: #d8241f;">}</span>

  <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">setTemplateMessage</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">SimpleMailMessage</span> <span style="color: #6c71c4;">templateMessage</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span>
    <span style="color: #859900;">this</span>.templateMessage = templateMessage;
  <span style="color: #d8241f;">}</span>

  <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">placeOrder</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">Order</span> <span style="color: #6c71c4;">order</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span>
    <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">1. &#22788;&#29702;&#19994;&#21153;&#36923;&#36753; ...</span>
    <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">2. &#35843;&#29992;&#21327;&#35843;&#27169;&#22359;&#65292;&#22788;&#29702;&#21457;&#36865;&#30340;&#39034;&#24207; ...</span>
    <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">3. &#22797;&#21046;&#27169;&#26495;&#65292;&#20351;&#29992;&#32447;&#31243;&#23433;&#20840;&#30340;&#27169;&#26495;&#36827;&#20837;&#21457;&#36865;&#38431;&#21015;</span>
    <span style="color: #268bd2;">SimpleMailMessage</span> <span style="color: #6c71c4;">msg</span> = <span style="color: #859900;">new</span> <span style="color: #268bd2;">SimpleMailMessage</span><span style="color: #9564bf;">(</span><span style="color: #859900;">this</span>.templateMessage<span style="color: #9564bf;">)</span>;
    msg.setTo<span style="color: #9564bf;">(</span>order.getCustomer<span style="color: #24a222;">()</span>.getEmailAddress<span style="color: #24a222;">()</span><span style="color: #9564bf;">)</span>;
    msg.setText<span style="color: #9564bf;">(</span><span style="color: #2aa198;">"Dear "</span> + order.getCustomer<span style="color: #24a222;">()</span>.getFirstName<span style="color: #24a222;">()</span>
                + order.getCustomer<span style="color: #24a222;">()</span>.getLastName<span style="color: #24a222;">()</span>
                + <span style="color: #2aa198;">", thank you for placing order. Your order number is "</span>
                + order.getOrderNumber<span style="color: #24a222;">()</span><span style="color: #9564bf;">)</span>;
    <span style="color: #859900;">try</span><span style="color: #9564bf;">{</span>
      <span style="color: #859900;">this</span>.mailSender.send<span style="color: #24a222;">(</span>msg<span style="color: #24a222;">)</span>;
    <span style="color: #9564bf;">}</span> <span style="color: #859900;">catch</span> <span style="color: #9564bf;">(</span><span style="color: #268bd2;">MailException</span> <span style="color: #6c71c4;">ex</span><span style="color: #9564bf;">)</span> <span style="color: #9564bf;">{</span>
      <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">simply log it and go on...</span>
      System.err.println<span style="color: #24a222;">(</span>ex.getMessage<span style="color: #ff7f00;">()</span><span style="color: #24a222;">)</span>;
    <span style="color: #9564bf;">}</span>
  <span style="color: #d8241f;">}</span>

<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org83dfbd3" class="outline-2">
<h2 id="org83dfbd3"><span class="section-number-2">19</span> 执行任务和任务调度</h2>
<div class="outline-text-2" id="text-19">
<p>
传统的 Spring 中的任务调度通过实现 <code>TaskExecutor</code> 和 <code>TaskScheduler</code> 接口来控
制，为了避免使用 XML 配置。我还可以在使用注解的方式来定义异步任务。要使用任务
需要在配置类中开启异步任务和任务调度，具体如下
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@Configuration</span>
<span style="color: #268bd2;">@EnableAsync</span>
<span style="color: #268bd2;">@EnableScheduling</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">AppConfig</span> <span style="color: #8d5649;">{</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
可以使用 <code>@Scheduled</code> 注解来定义周期任务，如下
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@Scheduled</span><span style="color: #8d5649;">(</span>fixedDelay=5000<span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">doSomething</span><span style="color: #8d5649;">()</span> <span style="color: #8d5649;">{</span>
  <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">something that should execute periodically</span>
<span style="color: #8d5649;">}</span>

<span style="color: #268bd2;">@Scheduled</span><span style="color: #8d5649;">(</span>initialDelay=1000, fixedRate=5000<span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">doSomething</span><span style="color: #8d5649;">()</span> <span style="color: #8d5649;">{</span>
  <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">something that should execute periodically</span>
<span style="color: #8d5649;">}</span>

<span style="color: #268bd2;">@Scheduled</span><span style="color: #8d5649;">(</span>cron=<span style="color: #2aa198;">"*/5 * * * * MON-FRI"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">doSomething</span><span style="color: #8d5649;">()</span> <span style="color: #8d5649;">{</span>
  <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">something that should execute on weekdays only</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
可以使用 <code>@Async</code> 注解来定义异步任务
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@Async</span>
<span style="color: #268bd2;">void</span> <span style="color: #b58900;">doSomething</span><span style="color: #8d5649;">()</span> <span style="color: #8d5649;">{</span>
  <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">this will be executed asynchronously</span>
<span style="color: #8d5649;">}</span>

<span style="color: #268bd2;">@Async</span>
<span style="color: #268bd2;">void</span> <span style="color: #b58900;">doSomething</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">s</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span>
  <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">this will be executed asynchronously</span>
<span style="color: #8d5649;">}</span>

<span style="color: #268bd2;">@Async</span>
<span style="color: #268bd2;">Future</span><span style="color: #8d5649;">&lt;</span><span style="color: #268bd2;">String</span><span style="color: #8d5649;">&gt;</span> <span style="color: #b58900;">returnSomething</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">int</span> <span style="color: #6c71c4;">i</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span>
  <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">this will be executed asynchronously</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
<code>@Async</code> 注解的异步任务有时候会发送异常，对于异常处理方式如下
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">MyAsyncUncaughtExceptionHandler</span> <span style="color: #859900;">implements</span> <span style="color: #268bd2;">AsyncUncaughtExceptionHandler</span> <span style="color: #8d5649;">{</span>
  <span style="color: #268bd2;">@Override</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">handleUncaughtException</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">Throwable</span> <span style="color: #6c71c4;">ex</span>, <span style="color: #268bd2;">Method</span> <span style="color: #6c71c4;">method</span>, <span style="color: #268bd2;">Object</span>... <span style="color: #6c71c4;">params</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span>
    <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">&#22788;&#29702;&#24322;&#24120;&#36923;&#36753;</span>
  <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3ac94fb" class="outline-2">
<h2 id="org3ac94fb"><span class="section-number-2">20</span> 缓存 Cache</h2>
<div class="outline-text-2" id="text-20">
<p>
缓存 <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#cache-annotations">Cache</a> 使用如下的注解俩定义
</p>
<ul class="org-ul">
<li><code>@Cacheable</code> 标注定义缓存的方法</li>
<li><code>@CacheEvict</code>: 标注删除缓存</li>
<li><code>@CachePut</code>: 标注更新缓存</li>
<li><code>@Caching</code>: 重新组合和定义缓存，一般适用于定义组合式的缓存策略</li>
<li><code>@CacheConfig</code>: 标注在类上，定义类级别共享的缓存</li>
</ul>
</div>
<div id="outline-container-orga523177" class="outline-3">
<h3 id="orga523177"><span class="section-number-3">20.1</span> 开启缓存</h3>
<div class="outline-text-3" id="text-20-1">
<p>
通过配置类的方式开启缓存
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@Configuration</span>
<span style="color: #268bd2;">@EnableCaching</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">AppConfig</span> <span style="color: #8d5649;">{</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd93a273" class="outline-3">
<h3 id="orgd93a273"><span class="section-number-3">20.2</span> <code>@Cacheable</code></h3>
<div class="outline-text-3" id="text-20-2">
<p>
<code>@Cacheable</code> 是用来声明方法是可缓存的。将结果存储到缓存中以便后续使用相同参
数调用时不需执行实际的方法。直接从缓存中取值。最简单的格式需要制定缓存名称。
</p>

<p>
定义缓存的方法如下
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@Cacheable</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"books"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">Book</span> <span style="color: #b58900;">findBook</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">ISBN</span> <span style="color: #6c71c4;">isbn</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #8d5649;">}</span>

<span style="color: #268bd2;">@Cacheable</span><span style="color: #8d5649;">(</span><span style="color: #d8241f;">{</span><span style="color: #2aa198;">"books"</span>, <span style="color: #2aa198;">"isbns"</span><span style="color: #d8241f;">}</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">Book</span> <span style="color: #b58900;">findBook</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">ISBN</span> <span style="color: #6c71c4;">isbn</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #8d5649;">}</span>

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">SpEL</span>
<span style="color: #268bd2;">@Cacheable</span><span style="color: #8d5649;">(</span>cacheNames=<span style="color: #2aa198;">"books"</span>, key=<span style="color: #2aa198;">"#isbn"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">Book</span> <span style="color: #b58900;">findBook</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">ISBN</span> <span style="color: #6c71c4;">isbn</span>, <span style="color: #268bd2;">boolean</span> <span style="color: #6c71c4;">checkWarehouse</span>, <span style="color: #268bd2;">boolean</span> <span style="color: #6c71c4;">includeUsed</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span><span style="color: #8d5649;">}</span>
<span style="color: #268bd2;">@Cacheable</span><span style="color: #8d5649;">(</span>cacheNames=<span style="color: #2aa198;">"books"</span>, key=<span style="color: #2aa198;">"#isbn.rawNumber"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">Book</span> <span style="color: #b58900;">findBook</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">ISBN</span> <span style="color: #6c71c4;">isbn</span>, <span style="color: #268bd2;">boolean</span> <span style="color: #6c71c4;">checkWarehouse</span>, <span style="color: #268bd2;">boolean</span> <span style="color: #6c71c4;">includeUsed</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span><span style="color: #8d5649;">}</span>
<span style="color: #268bd2;">@Cacheable</span><span style="color: #8d5649;">(</span>cacheNames=<span style="color: #2aa198;">"books"</span>, key=<span style="color: #2aa198;">"T(someType).hash(#isbn)"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">Book</span> <span style="color: #b58900;">findBook</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">ISBN</span> <span style="color: #6c71c4;">isbn</span>, <span style="color: #268bd2;">boolean</span> <span style="color: #6c71c4;">checkWarehouse</span>, <span style="color: #268bd2;">boolean</span> <span style="color: #6c71c4;">includeUsed</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span><span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
定义同步缓存
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@Cacheable</span><span style="color: #8d5649;">(</span>cacheNames=<span style="color: #2aa198;">"foos"</span>, sync=<span style="color: #268bd2;">true</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">Foo</span> <span style="color: #b58900;">executeExpensiveOperation</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">id</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #8d5649;">}</span>
</pre>
</div>
<p>
条件缓存
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@Cacheable</span><span style="color: #8d5649;">(</span>cacheNames=<span style="color: #2aa198;">"book"</span>, condition=<span style="color: #2aa198;">"#name.length() &lt; 32"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">Book</span> <span style="color: #b58900;">findBook</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">name</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #8d5649;">}</span>

<span style="color: #268bd2;">@Cacheable</span><span style="color: #8d5649;">(</span>cacheNames=<span style="color: #2aa198;">"book"</span>, condition=<span style="color: #2aa198;">"#name.length() &lt; 32"</span>, unless=<span style="color: #2aa198;">"#result.hardback"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">Book</span> <span style="color: #b58900;">findBook</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">name</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #8d5649;">}</span>

<span style="color: #268bd2;">@Cacheable</span><span style="color: #8d5649;">(</span>cacheNames=<span style="color: #2aa198;">"book"</span>, condition=<span style="color: #2aa198;">"#name.length() &lt; 32"</span>, unless=<span style="color: #2aa198;">"#result?.hardback"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">Optional</span><span style="color: #8d5649;">&lt;</span><span style="color: #268bd2;">Book</span><span style="color: #8d5649;">&gt;</span> <span style="color: #b58900;">findBook</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">name</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaf3d32a" class="outline-3">
<h3 id="orgaf3d32a"><span class="section-number-3">20.3</span> 其它注解</h3>
<div class="outline-text-3" id="text-20-3">
<p>
<code>@CachePut</code> 也可以声明一个方法支持缓存功能。与 <code>@Cacheable</code> 不同的是使用
<code>@CachePut</code> 标注的方法在执行前不会去检查缓存中是否存在之前执行过的结果，而是
每次都会执行该方法，并将执行结果以键值对的形式存入指定的缓存中
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@CachePut</span><span style="color: #8d5649;">(</span>cacheNames=<span style="color: #2aa198;">"book"</span>, key=<span style="color: #2aa198;">"#isbn"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">Book</span> <span style="color: #b58900;">updateBook</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">ISBN</span> <span style="color: #6c71c4;">isbn</span>, <span style="color: #268bd2;">BookDescriptor</span> <span style="color: #6c71c4;">descriptor</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span><span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
<code>@CacheEvict</code> 是用来标注在需要清除缓存元素的方法或类上的。当标记在一个类上时
表示其中所有的方法的执行都会触发缓存的清除操作
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">allEntries &#34920;&#31034;&#21024;&#38500;&#25152;&#26377;&#39033;&#30446;</span>
<span style="color: #268bd2;">@CacheEvict</span><span style="color: #8d5649;">(</span>cacheNames=<span style="color: #2aa198;">"books"</span>, allEntries=<span style="color: #268bd2;">true</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">void</span> <span style="color: #b58900;">loadBooks</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">InputStream</span> <span style="color: #6c71c4;">batch</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span><span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
<code>@Caching</code> 注解可以让我们在一个方法或者类上同时指定多个 Spring Cache 相关的
注解。
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@Caching</span><span style="color: #8d5649;">(</span>evict = <span style="color: #d8241f;">{</span> <span style="color: #268bd2;">@CacheEvict</span><span style="color: #9564bf;">(</span><span style="color: #2aa198;">"primary"</span><span style="color: #9564bf;">)</span>, <span style="color: #268bd2;">@CacheEvict</span><span style="color: #9564bf;">(</span>cacheNames=<span style="color: #2aa198;">"secondary"</span>, key=<span style="color: #2aa198;">"#p0"</span><span style="color: #9564bf;">)</span> <span style="color: #d8241f;">}</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #268bd2;">Book</span> <span style="color: #b58900;">importBooks</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">String</span> <span style="color: #6c71c4;">deposit</span>, <span style="color: #268bd2;">Date</span> <span style="color: #6c71c4;">date</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span><span style="color: #8d5649;">}</span>
</pre>
</div>

<p>
有时候一个类中可能会有多个缓存操作，而这些缓存操作可能是重复的。这个时候可以
使用 <code>@CacheConfig</code>
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #268bd2;">@CacheConfig</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">"books"</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">public</span> <span style="color: #859900;">class</span> <span style="color: #268bd2;">BookRepositoryImpl</span> <span style="color: #859900;">implements</span> <span style="color: #268bd2;">BookRepository</span> <span style="color: #8d5649;">{</span>
  <span style="color: #268bd2;">@Cacheable</span>
  <span style="color: #859900;">public</span> <span style="color: #268bd2;">Book</span> <span style="color: #b58900;">findBook</span><span style="color: #d8241f;">(</span><span style="color: #268bd2;">ISBN</span> <span style="color: #6c71c4;">isbn</span><span style="color: #d8241f;">)</span> <span style="color: #d8241f;">{</span> <span style="color: #93a1a1; font-style: italic;">/* </span><span style="color: #93a1a1; font-style: italic;">... */</span> <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcbfbca4" class="outline-2">
<h2 id="orgcbfbca4"><span class="section-number-2">21</span> 参考链接</h2>
<div class="outline-text-2" id="text-21">
<ol class="org-ol">
<li><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/">Spring Framework 文档</a></li>
<li><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html">Spring Web MVC文档</a></li>
<li><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/">Spring Boot 文档</a></li>
<li><a href="https://start.spring.io/">start.spring.io</a></li>
<li><a href="https://spring.io/guides">"Getting Started" Guides</a></li>
</ol>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Last Updated 2020-03-15 Sun 22:29. Created by Jinghui Hu at 2020-03-15 Sun 22:27.</p>
</div>
</body>
</html>
