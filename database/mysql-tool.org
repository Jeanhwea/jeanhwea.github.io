#+TITLE: MySQL 工具使用笔记
#+AUTHOR: Jinghui Hu
#+EMAIL: hujinghui@buaa.edu.cn
#+DATE: <2022-11-03 Thu 10:19:36>
#+HTML_LINK_UP: ../readme.html
#+HTML_LINK_HOME: ../index.html
#+SETUPFILE: ~/.emacs.d/site-lisp/org-html-themes/setup/theme-readtheorg-local.setup
#+PROPERTY: header-args:sql :database test01 :engine mysql :exports both
#+OPTIONS: ^:nil
#+TAGS: mysql


* 索引
** explain 工具
直接通过在 query 的前面添加 ~explain~ 关键字就可以得到查询计划

#+BEGIN_SRC sql
  explain select * from t;
#+END_SRC

#+RESULTS:
| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra |
|----+-------------+-------+------------+------+---------------+------+---------+------+------+----------+-------|
|  1 | SIMPLE      | t     | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    6 |   100.00 | NULL  |

** 使用 optimize trace 工具
开启 optimize trace 工具，

#+BEGIN_SRC sql :exports none
  set optimizer_trace="enabled=on";
  select count(*) from t;
  select * from information_schema.optimizer_trace;
#+END_SRC

#+RESULTS:
| count(*)               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                   |                         |
|------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------+-------------------------|
| 6                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                   |                         |
| QUERY                  | TRACE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | MISSING_BYTES_BEYOND_MAX_MEM_SIZE | INSUFFICIENT_PRIVILEGES |
| select count(*) from t | {\n  "steps": [\n    {\n      "join_preparation": {\n        "select#": 1,\n        "steps": [\n          {\n            "expanded_query": "/* select#1 */ select count(0) AS `count(*)` from `t`"\n          }\n        ]\n      }\n    },\n    {\n      "join_optimization": {\n        "select#": 1,\n        "steps": [\n          {\n            "table_dependencies": [\n              {\n                "table": "`t`",\n                "row_may_be_null": false,\n                "map_bit": 0,\n                "depends_on_map_bits": [\n                ]\n              }\n            ]\n          },\n          {\n            "rows_estimation": [\n              {\n                "table": "`t`",\n                "table_scan": {\n                  "rows": 6,\n                  "cost": 0.25\n                }\n              }\n            ]\n          },\n          {\n            "considered_execution_plans": [\n              {\n                "plan_prefix": [\n                ],\n                "table": "`t`",\n                "best_access_path": {\n                  "considered_access_paths": [\n                    {\n                      "rows_to_scan": 6,\n                      "access_type": "scan",\n                      "resulting_rows": 6,\n                      "cost": 0.85,\n                      "chosen": true\n                    }\n                  ]\n                },\n                "condition_filtering_pct": 100,\n                "rows_for_plan": 6,\n                "cost_for_plan": 0.85,\n                "chosen": true\n              }\n            ]\n          },\n          {\n            "attaching_conditions_to_tables": {\n              "original_condition": null,\n              "attached_conditions_computation": [\n              ],\n              "attached_conditions_summary": [\n                {\n                  "table": "`t`",\n                  "attached": null\n                }\n              ]\n            }\n          },\n          {\n            "optimizing_distinct_group_by_order_by": {\n            }\n          },\n          {\n            "finalizing_table_conditions": [\n            ]\n          },\n          {\n            "refine_plan": [\n              {\n                "table": "`t`"\n              }\n            ]\n          },\n          {\n            "considering_tmp_tables": [\n            ]\n          }\n        ]\n      }\n    },\n    {\n      "join_execution": {\n        "select#": 1,\n        "steps": [\n        ]\n      }\n    }\n  ]\n} |                                 0 |                       0 |
