<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-07-02 Tue 12:06 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OpenCV 的介绍</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Jinghui Hu" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">OpenCV 的介绍</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org3a74298">1. 简介</a></li>
<li><a href="#org4ebdcbf">2. 安装</a></li>
<li><a href="#org01a0fcd">3. 导入 opencv</a></li>
<li><a href="#orgcee71f7">4. 使用介绍</a>
<ul>
<li><a href="#orgfd8b2d5">4.1. 图片读写</a>
<ul>
<li><a href="#org8f16e99">4.1.1. 读取图片</a></li>
<li><a href="#orgaad0c3f">4.1.2. 显示图片</a></li>
<li><a href="#org8d8f808">4.1.3. 写入图片</a></li>
</ul>
</li>
<li><a href="#org8ddb5b2">4.2. 视频操作</a>
<ul>
<li><a href="#org4c49498">4.2.1. 读取摄像头数据</a></li>
<li><a href="#orgfd3cb4f">4.2.2. 播放视频文件</a></li>
<li><a href="#org7f9dd14">4.2.3. 保存视频文件</a></li>
</ul>
</li>
<li><a href="#orgaa159ff">4.3. 画图函数</a>
<ul>
<li><a href="#org3c2f740">4.3.1. 画几何图形</a></li>
<li><a href="#orgfe7481a">4.3.2. 写文字</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgdb9c74a">5. 核心操作</a>
<ul>
<li><a href="#org03db038">5.1. 基本操作</a>
<ul>
<li><a href="#orgd79dda1">5.1.1. 像素操作</a></li>
<li><a href="#orgb77fda5">5.1.2. 相片属性</a></li>
<li><a href="#org5cd2d37">5.1.3. 子图片和通道</a></li>
<li><a href="#orgab9f3d7">5.1.4. 图片边框</a></li>
</ul>
</li>
<li><a href="#org1883793">5.2. 算术操作</a>
<ul>
<li><a href="#org419fc0d">5.2.1. 图片相加</a></li>
<li><a href="#org2aaf0a9">5.2.2. 图片混合(Blending)</a></li>
<li><a href="#orgb4c04f0">5.2.3. 位操作</a></li>
</ul>
</li>
<li><a href="#org731a6ec">5.3. 图片处理</a>
<ul>
<li><a href="#orgf27a03f">5.3.1. 几何变换</a></li>
<li><a href="#orgcd5c99f">5.3.2. 二值化(Thresholding)</a></li>
<li><a href="#org6d9d224">5.3.3. 平滑(Smoothing Images)</a></li>
<li><a href="#org88b4a24">5.3.4. Canny 边界检测</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orga62bd1e">6. 参考链接</a></li>
</ul>
</div>
</div>


<div id="outline-container-org3a74298" class="outline-2">
<h2 id="org3a74298"><span class="section-number-2">1</span> 简介</h2>
<div class="outline-text-2" id="text-1">
<p>
OpenCV 是一个基于 BSD 许可（开源）发行的跨平台计算机视觉库，可以运行在 Linux、
Windows、Android 和 Mac OS 操作系统上。它轻量级而且高效——由一系列 C 函数和少量 C++
类构成，同时提供了 Python、Ruby、MATLAB 等语言的接口，实现了图像处理和计算机视觉方
面的很多通用算法。
</p>


<div class="figure">
<p><img src="../static/image/2019/01/opencv-logo.png" alt="opencv-logo.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org4ebdcbf" class="outline-2">
<h2 id="org4ebdcbf"><span class="section-number-2">2</span> 安装</h2>
<div class="outline-text-2" id="text-2">
<p>
建议使用 pip 来安装
</p>

<div class="org-src-container">
<pre class="src src-sh">pip install opencv-python
</pre>
</div>
</div>
</div>

<div id="outline-container-org01a0fcd" class="outline-2">
<h2 id="org01a0fcd"><span class="section-number-2">3</span> 导入 opencv</h2>
<div class="outline-text-2" id="text-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #859900;">import</span> cv2 <span style="color: #859900;">as</span> cv
<span style="color: #859900;">import</span> numpy <span style="color: #859900;">as</span> np
<span style="color: #6c71c4;">lenna</span> = <span style="color: #2aa198;">'static/image/2019/01/lenna.png'</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgcee71f7" class="outline-2">
<h2 id="orgcee71f7"><span class="section-number-2">4</span> 使用介绍</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orgfd8b2d5" class="outline-3">
<h3 id="orgfd8b2d5"><span class="section-number-3">4.1</span> 图片读写</h3>
<div class="outline-text-3" id="text-4-1">
</div>
<div id="outline-container-org8f16e99" class="outline-4">
<h4 id="org8f16e99"><span class="section-number-4">4.1.1</span> 读取图片</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
opencv 的彩色的图片采用 <b><b>BGR</b></b> 的排列方式，和我们通常使用 <b><b>RGB</b></b> 的方式有所不同。
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #6c71c4;">img</span> = cv.imread<span style="color: #8d5649;">(</span>lenna<span style="color: #8d5649;">)</span>
<span style="color: #859900;">print</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">'img type = {}'</span>.<span style="color: #6c71c4;">format</span><span style="color: #d8241f;">(</span><span style="color: #6c71c4;">type</span><span style="color: #9564bf;">(</span>img<span style="color: #9564bf;">)</span><span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">print</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">'img.shape = {}'</span>.<span style="color: #6c71c4;">format</span><span style="color: #d8241f;">(</span>img.shape<span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">gray_image</span> = cv.imread<span style="color: #8d5649;">(</span>lenna, cv.IMREAD_GRAYSCALE<span style="color: #8d5649;">)</span>
<span style="color: #859900;">print</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">'gray_image.shape = {}'</span>.<span style="color: #6c71c4;">format</span><span style="color: #d8241f;">(</span>gray_image.shape<span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>
</pre>
</div>

<pre class="example">
img type = &lt;class 'numpy.ndarray'&gt;
img.shape = (512, 512, 3)
gray_image.shape = (512, 512)

</pre>
</div>
</div>

<div id="outline-container-orgaad0c3f" class="outline-4">
<h4 id="orgaad0c3f"><span class="section-number-4">4.1.2</span> 显示图片</h4>
<div class="outline-text-4" id="text-4-1-2">
<div class="org-src-container">
<pre class="src src-python">cv.imshow<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'image'</span>, img<span style="color: #8d5649;">)</span>
cv.waitKey<span style="color: #8d5649;">(</span>0<span style="color: #8d5649;">)</span>
cv.destroyAllWindows<span style="color: #8d5649;">()</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8d8f808" class="outline-4">
<h4 id="org8d8f808"><span class="section-number-4">4.1.3</span> 写入图片</h4>
<div class="outline-text-4" id="text-4-1-3">
<p>
使用 matplotlib 来存储图片
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #859900;">import</span> cv2 <span style="color: #859900;">as</span> cv
<span style="color: #859900;">import</span> numpy <span style="color: #859900;">as</span> np
<span style="color: #859900;">import</span> matplotlib.pyplot <span style="color: #859900;">as</span> plt
<span style="color: #6c71c4;">filename</span> = <span style="color: #2aa198;">'../static/image/2019/01/image094201.png'</span>
<span style="color: #6c71c4;">img</span> = cv.imread<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'../static/image/2019/01/lenna.png'</span><span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">img</span> = cv.cvtColor<span style="color: #8d5649;">(</span>img, cv.COLOR_BGR2RGB<span style="color: #8d5649;">)</span>
plt.imshow<span style="color: #8d5649;">(</span>img<span style="color: #8d5649;">)</span>
plt.savefig<span style="color: #8d5649;">(</span>filename<span style="color: #8d5649;">)</span>
<span style="color: #859900;">return</span> filename
</pre>
</div>


<div class="figure">
<p><img src="../static/image/2019/01/image094201.png" alt="image094201.png" />
</p>
</div>

<p>
使用 opencv 来存储图片
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #859900;">import</span> numpy <span style="color: #859900;">as</span> np
<span style="color: #859900;">import</span> matplotlib.pyplot <span style="color: #859900;">as</span> plt
<span style="color: #859900;">import</span> cv2 <span style="color: #859900;">as</span> cv
<span style="color: #6c71c4;">filename</span> = <span style="color: #2aa198;">'../static/image/2019/01/image094813.png'</span>
<span style="color: #6c71c4;">img</span> = cv.imread<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'../static/image/2019/01/lenna.png'</span><span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">gray</span> = cv.cvtColor<span style="color: #8d5649;">(</span>img, cv.COLOR_BGR2GRAY<span style="color: #8d5649;">)</span>
cv.imwrite<span style="color: #8d5649;">(</span>filename, gray<span style="color: #8d5649;">)</span>
<span style="color: #859900;">return</span> filename
</pre>
</div>


<div class="figure">
<p><img src="../static/image/2019/01/image094813.png" alt="image094813.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org8ddb5b2" class="outline-3">
<h3 id="org8ddb5b2"><span class="section-number-3">4.2</span> 视频操作</h3>
<div class="outline-text-3" id="text-4-2">
</div>
<div id="outline-container-org4c49498" class="outline-4">
<h4 id="org4c49498"><span class="section-number-4">4.2.1</span> 读取摄像头数据</h4>
<div class="outline-text-4" id="text-4-2-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #859900;">import</span> numpy <span style="color: #859900;">as</span> np
<span style="color: #859900;">import</span> cv2 <span style="color: #859900;">as</span> cv
<span style="color: #6c71c4;">cap</span> = cv.VideoCapture<span style="color: #8d5649;">(</span>0<span style="color: #8d5649;">)</span>
<span style="color: #859900;">while</span><span style="color: #8d5649;">(</span><span style="color: #268bd2;">True</span><span style="color: #8d5649;">)</span>:
  <span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">Capture frame-by-frame</span>
  <span style="color: #6c71c4;">ret</span>, <span style="color: #6c71c4;">frame</span> = cap.read<span style="color: #8d5649;">()</span>
  <span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">get/set props</span>
  <span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">frame_width = cap.get(cv.CAP_PROP_FRAME_WIDTH)</span>
  <span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">frame_height = cap.get(cv.CAP_PROP_FRAME_HEIGHT)</span>
  <span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">ret = cap.set(cv.CAP_PROP_FRAME_WIDTH, 320)</span>
  <span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">ret = cap.set(cv.CAP_PROP_FRAME_HEIGHT, 240)</span>
  <span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">Our operations on the frame come here</span>
  <span style="color: #6c71c4;">gray</span> = cv.cvtColor<span style="color: #8d5649;">(</span>frame, cv.COLOR_BGR2GRAY<span style="color: #8d5649;">)</span>
  <span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">Display the resulting frame</span>
  cv.imshow<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'frame'</span>, gray<span style="color: #8d5649;">)</span>
  <span style="color: #859900;">if</span> cv.waitKey<span style="color: #8d5649;">(</span>1<span style="color: #8d5649;">)</span> &amp; 0xFF == <span style="color: #6c71c4;">ord</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">'q'</span><span style="color: #8d5649;">)</span>:
    <span style="color: #859900;">break</span>
<span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">When everything done, release the capture</span>
cap.release<span style="color: #8d5649;">()</span>
cv.destroyAllWindows<span style="color: #8d5649;">()</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfd3cb4f" class="outline-4">
<h4 id="orgfd3cb4f"><span class="section-number-4">4.2.2</span> 播放视频文件</h4>
<div class="outline-text-4" id="text-4-2-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #859900;">import</span> numpy <span style="color: #859900;">as</span> np
<span style="color: #859900;">import</span> cv2 <span style="color: #859900;">as</span> cv
<span style="color: #6c71c4;">cap</span> = cv.VideoCapture<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'vtest.avi'</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">while</span><span style="color: #8d5649;">(</span>cap.isOpened<span style="color: #d8241f;">()</span><span style="color: #8d5649;">)</span>:
  <span style="color: #6c71c4;">ret</span>, <span style="color: #6c71c4;">frame</span> = cap.read<span style="color: #8d5649;">()</span>
  <span style="color: #6c71c4;">gray</span> = cv.cvtColor<span style="color: #8d5649;">(</span>frame, cv.COLOR_BGR2GRAY<span style="color: #8d5649;">)</span>
  cv.imshow<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'frame'</span>, gray<span style="color: #8d5649;">)</span>
  <span style="color: #859900;">if</span> cv.waitKey<span style="color: #8d5649;">(</span>1<span style="color: #8d5649;">)</span> &amp; 0xFF == <span style="color: #6c71c4;">ord</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">'q'</span><span style="color: #8d5649;">)</span>:
    <span style="color: #859900;">break</span>
cap.release<span style="color: #8d5649;">()</span>
cv.destroyAllWindows<span style="color: #8d5649;">()</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7f9dd14" class="outline-4">
<h4 id="org7f9dd14"><span class="section-number-4">4.2.3</span> 保存视频文件</h4>
<div class="outline-text-4" id="text-4-2-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #859900;">import</span> numpy <span style="color: #859900;">as</span> np
<span style="color: #859900;">import</span> cv2 <span style="color: #859900;">as</span> cv
<span style="color: #6c71c4;">cap</span> = cv.VideoCapture<span style="color: #8d5649;">(</span>0<span style="color: #8d5649;">)</span>
<span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">Define the codec and create VideoWriter object</span>
<span style="color: #6c71c4;">fourcc</span> = cv.VideoWriter_fourcc<span style="color: #8d5649;">(</span>*<span style="color: #2aa198;">'XVID'</span><span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">out</span> = cv.VideoWriter<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'output.avi'</span>, fourcc, 20.0, <span style="color: #d8241f;">(</span>640, 480<span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">while</span><span style="color: #8d5649;">(</span>cap.isOpened<span style="color: #d8241f;">()</span><span style="color: #8d5649;">)</span>:
  <span style="color: #6c71c4;">ret</span>, <span style="color: #6c71c4;">frame</span> = cap.read<span style="color: #8d5649;">()</span>
  <span style="color: #859900;">if</span> ret == <span style="color: #268bd2;">True</span>:
    <span style="color: #6c71c4;">frame</span> = cv.flip<span style="color: #8d5649;">(</span>frame, 0<span style="color: #8d5649;">)</span>
  <span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">write the flipped frame</span>
  out.write<span style="color: #8d5649;">(</span>frame<span style="color: #8d5649;">)</span>
  cv.imshow<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'frame'</span>, frame<span style="color: #8d5649;">)</span>
  <span style="color: #859900;">if</span> cv.waitKey<span style="color: #8d5649;">(</span>1<span style="color: #8d5649;">)</span> &amp; 0xFF == <span style="color: #6c71c4;">ord</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">'q'</span><span style="color: #8d5649;">)</span>:
    <span style="color: #859900;">break</span>
  <span style="color: #859900;">else</span>:
    <span style="color: #859900;">break</span>
<span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">Release everything if job is finished</span>
cap.release<span style="color: #8d5649;">()</span>
out.release<span style="color: #8d5649;">()</span>
cv.destroyAllWindows<span style="color: #8d5649;">()</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgaa159ff" class="outline-3">
<h3 id="orgaa159ff"><span class="section-number-3">4.3</span> 画图函数</h3>
<div class="outline-text-3" id="text-4-3">
</div>
<div id="outline-container-org3c2f740" class="outline-4">
<h4 id="org3c2f740"><span class="section-number-4">4.3.1</span> 画几何图形</h4>
<div class="outline-text-4" id="text-4-3-1">
<p>
画几何图形，包括：线条、圆、矩形、椭圆等
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #859900;">import</span> numpy <span style="color: #859900;">as</span> np
<span style="color: #859900;">import</span> cv2 <span style="color: #859900;">as</span> cv
<span style="color: #859900;">import</span> matplotlib.pyplot <span style="color: #859900;">as</span> plt
<span style="color: #6c71c4;">filename</span> = <span style="color: #2aa198;">'../static/image/2019/01/image100920.png'</span>

<span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">Create a black image</span>
<span style="color: #6c71c4;">img</span> = np.zeros<span style="color: #8d5649;">(</span><span style="color: #d8241f;">(</span>320, 512, 3<span style="color: #d8241f;">)</span>, np.uint8<span style="color: #8d5649;">)</span>

<span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">cv.line(img, pt1, pt2, color, thickness)</span>
cv.line<span style="color: #8d5649;">(</span>img, <span style="color: #d8241f;">(</span>0, 0<span style="color: #d8241f;">)</span>, <span style="color: #d8241f;">(</span>300, 100<span style="color: #d8241f;">)</span>, <span style="color: #d8241f;">(</span>255, 0, 0<span style="color: #d8241f;">)</span>, 5<span style="color: #8d5649;">)</span>

<span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">cv.rectangle(img, pt1, pt2, color, thickness</span>
cv.rectangle<span style="color: #8d5649;">(</span>img, <span style="color: #d8241f;">(</span>384, 0<span style="color: #d8241f;">)</span>, <span style="color: #d8241f;">(</span>510, 128<span style="color: #d8241f;">)</span>, <span style="color: #d8241f;">(</span>0, 255, 0<span style="color: #d8241f;">)</span>, 3<span style="color: #8d5649;">)</span>

<span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">cv.circle(img, center, radius, color, thickness)</span>
cv.circle<span style="color: #8d5649;">(</span>img, <span style="color: #d8241f;">(</span>447, 63<span style="color: #d8241f;">)</span>, 63, <span style="color: #d8241f;">(</span>0, 0, 255<span style="color: #d8241f;">)</span>, -1<span style="color: #8d5649;">)</span>

<span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">cv.ellipse(img, center, axes, angle, startAngle, endAngle, color, thickness)</span>
cv.ellipse<span style="color: #8d5649;">(</span>img, <span style="color: #d8241f;">(</span>256, 256<span style="color: #d8241f;">)</span>, <span style="color: #d8241f;">(</span>100, 50<span style="color: #d8241f;">)</span>, 0, 0, 180, 255, -1<span style="color: #8d5649;">)</span>

<span style="color: #6c71c4;">pts</span> = np.array<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[</span><span style="color: #9564bf;">[</span>10, 5<span style="color: #9564bf;">]</span>, <span style="color: #9564bf;">[</span>20, 30<span style="color: #9564bf;">]</span>, <span style="color: #9564bf;">[</span>70, 20<span style="color: #9564bf;">]</span>, <span style="color: #9564bf;">[</span>50, 10<span style="color: #9564bf;">]</span><span style="color: #d8241f;">]</span>, np.int32<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">pts</span> = pts.reshape<span style="color: #8d5649;">(</span><span style="color: #d8241f;">(</span>-1, 1, 2<span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>
cv.polylines<span style="color: #8d5649;">(</span>img, <span style="color: #d8241f;">[</span>pts<span style="color: #d8241f;">]</span>, <span style="color: #268bd2;">True</span>, <span style="color: #d8241f;">(</span>0, 255, 255<span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>

plt.imshow<span style="color: #8d5649;">(</span>img<span style="color: #8d5649;">)</span>
plt.savefig<span style="color: #8d5649;">(</span>filename<span style="color: #8d5649;">)</span>
<span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">cv.imwrite(filename, img)</span>
<span style="color: #859900;">return</span> filename
</pre>
</div>


<div class="figure">
<p><img src="../static/image/2019/01/image100920.png" alt="image100920.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgfe7481a" class="outline-4">
<h4 id="orgfe7481a"><span class="section-number-4">4.3.2</span> 写文字</h4>
<div class="outline-text-4" id="text-4-3-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #859900;">import</span> numpy <span style="color: #859900;">as</span> np
<span style="color: #859900;">import</span> cv2 <span style="color: #859900;">as</span> cv
<span style="color: #859900;">import</span> matplotlib.pyplot <span style="color: #859900;">as</span> plt
<span style="color: #6c71c4;">filename</span> = <span style="color: #2aa198;">'../static/image/2019/01/image102219.png'</span>
<span style="color: #6c71c4;">img</span> = np.ones<span style="color: #8d5649;">(</span><span style="color: #d8241f;">(</span>320, 512, 3<span style="color: #d8241f;">)</span>, np.uint8<span style="color: #8d5649;">)</span> * 255

<span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">cv.putText(img, text, org, font, fontScale, color, thickness, bottonLeftOrigin)</span>
<span style="color: #6c71c4;">img</span> = cv.putText<span style="color: #8d5649;">(</span>img, <span style="color: #2aa198;">'OpenCV'</span>, <span style="color: #d8241f;">(</span>100, 100<span style="color: #d8241f;">)</span>, cv.FONT_HERSHEY_PLAIN, 4, <span style="color: #d8241f;">(</span>0, 0, 255<span style="color: #d8241f;">)</span>, 2, cv.LINE_AA<span style="color: #8d5649;">)</span>
<span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">cv.imwrite(filename, img)</span>
plt.imshow<span style="color: #8d5649;">(</span>img<span style="color: #8d5649;">)</span>
plt.savefig<span style="color: #8d5649;">(</span>filename<span style="color: #8d5649;">)</span>
<span style="color: #859900;">return</span> filename
</pre>
</div>


<div class="figure">
<p><img src="../static/image/2019/01/image102219.png" alt="image102219.png" />
</p>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-orgdb9c74a" class="outline-2">
<h2 id="orgdb9c74a"><span class="section-number-2">5</span> 核心操作</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org03db038" class="outline-3">
<h3 id="org03db038"><span class="section-number-3">5.1</span> 基本操作</h3>
<div class="outline-text-3" id="text-5-1">
</div>
<div id="outline-container-orgd79dda1" class="outline-4">
<h4 id="orgd79dda1"><span class="section-number-4">5.1.1</span> 像素操作</h4>
<div class="outline-text-4" id="text-5-1-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #6c71c4;">img</span> = cv.imread<span style="color: #8d5649;">(</span>lenna<span style="color: #8d5649;">)</span>
<span style="color: #859900;">print</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">'px[4, 5] = {}'</span>.<span style="color: #6c71c4;">format</span><span style="color: #d8241f;">(</span>img<span style="color: #9564bf;">[</span>4, 5<span style="color: #9564bf;">]</span><span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">print</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">'blut px[4, 5, 0] = {}'</span>.<span style="color: #6c71c4;">format</span><span style="color: #d8241f;">(</span>img<span style="color: #9564bf;">[</span>4, 5, 0<span style="color: #9564bf;">]</span><span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>
</pre>
</div>

<pre class="example">
px[4, 5] = [116 129 226]
blut px[4, 5, 0] = 116

</pre>
</div>
</div>

<div id="outline-container-orgb77fda5" class="outline-4">
<h4 id="orgb77fda5"><span class="section-number-4">5.1.2</span> 相片属性</h4>
<div class="outline-text-4" id="text-5-1-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #6c71c4;">img</span> = cv.imread<span style="color: #8d5649;">(</span>lenna<span style="color: #8d5649;">)</span>
<span style="color: #859900;">print</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">'shape = {}, size = {}, dtype = {}'</span>.<span style="color: #6c71c4;">format</span><span style="color: #d8241f;">(</span>img.shape, img.size, img.dtype<span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>
</pre>
</div>

<pre class="example">
shape = (512, 512, 3), size = 786432, dtype = uint8

</pre>
</div>
</div>

<div id="outline-container-org5cd2d37" class="outline-4">
<h4 id="org5cd2d37"><span class="section-number-4">5.1.3</span> 子图片和通道</h4>
<div class="outline-text-4" id="text-5-1-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #859900;">import</span> numpy <span style="color: #859900;">as</span> np
<span style="color: #859900;">import</span> matplotlib.pyplot <span style="color: #859900;">as</span> plt
<span style="color: #859900;">import</span> cv2 <span style="color: #859900;">as</span> cv
<span style="color: #6c71c4;">filename</span> = <span style="color: #2aa198;">'../static/image/2019/01/image135851.png'</span>
<span style="color: #6c71c4;">lenna</span> = <span style="color: #2aa198;">'../static/image/2019/01/lenna.png'</span>

<span style="color: #6c71c4;">img</span> = cv.cvtColor<span style="color: #8d5649;">(</span>cv.imread<span style="color: #d8241f;">(</span>lenna<span style="color: #d8241f;">)</span>, cv.COLOR_BGR2RGB<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">subimg</span> = img<span style="color: #8d5649;">[</span>100:400, 100:400<span style="color: #8d5649;">]</span>

<span style="color: #93a1a1; font-style: italic;">#</span><span style="color: #93a1a1; font-style: italic;">rimg, gimg, bimg = cv.split(subimg)</span>
<span style="color: #6c71c4;">rimg</span>, <span style="color: #6c71c4;">gimg</span>, <span style="color: #6c71c4;">bimg</span> = subimg<span style="color: #8d5649;">[</span>:, :, 0<span style="color: #8d5649;">]</span>, subimg<span style="color: #8d5649;">[</span>:, :, 1<span style="color: #8d5649;">]</span>, subimg<span style="color: #8d5649;">[</span>:, :, 2<span style="color: #8d5649;">]</span>

<span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">nrow, ncol, index</span>
plt.subplot<span style="color: #8d5649;">(</span>231<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>img<span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'original'</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>233<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>subimg<span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'croped'</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>234<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>rimg<span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'red channel'</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>235<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>gimg<span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'green channel'</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>236<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>bimg<span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'blue channel'</span><span style="color: #8d5649;">)</span>
plt.savefig<span style="color: #8d5649;">(</span>filename<span style="color: #8d5649;">)</span>

<span style="color: #859900;">return</span> filename
</pre>
</div>


<div class="figure">
<p><img src="../static/image/2019/01/image135851.png" alt="image135851.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgab9f3d7" class="outline-4">
<h4 id="orgab9f3d7"><span class="section-number-4">5.1.4</span> 图片边框</h4>
<div class="outline-text-4" id="text-5-1-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #859900;">import</span> numpy <span style="color: #859900;">as</span> np
<span style="color: #859900;">import</span> matplotlib.pyplot <span style="color: #859900;">as</span> plt
<span style="color: #859900;">import</span> cv2 <span style="color: #859900;">as</span> cv
<span style="color: #6c71c4;">filename</span> = <span style="color: #2aa198;">'../static/image/2019/01/image141331.png'</span>
<span style="color: #6c71c4;">lenna</span> = <span style="color: #2aa198;">'../static/image/2019/01/lenna.png'</span>

<span style="color: #6c71c4;">BLUE</span> = <span style="color: #8d5649;">[</span>255, 0, 0<span style="color: #8d5649;">]</span>
<span style="color: #6c71c4;">img</span> = cv.cvtColor<span style="color: #8d5649;">(</span>cv.imread<span style="color: #d8241f;">(</span>lenna<span style="color: #d8241f;">)</span>, cv.COLOR_BGR2RGB<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">replicate</span> = cv.copyMakeBorder<span style="color: #8d5649;">(</span>img, 20, 20, 20, 20, cv.BORDER_REPLICATE<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">reflect</span> = cv.copyMakeBorder<span style="color: #8d5649;">(</span>img, 20, 20, 20, 20, cv.BORDER_REFLECT<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">reflect101</span> = cv.copyMakeBorder<span style="color: #8d5649;">(</span>img, 20, 20, 20, 20, cv.BORDER_REFLECT_101<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">wrap</span> = cv.copyMakeBorder<span style="color: #8d5649;">(</span>img, 20, 20, 20, 20, cv.BORDER_WRAP<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">constant</span> = cv.copyMakeBorder<span style="color: #8d5649;">(</span>img, 20, 20, 20, 20, cv.BORDER_CONSTANT, value=BLUE<span style="color: #8d5649;">)</span>


plt.subplot<span style="color: #8d5649;">(</span>231<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>img, <span style="color: #2aa198;">'gray'</span><span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'ORIGINAL'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>232<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>replicate, <span style="color: #2aa198;">'gray'</span><span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'REPLICATE'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>233<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>reflect, <span style="color: #2aa198;">'gray'</span><span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'REFLECT'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>234<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>reflect101, <span style="color: #2aa198;">'gray'</span><span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'REFLECT_101'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>235<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>wrap, <span style="color: #2aa198;">'gray'</span><span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'WRAP'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>236<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>constant, <span style="color: #2aa198;">'gray'</span><span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'CONSTANT'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>

plt.savefig<span style="color: #8d5649;">(</span>filename<span style="color: #8d5649;">)</span>
<span style="color: #859900;">return</span> filename
</pre>
</div>


<div class="figure">
<p><img src="../static/image/2019/01/image141331.png" alt="image141331.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org1883793" class="outline-3">
<h3 id="org1883793"><span class="section-number-3">5.2</span> 算术操作</h3>
<div class="outline-text-3" id="text-5-2">
</div>
<div id="outline-container-org419fc0d" class="outline-4">
<h4 id="org419fc0d"><span class="section-number-4">5.2.1</span> 图片相加</h4>
<div class="outline-text-4" id="text-5-2-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #6c71c4;">x</span> = np.uint8<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[</span>250<span style="color: #d8241f;">]</span><span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">y</span> = np.uint8<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[</span>10<span style="color: #d8241f;">]</span><span style="color: #8d5649;">)</span>
<span style="color: #859900;">print</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">'cv.add(x,y) = {}'</span>.<span style="color: #6c71c4;">format</span><span style="color: #d8241f;">(</span>cv.add<span style="color: #9564bf;">(</span>x, y<span style="color: #9564bf;">)</span><span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span> <span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">250+10 = 260 =&gt; 255</span>
<span style="color: #859900;">print</span><span style="color: #8d5649;">(</span><span style="color: #2aa198;">'x + y = {}'</span>.<span style="color: #6c71c4;">format</span><span style="color: #d8241f;">(</span>x + y<span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>              <span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">250+10 = 260 % 256 =&gt; 4</span>
</pre>
</div>

<pre class="example">
cv.add(x,y) = [[255]]
x + y = [4]

</pre>
</div>
</div>

<div id="outline-container-org2aaf0a9" class="outline-4">
<h4 id="org2aaf0a9"><span class="section-number-4">5.2.2</span> 图片混合(Blending)</h4>
<div class="outline-text-4" id="text-5-2-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #859900;">import</span> numpy <span style="color: #859900;">as</span> np
<span style="color: #859900;">import</span> matplotlib.pyplot <span style="color: #859900;">as</span> plt
<span style="color: #859900;">import</span> cv2 <span style="color: #859900;">as</span> cv
<span style="color: #6c71c4;">filename</span> = <span style="color: #2aa198;">'../static/image/2019/01/image142651.png'</span>
<span style="color: #6c71c4;">lenna</span> = cv.cvtColor<span style="color: #8d5649;">(</span>cv.imread<span style="color: #d8241f;">(</span><span style="color: #2aa198;">'../static/image/2019/01/lenna.png'</span><span style="color: #d8241f;">)</span>, cv.COLOR_BGR2RGB<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">circle</span> = np.zeros<span style="color: #8d5649;">(</span>lenna.shape<span style="color: #8d5649;">)</span>.astype<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'uint8'</span><span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">cx</span>, <span style="color: #6c71c4;">cy</span> = <span style="color: #6c71c4;">int</span><span style="color: #8d5649;">(</span>lenna.shape<span style="color: #d8241f;">[</span>0<span style="color: #d8241f;">]</span> / 2<span style="color: #8d5649;">)</span>, <span style="color: #6c71c4;">int</span><span style="color: #8d5649;">(</span>lenna.shape<span style="color: #d8241f;">[</span>1<span style="color: #d8241f;">]</span> / 2<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">circle</span> = cv.circle<span style="color: #8d5649;">(</span>circle, <span style="color: #d8241f;">(</span>cx, cy<span style="color: #d8241f;">)</span>, 250, <span style="color: #d8241f;">(</span>255, 255, 255<span style="color: #d8241f;">)</span>, -1<span style="color: #8d5649;">)</span>

<span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">dst = 0.7*lenna + 0.3*circle + 0</span>
<span style="color: #6c71c4;">dst</span> = cv.addWeighted<span style="color: #8d5649;">(</span>lenna, 0.7, circle, 0.3, 0<span style="color: #8d5649;">)</span>

plt.subplot<span style="color: #8d5649;">(</span>131<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>lenna<span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'lenna'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>132<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>circle<span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'circle'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>133<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>dst<span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'dst'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>

plt.savefig<span style="color: #8d5649;">(</span>filename<span style="color: #8d5649;">)</span>
<span style="color: #859900;">return</span> filename
</pre>
</div>


<div class="figure">
<p><img src="../static/image/2019/01/image142651.png" alt="image142651.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgb4c04f0" class="outline-4">
<h4 id="orgb4c04f0"><span class="section-number-4">5.2.3</span> 位操作</h4>
<div class="outline-text-4" id="text-5-2-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #859900;">import</span> numpy <span style="color: #859900;">as</span> np
<span style="color: #859900;">import</span> matplotlib.pyplot <span style="color: #859900;">as</span> plt
<span style="color: #859900;">import</span> cv2 <span style="color: #859900;">as</span> cv

<span style="color: #6c71c4;">filename</span> = <span style="color: #2aa198;">'../static/image/2019/01/image150141.png'</span>
<span style="color: #6c71c4;">lenna</span> = cv.cvtColor<span style="color: #8d5649;">(</span>cv.imread<span style="color: #d8241f;">(</span><span style="color: #2aa198;">'../static/image/2019/01/lenna.png'</span><span style="color: #d8241f;">)</span>, cv.COLOR_BGR2RGB<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">roi</span> = np.zeros<span style="color: #8d5649;">(</span>lenna.shape<span style="color: #8d5649;">)</span>.astype<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'uint8'</span><span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">cx</span>, <span style="color: #6c71c4;">cy</span> = <span style="color: #6c71c4;">int</span><span style="color: #8d5649;">(</span>lenna.shape<span style="color: #d8241f;">[</span>0<span style="color: #d8241f;">]</span> / 2<span style="color: #8d5649;">)</span>, <span style="color: #6c71c4;">int</span><span style="color: #8d5649;">(</span>lenna.shape<span style="color: #d8241f;">[</span>1<span style="color: #d8241f;">]</span> / 2<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">roi</span> = cv.circle<span style="color: #8d5649;">(</span>roi, <span style="color: #d8241f;">(</span>cx, cy<span style="color: #d8241f;">)</span>, 250, <span style="color: #d8241f;">(</span>255, 255, 255<span style="color: #d8241f;">)</span>, -1<span style="color: #8d5649;">)</span>

<span style="color: #6c71c4;">andimg</span> = cv.bitwise_and<span style="color: #8d5649;">(</span>lenna, roi<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">orimg</span> = cv.bitwise_or<span style="color: #8d5649;">(</span>lenna, roi<span style="color: #8d5649;">)</span>

plt.subplot<span style="color: #8d5649;">(</span>221<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>lenna<span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'lenna'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>222<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>roi<span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'roi'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>223<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>andimg<span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'and'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>224<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>orimg<span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'or'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>

plt.savefig<span style="color: #8d5649;">(</span>filename<span style="color: #8d5649;">)</span>
<span style="color: #859900;">return</span> filename
</pre>
</div>


<div class="figure">
<p><img src="../static/image/2019/01/image150141.png" alt="image150141.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org731a6ec" class="outline-3">
<h3 id="org731a6ec"><span class="section-number-3">5.3</span> 图片处理</h3>
<div class="outline-text-3" id="text-5-3">
</div>
<div id="outline-container-orgf27a03f" class="outline-4">
<h4 id="orgf27a03f"><span class="section-number-4">5.3.1</span> 几何变换</h4>
<div class="outline-text-4" id="text-5-3-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #859900;">import</span> numpy <span style="color: #859900;">as</span> np
<span style="color: #859900;">import</span> matplotlib.pyplot <span style="color: #859900;">as</span> plt
<span style="color: #859900;">import</span> cv2 <span style="color: #859900;">as</span> cv

<span style="color: #6c71c4;">filename</span> = <span style="color: #2aa198;">'../static/image/2019/01/image152231.png'</span>
<span style="color: #6c71c4;">lenna</span> = cv.cvtColor<span style="color: #8d5649;">(</span>cv.imread<span style="color: #d8241f;">(</span><span style="color: #2aa198;">'../static/image/2019/01/lenna.png'</span><span style="color: #d8241f;">)</span>, cv.COLOR_BGR2RGB<span style="color: #8d5649;">)</span>


<span style="color: #859900;">def</span> <span style="color: #b58900;">scale</span><span style="color: #8d5649;">(</span>img, scale_x, scale_y<span style="color: #8d5649;">)</span>:
  <span style="color: #6c71c4;">h</span>, <span style="color: #6c71c4;">w</span> = img.shape<span style="color: #8d5649;">[</span>:2<span style="color: #8d5649;">]</span>
  <span style="color: #859900;">return</span> cv.resize<span style="color: #8d5649;">(</span>img, <span style="color: #d8241f;">(</span><span style="color: #6c71c4;">int</span><span style="color: #9564bf;">(</span>h * scale_y<span style="color: #9564bf;">)</span>, <span style="color: #6c71c4;">int</span><span style="color: #9564bf;">(</span>w * scale_x<span style="color: #9564bf;">)</span><span style="color: #d8241f;">)</span>, interpolation=cv.INTER_CUBIC<span style="color: #8d5649;">)</span>


<span style="color: #859900;">def</span> <span style="color: #b58900;">translation</span><span style="color: #8d5649;">(</span>img, trans_x, trans_y<span style="color: #8d5649;">)</span>:
  <span style="color: #6c71c4;">h</span>, <span style="color: #6c71c4;">w</span> = img.shape<span style="color: #8d5649;">[</span>:2<span style="color: #8d5649;">]</span>
  <span style="color: #6c71c4;">M</span> = np.float32<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[</span><span style="color: #9564bf;">[</span>1, 0, trans_x<span style="color: #9564bf;">]</span>, <span style="color: #9564bf;">[</span>0, 1, trans_y<span style="color: #9564bf;">]</span><span style="color: #d8241f;">]</span><span style="color: #8d5649;">)</span>
  <span style="color: #859900;">return</span> cv.warpAffine<span style="color: #8d5649;">(</span>img, M, <span style="color: #d8241f;">(</span>h, w<span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>


<span style="color: #859900;">def</span> <span style="color: #b58900;">rotate</span><span style="color: #8d5649;">(</span>img, angle<span style="color: #8d5649;">)</span>:
  <span style="color: #6c71c4;">h</span>, <span style="color: #6c71c4;">w</span> = img.shape<span style="color: #8d5649;">[</span>:2<span style="color: #8d5649;">]</span>
  <span style="color: #6c71c4;">center</span> = <span style="color: #6c71c4;">int</span><span style="color: #8d5649;">(</span>w / 2.0<span style="color: #8d5649;">)</span>, <span style="color: #6c71c4;">int</span><span style="color: #8d5649;">(</span>h / 2.0<span style="color: #8d5649;">)</span>
  <span style="color: #6c71c4;">M</span> = cv.getRotationMatrix2D<span style="color: #8d5649;">(</span>center, angle, 1<span style="color: #8d5649;">)</span>
  <span style="color: #859900;">return</span> cv.warpAffine<span style="color: #8d5649;">(</span>img, M, <span style="color: #d8241f;">(</span>w, h<span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>


<span style="color: #859900;">def</span> <span style="color: #b58900;">affine</span><span style="color: #8d5649;">(</span>img, pts1, pts2<span style="color: #8d5649;">)</span>:
  <span style="color: #6c71c4;">h</span>, <span style="color: #6c71c4;">w</span>, <span style="color: #6c71c4;">d</span> = img.shape
  <span style="color: #6c71c4;">M</span> = cv.getAffineTransform<span style="color: #8d5649;">(</span>pts1, pts2<span style="color: #8d5649;">)</span>
  <span style="color: #859900;">return</span> cv.warpAffine<span style="color: #8d5649;">(</span>img, M, <span style="color: #d8241f;">(</span>w, h<span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>


<span style="color: #859900;">def</span> <span style="color: #b58900;">perspective</span><span style="color: #8d5649;">(</span>img, pts1, pts2<span style="color: #8d5649;">)</span>:
  <span style="color: #6c71c4;">h</span>, <span style="color: #6c71c4;">w</span>, <span style="color: #6c71c4;">d</span> = img.shape
  <span style="color: #6c71c4;">M</span> = cv.getPerspectiveTransform<span style="color: #8d5649;">(</span>pts1, pts2<span style="color: #8d5649;">)</span>
  <span style="color: #859900;">return</span> cv.warpPerspective<span style="color: #8d5649;">(</span>img, M, <span style="color: #d8241f;">(</span>w, h<span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>


<span style="color: #6c71c4;">lenna_scale</span> = scale<span style="color: #8d5649;">(</span>lenna, 1.5, 2<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">lenna_trans</span> = translation<span style="color: #8d5649;">(</span>lenna, 50, 100<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">lenna_rotate120</span> = rotate<span style="color: #8d5649;">(</span>lenna, 120<span style="color: #8d5649;">)</span>

<span style="color: #6c71c4;">pts1</span> = np.float32<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[</span><span style="color: #9564bf;">[</span>50, 50<span style="color: #9564bf;">]</span>, <span style="color: #9564bf;">[</span>200, 50<span style="color: #9564bf;">]</span>, <span style="color: #9564bf;">[</span>50, 200<span style="color: #9564bf;">]</span><span style="color: #d8241f;">]</span><span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">pts2</span> = np.float32<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[</span><span style="color: #9564bf;">[</span>10, 100<span style="color: #9564bf;">]</span>, <span style="color: #9564bf;">[</span>200, 50<span style="color: #9564bf;">]</span>, <span style="color: #9564bf;">[</span>100, 250<span style="color: #9564bf;">]</span><span style="color: #d8241f;">]</span><span style="color: #8d5649;">)</span>
<span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">mapping three points from origin picture to dest picture, using affine transform</span>
<span style="color: #6c71c4;">lenna_affine</span> = affine<span style="color: #8d5649;">(</span>lenna, pts1, pts2<span style="color: #8d5649;">)</span>

<span style="color: #6c71c4;">pts3</span> = np.float32<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[</span><span style="color: #9564bf;">[</span>0, 0<span style="color: #9564bf;">]</span>, <span style="color: #9564bf;">[</span>512, 0<span style="color: #9564bf;">]</span>, <span style="color: #9564bf;">[</span>0, 512<span style="color: #9564bf;">]</span>, <span style="color: #9564bf;">[</span>512, 512<span style="color: #9564bf;">]</span><span style="color: #d8241f;">]</span><span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">pts4</span> = np.float32<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[</span><span style="color: #9564bf;">[</span>100, 300<span style="color: #9564bf;">]</span>, <span style="color: #9564bf;">[</span>350, 300<span style="color: #9564bf;">]</span>, <span style="color: #9564bf;">[</span>0, 512<span style="color: #9564bf;">]</span>, <span style="color: #9564bf;">[</span>512, 512<span style="color: #9564bf;">]</span><span style="color: #d8241f;">]</span><span style="color: #8d5649;">)</span>
<span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">mapping four points, using perspective transform</span>
<span style="color: #6c71c4;">lenna_perspective</span> = perspective<span style="color: #8d5649;">(</span>lenna, pts3, pts4<span style="color: #8d5649;">)</span>

plt.subplot<span style="color: #8d5649;">(</span>231<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>lenna<span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'lenna'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>232<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>lenna_scale<span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'scale'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>233<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>lenna_trans<span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'translation'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>234<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>lenna_rotate120<span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'rotate 120$\degree$'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>235<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>lenna_affine<span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'affine'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>236<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>lenna_perspective<span style="color: #8d5649;">)</span>, plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'perspective'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>

plt.savefig<span style="color: #8d5649;">(</span>filename<span style="color: #8d5649;">)</span>
<span style="color: #859900;">return</span> filename
</pre>
</div>


<div class="figure">
<p><img src="../static/image/2019/01/image152231.png" alt="image152231.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgcd5c99f" class="outline-4">
<h4 id="orgcd5c99f"><span class="section-number-4">5.3.2</span> 二值化(Thresholding)</h4>
<div class="outline-text-4" id="text-5-3-2">
</div>
<ol class="org-ol">
<li><a id="org1b3f70c"></a>普通二值化<br />
<div class="outline-text-5" id="text-5-3-2-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #859900;">import</span> numpy <span style="color: #859900;">as</span> np
<span style="color: #859900;">import</span> matplotlib.pyplot <span style="color: #859900;">as</span> plt
<span style="color: #859900;">import</span> cv2 <span style="color: #859900;">as</span> cv
<span style="color: #6c71c4;">filename</span> = <span style="color: #2aa198;">'../static/image/2019/01/image190450.png'</span>
<span style="color: #6c71c4;">img</span> = cv.imread<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'../static/image/2019/01/lena_meyer.png'</span>, 0<span style="color: #8d5649;">)</span>

<span style="color: #6c71c4;">ret</span>, <span style="color: #6c71c4;">thresh1</span> = cv.threshold<span style="color: #8d5649;">(</span>img, 127, 255, cv.THRESH_BINARY<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">ret</span>, <span style="color: #6c71c4;">thresh2</span> = cv.threshold<span style="color: #8d5649;">(</span>img, 127, 255, cv.THRESH_BINARY_INV<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">ret</span>, <span style="color: #6c71c4;">thresh3</span> = cv.threshold<span style="color: #8d5649;">(</span>img, 127, 255, cv.THRESH_TRUNC<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">ret</span>, <span style="color: #6c71c4;">thresh4</span> = cv.threshold<span style="color: #8d5649;">(</span>img, 127, 255, cv.THRESH_TOZERO<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">ret</span>, <span style="color: #6c71c4;">thresh5</span> = cv.threshold<span style="color: #8d5649;">(</span>img, 127, 255, cv.THRESH_TOZERO_INV<span style="color: #8d5649;">)</span>

<span style="color: #6c71c4;">titles</span> = <span style="color: #8d5649;">[</span><span style="color: #2aa198;">'Original Image'</span>, <span style="color: #2aa198;">'BINARY'</span>, <span style="color: #2aa198;">'BINARY_INV'</span>, <span style="color: #2aa198;">'TRUNC'</span>, <span style="color: #2aa198;">'TOZERO'</span>, <span style="color: #2aa198;">'TOZERO_INV'</span><span style="color: #8d5649;">]</span>
<span style="color: #6c71c4;">images</span> = <span style="color: #8d5649;">[</span>img, thresh1, thresh2, thresh3, thresh4, thresh5<span style="color: #8d5649;">]</span>
<span style="color: #859900;">for</span> i <span style="color: #859900;">in</span> <span style="color: #6c71c4;">range</span><span style="color: #8d5649;">(</span>6<span style="color: #8d5649;">)</span>:
  plt.subplot<span style="color: #8d5649;">(</span>2, 3, i+1<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>images<span style="color: #d8241f;">[</span>i<span style="color: #d8241f;">]</span>, <span style="color: #2aa198;">'gray'</span><span style="color: #8d5649;">)</span>
  plt.title<span style="color: #8d5649;">(</span>titles<span style="color: #d8241f;">[</span>i<span style="color: #d8241f;">]</span><span style="color: #8d5649;">)</span>
  plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>

plt.savefig<span style="color: #8d5649;">(</span>filename<span style="color: #8d5649;">)</span>
<span style="color: #859900;">return</span> filename
</pre>
</div>


<div class="figure">
<p><img src="../static/image/2019/01/image190450.png" alt="image190450.png" />
</p>
</div>
</div>
</li>

<li><a id="orgf15c10f"></a>自适应二值化<br />
<div class="outline-text-5" id="text-5-3-2-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #859900;">import</span> numpy <span style="color: #859900;">as</span> np
<span style="color: #859900;">import</span> matplotlib.pyplot <span style="color: #859900;">as</span> plt
<span style="color: #859900;">import</span> cv2 <span style="color: #859900;">as</span> cv
<span style="color: #6c71c4;">filename</span> = <span style="color: #2aa198;">'../static/image/2019/01/image191045.png'</span>
<span style="color: #6c71c4;">img</span> = cv.imread<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'../static/image/2019/01/lena_meyer.png'</span>, 0<span style="color: #8d5649;">)</span>

<span style="color: #6c71c4;">img</span> = cv.medianBlur<span style="color: #8d5649;">(</span>img, 5<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">ret</span>, <span style="color: #6c71c4;">th1</span> = cv.threshold<span style="color: #8d5649;">(</span>img, 127, 255, cv.THRESH_BINARY<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">th2</span> = cv.adaptiveThreshold<span style="color: #8d5649;">(</span>img, 255, cv.ADAPTIVE_THRESH_MEAN_C, cv.THRESH_BINARY, 11, 2<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">th3</span> = cv.adaptiveThreshold<span style="color: #8d5649;">(</span>img, 255, cv.ADAPTIVE_THRESH_GAUSSIAN_C, cv.THRESH_BINARY, 11, 2<span style="color: #8d5649;">)</span>

<span style="color: #6c71c4;">titles</span> = <span style="color: #8d5649;">[</span>
    <span style="color: #2aa198;">'Original Image'</span>, <span style="color: #2aa198;">'Global Thresholding (v = 127)'</span>,
    <span style="color: #2aa198;">'Adaptive Mean Thresholding'</span>, <span style="color: #2aa198;">'Adaptive Gaussian Thresholding'</span>
<span style="color: #8d5649;">]</span>
<span style="color: #6c71c4;">images</span> = <span style="color: #8d5649;">[</span>img, th1, th2, th3<span style="color: #8d5649;">]</span>
<span style="color: #859900;">for</span> i <span style="color: #859900;">in</span> <span style="color: #6c71c4;">range</span><span style="color: #8d5649;">(</span>4<span style="color: #8d5649;">)</span>:
  plt.subplot<span style="color: #8d5649;">(</span>2, 2, i+1<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>images<span style="color: #d8241f;">[</span>i<span style="color: #d8241f;">]</span>, <span style="color: #2aa198;">'gray'</span><span style="color: #8d5649;">)</span>
  plt.title<span style="color: #8d5649;">(</span>titles<span style="color: #d8241f;">[</span>i<span style="color: #d8241f;">]</span><span style="color: #8d5649;">)</span>
  plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.savefig<span style="color: #8d5649;">(</span>filename<span style="color: #8d5649;">)</span>
<span style="color: #859900;">return</span> filename
</pre>
</div>


<div class="figure">
<p><img src="../static/image/2019/01/image191045.png" alt="image191045.png" />
</p>
</div>
</div>
</li>

<li><a id="orge7b9c63"></a>Otsu 二值化<br />
<div class="outline-text-5" id="text-5-3-2-3">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #859900;">import</span> numpy <span style="color: #859900;">as</span> np
<span style="color: #859900;">import</span> matplotlib.pyplot <span style="color: #859900;">as</span> plt
<span style="color: #859900;">import</span> cv2 <span style="color: #859900;">as</span> cv
<span style="color: #6c71c4;">filename</span> = <span style="color: #2aa198;">'../static/image/2019/01/image193021.png'</span>
<span style="color: #6c71c4;">img</span> = cv.imread<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'../static/image/2019/01/lenna.png'</span>,0<span style="color: #8d5649;">)</span>

<span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">global thresholding</span>
<span style="color: #6c71c4;">ret1</span>,<span style="color: #6c71c4;">th1</span> = cv.threshold<span style="color: #8d5649;">(</span>img,127,255,cv.THRESH_BINARY<span style="color: #8d5649;">)</span>

<span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">Otsu's thresholding</span>
<span style="color: #6c71c4;">ret2</span>,<span style="color: #6c71c4;">th2</span> = cv.threshold<span style="color: #8d5649;">(</span>img,0,255,cv.THRESH_BINARY+cv.THRESH_OTSU<span style="color: #8d5649;">)</span>

<span style="color: #93a1a1; font-style: italic;"># </span><span style="color: #93a1a1; font-style: italic;">Otsu's thresholding after Gaussian filtering</span>
<span style="color: #6c71c4;">blur</span> = cv.GaussianBlur<span style="color: #8d5649;">(</span>img,<span style="color: #d8241f;">(</span>5,5<span style="color: #d8241f;">)</span>,0<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">ret3</span>,<span style="color: #6c71c4;">th3</span> = cv.threshold<span style="color: #8d5649;">(</span>blur,0,255,cv.THRESH_BINARY+cv.THRESH_OTSU<span style="color: #8d5649;">)</span>

<span style="color: #6c71c4;">images</span> = <span style="color: #8d5649;">[</span>img, th1, th2, th3<span style="color: #8d5649;">]</span>
<span style="color: #859900;">for</span> i <span style="color: #859900;">in</span> <span style="color: #6c71c4;">range</span><span style="color: #8d5649;">(</span>4<span style="color: #8d5649;">)</span>:
  plt.subplot<span style="color: #8d5649;">(</span>2,2, i+1<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>images<span style="color: #d8241f;">[</span>i<span style="color: #d8241f;">]</span>, <span style="color: #2aa198;">'gray'</span><span style="color: #8d5649;">)</span>
  plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.savefig<span style="color: #8d5649;">(</span>filename<span style="color: #8d5649;">)</span>
<span style="color: #859900;">return</span> filename
</pre>
</div>


<div class="figure">
<p><img src="../static/image/2019/01/image193021.png" alt="image193021.png" />
</p>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org6d9d224" class="outline-4">
<h4 id="org6d9d224"><span class="section-number-4">5.3.3</span> 平滑(Smoothing Images)</h4>
<div class="outline-text-4" id="text-5-3-3">
</div>
<ol class="org-ol">
<li><a id="orga91e5ed"></a>卷积<br />
<div class="outline-text-5" id="text-5-3-3-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #859900;">import</span> numpy <span style="color: #859900;">as</span> np
<span style="color: #859900;">import</span> matplotlib.pyplot <span style="color: #859900;">as</span> plt
<span style="color: #859900;">import</span> cv2 <span style="color: #859900;">as</span> cv
<span style="color: #6c71c4;">filename</span> = <span style="color: #2aa198;">'../static/image/2019/01/image190747.png'</span>

<span style="color: #6c71c4;">img</span> = cv.imread<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'../static/image/2019/01/lena_meyer.png'</span><span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">img</span> = cv.cvtColor<span style="color: #8d5649;">(</span>img, cv.COLOR_BGR2RGB<span style="color: #8d5649;">)</span>
<span style="color: #6c71c4;">kernel</span> = np.ones<span style="color: #8d5649;">(</span><span style="color: #d8241f;">(</span>5, 5<span style="color: #d8241f;">)</span>, np.float32<span style="color: #8d5649;">)</span>/25
<span style="color: #6c71c4;">dst</span> = cv.filter2D<span style="color: #8d5649;">(</span>img, -1, kernel<span style="color: #8d5649;">)</span>

plt.subplot<span style="color: #8d5649;">(</span>121<span style="color: #8d5649;">)</span>,plt.imshow<span style="color: #8d5649;">(</span>img<span style="color: #8d5649;">)</span>,plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'Original'</span><span style="color: #8d5649;">)</span>
plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>122<span style="color: #8d5649;">)</span>,plt.imshow<span style="color: #8d5649;">(</span>dst<span style="color: #8d5649;">)</span>,plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'Averaging'</span><span style="color: #8d5649;">)</span>
plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.savefig<span style="color: #8d5649;">(</span>filename<span style="color: #8d5649;">)</span>

<span style="color: #859900;">return</span> filename
</pre>
</div>


<div class="figure">
<p><img src="../static/image/2019/01/image190747.png" alt="image190747.png" />
</p>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org88b4a24" class="outline-4">
<h4 id="org88b4a24"><span class="section-number-4">5.3.4</span> Canny 边界检测</h4>
<div class="outline-text-4" id="text-5-3-4">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #859900;">import</span> numpy <span style="color: #859900;">as</span> np
<span style="color: #859900;">import</span> matplotlib.pyplot <span style="color: #859900;">as</span> plt
<span style="color: #859900;">import</span> cv2 <span style="color: #859900;">as</span> cv
<span style="color: #6c71c4;">filename</span> = <span style="color: #2aa198;">'../static/image/2019/01/image203420.png'</span>
<span style="color: #6c71c4;">img</span> = cv.imread<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'../static/image/2019/01/lena_meyer.png'</span>, 0<span style="color: #8d5649;">)</span>

<span style="color: #6c71c4;">edges</span>=cv.Canny<span style="color: #8d5649;">(</span>img, 100, 200<span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>121<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>img, cmap=<span style="color: #2aa198;">'gray'</span><span style="color: #8d5649;">)</span>
plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'Original Image'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>
plt.subplot<span style="color: #8d5649;">(</span>122<span style="color: #8d5649;">)</span>, plt.imshow<span style="color: #8d5649;">(</span>edges, cmap=<span style="color: #2aa198;">'gray'</span><span style="color: #8d5649;">)</span>
plt.title<span style="color: #8d5649;">(</span><span style="color: #2aa198;">'Edge Image'</span><span style="color: #8d5649;">)</span>, plt.xticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>, plt.yticks<span style="color: #8d5649;">(</span><span style="color: #d8241f;">[]</span><span style="color: #8d5649;">)</span>

plt.savefig<span style="color: #8d5649;">(</span>filename<span style="color: #8d5649;">)</span>
<span style="color: #859900;">return</span> filename
</pre>
</div>


<div class="figure">
<p><img src="../static/image/2019/01/image203420.png" alt="image203420.png" />
</p>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-orga62bd1e" class="outline-2">
<h2 id="orga62bd1e"><span class="section-number-2">6</span> 参考链接</h2>
<div class="outline-text-2" id="text-6">
<ol class="org-ol">
<li><a href="https://docs.opencv.org/4.0.0/pages.html">OpenCV Documetation</a></li>
<li><a href="https://docs.opencv.org/4.0.0/d6/d00/tutorial_py_root.html">OpenCV-Python Tutorials</a></li>
<li><a href="http://www.lenna.org/">Lenna Intro</a></li>
</ol>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2019-01-25 Fri 00:00</p>
<p class="author">Author: Jinghui Hu</p>
<p class="date">Created: 2019-07-02 Tue 12:06</p>
<p class="validation"></p>
</div>
</body>
</html>
