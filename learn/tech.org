#+TITLE: æŠ€æœ¯æ–‡æ¡£
#+AUTHOR: Jinghui Hu
#+EMAIL: hujinghui@buaa.edu.cn
#+DATE: <2023-01-29 Sun 10:55:28>
#+HTML_LINK_UP: ../readme.html
#+HTML_LINK_HOME: ../index.html
#+SETUPFILE: ~/.emacs.d/site-lisp/org-html-themes/setup/theme-readtheorg-local.setup
#+STARTUP: indent cache num inlineimages
#+LATEX_COMPILER: xelatex
#+LATEX_CLASS: beamer
#+LATEX_CLASS_OPTIONS: [presentation]
#+LATEX_HEADER: \usepackage[scheme=plain]{ctex}
#+BEAMER_THEME: boxes


* Oracle
** ğŸ“š å‚è€ƒèµ„æ–™
1. Oracle å…³ç³»æ•°æ®åº“ [[file:../database/oracle.org::*å‚è€ƒé“¾æ¥][å‚è€ƒé“¾æ¥]]
** å¼€å‘ç¯å¢ƒé…ç½®
*** Centos 7
1. [[https://hub.docker.com/_/centos/][docker container]]
2. å¯åŠ¨ centos7 é•œåƒ
   #+BEGIN_SRC sh
     docker run -d -it --restart always \
            -v ~/srv/pence/data:/data \
            --hostname pence --name pence centos:7
   #+END_SRC
3. é‡æ–°è¿›å…¥è¿›è¡Œå®¹å™¨
   #+BEGIN_SRC sh
     docker exec -it pence bash
   #+END_SRC
4. åˆ é™¤å®¹å™¨
   #+BEGIN_SRC sh
     docker rm -f pence
   #+END_SRC
*** é…ç½®ä¸»æœºå¼€å‘ç¯å¢ƒ
å®‰è£…ä¸€æ³¢ç³»ç»Ÿä¾èµ–åº“
#+BEGIN_SRC sh
  yum update

  # common tools
  yum install -y net-tools vim tmux tree kernel-devel kernel-doc kernel-headers \
      samba samba-client ntp rsync curl git

  # for oracle 11g install
  yum install -y binutils compat-libcap1 compat-libstdc++-33 gcc gcc-c++ glibc \
      glibc-devel ksh libgcc libstdc++ libstdc++-devel libaio libaio-devel libXi \
      libXtst make sysstat unixODBC unixODBC-devel oracleasm-support

  yum install -y gcc gcc-c++ cmake automake zip unzip python3 python3-devel \
      python-devel python rpm-build redhat-rpm-config asciidoc hmaccalc \
      perl-ExtUtils-Embed pesign xmlto audit-libs-devel binutils-devel \
      elfutils-devel elfutils-libelf-devel ncurses-devel bison-devel newt-devel \
      numactl-devel pciutils-devel python-devel zlib-devel readline-devel

  # for mysql
  yum install -y cmake ncurses ncurses-devel bison bison-devel openssl openssl-devel

  # for openGauss
  yum install -y libaio-devel flex bison bison-devel ncurses-devel glibc-devel \
      patch redhat-lsb-core readline-devel

  # basic
  yum install -y openssl-devel gettext-devel
#+END_SRC
*** è®¾ç½®æ—¶åŒº
#+BEGIN_SRC sh
  cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
#+END_SRC

* ğŸ’¾ MySQL
** ğŸ“š å‚è€ƒèµ„æ–™
1. MySQL å¼€å‘æ–‡æ¡£ 8.0.30  [[https://dev.mysql.com/doc/dev/mysql-server/8.0.30/PAGE_GET_STARTED.html#start_source][Source Code Documents]]
2. MySQL ä½¿ç”¨æ–‡æ¡£ [[https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html][InnoDB Storage Engine]]
3. ä¸“æ  [[https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/MySQL%E5%AE%9E%E6%88%9845%E8%AE%B2][MySQLå®æˆ˜45è®²]]
3. ä¸‰æ–¹åº“ [[https://gorm.io/docs/index.html][GORM]] | [[https://docs.spring.io/spring-data/jpa/docs/2.7.7/reference/html/][JPA]] | [[https://github.com/mybatis/mybatis-3][mybatis-3]]

** ä¸»ä»æ¶æ„å®éªŒç¯å¢ƒ
*** ğŸ³ é…ç½® Docker ç¯å¢ƒ
1. å®‰è£… Docker Server
2. å‚è€ƒæ–‡æ¡£ [[https://docs.docker.com/compose/install/other][Install the Compose standalone]] å®‰è£… docker-compose
3. ç¼–å†™å¯åŠ¨é…ç½®æ–‡ä»¶ [[file:env-mysql/][MySQL ä¸»å¤‡é…ç½®]]
4. docker hub [[https://hub.docker.com/_/mysql][mysql é•œåƒ]]
5. å¯åŠ¨æœåŠ¡
#+BEGIN_SRC sh :dir env-mysql
  docker-compose up -d
#+END_SRC

*** é…ç½®ä¸»å¤‡ç¯å¢ƒ
**** æŸ¥çœ‹ä¸»å¤‡ç½‘ç»œé…ç½®
#+BEGIN_SRC sh :results output
  docker inspect mysql-master | jq '.[0].NetworkSettings.Networks.dbnet.IPAddress'
  docker inspect mysql-slave  | jq '.[0].NetworkSettings.Networks.dbnet.IPAddress'
#+END_SRC

#+RESULTS:
: "172.20.0.100"
: "172.20.0.101"

æŸ¥çœ‹ä¸»æœºç½‘ç»œ
#+BEGIN_SRC sh
  docker network ls
#+END_SRC

#+RESULTS:
| NETWORK      | ID       | NAME   | DRIVER | SCOPE |
| e09faf7e7340 | dbnet    | bridge | local  |       |
| c21a61df1551 | none     | null   | local  |       |

**** ä¸»åº“é…ç½®å¤‡åº“ç”¨æˆ·çš„è®¿é—®æƒé™
:properties:
:header-args:sql: :engine mysql :dbhost 127.0.0.1 :dbport 9001 :database test01 :dbuser root :dbpassword p111
:end:

#+BEGIN_SRC sql :results output
  create user "user02"@"%" identified by "user02";
  grant replication slave on *.* to "user02"@"%";
  flush privileges;
#+END_SRC

#+RESULTS:

#+BEGIN_SRC sql
  show master status
#+END_SRC

#+RESULTS:
| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
|------------------+----------+--------------+------------------+-------------------|
| mysql-bin.000003 |      841 | test01       |                  |                   |

**** å¤‡åº“åŒæ­¥é…ç½®
:properties:
:header-args:sql: :engine mysql :dbhost 127.0.0.1 :dbport 9002 :database test01 :dbuser root :dbpassword p222
:end:

#+BEGIN_SRC sql :results output
  # è¿™é‡Œçš„ host ç­‰å‚æ•°éœ€è¦æ ¹æ®ä¸»åº“çš„é…ç½®ä¿®æ”¹
  -- change master to master_host='172.20.0.100', master_user='user02', master_password='user02', master_log_file='1.000003', master_log_pos=823;
  -- change master to master_host='mysql-master', master_user='user02', master_password='user02', master_log_file='mysql-bin.000003', master_log_pos=0;
  change master to master_host='mysql-master', master_user='user02', master_password='user02', master_log_file='mysql-bin.000003', master_log_pos=841;
#+END_SRC

#+RESULTS:

#+BEGIN_SRC sql :results output
   start slave;
#+END_SRC

#+RESULTS:

#+BEGIN_SRC sql :results output
  show slave status\G
#+END_SRC

#+RESULTS:
#+begin_example
,*************************** 1. row ***************************
               Slave_IO_State: Waiting for source to send event
                  Master_Host: mysql-master
                  Master_User: user02
                  Master_Port: 3306
                Connect_Retry: 60
              Master_Log_File: mysql-bin.000003
          Read_Master_Log_Pos: 841
               Relay_Log_File: 1e8e597992df-relay-bin.000002
                Relay_Log_Pos: 326
        Relay_Master_Log_File: mysql-bin.000003
             Slave_IO_Running: Yes
            Slave_SQL_Running: Yes
              Replicate_Do_DB:
          Replicate_Ignore_DB:
           Replicate_Do_Table:
       Replicate_Ignore_Table:
      Replicate_Wild_Do_Table:
  Replicate_Wild_Ignore_Table:
                   Last_Errno: 0
                   Last_Error:
                 Skip_Counter: 0
          Exec_Master_Log_Pos: 841
              Relay_Log_Space: 543
              Until_Condition: None
               Until_Log_File:
                Until_Log_Pos: 0
           Master_SSL_Allowed: No
           Master_SSL_CA_File:
           Master_SSL_CA_Path:
              Master_SSL_Cert:
            Master_SSL_Cipher:
               Master_SSL_Key:
        Seconds_Behind_Master: 0
Master_SSL_Verify_Server_Cert: No
                Last_IO_Errno: 0
                Last_IO_Error:
               Last_SQL_Errno: 0
               Last_SQL_Error:
  Replicate_Ignore_Server_Ids:
             Master_Server_Id: 100
                  Master_UUID: 860a4dac-94f0-11ed-a2f3-0242ac140064
             Master_Info_File: mysql.slave_master_info
                    SQL_Delay: 0
          SQL_Remaining_Delay: NULL
      Slave_SQL_Running_State: Replica has read all relay log; waiting for more updates
           Master_Retry_Count: 86400
                  Master_Bind:
      Last_IO_Error_Timestamp:
     Last_SQL_Error_Timestamp:
               Master_SSL_Crl:
           Master_SSL_Crlpath:
           Retrieved_Gtid_Set:
            Executed_Gtid_Set:
                Auto_Position: 0
         Replicate_Rewrite_DB:
                 Channel_Name:
           Master_TLS_Version:
       Master_public_key_path:
        Get_master_public_key: 0
            Network_Namespace:
#+end_example

å¦‚æœå‡ºç°è¿™æ ·çš„ä¸¤è¡Œè¡¨ç¤ºç»“æœæ˜¯æ­£ç¡®çš„
#+begin_quote
Slave_IO_Running: Yes
Slave_SQL_Running: Yes
#+end_quote

é‡ç½® slave
#+BEGIN_SRC sql :results output
  stop slave;
  reset slave;
#+END_SRC

**** ä¸»åº“å»ºè¡¨
:properties:
:header-args:sql: :engine mysql :dbhost 127.0.0.1 :dbport 9001 :database test01 :dbuser root :dbpassword p111
:end:

#+BEGIN_SRC sql :results output
  create table t (
    id int primary key auto_increment,
    c int
  );
#+END_SRC

#+RESULTS:

#+BEGIN_SRC sql :results output
  insert into t(c) values (1), (2), (3);
#+END_SRC

#+RESULTS:

#+BEGIN_SRC sql :results output
  delete from t where id < 10;
#+END_SRC

#+RESULTS:

**** å¤‡åº“æŸ¥è¯¢
:properties:
:header-args:sql: :engine mysql :dbhost 127.0.0.1 :dbport 9002 :database test01 :dbuser root :dbpassword p222
:end:

#+BEGIN_SRC sql
  select * from t;
#+END_SRC

*** è®¾ç½®ç™»å½•åˆ«å
#+BEGIN_SRC sh
  alias my1="MYSQL_PWD=p111   mysql -h127.0.0.1 -uroot -P9001"
  alias my2="MYSQL_PWD=p222   mysql -h127.0.0.1 -uroot -P9002"
  alias u01="MYSQL_PWD=user01 mysql -h127.0.0.1 -uuser01 -P9001 test01"
  alias u02="MYSQL_PWD=user02 mysql -h127.0.0.1 -uuser02 -P9002 test01"
  alias m100='docker exec -it mysql-master /bin/bash'
  alias m101='docker exec -it mysql-slave /bin/bash'
#+END_SRC

** æºç ç ”ç©¶
1. [[*ä¸“æ  \[\[https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/MySQL%E5%AE%9E%E6%88%9845%E8%AE%B2\]\[MySQLå®æˆ˜45è®²\]\]][ä¸“æ  MySQLå®æˆ˜45è®²]]
2. [[file:mysql-source-code.org][MySQL æºç ç¬”è®°]]
3. ä»£ç é˜…è¯»åˆ†äº«
   - [[file:../mysql/share-01-mysql-group-by-analysis.org][GroupByè¯­å¥å®ç°åŸç†æ¢ç´¢]]
*** å®‰è£… Cmake
1. [[https://cmake.org/install/][CMake Install]]
   #+BEGIN_SRC sh
     curl -OL https://github.com/Kitware/CMake/releases/download/v3.20.1/cmake-3.20.1.tar.gz
   #+END_SRC

   #+BEGIN_SRC sh
     ./bootstrap
      make
      make install
   #+END_SRC

* ğŸŒŸ K8s
** minikube
1. [[https://minikube.sigs.k8s.io/docs/][æ–‡æ¡£ä¸­å¿ƒ]]
** ç¯å¢ƒé…ç½®
   #+BEGIN_SRC sh
     # å®‰è£…
     brew install minikube

     # å¯åŠ¨
     minikube start
   #+END_SRC
** Pod
*** æŸ¥çœ‹ Pod
#+BEGIN_SRC sh :results output
  kubectl get pods -A
#+END_SRC

#+RESULTS:
: NAMESPACE     NAME                               READY   STATUS    RESTARTS      AGE
: kube-system   coredns-787d4945fb-g688w           1/1     Running   0             50s
: kube-system   etcd-minikube                      1/1     Running   0             65s
: kube-system   kube-apiserver-minikube            1/1     Running   0             57s
: kube-system   kube-controller-manager-minikube   1/1     Running   0             56s
: kube-system   kube-proxy-4ph9m                   1/1     Running   0             50s
: kube-system   kube-scheduler-minikube            1/1     Running   0             57s
: kube-system   storage-provisioner                1/1     Running   1 (18s ago)   54s

* ğŸ¢ GDB & LLDB
** ğŸ“š å‚è€ƒèµ„æ–™
1. [[https://lldb.llvm.org/use/map.html][LLDB <-> GDB]]
2. [[https://github.com/hellogcc/100-gdb-tips][GDB å°æŠ€å·§]] | [[https://sourceware.org/gdb/onlinedocs/gdb/][GDB åœ¨çº¿æ‰‹å†Œ]]
3. è§†é¢‘ [[https://www.youtube.com/watch?v=svG6OPyKsrw][GDB Tutorial]]
** ğŸ“’ ä½¿ç”¨ç¬”è®°
*** è¿›ç¨‹å¯åŠ¨: run & attach
æ–¹æ³•ä¸€ï¼šä½¿ç”¨ attach æ¨¡å¼è°ƒè¯•ã€‚é¦–å…ˆæ­£å¸¸å¯åŠ¨é‡æ–°ï¼Œç„¶åä½¿ç”¨ attach å‘½ä»¤é™„å±åˆ°è¿›ç¨‹ä¸Š
#+BEGIN_SRC sh
  (lldb) attach -p 18616
  (gdb) attach 18616
#+END_SRC

æ–¹æ³•äºŒï¼šç›´æ¥ run å¯åŠ¨è¿›ç¨‹
#+BEGIN_SRC sh
  # æŒ‡å®šå¯åŠ¨æ–‡ä»¶
  (lldb/gdb) file <binary>

  # ç›´æ¥ run å¯åŠ¨è¿›ç¨‹
  (lldb/gdb) r
  # æ·»åŠ å¯åŠ¨å‚æ•°
  (lldb/gdb) r args1 args2 ...
  # æŸ¥çœ‹å‚æ•°
  (gdb) show args
  (lldb) settings show target.run-args
#+END_SRC
[[file:../static/image/2023/0205/131917.png]]

*** è°ƒè¯•æµç¨‹æ§åˆ¶
**** è®¾ç½®æ–­ç‚¹ breakpoint
#+BEGIN_SRC sh
  # æ™®é€šæ–­ç‚¹
  b main
  b main.cc:12
  b 12
  # æ¡ä»¶æ–­ç‚¹
  b 34 if i = 10
  # ä¸´æ—¶æ–­ç‚¹: ä¸´æ—¶æ–­ç‚¹æ‰§è¡Œä¸€æ¬¡åè‡ªåŠ¨é”€æ¯
  tb main
#+END_SRC

**** æµç¨‹æ§åˆ¶ step & next & continue
1. step å•æ­¥è°ƒè¯•ï¼Œä¸è¿›å…¥å‡½æ•°
2. next å•æ­¥è°ƒè¯•ï¼Œè¿›å…¥å‡½æ•°
3. continue ç»§ç»­æ‰§è¡Œ
   #+BEGIN_SRC sh
     s # step
     n # next
     c # continue

     # until ç›´æ¥æ‰§è¡Œåˆ°è¡Œæ•°
     (gdb) until 12
     (lldb) thread until 12
   #+END_SRC
4. è·³è½¬åˆ°æŒ‡å®šè¡Œ
   - æ¡ä»¶æ–­ç‚¹ ~tb~ temp breakpoint
   - until ~until <line>~
5. è¿”å›å½“å‰å€¼
   #+BEGIN_SRC sh
     (gdb) return <return expression>
     (lldb) thread return <return expression>
   #+END_SRC

*** ä¿æŒæ–­ç‚¹ & ç°åœºæ¢å¤
GDB ä¿å­˜æ–­ç‚¹çš„æ–¹å¼æ¯”è¾ƒæ–¹ä¾¿ï¼Œç›´æ¥ä¿æŒæˆä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶åï¼Œå†åº”ç”¨ä»£ç 
#+BEGIN_SRC sh
  # ä¿æŒæ–­ç‚¹åˆ°æ–‡ä»¶ä¸­
  (gdb) save breakpoint mybreak.txt
  # é‡æ–°åŠ è½½ä¿å­˜çš„æ–­ç‚¹
  (gdb) source mybreak.txt
#+END_SRC

LLDB ä¿å­˜æ–­ç‚¹ä¹Ÿæœ‰ç±»ä¼¼çš„å‘½ä»¤ï¼Œä½†æ˜¯ä¿å­˜ç»“æœæ˜¯ä¸€ä¸ª JSON
#+BEGIN_SRC sh
  # ä¿å­˜æ–­ç‚¹åˆ° json æ ¼å¼æ–‡ä»¶
  (lldb) breakpoint write -f dbg001
  # è¯»å–æ–­ç‚¹åˆ° json æ ¼å¼æ–‡ä»¶
  (lldb) breakpoint read -f dbg001
#+END_SRC

ä¹Ÿå¯ä»¥å‚è€ƒè¿™ä¸ªç­”æ¡ˆä¼˜åŒ–æµç¨‹ [[https://stackoverflow.com/questions/24638515/save-breakpoints-in-lldb][SO]]

[[file:../static/image/2023/0205/100837.png]]

*** æŸ¥çœ‹/ä¿®æ”¹å˜é‡å’Œå†…å­˜æ•°æ®
1. æ‰“å°å˜é‡ print
   #+BEGIN_SRC sh
     (lldb) p thd->m_thread_id
     (my_thread_id) $1 = 10
     (lldb) x/w &$1
     0x7fbdc1240188: 0x0000000a
     (lldb)
   #+END_SRC
2. æŸ¥çœ‹å†…å­˜åœ°å€ä¸­çš„æ•°æ®
   #+BEGIN_SRC sh
     (lldb) x/8w $0 => æ‰“å°åœ°å€çš„æ•°æ®, æ‰“å°8 æ¡æ•°æ®, [w, b] è¡¨ç¤ºä¸åŒçš„æ‰“å°æ–¹å¼
     0x7fbdc123dc00: 0x0916f4d8 0x00000001 0x0916f548 0x00000001
     0x7fbdc123dc10: 0x00000000 0x00000000 0xc1240440 0x00007fbd
     (lldb) x/8b $0
     0x7fbdc123dc00: 0xd8 0xf4 0x16 0x09 0x01 0x00 0x00 0x00
     (lldb) x/8x $0
     0x7fbdc123dc00: 0xd8 0xf4 0x16 0x09 0x01 0x00 0x00 0x00
   #+END_SRC
3. æŸ¥çœ‹ frame ä¸­å˜é‡
   #+BEGIN_SRC sh
     # æŸ¥çœ‹å±€éƒ¨å˜é‡
     (lldb) frame variable
     (lldb) fr v
     # æŸ¥çœ‹å…¨å±€å˜é‡
     (lldb) target variable
     (lldb) ta v
     # æŸ¥çœ‹è°ƒç”¨æ ˆ thread backtrace
     (lldb/gdb) bt
   #+END_SRC

** ğŸ› é—®é¢˜ä¿®å¤
*** MacOS: è¯ä¹¦é”™è¯¯é—®é¢˜ [[https://timnash.co.uk/getting-gdb-to-semi-reliably-work-on-mojave-macos/][(^-^)]]
#+BEGIN_QUOTE
  please check gdb is codesigned - see taskgated(8)
#+END_QUOTE
æ‰‹å·¥ç¼–å†™ gdb.xml
#+BEGIN_SRC xml
  <?xml version="1.0" encoding="UTF-8"?>
  <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN"
  "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
  <plist version="1.0">
  <dict>
      <key>com.apple.security.cs.allow-jit</key>
      <true/>
      <key>com.apple.security.cs.allow-unsigned-executable-memory</key>
      <true/>
      <key>com.apple.security.cs.allow-dyld-environment-variables</key>
      <true/>
      <key>com.apple.security.cs.disable-library-validation</key>
      <true/>
      <key>com.apple.security.cs.disable-executable-page-protection</key>
      <true/>
      <key>com.apple.security.cs.debugger</key>
      <true/>
      <key>com.apple.security.get-task-allow</key>
      <true/>
  </dict>
  </plist>
#+END_SRC
ä½¿ç”¨å‘½ä»¤ç»™ gdb æ·»åŠ è¯ä¹¦
#+BEGIN_SRC sh
  codesign --entitlements gdb.xml -fs gdb-cert /usr/local/bin/gdb
#+END_SRC
* ğŸ„ è„šæœ¬è¯­è¨€
** Perl
*** ç¯å¢ƒé…ç½®
**** åŒ…ç®¡ç†å·¥å…·é…ç½® CPAN
1. å®˜ç½‘ [[https://metacpan.org/][CPAN]]
2. é•œåƒ [[https://mirrors.tuna.tsinghua.edu.cn/help/CPAN/][TUNA]]
   #+BEGIN_SRC sh
     PERL_MM_USE_DEFAULT=1 perl -MCPAN -e 'CPAN::HandleConfig->edit("pushy_https", 0); CPAN::HandleConfig->edit("urllist", "unshift", "https://mirrors.tuna.tsinghua.edu.cn/CPAN/"); mkmyconfig'
   #+END_SRC
3. CPAN çš„é…ç½®æ–‡ä»¶: =~/.cpan/CPAN/MyConfig.pm=
**** åŒ…ç®¡ç†å‘½ä»¤
#+BEGIN_SRC sh
  perl -MCPAN -e 'install Excel::Writer::XLSX'
#+END_SRC
*** åŸºæœ¬ä½¿ç”¨
**** Hello world
åˆ›å»º =hello.pl= æ–‡ä»¶å†™ä»¥ä¸‹ä»£ç 
#+BEGIN_SRC perl :results output
  print("hello world\n");
#+END_SRC

#+RESULTS:
: hello world

ä½¿ç”¨ perl å‘½ä»¤è¿è¡Œä»£ç 
#+BEGIN_SRC sh
  perl hello.pl
#+END_SRC
[[file:../static/image/2023/0129/192740.png]]

** Python
* æå®¢æ—¶å…‰
** ä¸“æ  [[https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/22%20%E8%AE%B2%E9%80%9A%E5%85%B3%20Go%20%E8%AF%AD%E8%A8%80-%E5%AE%8C][22 è®²é€šå…³ Go è¯­è¨€]]
** ä¸“æ  [[https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/24%E8%AE%B2%E5%90%83%E9%80%8F%E5%88%86%E5%B8%83%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%AE%8C][24è®²åƒé€åˆ†å¸ƒå¼æ•°æ®åº“]]
