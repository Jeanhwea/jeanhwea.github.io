#+TITLE: æŠ€æœ¯æ–‡æ¡£æ±‡æ€»
#+AUTHOR: Jinghui Hu
#+EMAIL: hujinghui@buaa.edu.cn
#+DATE: <2023-01-29 Sun 10:55:28>
#+HTML_LINK_UP: ../readme.html
#+HTML_LINK_HOME: ../index.html
#+SETUPFILE: ~/.emacs.d/site-lisp/org-html-themes/setup/theme-readtheorg-local.setup
#+STARTUP: indent cache num inlineimages
#+LATEX_COMPILER: xelatex
#+LATEX_CLASS: beamer
#+LATEX_CLASS_OPTIONS: [presentation]
#+LATEX_HEADER: \usepackage[scheme=plain]{ctex}
#+BEAMER_THEME: boxes

* åç«¯ç ”å‘
** Oracle
*** ğŸ“š å‚è€ƒèµ„æ–™
1. Oracle å…³ç³»æ•°æ®åº“ [[file:../database/oracle.org::*å‚è€ƒé“¾æ¥][å‚è€ƒé“¾æ¥]]
*** å¼€å‘ç¯å¢ƒé…ç½®
**** CentOS 7 é•œåƒå¯åŠ¨
1. [[https://hub.docker.com/_/centos/][docker container]]
2. å¯åŠ¨ centos7 é•œåƒ
   #+BEGIN_SRC sh
     docker run _D -it --restart always \
            -v ~/srv/pence/data:/data \
            --hostname pence --name pence centos:7
   #+END_SRC
3. é‡æ–°è¿›å…¥è¿›è¡Œå®¹å™¨
   #+BEGIN_SRC sh
     docker exec -it pence bash
   #+END_SRC
4. åˆ é™¤å®¹å™¨
   #+BEGIN_SRC sh
     docker rm -f pence
   #+END_SRC
**** é…ç½®ä¸»æœºå¼€å‘ç¯å¢ƒ
å®‰è£…ä¸€æ³¢ç³»ç»Ÿä¾èµ–åº“
#+BEGIN_SRC sh
  yum update

  # common tools
  yum install -y net-tools vim tmux tree kernel-devel kernel-doc kernel-headers \
      samba samba-client ntp rsync curl git

  # for oracle 11g install
  yum install -y binutils compat-libcap1 compat-libstdc++-33 gcc gcc-c++ glibc \
      glibc-devel ksh libgcc libstdc++ libstdc++-devel libaio libaio-devel libXi \
      libXtst make sysstat unixODBC unixODBC-devel oracleasm-support

  yum install -y gcc gcc-c++ cmake automake zip unzip python3 python3-devel \
      python-devel python rpm-build redhat-rpm-config asciidoc hmaccalc \
      perl-ExtUtils-Embed pesign xmlto audit-libs-devel binutils-devel \
      elfutils-devel elfutils-libelf-devel ncurses-devel bison-devel newt-devel \
      numactl-devel pciutils-devel python-devel zlib-devel readline-devel

  # for mysql
  yum install -y cmake ncurses ncurses-devel bison bison-devel openssl openssl-devel

  # for openGauss
  yum install -y libaio-devel flex bison bison-devel ncurses-devel glibc-devel \
      patch redhat-lsb-core readline-devel

#+END_SRC

**** è®¾ç½®æ—¶åŒº
#+BEGIN_SRC sh
  cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
#+END_SRC

**** å®‰è£…æ•°æ®åº“çš„å‰ç½®å‡†å¤‡
1. [[file:../article/install-oracle-11g-on-linux.org][å®‰è£… Oracle 11g]]
2. é…ç½®ç³»ç»Ÿå†…å­˜ä»¥åŠ swap

*** è¿ç»´ç›¸å…³
**** è¡¨ç©ºé—´åŠæ•°æ®æ–‡ä»¶
æŸ¥çœ‹æ•°æ®
#+BEGIN_SRC sh

#+END_SRC

ä¿®æ”¹æ•°æ®
#+BEGIN_SRC sql
  -- æ·»åŠ æ•°æ®æ–‡ä»¶åˆ°è¡¨ç©ºé—´
  alter tablespace TBS_PART01 add datafile '/u01/part01.dbf' size 4G;
  -- ä¿®æ”¹æ•°æ®æ–‡ä»¶å±æ€§
  alter database datafile '/u01/part01.dbf' autoextend off;
  alter database datafile '/u01/part01.dbf' autoextend on next 100M maxsize 10G;
#+END_SRC
** MySQL
*** ğŸ“š å‚è€ƒèµ„æ–™
1. MySQL å¼€å‘æ–‡æ¡£ 8.0.30  [[https://dev.mysql.com/doc/dev/mysql-server/8.0.30/PAGE_GET_STARTED.html#start_source][Source Code Documents]]
2. MySQL ä½¿ç”¨æ–‡æ¡£ [[https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html][InnoDB Storage Engine]]
3. ä¸“æ  [[https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/MySQL%E5%AE%9E%E6%88%9845%E8%AE%B2][MySQL å®æˆ˜ 45 è®²]]
4. ä¸‰æ–¹åº“ [[https://gorm.io/docs/index.html][GORM]] | [[https://docs.spring.io/spring-data/jpa/docs/2.7.7/reference/html/][JPA]] | [[https://github.com/mybatis/mybatis-3][mybatis-3]]

*** ä¸»ä»æ¶æ„å®éªŒç¯å¢ƒ
**** é…ç½® Docker ç¯å¢ƒ
1. å®‰è£… Docker Server
2. å‚è€ƒæ–‡æ¡£ [[https://docs.docker.com/compose/install/other][Install the Compose standalone]] å®‰è£… docker-compose
3. ç¼–å†™å¯åŠ¨é…ç½®æ–‡ä»¶ [[file:env-mysql/][MySQL ä¸»å¤‡é…ç½®]]
4. docker hub [[https://hub.docker.com/_/mysql][mysql é•œåƒ]]
5. å¯åŠ¨æœåŠ¡
#+BEGIN_SRC sh :dir env-mysql
  docker-compose up -d
#+END_SRC

**** é…ç½®ä¸»å¤‡ç¯å¢ƒ
***** æŸ¥çœ‹ä¸»å¤‡ç½‘ç»œé…ç½®
#+BEGIN_SRC sh :results output
  docker inspect mysql-master | jq '.[0].NetworkSettings.Networks.dbnet.IPAddress'
  docker inspect mysql-slave  | jq '.[0].NetworkSettings.Networks.dbnet.IPAddress'
#+END_SRC

#+RESULTS:
: "172.20.0.100"
: "172.20.0.101"

æŸ¥çœ‹ä¸»æœºç½‘ç»œ
#+BEGIN_SRC sh
  docker network ls
#+END_SRC

#+RESULTS:
| NETWORK      | ID       | NAME   | DRIVER | SCOPE |
| e09faf7e7340 | dbnet    | bridge | local  |       |
| c21a61df1551 | none     | null   | local  |       |

***** ä¸»åº“é…ç½®å¤‡åº“ç”¨æˆ·çš„è®¿é—®æƒé™
:properties:
:header-args:sql: :engine mysql :dbhost 127.0.0.1 :dbport 9001 :database test01 :dbuser root :dbpassword p111
:end:

#+BEGIN_SRC sql :results output
  create user "user02"@"%" identified by "user02";
  grant replication slave on *.* to "user02"@"%";
  flush privileges;
#+END_SRC

#+RESULTS:

#+BEGIN_SRC sql
  show master status
#+END_SRC

#+RESULTS:
| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
|------------------+----------+--------------+------------------+-------------------|
| mysql-bin.000003 |      841 | test01       |                  |                   |

***** å¤‡åº“åŒæ­¥é…ç½®
:properties:
:header-args:sql: :engine mysql :dbhost 127.0.0.1 :dbport 9002 :database test01 :dbuser root :dbpassword p222
:end:

#+BEGIN_SRC sql :results output
  # è¿™é‡Œçš„ host ç­‰å‚æ•°éœ€è¦æ ¹æ®ä¸»åº“çš„é…ç½®ä¿®æ”¹
  -- change master to master_host='172.20.0.100', master_user='user02', master_password='user02', master_log_file='1.000003', master_log_pos=823;
  -- change master to master_host='mysql-master', master_user='user02', master_password='user02', master_log_file='mysql-bin.000003', master_log_pos=0;
  change master to master_host='mysql-master', master_user='user02', master_password='user02', master_log_file='mysql-bin.000003', master_log_pos=841;
#+END_SRC

#+RESULTS:

#+BEGIN_SRC sql :results output
   start slave;
#+END_SRC

#+RESULTS:

#+BEGIN_SRC sql :results output
  show slave status\G
#+END_SRC

#+RESULTS:
#+begin_example
,*************************** 1. row ***************************
               Slave_IO_State: Waiting for source to send event
                  Master_Host: mysql-master
                  Master_User: user02
                  Master_Port: 3306
                Connect_Retry: 60
              Master_Log_File: mysql-bin.000003
          Read_Master_Log_Pos: 841
               Relay_Log_File: 1e8e597992df-relay-bin.000002
                Relay_Log_Pos: 326
        Relay_Master_Log_File: mysql-bin.000003
             Slave_IO_Running: Yes
            Slave_SQL_Running: Yes
              Replicate_Do_DB:
          Replicate_Ignore_DB:
           Replicate_Do_Table:
       Replicate_Ignore_Table:
      Replicate_Wild_Do_Table:
  Replicate_Wild_Ignore_Table:
                   Last_Errno: 0
                   Last_Error:
                 Skip_Counter: 0
          Exec_Master_Log_Pos: 841
              Relay_Log_Space: 543
              Until_Condition: None
               Until_Log_File:
                Until_Log_Pos: 0
           Master_SSL_Allowed: No
           Master_SSL_CA_File:
           Master_SSL_CA_Path:
              Master_SSL_Cert:
            Master_SSL_Cipher:
               Master_SSL_Key:
        Seconds_Behind_Master: 0
Master_SSL_Verify_Server_Cert: No
                Last_IO_Errno: 0
                Last_IO_Error:
               Last_SQL_Errno: 0
               Last_SQL_Error:
  Replicate_Ignore_Server_Ids:
             Master_Server_Id: 100
                  Master_UUID: 860a4dac-94f0-11ed-a2f3-0242ac140064
             Master_Info_File: mysql.slave_master_info
                    SQL_Delay: 0
          SQL_Remaining_Delay: NULL
      Slave_SQL_Running_State: Replica has read all relay log; waiting for more updates
           Master_Retry_Count: 86400
                  Master_Bind:
      Last_IO_Error_Timestamp:
     Last_SQL_Error_Timestamp:
               Master_SSL_Crl:
           Master_SSL_Crlpath:
           Retrieved_Gtid_Set:
            Executed_Gtid_Set:
                Auto_Position: 0
         Replicate_Rewrite_DB:
                 Channel_Name:
           Master_TLS_Version:
       Master_public_key_path:
        Get_master_public_key: 0
            Network_Namespace:
#+end_example

å¦‚æœå‡ºç°è¿™æ ·çš„ä¸¤è¡Œè¡¨ç¤ºç»“æœæ˜¯æ­£ç¡®çš„
#+begin_quote
Slave_IO_Running: Yes
Slave_SQL_Running: Yes
#+end_quote

é‡ç½® slave
#+BEGIN_SRC sql :results output
  stop slave;
  reset slave;
#+END_SRC

***** ä¸»åº“å»ºè¡¨
:properties:
:header-args:sql: :engine mysql :dbhost 127.0.0.1 :dbport 9001 :database test01 :dbuser root :dbpassword p111
:end:

#+BEGIN_SRC sql :results output
  create table t (
    id int primary key auto_increment,
    c int
  );
#+END_SRC

#+RESULTS:

#+BEGIN_SRC sql :results output
  insert into t(c) values (1), (2), (3);
#+END_SRC

#+RESULTS:

#+BEGIN_SRC sql :results output
  delete from t where id < 10;
#+END_SRC

#+RESULTS:

***** å¤‡åº“æŸ¥è¯¢
:properties:
:header-args:sql: :engine mysql :dbhost 127.0.0.1 :dbport 9002 :database test01 :dbuser root :dbpassword p222
:end:

#+BEGIN_SRC sql
  select * from t;
#+END_SRC

**** è®¾ç½®ç™»å½•åˆ«å
#+BEGIN_SRC sh
  alias my1="MYSQL_PWD=p111   mysql -h127.0.0.1 -uroot -P9001"
  alias my2="MYSQL_PWD=p222   mysql -h127.0.0.1 -uroot -P9002"
  alias u01="MYSQL_PWD=user01 mysql -h127.0.0.1 -uuser01 -P9001 test01"
  alias u02="MYSQL_PWD=user02 mysql -h127.0.0.1 -uuser02 -P9002 test01"
  alias m100='docker exec -it mysql-master /bin/bash'
  alias m101='docker exec -it mysql-slave /bin/bash'
#+END_SRC

*** è¿ç»´ä¸»é¢˜
**** åˆ›å»ºç”¨æˆ· & æˆæƒè®¿é—®æ•°æ®åº“
#+BEGIN_SRC sql
  create user 'jeffrey'@'%' identified by 'hello';
  grant all privileges on employees.* to 'jeffrey'@'%';
  flush privileges;
#+END_SRC

**** æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™
#+BEGIN_SRC sql
  select user, host from mysql.user;
#+END_SRC
**** ä¿®æ”¹ç”¨æˆ·å¯†ç 
#+BEGIN_SRC sql
  use mysql;
  set password for 'jeffrey'@'%' = password('root');
  update user set password = password('new.password') where user = 'jeffrey' and host = '%';
  update user set host = '%' where user = 'root';
  flush privileges;

  alter user 'jeffrey'@'%' identitied by 'mypass';
#+END_SRC

*** æºç ç ”ç©¶
1. ä¸“æ  [[https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/MySQL%E5%AE%9E%E6%88%9845%E8%AE%B2][MySQL45]] | [[https://blog.jcole.us/innodb/][Data Structure]] | [[http://www.unofficialmysqlguide.com/introduction.html][Unofficial Optimizer Guide]]
2. [[file:mysql-source-code.org][MySQL æºç ç¬”è®°]]
3. ç¤ºä¾‹æ•°æ®åº“ [[https://dev.mysql.com/doc/employee/en/employees-installation.html][Employees Sample Database]] | [[https://github.com/datacharmer/test_db][Github]] | [[https://dev.mysql.com/doc/index-other.html][Example DB: world, sakila]]
4. ä»£ç é˜…è¯»åˆ†äº«
   - [[file:../mysql/share-01-mysql-group-by-analysis.org][GroupBy è¯­å¥å®ç°åŸç†æ¢ç´¢]]
   - [[file:../mysql/share-02-mysql-optimize.org][MySQL ä¼˜åŒ–å™¨å®ç°åŸç†æ¢ç´¢]]
**** å®‰è£…ç¼–è¯‘è°ƒè¯•ç¯å¢ƒ
1. ç³»ç»Ÿä¾èµ–å®‰è£…
   #+BEGIN_SRC sh
     # å®‰è£…ä¾èµ–åŒ…
     yum update

     yum install -y net-tools vim tmux tree kernel-devel kernel-doc kernel-headers \
         samba samba-client ntp rsync curl git wget

     yum install -y binutils compat-libcap1 compat-libstdc++-33 gcc gcc-c++ glibc \
         glibc-devel ksh libgcc libstdc++ libstdc++-devel libaio libaio-devel libXi \
         libXtst make sysstat unixODBC unixODBC-devel oracleasm-support zip unzip \
         python-devel python rpm-build redhat-rpm-config asciidoc hmaccalc \
         perl-ExtUtils-Embed pesign xmlto audit-libs-devel binutils-devel \
         elfutils-devel elfutils-libelf-devel ncurses-devel bison-devel newt-devel \
         python3 python3-devel \
         numactl-devel pciutils-devel python-devel zlib-devel readline-devel
   #+END_SRC
2. ç¼–è¯‘å·¥å…·å®‰è£… [[https://gcc.gnu.org/install/][GCC]] | [[https://www.sourceware.org/gdb/][GDB]]
   #+BEGIN_SRC sh
     # gcc
     wget https://mirrors.tuna.tsinghua.edu.cn/gnu/gcc/gcc-12.1.0/gcc-12.1.0.tar.gz
     # ä¸‹è½½ gcc çš„ä¾èµ–
     ./contrib/download_prerequisites
     # --enable-multilib å¼€å¯ 32 ä½åº“æ”¯æŒ
     ./configure --prefix=/usr/local/gcc --disable-multilib
     make
     make install

     # gdb
     wget https://mirrors.tuna.tsinghua.edu.cn/gnu/gdb/gdb-12.1.tar.gz
     ./configure --prefix=/usr/local/gdb
     make
     make install
   #+END_SRC
   æ·»åŠ ç¯å¢ƒå˜é‡
   #+BEGIN_SRC sh
     export PATH=/usr/local/gcc/bin:$PATH
     export LD_LIBRARY_PATH=/usr/local/gcc/lib64:$LD_LIBRARY_PATH
     export PATH=/usr/local/gdb/bin:$PATH
   #+END_SRC
4. cmake å®‰è£… [[https://cmake.org/install/][CMake Install]]
   #+BEGIN_SRC sh
     # ä¸‹è½½ä»£ç 
     curl -OL https://github.com/Kitware/CMake/releases/download/v3.25.2/cmake-3.25.2.tar.gz
     # ç¼–è¯‘å®‰è£…
     ./bootstrap --prefix=/usr/local/cmake
     make
     make install
   #+END_SRC
   æ·»åŠ ç¯å¢ƒå˜é‡
   #+BEGIN_SRC sh
     export PATH=/usr/local/cmake/bin:$PATH
   #+END_SRC
5. boost ä¸‹è½½å¹¶å®‰è£…
   #+BEGIN_SRC sh
     wget -c https://boostorg.jfrog.io/artifactory/main/release/1.77.0/source/boost_1_77_0.tar.bz2
     tar xjvf boost_1_77_0.tar.bz2
   #+END_SRC
**** ç¼–è¯‘ä»£ç åŠåˆå§‹æ•°æ®åº“
1. å‚è€ƒèµ„æ–™ [[https://dev.mysql.com/doc/refman/8.0/en/source-installation.html][æºä»£ç å®‰è£…æ–‡æ¡£]] | [[https://dev.mysql.com/doc/refman/8.0/en/making-trace-files.html][TRACE æ–‡ä»¶]] | [[https://dev.mysql.com/doc/refman/8.0/en/using-gdb-on-mysqld.html][--gdb]] | [[https://dev.mysql.com/doc/dev/mysql-server/8.0.30/PAGE_OPT_TRACE.html][The Optimizer Trace]]
2. é…ç½®æ–‡ä»¶ ~/etc/my.cnf~
   #+BEGIN_SRC conf
     # -* mode: Conf; -*-

     [mysqld]
     basedir=/opt/local/mysql
     datadir=/opt/local/mysql/data
     log-error=/tmp/mysql-error.log
     pid-file=/tmp/mysql.pid
     # debug=d,info,error,query,general,where:O,/tmp/mysqld.trace
     # debug=+d,info,error,query,general,enter,where:O,/tmp/mysqld.trace
     debug

     # autocommit=0
     innodb_lock_wait_timeout=3600
     # long_query_time = 0
     slow_query_log = on
     slow_query_log_file = /tmp/mysql-slow.log
     # secure_file_priv = /tmp

     [client]
     user=root
   #+END_SRC
2. ç¼–è¯‘æºä»£ç 
   #+BEGIN_SRC sh
     # å‡†å¤‡ä»£ç ç¼–è¯‘ç›®å½•, è¾“å‡ºç›®å½•ä¸º out
     mkdir out
     cd out
     cmake -DCMAKE_INSTALL_PREFIX=/opt/local/mysql -DWITH_BOOST=../../boost/boost_1_77_0 -DWITH_DEBUG=1 -DWITH_UNIT_TESTS=0 ..
     # ç¼–è¯‘ä»£ç 
     cd out
     make -j8
     make install
   #+END_SRC
3. åˆå§‹åŒ–æ•°æ®åº“
   #+BEGIN_SRC sh
     # åˆå§‹åŒ–æ•°æ®åº“
     mysqld --defaults-file=/etc/my.cnf --initialize-insecure

     # https://dev.mysql.com/doc/refman/8.0/en/starting-server.html
     # å¯åŠ¨æ•°æ®åº“æ•°æ®åº“, --gdb æ˜¯å¼€å¯ gdb è°ƒè¯•æ”¯æŒ
     # --debug=d,info,error,query,general,where:O,/tmp/mysqld.trace
     mysqld --gdb >/dev/null 2>&1 &

     # é“¾æ¥æ•°æ®åº“
     mysql
     # å…³é—­æ•°æ®åº“
     mysqladmin shutdown
   #+END_SRC
**** ä»£ç é˜…è¯»é…ç½®
#+BEGIN_SRC sh
  # ç”Ÿæˆè·³è½¬çš„ TAG
  ctags -e -R --languages=c,c++ .
#+END_SRC

** Postgres
*** å‰ç½®ç¯å¢ƒå˜é‡
#+BEGIN_SRC sh
  export PGDATA=/opt/local/pgsql/data
#+END_SRC
*** ç¼–è¯‘è°ƒè¯• & åˆå§‹åŒ–æ•°æ®
#+BEGIN_SRC sh
  # é…ç½®è°ƒè¯•ç¯å¢ƒ
  ./configure --prefix=/opt/local/pgsql --enable-cassert --enable-debug CFLAGS="-ggdb -O0 -fno-omit-frame-pointer"
  # ç¼–è¯‘, å®‰è£…
  make -j8
  make install
#+END_SRC

#+BEGIN_SRC sh
  # åˆå§‹åŒ–æ•°æ®åº“
  initdb -D /opt/local/pgsql/data
  # å¯åŠ¨æ•°æ®åº“
  pg_ctl -D /opt/local/pgsql/data -l logfile start
  # åˆ›å»ºåº“
  createdb test01
  # é“¾æ¥åº“
  psql test01
#+END_SRC
*** è°ƒè¯•å‘½ä»¤
æ‰¾åˆ°å¯¹åº”çš„è¿›ç¨‹
#+BEGIN_SRC sh :results output :exports both
  $ ps aux | grep postgres
  jinghuihu        87208   0.0  0.0 34130524    676 s006  S+   12:13PM   0:00.00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn --exclude-dir=.idea --exclude-dir=.tox postgres
  jinghuihu        82329   0.0  0.2 34313316  36860   ??  Ss   10:51AM   0:00.16 postgres: jinghuihu test01 [local] idle
  jinghuihu        82278   0.0  0.0 34309036   1792   ??  Ss   10:51AM   0:00.00 postgres: logical replication launcher
  jinghuihu        82277   0.0  0.0 34310060   2136   ??  Ss   10:51AM   0:00.02 postgres: autovacuum launcher
  jinghuihu        82276   0.0  0.0 34307820   5152   ??  Ss   10:51AM   0:00.04 postgres: walwriter
  jinghuihu        82275   0.0  0.0 34307820   2212   ??  Ss   10:51AM   0:00.06 postgres: background writer
  jinghuihu        82274   0.0  0.0 34307820   2788   ??  Ss   10:51AM   0:00.01 postgres: checkpointer
  jinghuihu        80299   0.0  0.1 34309108  14920   ??  Ss   10:41AM   0:00.13 /opt/local/pgsql/bin/postgres -D /opt/local/pgsql/data
#+END_SRC

æ‰¾åˆ°å¯¹åº”çš„è¿›ç¨‹ï¼Œç„¶åä½¿ç”¨ lldb attach ä¸Šï¼Œæ‰“æ–­ç‚¹
#+BEGIN_SRC text
  (lldb) attach -p 82329
  Process 82329 stopped
  ,* thread #1, queue = 'com.apple.main-thread', stop reason = signal SIGSTOP
      frame #0: 0x00007ff810e892fe libsystem_kernel.dylib`kevent + 10
  libsystem_kernel.dylib`kevent:
  ->  0x7ff810e892fe <+10>: jae    0x7ff810e89308            ; <+20>
      0x7ff810e89300 <+12>: movq   %rax, %rdi
      0x7ff810e89303 <+15>: jmp    0x7ff810e84dc2            ; cerror_nocancel
      0x7ff810e89308 <+20>: retq
  Target 0: (postgres) stopped.
  Executable module set to "/opt/local/pgsql/bin/postgres".
  Architecture set to: x86_64h-apple-macosx-.
  (lldb) b exec_simple_query
  Breakpoint 1: where = postgres`exec_simple_query + 29 at postgres.c:994:21, address = 0x000000010f17af6d
  (lldb) c
  Process 82329 resuming
  Process 82329 stopped
  ,* thread #1, queue = 'com.apple.main-thread', stop reason = breakpoint 1.1
      frame #0: 0x000000010f17af6d postgres`exec_simple_query + 29 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/tcop/postgres.c:994
     991  static void
     992  exec_simple_query(const char *query_string)
     993  {
  -> 994      CommandDest dest = whereToSendOutput;
                                 ^
     995      MemoryContext oldcontext;
     996      List	   *parsetree_list;
     997      ListCell   *parsetree_item;
  Target 0: (postgres) stopped.
  (lldb)  bt
  ,* thread #1, queue = 'com.apple.main-thread', stop reason = breakpoint 1.1
    ,* frame #0: 0x000000010f17af6d postgres`exec_simple_query + 29 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/tcop/postgres.c:994
      frame #1: 0x000000010f17a633 postgres`PostgresMain + 2243 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/tcop/postgres.c:4593
      frame #2: 0x000000010f08d0d2 postgres`BackendRun + 50 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/postmaster/postmaster.c:4511
      frame #3: 0x000000010f08c6bc postgres`BackendStartup + 524 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/postmaster/postmaster.c:4239
      frame #4: 0x000000010f08b4ec postgres`ServerLoop + 716 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/postmaster/postmaster.c:1806
      frame #5: 0x000000010f088dc7 postgres`PostmasterMain + 6471 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/postmaster/postmaster.c:1478
      frame #6: 0x000000010ef6eda0 postgres`main + 816 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/main/main.c:202
      frame #7: 0x00007ff810b92310 dyld`start + 2432
  (lldb) c
  Process 82329 resuming
  (lldb) detach
  Process 82329 detached
  (lldb)
#+END_SRC

** ClickHouse
*** å®‰è£…æ­¥éª¤
1. å®˜æ–¹æ–‡æ¡£ [[https://clickhouse.com/docs/en/install][doc]]
#+BEGIN_SRC sh
  # https://clickhouse.com/docs/en/development/build-osx
  cmake -G Ninja -DCMAKE_BUILD_TYPE=RelWithDebInfo -S . -B build
#+END_SRC
** Java
*** Spring Framework
1. ä»£ç  [[https://github.com/spring-projects/spring-framework][Source]] | [[https://github.com/Jeanhwea/spring-framework/tree/jh/5.3.25][jh/5.3.25]]
2. ç¼–è¯‘ [[https://github.com/spring-projects/spring-framework/wiki/Build-from-Source][BUILD]] => Java8 åˆ‡åˆ° 5.3 åˆ†æ”¯
   #+BEGIN_SRC sh
     # ç¼–è¯‘
     ./gradlew build
     # è·³è¿‡æµ‹è¯•ç”¨ä¾‹
     ./gradlew build -x test
   #+END_SRC
3. ç¼–è¯‘æ–‡æ¡£, ä¾èµ– asciidoctor
   #+BEGIN_SRC sh
     ./gradlew asciidoctor
   #+END_SRC
4. æŸ¥çœ‹ tasks
   #+BEGIN_SRC sh :results output :dir ../../spring-framework
     ./gradlew tasks
   #+END_SRC
5. ç”Ÿæˆä»£ç æµé‡è·³è½¬ TAGS
   #+BEGIN_SRC sh
     # ç”Ÿæˆè·³è½¬çš„ TAG
     ctags -e -R --languages=c,c++ .
   #+END_SRC
*** Kafka
CLOSED: [2023-06-03 Sat 23:39]
1. [[https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89][JVM ç³»åˆ—]]
**** èµ„æºé“¾æ¥
1. è¯´æ˜æ–‡æ¡£ [[https://kafka.apache.org/documentation/][link]]
**** ç¯å¢ƒé…ç½®
***** å®˜ç½‘å¿«é€Ÿä½¿ç”¨æ‰‹å†Œ
1. [[https://kafka.apache.org/quickstart][quickstart]]
#+BEGIN_SRC sh
  # å¯åŠ¨ zk
  ./bin/zookeeper-server-start.sh config/zookeeper.properties
  # å¯åŠ¨ kafka
  ./bin/kafka-server-start.sh config/server.properties

  # åˆ›å»º topic
  ./bin/kafka-topics.sh --bootstrap-server localhost:9092 --create --topic quickstart-events
  # æ˜¾ç¤º topic åˆ—è¡¨
  ./bin/kafka-topics.sh --bootstrap-server localhost:9092 --list
  # æŸ¥çœ‹æŒ‡å®š topic çŠ¶æ€
  ./bin/kafka-topics.sh --bootstrap-server localhost:9092 --describe --topic quickstart-events

  # ç”Ÿäº§è€… & æ¶ˆè´¹è€…
  ./bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --from-beginning --topic quickstart-events
  ./bin/kafka-console-producer.sh --bootstrap-server localhost:9092 --topic quickstart-events
#+END_SRC

é…ç½®ç›¸å…³
#+BEGIN_SRC sh
  ./bin/kafka-configs.sh --zookeeper localhost:2181 --all
#+END_SRC

***** docker ç‰ˆæœ¬é…ç½®
1. [[https://hub.docker.com/r/bitnami/kafka/][docker hub]]
2. é…ç½®æ–‡ä»¶ [[file:env-kafka/docker-compose.yaml][docker-compose.yaml]]
   #+BEGIN_SRC sh
     docker-compose up -d
   #+END_SRC

***** æºä»£ç 
è·³è¿‡æµ‹è¯•ç¼–è¯‘
#+BEGIN_SRC sh
  ./gradlew build -x test
#+END_SRC

ç¼–è¯‘å‘å¸ƒåŒ…
#+BEGIN_SRC sh
  # ç¼–è¯‘åŒ…
  ./gradlew clean releaseTarGz

  # ç¼–è¯‘äº§ç‰©
  ls ./core/build/distributions/
#+END_SRC
*** RocketMQ
**** èµ„æºé“¾æ¥
1. å®˜ç½‘æ–‡æ¡£ [[https://rocketmq.apache.org/docs/4.x/introduction/02quickstart][link]]
*** JVM
**** ç¼–è¯‘ JDK
1. OpenJDK ç¼–è¯‘è¯´æ˜ [[https://openjdk.org/groups/build/][link]]
2. JDK 8 ç¼–è¯‘è¯´æ˜ [[https://hg.openjdk.org/jdk8/jdk8/raw-file/tip/README-builds.html][link]]
#+BEGIN_SRC sh
  git clone git@github.com:openjdk/jdk.git
  git checkout -b jh/jdk8-b99 jdk8-b99

  # é…ç½® & ç¼–è¯‘
  MAKE=/usr/bin/make ./configure
  JOBS=12 /usr/bin/make all
#+END_SRC
*** Hive
é…ç½® [[https://hadoop.apache.org/docs/r2.6.2/hadoop-project-dist/hadoop-common/SingleCluster.html#Standalone_Operation][hadoop]]
#+BEGIN_SRC sh
  export HADOOP_HOME=/opt/local/hack/hadoop-2.6.0
  export PATH="$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$PATH"
  export HIVE_HOME=/opt/local/hack/apache-hive-1.2.2-bin
  export PATH="$HIVE_HOME/bin:$PATH"
#+END_SRC

é…ç½® core-site.xml
#+BEGIN_SRC xml
  <configuration>
     <property>
        <name>fs.defaultFS</name>
        <value>hdfs://localhost:9000</value>
     </property>
  </configuration>
#+END_SRC

é…ç½® hdfs-site.xml
#+BEGIN_SRC xml
  <configuration>
    <property>
      <name>dfs.replication</name>
      <value>1</value>
    </property>

    <property>
      <name>dfs.namenode.name.dir</name>
      <value>/opt/local/hdfs/namenode</value>
    </property>

    <property>
      <name>dfs.datanode.data.dir</name>
      <value>/opt/local/hdfs/datanode</value>
    </property>
  </configuration>
#+END_SRC

åˆå§‹åŒ–å‘½ä»¤
#+BEGIN_SRC sh
  # æ ¼å¼åŒ– namenode
  hdfs namenode -format
  # å¯åŠ¨/å…³é—­ dfs
  start-dfs.sh
  stop-dfs.sh
#+END_SRC

[[https://cwiki.apache.org/confluence/display/Hive/GettingStarted#GettingStarted-InstallationandConfiguration][hive]] éœ€è¦æœ‰ /tmp, /user/hive/warehouse ç›®å½•, å¹¶ä¸”é…ç½® g+w æƒé™
- é…ç½®å…ƒæ•°æ®å­˜æ”¾ç›®å½• hive.metastore.warehouse.dir
#+BEGIN_SRC sh
  hadoop fs -mkdir       /tmp
  hadoop fs -mkdir -p    /user/hive/warehouse
  hadoop fs -chmod g+w   /tmp
  hadoop fs -chmod g+w   /user/hive/warehouse
#+END_SRC

è§£å†³ [ERROR] Terminal initialization failed; falling back to unsupported é—®é¢˜
#+BEGIN_SRC sh
  export HADOOP_USER_CLASSPATH_FIRST=true
#+END_SRC
*** SDK Man
1. å®˜ç½‘ [[https://sdkman.io/][link]]
#+BEGIN_SRC sh
  # å®‰è£… SDK Man
  curl -s "https://get.sdkman.io" | bash

  # å®‰è£… JDK
  sdk list java
  sdk install java 11.0.19-tem
  sdk install java 8.0.302-open
  sdk install java 17.0.7-tem

  # ç¦»çº¿å®‰è£…, åˆ›å»º SDK åŒ…ä¸º 8.0.191-online
  sdk install java 8.0.191-online /opt/admin/java
  export JAVA_HOME=/opt/admin/java

  # ä¿®æ”¹é»˜è®¤ SDK ç‰ˆæœ¬
  sdk list java | grep installed
  sdk default java 11.0.19-zulu

  # ç¯å¢ƒ
  # åˆå§‹åŒ–ç¯å¢ƒ, ç”Ÿæˆ .sdkmanrc
  sdk env init
  # å®‰è£…ç¯å¢ƒ
  sdk env install
  # åˆ‡æ¢ç¯å¢ƒ
  sdk env
  # æ¸…é™¤ç¯å¢ƒ
  sdk env clear


  # å®‰è£…å…¶ä»– SDK å·¥å…·
  sdk install gradle
  sdk install java
  sdk install hadoop
  sdk install ant

  # å¼ºåˆ¶æ›´æ–° SDK Man
  sdk selfupdate force
#+END_SRC

** äº‘åŸç”Ÿ
*** IDL
å®šä¹‰çš„ç»“æœå¦‚ä¸‹
1. [[https://thrift.apache.org/][Apache Thrift]]
2. [[https://diwakergupta.github.io/thrift-missing-guide/][Thrift: The Missing Guide]]
*** hertz
æ“ä½œæ‰‹å†Œ [[https://www.cloudwego.io/zh/docs/hertz/tutorials/toolkit/usage/usage-thrift/][link]]
#+BEGIN_SRC sh
  hz new -module $(MODULE) -idl idl/aps_core_api.thrift
  hz update -idl idl/aps_core_api.thrift
  go mod edit -replace github.com/apache/thrift=github.com/apache/thrift@v0.13.0
#+END_SRC
*** kitex
Kitex å¾®æœåŠ¡æ¶æ„å·¥å…· [[https://www.cloudwego.io/zh/docs/kitex/][kitex]]
* ç³»ç»Ÿè¿ç»´
** Docker
*** Engine é…ç½®
å®‰è£…æ–‡æ¡£ [[https://docs.docker.com/engine/install/ubuntu/][link]]
#+BEGIN_SRC sh
  vim /etc/docker/daemon.json
  systemctl restart docker
#+END_SRC

daemon.json é…ç½®
#+BEGIN_SRC json
  {
    "insecure-registries": [
      "gitana.jeanhwea.io:5000"
    ]
  }
#+END_SRC
*** å›½å†…é•œåƒ
daemon.json é…ç½®
#+BEGIN_SRC json
  {
    "registry-mirrors": [
      "https://registry.docker-cn.com",
      "https://docker.mirrors.ustc.edu.cn",
      "http://hub-mirror.c.163.com"
    ]
  }
#+END_SRC

** Kubernetes
*** minikube
1. [[https://minikube.sigs.k8s.io/docs/][æ–‡æ¡£ä¸­å¿ƒ]]
é…ç½®
#+BEGIN_SRC sh
  brew install minikube
  minikube start
#+END_SRC

#+BEGIN_SRC sh
  minikube dashboard
#+END_SRC
*** kubeadm
ç³»ç»Ÿå®‰è£…
#+BEGIN_SRC sh
  # åˆ›å»º master é›†ç¾¤
  kubeadm init --apiserver-advertise-address=192.168.0.210 \
          --pod-network-cidr=10.244.0.0/16 \
          --kubernetes-version 1.27.2 \
          --image-repository registry.aliyuncs.com/google_containers

  # é‡åˆ°é”™è¯¯é‡ç½®
  kubeadm reset
#+END_SRC

æŸ¥çœ‹ä½¿ç”¨åˆ°çš„é•œåƒ
#+BEGIN_SRC sh
  kubeadm config images list
  kubeadm config images pull --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers
  kubeadm config images pull --image-repository registry.aliyuncs.com/google_containers
#+END_SRC

æ–°å¢ node èŠ‚ç‚¹
#+BEGIN_SRC sh
  kubeadm token create --print-join-command
#+END_SRC

*** kubectl
**** å¿«é€Ÿå¼€å§‹
å¿«é€Ÿå¯åŠ¨ä¸€ä¸ªæµ‹è¯•æœåŠ¡
#+BEGIN_SRC sh
  # åˆ›å»ºéƒ¨ç½²
  kubectl create deployment sayhello --image=jeanhwea/sayhello:v1.0.0
  kubectl create deployment sayhello --image=jeanhwea/sayhello:v1.0.0 -r 4

  # é€šè¿‡ NodePort æš´éœ²æœåŠ¡
  kubectl expose deployment sayhello --port=80 --type=NodePort

  # åŠ¨æ€æ‰©å®¹
  kubectl scale  deployment sayhello --replicas=4
#+END_SRC

è·å–å¯åŠ¨çš„ Service
#+BEGIN_SRC sh :results output
  kubectl get svc
#+END_SRC

#+RESULTS:
: NAME          TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
: kubernetes    ClusterIP   10.96.0.1       <none>        443/TCP        122d
: web-gateway   NodePort    10.98.232.246   <none>        80:31151/TCP   8m1s

#+BEGIN_SRC sh
  # ç™»å½•åˆ° minikube shell
  minikube ssh
  # åœ¨ NameNode ä¸­è·å–é¡µé¢
  curl http://0.0.0.0:31151
#+END_SRC

#+BEGIN_SRC sh
  # Service å¯¹è±¡çš„åŸŸåå®Œå…¨å½¢å¼æ˜¯ "å¯¹è±¡.åå­—ç©ºé—´.svc.cluster.local"
  wget -qO- sayhello.default.svc.cluster.local
#+END_SRC
**** é…ç½® DashBoard
#+BEGIN_SRC sh
  wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml
  # å®‰è£… dashboard
  kubectl apply -f recommended.yaml
  # å¸è½½ dashboard
  kubectl delete -f recommended.yaml
  kubectl get pods,svc -n kubernetes-dashboard
#+END_SRC

**** æŸ¥çœ‹ Pod
#+BEGIN_SRC sh :results output
  kubectl get pods -A
  # ç™»å½•åˆ° pod ä¸Šæ’æŸ¥é—®é¢˜
  kubectl exec -it sayhello-847d5df547-4bk9z -- /bin/bash
#+END_SRC

#+RESULTS:
: NAMESPACE     NAME                               READY   STATUS    RESTARTS      AGE
: kube-system   coredns-787d4945fb-g688w           1/1     Running   0             50s
: kube-system   etcd-minikube                      1/1     Running   0             65s
: kube-system   kube-apiserver-minikube            1/1     Running   0             57s
: kube-system   kube-controller-manager-minikube   1/1     Running   0             56s
: kube-system   kube-proxy-4ph9m                   1/1     Running   0             50s
: kube-system   kube-scheduler-minikube            1/1     Running   0             57s
: kube-system   storage-provisioner                1/1     Running   1 (18s ago)   54s

**** åˆ›å»º Job
è·å–ä¸€ä¸ªåŸºç¡€çš„ yaml
#+BEGIN_SRC sh
  kubectl create job echo-job --image=busybox --dry-run=client -o yaml
#+END_SRC

ä¿®æ”¹å¾—åˆ°é…ç½®
#+BEGIN_SRC yaml
  apiVersion: batch/v1
  kind: Job
  metadata:
    name: echo-job

  spec:
    template:
     spec:
        restartPolicy: OnFailure
        containers:
        - image: busybox
          name: echo-job
          imagePullPolicy: IfNotPresent
          command: ["/bin/echo"]
          args: ["hello", "world"]
#+END_SRC

**** é…ç½® ConfigMap
#+BEGIN_SRC sh
  kubectl get cm
  kubectl describe cm config01
#+END_SRC

*** ç®¡ç†å·¥å…·
1. k8s åŒ…ç®¡ç†å™¨: helm [[https://helm.sh/][link]]
   #+BEGIN_SRC sh
     helm repo add bitnami https://charts.bitnami.com/bitnami
     helm repo update
     helm install bitnami/mysql --generate-name
     helm show all bitnami/mysql
     helm list
     helm uninstall mysql-1686374196
   #+END_SRC

** ç£ç›˜ç®¡ç†
*** å¯åŠ¨ç›˜åˆ¶ä½œ
1. å¯åŠ¨ç›˜åˆ¶ä½œå·¥å…· rufus [[https://rufus.ie/zh/][link]] | [[https://github.com/pbatard/rufus][code]]
2. å…‰ç›˜æå–å·¥å…· InfraRecorder [[http://infrarecorder.org/][link]] | [[https://github.com/kindahl/infrarecorder][code]]
*** Ubuntu ç£ç›˜åˆ†åŒºæ‰©å®¹
ä½¿ç”¨ parted, resize2fs å‘½ä»¤è¡Œå·¥å…·è¿›è¡Œæ“ä½œ
#+BEGIN_SRC sh
  root@ubuntu201:/home/ubuntu# parted
  GNU Parted 3.4
  Using /dev/sda
  Welcome to GNU Parted! Type 'help' to view a list of commands.
  (parted) print                 # ==> æŸ¥çœ‹å½“å‰ç£ç›˜åˆ†åŒºä¿¡æ¯
  Model: VMware Virtual disk (scsi)
  Disk /dev/sda: 215GB
  Sector size (logical/physical): 512B/512B
  Partition Table: gpt
  Disk Flags:

  Number  Start   End     Size    File system  Name  Flags
   1      1049kB  2097kB  1049kB                     bios_grub
   2      2097kB  53.7GB  53.7GB  ext4

  (parted) resizepart            # ==> æ‰©å®¹åˆ†åŒº 2
  Partition number? 2
  Warning: Partition /dev/sda2 is being used. Are you sure you want to continue?
  Yes/No? Yes
  End?  [53.7GB]? 215GB          # ==> è¿™é‡Œæ‰©å®¹åˆ°æœ€å¤§å¯è§åˆ†åŒº
  (parted) print                 # ==> æ‰©å®¹åçš„åˆ†åŒº 2 å˜æˆ 215G
  Model: VMware Virtual disk (scsi)
  Disk /dev/sda: 215GB
  Sector size (logical/physical): 512B/512B
  Partition Table: gpt
  Disk Flags:

  Number  Start   End     Size    File system  Name  Flags
   1      1049kB  2097kB  1049kB                     bios_grub
   2      2097kB  215GB   215GB   ext4

  (parted)

  Information: You may need to update /etc/fstab.

  root@ubuntu201:/home/ubuntu# df -h # ==> æ–‡ä»¶ç³»ç»Ÿå¹¶æœªæ‰©å®¹
  Filesystem      Size  Used Avail Use% Mounted on
  tmpfs           1.6G  1.2M  1.6G   1% /run
  /dev/sda2        49G   44G  3.1G  94% /
  tmpfs           7.8G     0  7.8G   0% /dev/shm
  tmpfs           5.0M     0  5.0M   0% /run/lock
  tmpfs           1.6G  4.0K  1.6G   1% /run/user/1000
  root@ubuntu201:/home/ubuntu# resize2fs /dev/sda2 # ==> è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°
  resize2fs 1.46.5 (30-Dec-2021)
  Filesystem at /dev/sda2 is mounted on /; on-line resizing required
  old_desc_blocks = 7, new_desc_blocks = 25
  The filesystem on /dev/sda2 is now 52428283 (4k) blocks long.

  root@ubuntu201:/home/ubuntu# df -h
  Filesystem      Size  Used Avail Use% Mounted on
  tmpfs           1.6G  1.2M  1.6G   1% /run
  /dev/sda2       197G   44G  145G  24% /
  tmpfs           7.8G     0  7.8G   0% /dev/shm
  tmpfs           5.0M     0  5.0M   0% /run/lock
  tmpfs           1.6G  4.0K  1.6G   1% /run/user/1000
  root@ubuntu201:/home/ubuntu# reboot
#+END_SRC
* ç ”å‘æ•ˆç‡
** GDB & LLDB
*** å‚è€ƒèµ„æ–™åŠé“¾æ¥
1. [[https://lldb.llvm.org/use/map.html][LLDB <-> GDB]]
2. [[https://github.com/hellogcc/100-gdb-tips][GDB å°æŠ€å·§]] | [[https://sourceware.org/gdb/onlinedocs/gdb/][GDB åœ¨çº¿æ‰‹å†Œ]]
3. è§†é¢‘ [[https://www.youtube.com/watch?v=svG6OPyKsrw][GDB Tutorial]]
*** è¿›ç¨‹å¯åŠ¨: run & attach
æ–¹æ³•ä¸€ï¼šä½¿ç”¨ attach æ¨¡å¼è°ƒè¯•ã€‚é¦–å…ˆæ­£å¸¸å¯åŠ¨é‡æ–°ï¼Œç„¶åä½¿ç”¨ attach å‘½ä»¤é™„å±åˆ°è¿›ç¨‹ä¸Š
#+BEGIN_SRC sh
  (lldb) attach -p 18616
  (gdb) attach 18616
#+END_SRC

æ–¹æ³•äºŒï¼šç›´æ¥ run å¯åŠ¨è¿›ç¨‹
#+BEGIN_SRC sh
  # æŒ‡å®šå¯åŠ¨æ–‡ä»¶
  (lldb/gdb) file <binary>

  # ç›´æ¥ run å¯åŠ¨è¿›ç¨‹
  (lldb/gdb) r
  # æ·»åŠ å¯åŠ¨å‚æ•°
  (lldb/gdb) r args1 args2 ...
  # æŸ¥çœ‹å‚æ•°
  (gdb) show args
  (lldb) settings show target.run-args
#+END_SRC
[[file:../static/image/2023/0205/131917.png]]

*** è°ƒè¯•æµç¨‹æ§åˆ¶
**** è®¾ç½®æ–­ç‚¹ breakpoint
#+BEGIN_SRC sh
  # æ™®é€šæ–­ç‚¹
  b main
  b main.cc:12
  b 12
  # æ¡ä»¶æ–­ç‚¹
  (gdb) b 34 if i = 10
  (gdb) break foo if strcmp(y,"hello") == 0
  (lldb) breakpoint set --name foo --condition '(int)strcmp(y,"hello") == 0'
  (lldb) br s -n foo -c '(int)strcmp(y,"hello") == 0'
  (lldb) br s -n read_page -c 'm_page_id.space()==56'
  # ä¸´æ—¶æ–­ç‚¹: ä¸´æ—¶æ–­ç‚¹æ‰§è¡Œä¸€æ¬¡åè‡ªåŠ¨é”€æ¯
  tb main
#+END_SRC

**** æµç¨‹æ§åˆ¶ step & next & continue
1. step å•æ­¥è°ƒè¯•ï¼Œä¸è¿›å…¥å‡½æ•°
2. next å•æ­¥è°ƒè¯•ï¼Œè¿›å…¥å‡½æ•°
3. continue ç»§ç»­æ‰§è¡Œ
   #+BEGIN_SRC sh
     s # step
     n # next
     c # continue

     # until ç›´æ¥æ‰§è¡Œåˆ°è¡Œæ•°
     (gdb) until 12
     (lldb) thread until 12
   #+END_SRC
4. è·³è½¬åˆ°æŒ‡å®šè¡Œ
   - æ¡ä»¶æ–­ç‚¹ ~tb~ temp breakpoint
   - until ~until <line>~
5. è¿”å›å½“å‰å€¼
   #+BEGIN_SRC sh
     (gdb) return <return expression>
     (lldb) thread return <return expression>
   #+END_SRC

*** ä¿æŒæ–­ç‚¹ & ç°åœºæ¢å¤
GDB ä¿å­˜æ–­ç‚¹çš„æ–¹å¼æ¯”è¾ƒæ–¹ä¾¿ï¼Œç›´æ¥ä¿æŒæˆä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶åï¼Œå†åº”ç”¨ä»£ç 
#+BEGIN_SRC sh
  # ä¿æŒæ–­ç‚¹åˆ°æ–‡ä»¶ä¸­
  (gdb) save breakpoint mybreak.txt
  # é‡æ–°åŠ è½½ä¿å­˜çš„æ–­ç‚¹
  (gdb) source mybreak.txt
#+END_SRC

LLDB ä¿å­˜æ–­ç‚¹ä¹Ÿæœ‰ç±»ä¼¼çš„å‘½ä»¤ï¼Œä½†æ˜¯ä¿å­˜ç»“æœæ˜¯ä¸€ä¸ª JSON
#+BEGIN_SRC sh
  # ä¿å­˜æ–­ç‚¹åˆ° json æ ¼å¼æ–‡ä»¶
  (lldb) breakpoint write -f dbg001
  # è¯»å–æ–­ç‚¹åˆ° json æ ¼å¼æ–‡ä»¶
  (lldb) breakpoint read -f dbg001
#+END_SRC

ä¹Ÿå¯ä»¥å‚è€ƒè¿™ä¸ªç­”æ¡ˆä¼˜åŒ–æµç¨‹ [[https://stackoverflow.com/questions/24638515/save-breakpoints-in-lldb][SO]]

[[file:../static/image/2023/0205/100837.png]]

*** æŸ¥çœ‹/ä¿®æ”¹å˜é‡å’Œå†…å­˜æ•°æ®
1. æ‰“å°å˜é‡ print
   #+BEGIN_SRC sh
     (lldb) p thd->m_thread_id
     (my_thread_id) $1 = 10
     (lldb) x/w &$1
     0x7fbdc1240188: 0x0000000a
     (lldb)
   #+END_SRC
2. æŸ¥çœ‹å†…å­˜åœ°å€ä¸­çš„æ•°æ®
   #+BEGIN_SRC sh
     (lldb) x/8w $0 => æ‰“å°åœ°å€çš„æ•°æ®, æ‰“å° 8 æ¡æ•°æ®, [w, b] è¡¨ç¤ºä¸åŒçš„æ‰“å°æ–¹å¼
     0x7fbdc123dc00: 0x0916f4d8 0x00000001 0x0916f548 0x00000001
     0x7fbdc123dc10: 0x00000000 0x00000000 0xc1240440 0x00007fbd
     (lldb) x/8b $0
     0x7fbdc123dc00: 0xd8 0xf4 0x16 0x09 0x01 0x00 0x00 0x00
     (lldb) x/8x $0
     0x7fbdc123dc00: 0xd8 0xf4 0x16 0x09 0x01 0x00 0x00 0x00
   #+END_SRC
3. æŸ¥çœ‹ frame ä¸­å˜é‡
   #+BEGIN_SRC sh
     # æŸ¥çœ‹å±€éƒ¨å˜é‡
     (lldb) frame variable
     (lldb) fr v
     # æŸ¥çœ‹å…¨å±€å˜é‡
     (lldb) target variable
     (lldb) ta v
     # æŸ¥çœ‹è°ƒç”¨æ ˆ thread backtrace
     (lldb/gdb) bt
   #+END_SRC

*** MacOS: è¯ä¹¦é”™è¯¯é—®é¢˜ [[https://timnash.co.uk/getting-gdb-to-semi-reliably-work-on-mojave-macos/][(^-^)]]
#+BEGIN_QUOTE
  please check gdb is codesigned - see taskgated(8)
#+END_QUOTE
æ‰‹å·¥ç¼–å†™ gdb.xml
#+BEGIN_SRC xml
  <?xml version="1.0" encoding="UTF-8"?>
  <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN"
  "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
  <plist version="1.0">
  <dict>
      <key>com.apple.security.cs.allow-jit</key>
      <true/>
      <key>com.apple.security.cs.allow-unsigned-executable-memory</key>
      <true/>
      <key>com.apple.security.cs.allow-dyld-environment-variables</key>
      <true/>
      <key>com.apple.security.cs.disable-library-validation</key>
      <true/>
      <key>com.apple.security.cs.disable-executable-page-protection</key>
      <true/>
      <key>com.apple.security.cs.debugger</key>
      <true/>
      <key>com.apple.security.get-task-allow</key>
      <true/>
  </dict>
  </plist>
#+END_SRC
ä½¿ç”¨å‘½ä»¤ç»™ gdb æ·»åŠ è¯ä¹¦
#+BEGIN_SRC sh
  codesign --entitlements gdb.xml -fs gdb-cert /usr/local/bin/gdb
#+END_SRC

*** äº¤å‰ç¼–è¯‘
#+BEGIN_SRC sh
  export PREFIX="/opt/i386-elf-toolchain"
  export TARGET=i386-elf
  export PATH="$PREFIX/bin:$PATH"

  wget -c https://mirrors.tuna.tsinghua.edu.cn/gnu/gcc/gcc-11.4.0/gcc-11.4.0.tar.gz
  wget -c https://mirrors.tuna.tsinghua.edu.cn/gnu/binutils/binutils-2.40.tar.gz
  wget -c https://mirrors.tuna.tsinghua.edu.cn/gnu/gdb/gdb-11.2.tar.gz

  tar xzvf binutils-2.40.tar.gz
  tar xzvf gcc-11.4.0.tar.gz
  cd gcc-11.4.0
  ./contrib/download_prerequisites


  DIR=$PWD

  # rm -rf $DIR/build-binutils
  mkdir -p $DIR/build-binutils
  cd $DIR/build-binutils
  ../binutils-2.40/configure --target=$TARGET --prefix=$PREFIX --enable-interwork --enable-multilib --disable-nls --disable-werror 2>&1 | tee configure.log
  make all -j4 2>&1 | tee make.log
  sudo make install 2>&1 | tee install.log


  # rm -rf $DIR/build-gcc
  mkdir -p $DIR/build-gcc
  cd $DIR/build-gcc
  ../gcc-11.4.0/configure --target=$TARGET --prefix=$PREFIX --disable-nls --disable-libssp --enable-languages=c --without-headers 2>&1 | tee configure.log
  make all-gcc -j4 2>&1 | tee make-all-gcc.log
  make all-target-libgcc -j4 2>&1 | tee make-all-target-libgcc.log
  sudo make install-gcc 2>&1 | tee make-install-gcc.log
  sudo make install-target-libgcc 2>&1 | tee make-install-target-libgcc.log


  # rm -rf $DIR/build-gdb
  mkdir -p $DIR/build-gdb
  cd $DIR/build-gdb
  ../gdb-11.2/configure --target=$TARGET --prefix=$PREFIX --program-prefix=i386-elf-
  make -j4 2>&1 | tee make.log
  sudo make install 2>&1 | tee install.log
#+END_SRC
** SSH é…ç½®
*** forward ç«¯å£è½¬å‘
æœ¬åœ°è½¬å‘
#+BEGIN_SRC sh
  # -N ä¸æ‰§è¡Œå‘½ä»¤, -L local è½¬å‘ <remote-port>:<local-host>:<local-port>
  ssh -N -L 9092:127.0.0.1:9092 user@host
#+END_SRC

è¿œç«¯è½¬å‘
#+BEGIN_SRC sh
  # -N ä¸æ‰§è¡Œå‘½ä»¤, -R remote è½¬å‘ <local-port>:<remote-host>:<remote-port>
  ssh -N -R 9092:127.0.0.1:9092 user@host
#+END_SRC
** Git
*** é…ç½®ç”¨æˆ·ä¿¡æ¯
#+BEGIN_SRC sh
  git config --global user.email "hujinghui@buaa.edu.cn"
  git config --global user.name "Jinghui Hu"
#+END_SRC
** Docker ç¯å¢ƒ
å®‰è£…å‚è€ƒé“¾æ¥ [[https://docs.docker.com/engine/install/centos/#install-using-the-repository][link]]
#+BEGIN_SRC sh
  yum install -y yum-utils
  yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo

  yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
#+END_SRC
** CentOS å·¥å…·é“¾
*** SCL (Software Collection)
SCL æä¾›ä¸€ä¸‹è¾ƒæ–°çš„å·¥å…·é›† [[https://wiki.centos.org/AdditionalResources/Repositories/SCL][link]]
#+BEGIN_SRC sql
  yum install centos-release-scl

  yum makecache
  yum repolist
#+END_SRC

*** Red Hat Developer Toolset
1. ä½¿ç”¨æ‰‹å†Œ [[https://access.redhat.com/documentation/en-us/red_hat_developer_toolset/11/html-single/user_guide/index#doc-wrapper][User Guide]]
   #+BEGIN_SRC sh
     yum install scl-utils centos-release-scl

     yum list all --enablerepo='centos-sclo-rh' | grep "devtoolset"
     yum install devtoolset-11-toolchain
   #+END_SRC
2. é…ç½®å¹¶å¯ç”¨ scl å·¥å…·é›†
   #+BEGIN_SRC sh
     scl --list
     scl enable devtoolset-11 bash
   #+END_SRC
** WSL
*** Ubuntu å®‰è£…å¹¶è¿ç§»åˆ°å…¶ä»–ç›˜
1. å®‰è£…è¯´æ˜ [[https://learn.microsoft.com/zh-cn/windows/wsl/install-manual][link]]
2. ç§»åŠ¨æ•°æ®æ–‡ä»¶åˆ°éç³»ç»Ÿç›˜
   #+BEGIN_SRC sh
     # æŸ¥çœ‹å½“å‰çš„ wsl å®¹å™¨
     wsl -l -v

     wsl --export Ubuntu ubuntu2204.tar
     wsl --unregister Ubuntu

     mkdir data
     wsl --import Ubuntu-22.04 data ubuntu2204.tar
   #+END_SRC
*** Docker æ— æ³•å¯åŠ¨
/usr/sbin/iptables-nft ç½‘ç»œç®¡ç† WSL2 ä¸æ”¯æŒï¼Œéœ€è¦ä¿®æ”¹ä¸€ä¸‹
#+BEGIN_SRC sh
  $ sudo update-alternatives --config iptables
  There are 2 choices for the alternative iptables (providing /usr/sbin/iptables).

    Selection    Path                       Priority   Status
  ------------------------------------------------------------
  ,* 0            /usr/sbin/iptables-nft      20        auto mode
    1            /usr/sbin/iptables-legacy   10        manual mode
    2            /usr/sbin/iptables-nft      20        manual mode

  Press <enter> to keep the current choice[*], or type selection number: 1
  update-alternatives: using /usr/sbin/iptables-legacy to provide /usr/sbin/iptables (iptables) in manual mode
  $ sudo service docker start
   ,* Starting Docker: docker                                                                                                                                            [ OK ]
  $ docker ps
  CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
#+END_SRC
*** ç¼ºå¤±å­—ä½“
é»˜è®¤æ·»åŠ  Windows è‡ªå¸¦çš„å­—ä½“æ¥æ˜¾ç¤ºç¼ºå¤±å­—ä½“
#+BEGIN_SRC sh
  sudo ln -s /mnt/c/Windows/Fonts /usr/share/fonts/host
  fc-cache -fv
#+END_SRC
*** è§£å†³æç¤ºç¬¦é”™è¯¯
Windows Terminal åœ¨å®‰è£… zsh-autosuggestions æ—¶ä¼šæ˜¾ç¤ºçš„æœ‰é—®é¢˜ï¼Œè¿™é‡Œä¿®æ”¹ä¸€ä¸‹ ~PS1~
#+BEGIN_SRC sh
  ZSH_THEME="none"
  export PS1='WSL(%3~)%# '
#+END_SRC
** LSP
Java LSP æœåŠ¡
#+BEGIN_SRC sh
  git clone https://github.com/eruizc-dev/jdtls-launcher.git
  ./install.sh
#+END_SRC

Python LSP æœåŠ¡
#+BEGIN_SRC sh
  pip install --user pandas
  pip install --user sqlalchemy
  pip install --user pymysql
  pip install --user yapf
  pip install --user "python-lsp-server[yapf]"
#+END_SRC
** Tmux
#+BEGIN_SRC sh
  set -g mouse on
  set -g default-terminal "xterm-256color"
  set -g escape-time 0
#+END_SRC
* æ•ˆç‡å·¥å…·
** Perl
*** ç¯å¢ƒé…ç½®
**** åŒ…ç®¡ç†å·¥å…·é…ç½® CPAN
1. å®˜ç½‘ [[https://metacpan.org/][CPAN]]
2. é•œåƒ [[https://mirrors.tuna.tsinghua.edu.cn/help/CPAN/][TUNA]]
   #+BEGIN_SRC sh
     PERL_MM_USE_DEFAULT=1 perl -MCPAN -e 'CPAN::HandleConfig->edit("pushy_https", 0); CPAN::HandleConfig->edit("urllist", "unshift", "https://mirrors.tuna.tsinghua.edu.cn/CPAN/"); mkmyconfig'
   #+END_SRC
3. CPAN çš„é…ç½®æ–‡ä»¶: =~/.cpan/CPAN/MyConfig.pm=
**** åŒ…ç®¡ç†å‘½ä»¤
#+BEGIN_SRC sh
  perl -MCPAN -e 'install Excel::Writer::XLSX'
#+END_SRC
*** åŸºæœ¬ä½¿ç”¨
**** Hello world
åˆ›å»º =hello.pl= æ–‡ä»¶å†™ä»¥ä¸‹ä»£ç 
#+BEGIN_SRC perl :results output
  print("hello world\n");
#+END_SRC

#+RESULTS:
: hello world

ä½¿ç”¨ perl å‘½ä»¤è¿è¡Œä»£ç 
#+BEGIN_SRC sh
  perl hello.pl
#+END_SRC
[[file:../static/image/2023/0129/192740.png]]

**** è¿‡æ»¤ MySQL trace æ—¥å¿—
#+BEGIN_SRC perl :results file
  use strict;
  use warnings;

  my $cid = 8;
  my $fout = "/tmp/mysqld-thd-$cid.txt";
  open(FIN, '<:encoding(UTF-8)', "/tmp/mysqld.trace") or die;
  open(FOUT, '>', $fout) or die;

  while (my $line = <FIN>) {
      if ($line =~ /^T\@$cid/) {
          print FOUT $line;
      }
  }

  close(FOUT);
  $fout;
#+END_SRC

#+RESULTS:
[[file:/tmp/mysqld-thd-8.txt]]

** Python

** Ruby
1. é…ç½®å›½å†… GEM é•œåƒ [[https://gems.ruby-china.com/][Ruby China]]
* é—®é¢˜æ’æŸ¥
** ç§‘å­¦ä¸Šç½‘
*** githubusercontent é“¾æ¥å¤±è´¥
/etc/hosts
#+BEGIN_SRC sh
  185.199.108.133 raw.githubusercontent.com
#+END_SRC
** ä½¿ç”¨ä½“éªŒ
**** Esc é”®æœ‰å»¶è¿Ÿ
é—®é¢˜è¯´æ˜ [[https://www.johnhawthorn.com/2012/09/vi-escape-delays/][Eliminating delays on ESC in vim and zsh]]
å°è¯•æŒ‰ç…§ä»¥ä¸‹æ€è·¯è§£å†³è¿™ä¸ªé—®é¢˜
vim
#+BEGIN_SRC text
  set timeoutlen=1000 ttimeoutlen=0
#+END_SRC
zsh
#+BEGIN_SRC sh
  # 10ms for key sequences
  KEYTIMEOUT=1
#+END_SRC
tmux
#+BEGIN_SRC sh
  # .tmux.conf
  set -s escape-time 0
  echo 'set -s escape-time 0' >> ~/.tmux.conf
#+END_SRC
** CentOS
*** ç¡¬ä»¶æ—¶é’Ÿ hwclock
#+BEGIN_SRC sh
  # Display hwclock
  hwclock --show

  # Sync hwclock to system
  hwclock --hctosys

  # Save clock, for reboot
  clock -w
  hwclock -w
#+END_SRC
** MySQL
*** Public Key Retrieval is not allowed
åœ¨è®¾ç½®æ•°æ®åº“æ·»åŠ å¦‚ä¸‹çš„é“¾æ¥é€‰é¡¹
#+BEGIN_SRC text
  employees?allowPublicKeyRetrieval=true
#+END_SRC
** Docker
*** æ–‡ä»¶å¤¹é€’å½’å¤åˆ¶
#+BEGIN_SRC dockerfile
  # æ­£ç¡®åœ°é€’å½’å¤åˆ¶æ–‡ä»¶å¤¹æ–¹æ¡ˆ
  COPY src/  target/

  # ä»¥ä¸‹ä¸¤ç§ä¸å’Œé€’å½’å¤åˆ¶
  COPY src/* target
  COPY src   target
#+END_SRC

* åŸºç¡€çŸ¥è¯†
** æ•°æ®ç»“æ„
1. çº¢é»‘æ ‘ [[https://www.cs.usfca.edu/~galles/visualization/RedBlack.html][rbtree]]
** æ“ä½œç³»ç»Ÿ
*** è¯¾ç¨‹ [[https://pdos.csail.mit.edu/6.828/2019/index.html][MIT 6.828]]
**** ç¯å¢ƒå‡†å¤‡
1. [[https://pdos.csail.mit.edu/6.828/2019/tools.html][å·¥å…·é“¾]] risc-v
2. è¯¾ç¨‹è§†é¢‘ [[https://www.bilibili.com/video/BV19k4y1C7kA][BILI]]
3. ä¸­æ–‡è¯¾ç¨‹æ•´ç† [[http://xv6.dgs.zone/][ä¸­æ–‡ä»‹ç»]]
*** Minix
**** é…ç½®ç¯å¢ƒ
[[https://wiki.minix3.org/doku.php?id=developersguide:crosscompiling][äº¤å‰ç¼–è¯‘æ–‡æ¡£]]

ä¸‹è½½ä»£ç 
#+BEGIN_SRC sh
  mkdir minix
  cd minix
  git clone git://git.minix3.org/minix src
  cd src
#+END_SRC

å®‰è£…ä¾èµ–
#+BEGIN_SRC sql
  sudo apt-get install build-essential curl git zlibc zlib1g zlib1g-dev g++
#+END_SRC

ç¼–è¯‘å†…å­˜é•œåƒ
#+BEGIN_SRC sh
  JOBS=8 ./releasetools/x86_hdimage.sh
#+END_SRC

å¯åŠ¨é•œåƒ
#+BEGIN_SRC sh
  cd ../obj.i386/destdir.i386/boot/minix/.temp

  qemu-system-i386 -display none \
                   -serial stdio \
                   -kernel kernel \
                   -append "console=tty00 rootdevname=c0d0p1" \
                   -initrd "mod01_ds,mod02_rs,mod03_pm,mod04_sched,mod05_vfs,mod06_memory,mod07_tty,mod08_mfs,mod09_vm,mod10_pfs,mod11_init" \
                   -hda /opt/local/hack/minix/src/minix_x86.img --enable-kvm
#+END_SRC

[[file:../static/image/2023/0315/112736.png]]
*** Linux
**** ç¼–è¯‘å†…æ ¸
1. ä¸€äº›ä¾èµ–å®‰è£…
   #+BEGIN_SRC sh
     sudo apt install ncurses-dev flex bison libelf-dev libssl-dev dwarves
   #+END_SRC
2. å®šåˆ¶å†…æ ¸ [[https://wiki.centos.org/HowTos/Custom_Kernel][CentOS Wiki]]
#+BEGIN_SRC sh
  # ä¸‹è½½æºç 
  wget -c https://mirrors.tuna.tsinghua.edu.cn/kernel/v5.x/linux-5.15.115.tar.gz
  tar xvzf linux-5.15.115.tar.gz
  cd linux-5.15.115

  # å‡†å¤‡é…ç½®æ–‡ä»¶
  cp /boot/config-`uname -r` .config
  # å¼€å¯æˆ–å…³é—­é…ç½®é€‰é¡¹
  make menuconfig

  # ç¡®ä¿ CONFIG_SYSTEM_TRUSTED_KEYS ä¸ºç©º
  # cat .config | grep CONFIG_SYSTEM_TRUSTED_KEYS
  # CONFIG_SYSTEM_TRUSTED_KEYS=""

  # ç¼–è¯‘å†…æ ¸
  make -j12

  # å®‰è£…æ¨¡å—
  sudo make modules_install

  # å®‰è£…å†…æ ¸
  sudo make install

  # é‡å¯ç³»ç»Ÿ, æŸ¥çœ‹å†…æ ¸æ˜¯å¦è¿è¡Œæ­£å¸¸
  reboot
  uname -r
#+END_SRC

ä¿®æ”¹ grub ä»£ç 
#+BEGIN_SRC sh
  # æŸ¥çœ‹é»˜è®¤çš„ grub é€‰é¡¹
  grub2-editenv list
  # æ›´æ”¹é»˜è®¤å¯åŠ¨é€‰é¡¹
  grub2-set-default '5.16.0-1.el7.elrepo.x86_64) 7 (Core)'
#+END_SRC

**** Linux èµ„æ–™ç½‘ç«™
1. Linux From Scratch [[https://www.linuxfromscratch.org/][LFS]]
2. è€ç‰ˆæœ¬ Linux ç ”ç©¶ç½‘ç«™ [[http://www.oldlinux.org/][oldlinux]]

**** Ubuntu 22.04 ç¼–è¯‘ linux 0.11
#+BEGIN_SRC sh
  apt install bin86
#+END_SRC

** æå®¢æ—¶å…‰
*** ä¸“æ  [[https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/22%20%E8%AE%B2%E9%80%9A%E5%85%B3%20Go%20%E8%AF%AD%E8%A8%80-%E5%AE%8C][22 è®²é€šå…³ Go è¯­è¨€]]
*** ä¸“æ  [[https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/24%E8%AE%B2%E5%90%83%E9%80%8F%E5%88%86%E5%B8%83%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%AE%8C][24 è®²åƒé€åˆ†å¸ƒå¼æ•°æ®åº“]]
*** ä¸“æ  [[https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E9%AB%98%E6%89%8B%E8%AF%BE][æ¶ˆæ¯é˜Ÿåˆ—é«˜æ‰‹è¯¾]]
**** åˆ†å¸ƒå¼äº‹åŠ¡
1. è®¢å•ç³»ç»Ÿåœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸Šå¼€å¯ä¸€ä¸ªäº‹åŠ¡
2. ç„¶åè®¢å•ç³»ç»Ÿç»™æ¶ˆæ¯æœåŠ¡å™¨å‘é€ä¸€ä¸ª *åŠæ¶ˆæ¯*
3. è¿™ä¸ªåŠæ¶ˆæ¯ä¸æ˜¯è¯´æ¶ˆæ¯å†…å®¹ä¸å®Œæ•´ï¼Œå®ƒåŒ…å«çš„å†…å®¹å°±æ˜¯å®Œæ•´çš„æ¶ˆæ¯å†…å®¹ï¼ŒåŠæ¶ˆæ¯å’Œæ™®é€š
   æ¶ˆæ¯çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼Œåœ¨äº‹åŠ¡æäº¤ä¹‹å‰ï¼Œå¯¹äºæ¶ˆè´¹è€…æ¥è¯´ï¼Œè¿™ä¸ªæ¶ˆæ¯æ˜¯ä¸å¯è§çš„
4. åŠæ¶ˆæ¯å‘é€æˆåŠŸåï¼Œè®¢å•ç³»ç»Ÿå°±å¯ä»¥æ‰§è¡Œæœ¬åœ°äº‹åŠ¡

[[file:../static/image/2023/0308/224741.png]]

å¦‚æœ *åŠæ¶ˆæ¯* æäº¤å¤±è´¥ï¼Œä¸åŒé˜Ÿåˆ—ä¼šæœ‰ä¸åŒå¤„ç†æ–¹å¼
1. Kafka çš„è§£å†³æ–¹æ¡ˆæ¯”è¾ƒç®€å•ç²—æš´ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè®©ç”¨æˆ·è‡ªè¡Œå¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¸šåŠ¡ä»£
   ç ä¸­åå¤é‡è¯•æäº¤ï¼Œç›´åˆ°æäº¤æˆåŠŸï¼Œæˆ–è€…åˆ é™¤ä¹‹å‰åˆ›å»ºçš„è®¢å•è¿›è¡Œè¡¥å¿
2. RocketMQ ä¸­çš„äº‹åŠ¡å®ç°ä¸­ï¼Œå¢åŠ äº†äº‹åŠ¡åæŸ¥çš„æœºåˆ¶æ¥è§£å†³äº‹åŠ¡æ¶ˆæ¯æäº¤å¤±è´¥çš„é—®é¢˜

   [[file:../static/image/2023/0308/225054.png]]

   ä¸ºäº†æ”¯æ’‘è¿™ä¸ªäº‹åŠ¡åæŸ¥æœºåˆ¶ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡ä»£ç éœ€è¦å®ç°ä¸€ä¸ªåæŸ¥æœ¬åœ°äº‹åŠ¡çŠ¶æ€çš„æ¥å£ï¼Œ
   å‘ŠçŸ¥ RocketMQ æœ¬åœ°äº‹åŠ¡æ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥
**** é‡å¤æ¶ˆè´¹
åœ¨ MQTT åè®®ä¸­ï¼Œç»™å‡ºäº†ä¸‰ç§ä¼ é€’æ¶ˆæ¯æ—¶èƒ½å¤Ÿæä¾›çš„æœåŠ¡è´¨é‡æ ‡å‡†ï¼Œè¿™ä¸‰ç§æœåŠ¡è´¨é‡ä»ä½åˆ°
é«˜ä¾æ¬¡æ˜¯ï¼š

1. At most once: è‡³å¤šä¸€æ¬¡ã€‚æ¶ˆæ¯åœ¨ä¼ é€’æ—¶ï¼Œæœ€å¤šä¼šè¢«é€è¾¾ä¸€æ¬¡ã€‚æ¢ä¸€ä¸ªè¯´æ³•å°±æ˜¯ï¼Œæ²¡ä»€
   ä¹ˆæ¶ˆæ¯å¯é æ€§ä¿è¯ï¼Œå…è®¸ä¸¢æ¶ˆæ¯ã€‚ä¸€èˆ¬éƒ½æ˜¯ä¸€äº›å¯¹æ¶ˆæ¯å¯é æ€§è¦æ±‚ä¸å¤ªé«˜çš„ç›‘æ§åœºæ™¯ä½¿
   ç”¨ï¼Œæ¯”å¦‚æ¯åˆ†é’Ÿä¸ŠæŠ¥ä¸€æ¬¡æœºæˆ¿æ¸©åº¦æ•°æ®ï¼Œå¯ä»¥æ¥å—æ•°æ®å°‘é‡ä¸¢å¤±ã€‚
2. At least once: è‡³å°‘ä¸€æ¬¡ã€‚æ¶ˆæ¯åœ¨ä¼ é€’æ—¶ï¼Œè‡³å°‘ä¼šè¢«é€è¾¾ä¸€æ¬¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å…è®¸ä¸¢æ¶ˆ
   æ¯ï¼Œä½†æ˜¯å…è®¸æœ‰å°‘é‡é‡å¤æ¶ˆæ¯å‡ºç°ã€‚
3. Exactly onceï¼šæ°å¥½ä¸€æ¬¡ã€‚æ¶ˆæ¯åœ¨ä¼ é€’æ—¶ï¼Œåªä¼šè¢«é€è¾¾ä¸€æ¬¡ï¼Œä¸å…è®¸ä¸¢å¤±ä¹Ÿä¸å…è®¸é‡å¤ï¼Œ
   è¿™ä¸ªæ˜¯æœ€é«˜çš„ç­‰çº§ã€‚

ç”¨å¹‚ç­‰æ€§è§£å†³é‡å¤æ¶ˆæ¯é—®é¢˜
1. åˆ©ç”¨æ•°æ®åº“çš„å”¯ä¸€çº¦æŸå®ç°å¹‚ç­‰
2. ä¸ºæ›´æ–°çš„æ•°æ®è®¾ç½®å‰ç½®æ¡ä»¶
3. è®°å½•å¹¶æ£€æŸ¥æ“ä½œ

**** æ¶ˆæ¯ç§¯å‹
1. ä¼˜åŒ–æ¶ˆæ¯æ”¶å‘æ€§èƒ½ï¼Œé¢„é˜²æ¶ˆæ¯ç§¯å‹çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼Œ
   - å¢åŠ æ‰¹é‡æˆ–è€…æ˜¯å¢åŠ å¹¶å‘ï¼Œåœ¨å‘é€ç«¯è¿™ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥ä½¿ç”¨
   - åœ¨æ¶ˆè´¹ç«¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¢åŠ å¹¶å‘éœ€è¦åŒæ­¥æ‰©å®¹åˆ†åŒºæ•°é‡ï¼Œå¦åˆ™æ˜¯èµ·ä¸åˆ°æ•ˆæœçš„
2. å¯¹äºç³»ç»Ÿå‘ç”Ÿæ¶ˆæ¯ç§¯å‹çš„æƒ…å†µï¼Œéœ€è¦å…ˆè§£å†³ç§¯å‹ï¼Œå†åˆ†æåŸå› 
   - å¿«é€Ÿè§£å†³ç§¯å‹çš„æ–¹æ³•å°±æ˜¯é€šè¿‡æ°´å¹³æ‰©å®¹å¢åŠ  Consumer çš„å®ä¾‹æ•°é‡

* å­¦ä¹ è®¡åˆ’
** åˆ¶ä½œæ“ä½œç³»ç»Ÿ
1. c/c++ ç¼–å†™ä¸€ä¸ªæ“ä½œç³»ç»Ÿ [[https://samypesse.gitbook.io/how-to-create-an-operating-system/chapter-2][link]]
2. Linux å†…æ ¸å®Œå…¨æ³¨é‡Š [[http://www.oldlinux.org/download/CLK-5.0-WithCover.pdf][book]]
3. James kernel development tutorial [[http://www.jamesmolloy.co.uk/tutorial_html/index.html][link]]
3. os-tutorial
** æ“ä½œç³»ç»Ÿå®éªŒ
1. AUR ç¼–è¯‘è¯´æ˜æ–‡æ¡£ [[https://wiki.manjaro.org/index.php/Arch_User_Repository/zh-cn][link]]
   #+BEGIN_SRC sh
     # clone build repository
     git clone https://aur.archlinux.org/i386-elf-binutils.git
     # make binary package
     makepkg -s
     # install package
     sudo pacman -U i386-elf-binutils-2.40-1-x86_64.pkg.tar.zst
   #+END_SRC
2. c è¯­è¨€äº¤å‰ç¼–è¯‘
   #+BEGIN_SRC sh
     # äº¤å‰ç¼–è¯‘, -ffreestanding ä¸éœ€è¦æ ‡å‡†åº“æ”¯æŒï¼Œç”Ÿæˆç›®æ ‡æ˜¯ä¸€ä¸ªç‹¬ç«‹ç¯å¢ƒ
     i386-elf-gcc -ffreestanding -c function.c -o function.o
     # åæ±‡ç¼–
     i386-elf-objdump -d function.o

     # é“¾æ¥, -Ttext 0x0 è¡¨ç¤ºä»£ç æ®µçš„èµ·å§‹åœ°å€
     i386-elf-ld -o function.bin -Ttext 0x0 --oformat binary function.o

     # åæ±‡ç¼–æµ‹è¯•ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶
     ndisasm -b 32 function.bin
   #+END_SRC
3. gdb è°ƒè¯•å†…æ ¸
   #+BEGIN_SRC sh
     # -s è®© qemu åœæ­¢å¹¶ç›‘å¬ 1234 ç«¯å£ç­‰å¾…è°ƒè¯•
     qemu-system-i386 -s -fda os-image.bin &
     # åˆ›å»ºè¿æ¥ç¬¦å·æ–‡ä»¶
     i386-elf-ld -o kernel.elf -Ttext 0x1000 kernel.o obj1.o obj2.o
     # gdb æ‰§è¡Œå‘½ä»¤è¿›è¡Œè°ƒè¯•
     i386-elf-gdb -ex "target remote localhost:1234" -ex "symbol-file kernel.elf"
   #+END_SRC
