<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-06-26 Mon 10:03 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>技术文档汇总</title>
<meta name="author" content="Jinghui Hu" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="styles/readtheorg/css/readtheorg.css"/>
<script type="text/javascript" src="styles/lib/js/jquery.min.js"></script>
<script type="text/javascript" src="styles/lib/js/bootstrap.min.js"></script>
<script type="text/javascript" src="styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="styles/readtheorg/js/readtheorg.js"></script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="../readme.html"> UP </a>
 |
 <a accesskey="H" href="../index.html"> HOME </a>
</div><div id="content" class="content">
<h1 class="title">技术文档汇总</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org651a382">1. 后端研发</a>
<ul>
<li><a href="#org94bbd6b">1.1. Oracle</a>
<ul>
<li><a href="#orgeef7d88">1.1.1. 📚 参考资料</a></li>
<li><a href="#org15c453e">1.1.2. 开发环境配置</a></li>
<li><a href="#orgaba2747">1.1.3. 运维相关</a></li>
</ul>
</li>
<li><a href="#orgd9e9fb5">1.2. MySQL</a>
<ul>
<li><a href="#org45e62fc">1.2.1. 📚 参考资料</a></li>
<li><a href="#org1e1eaf7">1.2.2. 主从架构实验环境</a></li>
<li><a href="#org95c5ebb">1.2.3. 运维主题</a></li>
<li><a href="#orge6c43a8">1.2.4. 源码研究</a></li>
</ul>
</li>
<li><a href="#orgf75a082">1.3. Postgres</a>
<ul>
<li><a href="#org4729984">1.3.1. 前置环境变量</a></li>
<li><a href="#orgc905735">1.3.2. 编译调试 &amp; 初始化数据</a></li>
<li><a href="#org5212a79">1.3.3. 调试命令</a></li>
</ul>
</li>
<li><a href="#org4b2bfd6">1.4. ClickHouse</a>
<ul>
<li><a href="#org1c494fc">1.4.1. 安装步骤</a></li>
</ul>
</li>
<li><a href="#org67b948a">1.5. Java</a>
<ul>
<li><a href="#org94fb184">1.5.1. Spring Framework</a></li>
<li><a href="#orgcd1cdc9">1.5.2. Kafka</a></li>
<li><a href="#org50a894e">1.5.3. RocketMQ</a></li>
<li><a href="#org1f5337a">1.5.4. JVM</a></li>
<li><a href="#org55af708">1.5.5. Hive</a></li>
<li><a href="#org28408c5">1.5.6. SDK Man</a></li>
</ul>
</li>
<li><a href="#org48a862e">1.6. 云原生</a>
<ul>
<li><a href="#orgdef28c1">1.6.1. IDL</a></li>
<li><a href="#org7924b80">1.6.2. hertz</a></li>
<li><a href="#orgbf286f0">1.6.3. kitex</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org7de6591">2. 系统运维</a>
<ul>
<li><a href="#org61d72eb">2.1. Docker</a>
<ul>
<li><a href="#org6ff7a77">2.1.1. Engine 配置</a></li>
<li><a href="#orga18a941">2.1.2. 国内镜像</a></li>
</ul>
</li>
<li><a href="#org1444fec">2.2. Kubernetes</a>
<ul>
<li><a href="#org4929a5a">2.2.1. minikube</a></li>
<li><a href="#org0201c66">2.2.2. kubeadm</a></li>
<li><a href="#org5f7e3f2">2.2.3. kubectl</a></li>
<li><a href="#org7e8153a">2.2.4. 管理工具</a></li>
</ul>
</li>
<li><a href="#org1eda9c6">2.3. 磁盘管理</a>
<ul>
<li><a href="#org96db653">2.3.1. 启动盘制作</a></li>
<li><a href="#org3584945">2.3.2. Ubuntu 磁盘分区扩容</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2101fc8">3. 研发效率</a>
<ul>
<li><a href="#org67bce4c">3.1. GDB &amp; LLDB</a>
<ul>
<li><a href="#org9889091">3.1.1. 参考资料及链接</a></li>
<li><a href="#org05ef2ea">3.1.2. 进程启动: run &amp; attach</a></li>
<li><a href="#org8d75bdd">3.1.3. 调试流程控制</a></li>
<li><a href="#orgb29964e">3.1.4. 保持断点 &amp; 现场恢复</a></li>
<li><a href="#org906431c">3.1.5. 查看/修改变量和内存数据</a></li>
<li><a href="#orgb0be268">3.1.6. MacOS: 证书错误问题 (^-^)</a></li>
<li><a href="#org9032245">3.1.7. 交叉编译</a></li>
</ul>
</li>
<li><a href="#orgda54c5e">3.2. SSH 配置</a>
<ul>
<li><a href="#org91136cc">3.2.1. forward 端口转发</a></li>
</ul>
</li>
<li><a href="#orgcdc642c">3.3. Git</a>
<ul>
<li><a href="#orga2a4aac">3.3.1. 配置用户信息</a></li>
</ul>
</li>
<li><a href="#org0bc5b1f">3.4. Docker 环境</a></li>
<li><a href="#orgb41066e">3.5. CentOS 工具链</a>
<ul>
<li><a href="#org8e6ac57">3.5.1. SCL (Software Collection)</a></li>
<li><a href="#org0108325">3.5.2. Red Hat Developer Toolset</a></li>
</ul>
</li>
<li><a href="#org11fa285">3.6. WSL</a>
<ul>
<li><a href="#org2fc4ef9">3.6.1. Ubuntu 安装并迁移到其他盘</a></li>
<li><a href="#org05eb6b3">3.6.2. Docker 无法启动</a></li>
<li><a href="#orgf37b464">3.6.3. 缺失字体</a></li>
<li><a href="#orgdff1f42">3.6.4. 解决提示符错误</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgdcd4f9a">4. 效率工具</a>
<ul>
<li><a href="#org6c100ed">4.1. Perl</a>
<ul>
<li><a href="#org5620f3e">4.1.1. 环境配置</a></li>
<li><a href="#org73b8c4f">4.1.2. 基本使用</a></li>
</ul>
</li>
<li><a href="#org38bd7b2">4.2. Python</a></li>
<li><a href="#org880c309">4.3. Ruby</a></li>
</ul>
</li>
<li><a href="#org3adb560">5. 问题排查</a>
<ul>
<li><a href="#org820ad49">5.1. 科学上网</a>
<ul>
<li><a href="#orgea7588b">5.1.1. githubusercontent 链接失败</a></li>
</ul>
</li>
<li><a href="#orgb214967">5.2. 使用体验</a>
<ul>
<li><a href="#org61bdc4a">5.2.1. Esc 键有延迟</a></li>
</ul>
</li>
<li><a href="#org26b0f44">5.3. CentOS</a>
<ul>
<li><a href="#orgf71a976">5.3.1. 硬件时钟 hwclock</a></li>
</ul>
</li>
<li><a href="#org2c2e9cd">5.4. MySQL</a>
<ul>
<li><a href="#org46ce1c3">5.4.1. Public Key Retrieval is not allowed</a></li>
</ul>
</li>
<li><a href="#orgd8001bb">5.5. Docker</a>
<ul>
<li><a href="#orgd8b24ba">5.5.1. 文件夹递归复制</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org09bfad5">6. 基础知识</a>
<ul>
<li><a href="#org5e8c9fa">6.1. 数据结构</a></li>
<li><a href="#orgb7536e5">6.2. 操作系统</a>
<ul>
<li><a href="#orgac69fbd">6.2.1. 课程 MIT 6.828</a></li>
<li><a href="#org7d4430b">6.2.2. Minix</a></li>
<li><a href="#orgd4e68c9">6.2.3. Linux</a></li>
</ul>
</li>
<li><a href="#org19b13a2">6.3. 极客时光</a>
<ul>
<li><a href="#orgba69a29">6.3.1. 专栏 22 讲通关 Go 语言</a></li>
<li><a href="#orgf102041">6.3.2. 专栏 24 讲吃透分布式数据库</a></li>
<li><a href="#org96867b6">6.3.3. 专栏 消息队列高手课</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org1762b5d">7. 学习计划</a>
<ul>
<li><a href="#orgfdc78e2">7.1. 制作操作系统</a></li>
<li><a href="#org3eec5a0">7.2. 操作系统实验</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org651a382" class="outline-2">
<h2 id="org651a382"><span class="section-number-2">1.</span> 后端研发</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org94bbd6b" class="outline-3">
<h3 id="org94bbd6b"><span class="section-number-3">1.1.</span> Oracle</h3>
<div class="outline-text-3" id="text-1-1">
</div>
<div id="outline-container-orgeef7d88" class="outline-4">
<h4 id="orgeef7d88"><span class="section-number-4">1.1.1.</span> 📚 参考资料</h4>
<div class="outline-text-4" id="text-1-1-1">
<ol class="org-ol">
<li>Oracle 关系数据库 <a href="../database/oracle.html#MissingReference">参考链接</a></li>
</ol>
</div>
</div>
<div id="outline-container-org15c453e" class="outline-4">
<h4 id="org15c453e"><span class="section-number-4">1.1.2.</span> 开发环境配置</h4>
<div class="outline-text-4" id="text-1-1-2">
</div>
<ol class="org-ol">
<li><a id="org78008db"></a>CentOS 7 镜像启动<br />
<div class="outline-text-5" id="text-1-1-2-1">
<ol class="org-ol">
<li><a href="https://hub.docker.com/_/centos/">docker container</a></li>
<li><p>
启动 centos7 镜像
</p>
<div class="org-src-container">
<pre class="src src-sh">docker run _D -it --restart always <span style="color: #70c0b1;">\</span>
       -v ~/srv/pence/data:/data <span style="color: #70c0b1;">\</span>
       --hostname pence --name pence centos:7
</pre>
</div></li>
<li><p>
重新进入进行容器
</p>
<div class="org-src-container">
<pre class="src src-sh">docker exec -it pence bash
</pre>
</div></li>
<li><p>
删除容器
</p>
<div class="org-src-container">
<pre class="src src-sh">docker rm -f pence
</pre>
</div></li>
</ol>
</div>
</li>
<li><a id="org5e7264e"></a>配置主机开发环境<br />
<div class="outline-text-5" id="text-1-1-2-2">
<p>
安装一波系统依赖库
</p>
<div class="org-src-container">
<pre class="src src-sh">yum update

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">common tools</span>
yum install -y net-tools vim tmux tree kernel-devel kernel-doc kernel-headers <span style="color: #70c0b1;">\</span>
    samba samba-client ntp rsync curl git

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">for oracle 11g install</span>
yum install -y binutils compat-libcap1 compat-libstdc++-33 gcc gcc-c++ glibc <span style="color: #70c0b1;">\</span>
    glibc-devel ksh libgcc libstdc++ libstdc++-devel libaio libaio-devel libXi <span style="color: #70c0b1;">\</span>
    libXtst make sysstat unixODBC unixODBC-devel oracleasm-support

yum install -y gcc gcc-c++ cmake automake zip unzip python3 python3-devel <span style="color: #70c0b1;">\</span>
    python-devel python rpm-build redhat-rpm-config asciidoc hmaccalc <span style="color: #70c0b1;">\</span>
    perl-ExtUtils-Embed pesign xmlto audit-libs-devel binutils-devel <span style="color: #70c0b1;">\</span>
    elfutils-devel elfutils-libelf-devel ncurses-devel bison-devel newt-devel <span style="color: #70c0b1;">\</span>
    numactl-devel pciutils-devel python-devel zlib-devel readline-devel

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">for mysql</span>
yum install -y cmake ncurses ncurses-devel bison bison-devel openssl openssl-devel

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">for openGauss</span>
yum install -y libaio-devel flex bison bison-devel ncurses-devel glibc-devel <span style="color: #70c0b1;">\</span>
    patch redhat-lsb-core readline-devel

</pre>
</div>
</div>
</li>

<li><a id="orgf130bcc"></a>设置时区<br />
<div class="outline-text-5" id="text-1-1-2-3">
<div class="org-src-container">
<pre class="src src-sh">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</pre>
</div>
</div>
</li>

<li><a id="orgfa2622f"></a>安装数据库的前置准备<br />
<div class="outline-text-5" id="text-1-1-2-4">
<ol class="org-ol">
<li><a href="../article/install-oracle-11g-on-linux.html">安装 Oracle 11g</a></li>
<li>配置系统内存以及 swap</li>
</ol>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgaba2747" class="outline-4">
<h4 id="orgaba2747"><span class="section-number-4">1.1.3.</span> 运维相关</h4>
<div class="outline-text-4" id="text-1-1-3">
</div>
<ol class="org-ol">
<li><a id="org8d0b5ca"></a>表空间及数据文件<br />
<div class="outline-text-5" id="text-1-1-3-1">
<p>
查看数据
</p>
<div class="org-src-container">
<pre class="src src-sh">
</pre>
</div>

<p>
修改数据
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #969896; font-style: italic;">-- </span><span style="color: #969896; font-style: italic;">&#28155;&#21152;&#25968;&#25454;&#25991;&#20214;&#21040;&#34920;&#31354;&#38388;</span>
<span style="color: #b9ca4a;">alter</span> tablespace TBS_PART01 <span style="color: #b9ca4a;">add</span> datafile <span style="color: #70c0b1;">'/u01/part01.dbf'</span> <span style="color: #b9ca4a;">size</span> 4G;
<span style="color: #969896; font-style: italic;">-- </span><span style="color: #969896; font-style: italic;">&#20462;&#25913;&#25968;&#25454;&#25991;&#20214;&#23646;&#24615;</span>
<span style="color: #b9ca4a;">alter</span> database datafile <span style="color: #70c0b1;">'/u01/part01.dbf'</span> autoextend <span style="color: #b9ca4a;">off</span>;
<span style="color: #b9ca4a;">alter</span> database datafile <span style="color: #70c0b1;">'/u01/part01.dbf'</span> autoextend <span style="color: #b9ca4a;">on</span> <span style="color: #b9ca4a;">next</span> 100M maxsize 10G;
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-orgd9e9fb5" class="outline-3">
<h3 id="orgd9e9fb5"><span class="section-number-3">1.2.</span> MySQL</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-org45e62fc" class="outline-4">
<h4 id="org45e62fc"><span class="section-number-4">1.2.1.</span> 📚 参考资料</h4>
<div class="outline-text-4" id="text-1-2-1">
<ol class="org-ol">
<li>MySQL 开发文档 8.0.30  <a href="https://dev.mysql.com/doc/dev/mysql-server/8.0.30/PAGE_GET_STARTED.html#start_source">Source Code Documents</a></li>
<li>MySQL 使用文档 <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html">InnoDB Storage Engine</a></li>
<li>专栏 <a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/MySQL%E5%AE%9E%E6%88%9845%E8%AE%B2">MySQL 实战 45 讲</a></li>
<li>三方库 <a href="https://gorm.io/docs/index.html">GORM</a> | <a href="https://docs.spring.io/spring-data/jpa/docs/2.7.7/reference/html/">JPA</a> | <a href="https://github.com/mybatis/mybatis-3">mybatis-3</a></li>
</ol>
</div>
</div>

<div id="outline-container-org1e1eaf7" class="outline-4">
<h4 id="org1e1eaf7"><span class="section-number-4">1.2.2.</span> 主从架构实验环境</h4>
<div class="outline-text-4" id="text-1-2-2">
</div>
<ol class="org-ol">
<li><a id="org88dab80"></a>配置 Docker 环境<br />
<div class="outline-text-5" id="text-1-2-2-1">
<ol class="org-ol">
<li>安装 Docker Server</li>
<li>参考文档 <a href="https://docs.docker.com/compose/install/other">Install the Compose standalone</a> 安装 docker-compose</li>
<li>编写启动配置文件 <a href="env-mysql/">MySQL 主备配置</a></li>
<li>docker hub <a href="https://hub.docker.com/_/mysql">mysql 镜像</a></li>
<li>启动服务</li>
</ol>
<div class="org-src-container">
<pre class="src src-sh">docker-compose up -d
</pre>
</div>
</div>
</li>

<li><a id="org4b7c86a"></a>配置主备环境<br />
<ol class="org-ol">
<li><a id="org9793db3"></a>查看主备网络配置<br />
<div class="outline-text-6" id="text-1-2-2-2-1">
<div class="org-src-container">
<pre class="src src-sh">docker inspect mysql-master | jq <span style="color: #70c0b1;">'.[0].NetworkSettings.Networks.dbnet.IPAddress'</span>
docker inspect mysql-slave  | jq <span style="color: #70c0b1;">'.[0].NetworkSettings.Networks.dbnet.IPAddress'</span>
</pre>
</div>

<p>
查看主机网络
</p>
<div class="org-src-container">
<pre class="src src-sh">docker network ls
</pre>
</div>
</div>
</li>

<li><a id="orgb69237a"></a>主库配置备库用户的访问权限<br />
<div class="outline-text-6" id="text-1-2-2-2-2">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b9ca4a;">create</span> <span style="color: #c397d8;">user</span> "user02"@"%" identified <span style="color: #b9ca4a;">by</span> "user02";
<span style="color: #b9ca4a;">grant</span> replication slave <span style="color: #b9ca4a;">on</span> *.* <span style="color: #b9ca4a;">to</span> "user02"@"%";
flush <span style="color: #b9ca4a;">privileges</span>;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql">show master status
</pre>
</div>
</div>
</li>

<li><a id="org2dde8c2"></a>备库同步配置<br />
<div class="outline-text-6" id="text-1-2-2-2-3">
<div class="org-src-container">
<pre class="src src-sql"># &#36825;&#37324;&#30340; <span style="color: #b9ca4a;">host</span> &#31561;&#21442;&#25968;&#38656;&#35201;&#26681;&#25454;&#20027;&#24211;&#30340;&#37197;&#32622;&#20462;&#25913;
<span style="color: #969896; font-style: italic;">-- </span><span style="color: #969896; font-style: italic;">change master to master_host='172.20.0.100', master_user='user02', master_password='user02', master_log_file='1.000003', master_log_pos=823;</span>
<span style="color: #969896; font-style: italic;">-- </span><span style="color: #969896; font-style: italic;">change master to master_host='mysql-master', master_user='user02', master_password='user02', master_log_file='mysql-bin.000003', master_log_pos=0;</span>
change master <span style="color: #b9ca4a;">to</span> master_host=<span style="color: #70c0b1;">'mysql-master'</span>, master_user=<span style="color: #70c0b1;">'user02'</span>, master_password=<span style="color: #70c0b1;">'user02'</span>, master_log_file=<span style="color: #70c0b1;">'mysql-bin.000003'</span>, master_log_pos=841;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b9ca4a;">start</span> slave;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql">show slave status\G
</pre>
</div>

<p>
如果出现这样的两行表示结果是正确的
</p>
<blockquote>
<p>
Slave<sub>IO</sub><sub>Running</sub>: Yes
Slave<sub>SQL</sub><sub>Running</sub>: Yes
</p>
</blockquote>

<p>
重置 slave
</p>
<div class="org-src-container">
<pre class="src src-sql">stop slave;
reset slave;
</pre>
</div>
</div>
</li>

<li><a id="orgcbbc063"></a>主库建表<br />
<div class="outline-text-6" id="text-1-2-2-2-4">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b9ca4a;">create</span> <span style="color: #b9ca4a;">table</span> <span style="color: #e78c45;">t</span> (
  id <span style="color: #7aa6da;">int</span> <span style="color: #b9ca4a;">primary</span> <span style="color: #b9ca4a;">key</span> auto_increment,
  c <span style="color: #7aa6da;">int</span>
);
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b9ca4a;">insert</span> <span style="color: #b9ca4a;">into</span> t(c) <span style="color: #b9ca4a;">values</span> (1), (2), (3);
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b9ca4a;">delete</span> <span style="color: #b9ca4a;">from</span> t <span style="color: #b9ca4a;">where</span> id &lt; 10;
</pre>
</div>
</div>
</li>

<li><a id="org06d5a44"></a>备库查询<br />
<div class="outline-text-6" id="text-1-2-2-2-5">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b9ca4a;">select</span> * <span style="color: #b9ca4a;">from</span> t;
</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="orgb6dd2bd"></a>设置登录别名<br />
<div class="outline-text-5" id="text-1-2-2-3">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c397d8;">alias</span> <span style="color: #e7c547;">my1</span>=<span style="color: #70c0b1;">"MYSQL_PWD=p111   mysql -h127.0.0.1 -uroot -P9001"</span>
<span style="color: #c397d8;">alias</span> <span style="color: #e7c547;">my2</span>=<span style="color: #70c0b1;">"MYSQL_PWD=p222   mysql -h127.0.0.1 -uroot -P9002"</span>
<span style="color: #c397d8;">alias</span> <span style="color: #e7c547;">u01</span>=<span style="color: #70c0b1;">"MYSQL_PWD=user01 mysql -h127.0.0.1 -uuser01 -P9001 test01"</span>
<span style="color: #c397d8;">alias</span> <span style="color: #e7c547;">u02</span>=<span style="color: #70c0b1;">"MYSQL_PWD=user02 mysql -h127.0.0.1 -uuser02 -P9002 test01"</span>
<span style="color: #c397d8;">alias</span> <span style="color: #e7c547;">m100</span>=<span style="color: #70c0b1;">'docker exec -it mysql-master /bin/bash'</span>
<span style="color: #c397d8;">alias</span> <span style="color: #e7c547;">m101</span>=<span style="color: #70c0b1;">'docker exec -it mysql-slave /bin/bash'</span>
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org95c5ebb" class="outline-4">
<h4 id="org95c5ebb"><span class="section-number-4">1.2.3.</span> 运维主题</h4>
<div class="outline-text-4" id="text-1-2-3">
</div>
<ol class="org-ol">
<li><a id="org3b6c4bf"></a>创建用户 &amp; 授权访问数据库<br />
<div class="outline-text-5" id="text-1-2-3-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b9ca4a;">create</span> <span style="color: #c397d8;">user</span> <span style="color: #70c0b1;">'jeffrey'</span>@<span style="color: #70c0b1;">'%'</span> identified <span style="color: #b9ca4a;">by</span> <span style="color: #70c0b1;">'hello'</span>;
<span style="color: #b9ca4a;">grant</span> <span style="color: #b9ca4a;">all</span> <span style="color: #b9ca4a;">privileges</span> <span style="color: #b9ca4a;">on</span> employees.* <span style="color: #b9ca4a;">to</span> <span style="color: #70c0b1;">'jeffrey'</span>@<span style="color: #70c0b1;">'%'</span>;
flush <span style="color: #b9ca4a;">privileges</span>;
</pre>
</div>
</div>
</li>

<li><a id="orgf5b3f9e"></a>查看当前用户权限<br />
<div class="outline-text-5" id="text-1-2-3-2">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #b9ca4a;">select</span> <span style="color: #c397d8;">user</span>, <span style="color: #b9ca4a;">host</span> <span style="color: #b9ca4a;">from</span> mysql.<span style="color: #c397d8;">user</span>;
</pre>
</div>
</div>
</li>
<li><a id="org9a884c3"></a>修改用户密码<br />
<div class="outline-text-5" id="text-1-2-3-3">
<div class="org-src-container">
<pre class="src src-sql">use mysql;
<span style="color: #b9ca4a;">set</span> password <span style="color: #b9ca4a;">for</span> <span style="color: #70c0b1;">'jeffrey'</span>@<span style="color: #70c0b1;">'%'</span> = password(<span style="color: #70c0b1;">'root'</span>);
<span style="color: #b9ca4a;">update</span> <span style="color: #c397d8;">user</span> <span style="color: #b9ca4a;">set</span> password = password(<span style="color: #70c0b1;">'new.password'</span>) <span style="color: #b9ca4a;">where</span> <span style="color: #c397d8;">user</span> = <span style="color: #70c0b1;">'jeffrey'</span> <span style="color: #b9ca4a;">and</span> <span style="color: #b9ca4a;">host</span> = <span style="color: #70c0b1;">'%'</span>;
<span style="color: #b9ca4a;">update</span> <span style="color: #c397d8;">user</span> <span style="color: #b9ca4a;">set</span> <span style="color: #b9ca4a;">host</span> = <span style="color: #70c0b1;">'%'</span> <span style="color: #b9ca4a;">where</span> <span style="color: #c397d8;">user</span> = <span style="color: #70c0b1;">'root'</span>;
flush <span style="color: #b9ca4a;">privileges</span>;

<span style="color: #b9ca4a;">alter</span> <span style="color: #c397d8;">user</span> <span style="color: #70c0b1;">'jeffrey'</span>@<span style="color: #70c0b1;">'%'</span> identitied <span style="color: #b9ca4a;">by</span> <span style="color: #70c0b1;">'mypass'</span>;
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-orge6c43a8" class="outline-4">
<h4 id="orge6c43a8"><span class="section-number-4">1.2.4.</span> 源码研究</h4>
<div class="outline-text-4" id="text-1-2-4">
<ol class="org-ol">
<li>专栏 <a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/MySQL%E5%AE%9E%E6%88%9845%E8%AE%B2">MySQL45</a> | <a href="https://blog.jcole.us/innodb/">Data Structure</a> | <a href="http://www.unofficialmysqlguide.com/introduction.html">Unofficial Optimizer Guide</a></li>
<li><a href="mysql-source-code.html">MySQL 源码笔记</a></li>
<li>示例数据库 <a href="https://dev.mysql.com/doc/employee/en/employees-installation.html">Employees Sample Database</a> | <a href="https://github.com/datacharmer/test_db">Github</a> | <a href="https://dev.mysql.com/doc/index-other.html">Example DB: world, sakila</a></li>
<li>代码阅读分享
<ul class="org-ul">
<li><a href="../mysql/share-01-mysql-group-by-analysis.html">GroupBy 语句实现原理探索</a></li>
<li><a href="../mysql/share-02-mysql-optimize.html">MySQL 优化器实现原理探索</a></li>
</ul></li>
</ol>
</div>
<ol class="org-ol">
<li><a id="org1cb664a"></a>安装编译调试环境<br />
<div class="outline-text-5" id="text-1-2-4-1">
<ol class="org-ol">
<li><p>
系统依赖安装
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#23433;&#35013;&#20381;&#36182;&#21253;</span>
yum update

yum install -y net-tools vim tmux tree kernel-devel kernel-doc kernel-headers <span style="color: #70c0b1;">\</span>
    samba samba-client ntp rsync curl git wget

yum install -y binutils compat-libcap1 compat-libstdc++-33 gcc gcc-c++ glibc <span style="color: #70c0b1;">\</span>
    glibc-devel ksh libgcc libstdc++ libstdc++-devel libaio libaio-devel libXi <span style="color: #70c0b1;">\</span>
    libXtst make sysstat unixODBC unixODBC-devel oracleasm-support zip unzip <span style="color: #70c0b1;">\</span>
    python-devel python rpm-build redhat-rpm-config asciidoc hmaccalc <span style="color: #70c0b1;">\</span>
    perl-ExtUtils-Embed pesign xmlto audit-libs-devel binutils-devel <span style="color: #70c0b1;">\</span>
    elfutils-devel elfutils-libelf-devel ncurses-devel bison-devel newt-devel <span style="color: #70c0b1;">\</span>
    python3 python3-devel <span style="color: #70c0b1;">\</span>
    numactl-devel pciutils-devel python-devel zlib-devel readline-devel
</pre>
</div></li>
<li><p>
编译工具安装 <a href="https://gcc.gnu.org/install/">GCC</a> | <a href="https://www.sourceware.org/gdb/">GDB</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">gcc</span>
wget https://mirrors.tuna.tsinghua.edu.cn/gnu/gcc/gcc-12.1.0/gcc-12.1.0.tar.gz
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#19979;&#36733; gcc &#30340;&#20381;&#36182;</span>
./contrib/download_prerequisites
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">--enable-multilib &#24320;&#21551; 32 &#20301;&#24211;&#25903;&#25345;</span>
./configure --prefix=/usr/local/gcc --disable-multilib
make
make install

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">gdb</span>
wget https://mirrors.tuna.tsinghua.edu.cn/gnu/gdb/gdb-12.1.tar.gz
./configure --prefix=/usr/local/gdb
make
make install
</pre>
</div>
<p>
添加环境变量
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c397d8;">export</span> <span style="color: #e7c547;">PATH</span>=/usr/local/gcc/bin:$<span style="color: #e7c547;">PATH</span>
<span style="color: #c397d8;">export</span> <span style="color: #e7c547;">LD_LIBRARY_PATH</span>=/usr/local/gcc/lib64:$<span style="color: #e7c547;">LD_LIBRARY_PATH</span>
<span style="color: #c397d8;">export</span> <span style="color: #e7c547;">PATH</span>=/usr/local/gdb/bin:$<span style="color: #e7c547;">PATH</span>
</pre>
</div></li>
<li><p>
cmake 安装 <a href="https://cmake.org/install/">CMake Install</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#19979;&#36733;&#20195;&#30721;</span>
curl -OL https://github.com/Kitware/CMake/releases/download/v3.25.2/cmake-3.25.2.tar.gz
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#32534;&#35793;&#23433;&#35013;</span>
./bootstrap --prefix=/usr/local/cmake
make
make install
</pre>
</div>
<p>
添加环境变量
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c397d8;">export</span> <span style="color: #e7c547;">PATH</span>=/usr/local/cmake/bin:$<span style="color: #e7c547;">PATH</span>
</pre>
</div></li>
<li><p>
boost 下载并安装
</p>
<div class="org-src-container">
<pre class="src src-sh">wget -c https://boostorg.jfrog.io/artifactory/main/release/1.77.0/source/boost_1_77_0.tar.bz2
tar xjvf boost_1_77_0.tar.bz2
</pre>
</div></li>
</ol>
</div>
</li>
<li><a id="org6312a0c"></a>编译代码及初始数据库<br />
<div class="outline-text-5" id="text-1-2-4-2">
<ol class="org-ol">
<li>参考资料 <a href="https://dev.mysql.com/doc/refman/8.0/en/source-installation.html">源代码安装文档</a> | <a href="https://dev.mysql.com/doc/refman/8.0/en/making-trace-files.html">TRACE 文件</a> | <a href="https://dev.mysql.com/doc/refman/8.0/en/using-gdb-on-mysqld.html">&#x2013;gdb</a> | <a href="https://dev.mysql.com/doc/dev/mysql-server/8.0.30/PAGE_OPT_TRACE.html">The Optimizer Trace</a></li>
<li><p>
配置文件 <code>/etc/my.cnf</code>
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">-* mode: Conf; -*-</span>

[<span style="color: #7aa6da;">mysqld</span>]
<span style="color: #e7c547;">basedir</span>=/opt/local/mysql
<span style="color: #e7c547;">datadir</span>=/opt/local/mysql/data
<span style="color: #e7c547;">log-error</span>=/tmp/mysql-error.log
<span style="color: #e7c547;">pid-file</span>=/tmp/mysql.pid
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">debug=d,info,error,query,general,where:O,/tmp/mysqld.trace</span>
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">debug=+d,info,error,query,general,enter,where:O,/tmp/mysqld.trace</span>
debug

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">autocommit=0</span>
<span style="color: #e7c547;">innodb_lock_wait_timeout</span>=3600
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">long_query_time = 0</span>
<span style="color: #e7c547;">slow_query_log</span> = on
<span style="color: #e7c547;">slow_query_log_file</span> = /tmp/mysql-slow.log
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">secure_file_priv = /tmp</span>

[<span style="color: #7aa6da;">client</span>]
<span style="color: #e7c547;">user</span>=root
</pre>
</div></li>
<li><p>
编译源代码
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#20934;&#22791;&#20195;&#30721;&#32534;&#35793;&#30446;&#24405;, &#36755;&#20986;&#30446;&#24405;&#20026; out</span>
mkdir out
<span style="color: #c397d8;">cd</span> out
cmake -DCMAKE_INSTALL_PREFIX=/opt/local/mysql -DWITH_BOOST=../../boost/boost_1_77_0 -DWITH_DEBUG=1 -DWITH_UNIT_TESTS=0 ..
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#32534;&#35793;&#20195;&#30721;</span>
<span style="color: #c397d8;">cd</span> out
make -j8
make install
</pre>
</div></li>
<li><p>
初始化数据库
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#21021;&#22987;&#21270;&#25968;&#25454;&#24211;</span>
mysqld --defaults-file=/etc/my.cnf --initialize-insecure

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">https://dev.mysql.com/doc/refman/8.0/en/starting-server.html</span>
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#21551;&#21160;&#25968;&#25454;&#24211;&#25968;&#25454;&#24211;, --gdb &#26159;&#24320;&#21551; gdb &#35843;&#35797;&#25903;&#25345;</span>
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">--debug=d,info,error,query,general,where:O,/tmp/mysqld.trace</span>
mysqld --gdb &gt;/dev/null 2&gt;&amp;1 &amp;

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#38142;&#25509;&#25968;&#25454;&#24211;</span>
mysql
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#20851;&#38381;&#25968;&#25454;&#24211;</span>
mysqladmin shutdown
</pre>
</div></li>
</ol>
</div>
</li>
<li><a id="orgdf46251"></a>代码阅读配置<br />
<div class="outline-text-5" id="text-1-2-4-3">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#29983;&#25104;&#36339;&#36716;&#30340; TAG</span>
ctags -e -R --languages=c,c++ .
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-orgf75a082" class="outline-3">
<h3 id="orgf75a082"><span class="section-number-3">1.3.</span> Postgres</h3>
<div class="outline-text-3" id="text-1-3">
</div>
<div id="outline-container-org4729984" class="outline-4">
<h4 id="org4729984"><span class="section-number-4">1.3.1.</span> 前置环境变量</h4>
<div class="outline-text-4" id="text-1-3-1">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c397d8;">export</span> <span style="color: #e7c547;">PGDATA</span>=/opt/local/pgsql/data
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc905735" class="outline-4">
<h4 id="orgc905735"><span class="section-number-4">1.3.2.</span> 编译调试 &amp; 初始化数据</h4>
<div class="outline-text-4" id="text-1-3-2">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#37197;&#32622;&#35843;&#35797;&#29615;&#22659;</span>
./configure --prefix=/opt/local/pgsql --enable-cassert --enable-debug <span style="color: #e7c547;">CFLAGS</span>=<span style="color: #70c0b1;">"-ggdb -O0 -fno-omit-frame-pointer"</span>
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#32534;&#35793;, &#23433;&#35013;</span>
make -j8
make install
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#21021;&#22987;&#21270;&#25968;&#25454;&#24211;</span>
initdb -D /opt/local/pgsql/data
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#21551;&#21160;&#25968;&#25454;&#24211;</span>
pg_ctl -D /opt/local/pgsql/data -l logfile start
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#21019;&#24314;&#24211;</span>
createdb test01
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#38142;&#25509;&#24211;</span>
psql test01
</pre>
</div>
</div>
</div>
<div id="outline-container-org5212a79" class="outline-4">
<h4 id="org5212a79"><span class="section-number-4">1.3.3.</span> 调试命令</h4>
<div class="outline-text-4" id="text-1-3-3">
<p>
找到对应的进程
</p>
<div class="org-src-container">
<pre class="src src-sh">$ ps aux | grep postgres
jinghuihu        87208   0.0  0.0 34130524    676 s006  S+   12:13PM   0:00.00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn --exclude-dir=.idea --exclude-dir=.tox postgres
jinghuihu        82329   0.0  0.2 34313316  36860   ??  Ss   10:51AM   0:00.16 postgres: jinghuihu test01 [local] idle
jinghuihu        82278   0.0  0.0 34309036   1792   ??  Ss   10:51AM   0:00.00 postgres: logical replication launcher
jinghuihu        82277   0.0  0.0 34310060   2136   ??  Ss   10:51AM   0:00.02 postgres: autovacuum launcher
jinghuihu        82276   0.0  0.0 34307820   5152   ??  Ss   10:51AM   0:00.04 postgres: walwriter
jinghuihu        82275   0.0  0.0 34307820   2212   ??  Ss   10:51AM   0:00.06 postgres: background writer
jinghuihu        82274   0.0  0.0 34307820   2788   ??  Ss   10:51AM   0:00.01 postgres: checkpointer
jinghuihu        80299   0.0  0.1 34309108  14920   ??  Ss   10:41AM   0:00.13 /opt/local/pgsql/bin/postgres -D /opt/local/pgsql/data
</pre>
</div>

<p>
找到对应的进程，然后使用 lldb attach 上，打断点
</p>
<div class="org-src-container">
<pre class="src src-text">(lldb) attach -p 82329
Process 82329 stopped
* thread #1, queue = 'com.apple.main-thread', stop reason = signal SIGSTOP
    frame #0: 0x00007ff810e892fe libsystem_kernel.dylib`kevent + 10
libsystem_kernel.dylib`kevent:
-&gt;  0x7ff810e892fe &lt;+10&gt;: jae    0x7ff810e89308            ; &lt;+20&gt;
    0x7ff810e89300 &lt;+12&gt;: movq   %rax, %rdi
    0x7ff810e89303 &lt;+15&gt;: jmp    0x7ff810e84dc2            ; cerror_nocancel
    0x7ff810e89308 &lt;+20&gt;: retq
Target 0: (postgres) stopped.
Executable module set to "/opt/local/pgsql/bin/postgres".
Architecture set to: x86_64h-apple-macosx-.
(lldb) b exec_simple_query
Breakpoint 1: where = postgres`exec_simple_query + 29 at postgres.c:994:21, address = 0x000000010f17af6d
(lldb) c
Process 82329 resuming
Process 82329 stopped
* thread #1, queue = 'com.apple.main-thread', stop reason = breakpoint 1.1
    frame #0: 0x000000010f17af6d postgres`exec_simple_query + 29 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/tcop/postgres.c:994
   991  static void
   992  exec_simple_query(const char *query_string)
   993  {
-&gt; 994      CommandDest dest = whereToSendOutput;
                               ^
   995      MemoryContext oldcontext;
   996      List       *parsetree_list;
   997      ListCell   *parsetree_item;
Target 0: (postgres) stopped.
(lldb)  bt
* thread #1, queue = 'com.apple.main-thread', stop reason = breakpoint 1.1
  * frame #0: 0x000000010f17af6d postgres`exec_simple_query + 29 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/tcop/postgres.c:994
    frame #1: 0x000000010f17a633 postgres`PostgresMain + 2243 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/tcop/postgres.c:4593
    frame #2: 0x000000010f08d0d2 postgres`BackendRun + 50 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/postmaster/postmaster.c:4511
    frame #3: 0x000000010f08c6bc postgres`BackendStartup + 524 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/postmaster/postmaster.c:4239
    frame #4: 0x000000010f08b4ec postgres`ServerLoop + 716 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/postmaster/postmaster.c:1806
    frame #5: 0x000000010f088dc7 postgres`PostmasterMain + 6471 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/postmaster/postmaster.c:1478
    frame #6: 0x000000010ef6eda0 postgres`main + 816 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/main/main.c:202
    frame #7: 0x00007ff810b92310 dyld`start + 2432
(lldb) c
Process 82329 resuming
(lldb) detach
Process 82329 detached
(lldb)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4b2bfd6" class="outline-3">
<h3 id="org4b2bfd6"><span class="section-number-3">1.4.</span> ClickHouse</h3>
<div class="outline-text-3" id="text-1-4">
</div>
<div id="outline-container-org1c494fc" class="outline-4">
<h4 id="org1c494fc"><span class="section-number-4">1.4.1.</span> 安装步骤</h4>
<div class="outline-text-4" id="text-1-4-1">
<ol class="org-ol">
<li>官方文档 <a href="https://clickhouse.com/docs/en/install">doc</a></li>
</ol>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">https://clickhouse.com/docs/en/development/build-osx</span>
cmake -G Ninja -DCMAKE_BUILD_TYPE=RelWithDebInfo -S . -B build
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org67b948a" class="outline-3">
<h3 id="org67b948a"><span class="section-number-3">1.5.</span> Java</h3>
<div class="outline-text-3" id="text-1-5">
</div>
<div id="outline-container-org94fb184" class="outline-4">
<h4 id="org94fb184"><span class="section-number-4">1.5.1.</span> Spring Framework</h4>
<div class="outline-text-4" id="text-1-5-1">
<ol class="org-ol">
<li>代码 <a href="https://github.com/spring-projects/spring-framework">Source</a> | <a href="https://github.com/Jeanhwea/spring-framework/tree/jh/5.3.25">jh/5.3.25</a></li>
<li><p>
编译 <a href="https://github.com/spring-projects/spring-framework/wiki/Build-from-Source">BUILD</a> =&gt; Java8 切到 5.3 分支
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#32534;&#35793;</span>
./gradlew build
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#36339;&#36807;&#27979;&#35797;&#29992;&#20363;</span>
./gradlew build -x test
</pre>
</div></li>
<li><p>
编译文档, 依赖 asciidoctor
</p>
<div class="org-src-container">
<pre class="src src-sh">./gradlew asciidoctor
</pre>
</div></li>
<li><p>
查看 tasks
</p>
<div class="org-src-container">
<pre class="src src-sh">./gradlew tasks
</pre>
</div></li>
<li><p>
生成代码流量跳转 TAGS
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#29983;&#25104;&#36339;&#36716;&#30340; TAG</span>
ctags -e -R --languages=c,c++ .
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-orgcd1cdc9" class="outline-4">
<h4 id="orgcd1cdc9"><span class="section-number-4">1.5.2.</span> Kafka</h4>
<div class="outline-text-4" id="text-1-5-2">
<ol class="org-ol">
<li><a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89">JVM 系列</a></li>
</ol>
</div>
<ol class="org-ol">
<li><a id="org0704bc5"></a>资源链接<br />
<div class="outline-text-5" id="text-1-5-2-1">
<ol class="org-ol">
<li>说明文档 <a href="https://kafka.apache.org/documentation/">link</a></li>
</ol>
</div>
</li>
<li><a id="org38af857"></a>环境配置<br />
<ol class="org-ol">
<li><a id="org9dfab10"></a>官网快速使用手册<br />
<div class="outline-text-6" id="text-1-5-2-2-1">
<ol class="org-ol">
<li><a href="https://kafka.apache.org/quickstart">quickstart</a></li>
</ol>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#21551;&#21160; zk</span>
./bin/zookeeper-server-start.sh config/zookeeper.properties
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#21551;&#21160; kafka</span>
./bin/kafka-server-start.sh config/server.properties

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#21019;&#24314; topic</span>
./bin/kafka-topics.sh --bootstrap-server localhost:9092 --create --topic quickstart-events
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#26174;&#31034; topic &#21015;&#34920;</span>
./bin/kafka-topics.sh --bootstrap-server localhost:9092 --list
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#26597;&#30475;&#25351;&#23450; topic &#29366;&#24577;</span>
./bin/kafka-topics.sh --bootstrap-server localhost:9092 --describe --topic quickstart-events

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#29983;&#20135;&#32773; &amp; &#28040;&#36153;&#32773;</span>
./bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --from-beginning --topic quickstart-events
./bin/kafka-console-producer.sh --bootstrap-server localhost:9092 --topic quickstart-events
</pre>
</div>

<p>
配置相关
</p>
<div class="org-src-container">
<pre class="src src-sh">./bin/kafka-configs.sh --zookeeper localhost:2181 --all
</pre>
</div>
</div>
</li>

<li><a id="orgff15224"></a>docker 版本配置<br />
<div class="outline-text-6" id="text-1-5-2-2-2">
<ol class="org-ol">
<li><a href="https://hub.docker.com/r/bitnami/kafka/">docker hub</a></li>
<li><p>
配置文件 <a href="env-kafka/docker-compose.yaml">docker-compose.yaml</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">docker-compose up -d
</pre>
</div></li>
</ol>
</div>
</li>

<li><a id="orge189dd9"></a>源代码<br />
<div class="outline-text-6" id="text-1-5-2-2-3">
<p>
跳过测试编译
</p>
<div class="org-src-container">
<pre class="src src-sh">./gradlew build -x test
</pre>
</div>

<p>
编译发布包
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#32534;&#35793;&#21253;</span>
./gradlew clean releaseTarGz

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#32534;&#35793;&#20135;&#29289;</span>
ls ./core/build/distributions/
</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div id="outline-container-org50a894e" class="outline-4">
<h4 id="org50a894e"><span class="section-number-4">1.5.3.</span> RocketMQ</h4>
<div class="outline-text-4" id="text-1-5-3">
</div>
<ol class="org-ol">
<li><a id="org76ce9df"></a>资源链接<br />
<div class="outline-text-5" id="text-1-5-3-1">
<ol class="org-ol">
<li>官网文档 <a href="https://rocketmq.apache.org/docs/4.x/introduction/02quickstart">link</a></li>
</ol>
</div>
</li>
</ol>
</div>
<div id="outline-container-org1f5337a" class="outline-4">
<h4 id="org1f5337a"><span class="section-number-4">1.5.4.</span> JVM</h4>
<div class="outline-text-4" id="text-1-5-4">
</div>
<ol class="org-ol">
<li><a id="org2fe9f4a"></a>编译 JDK<br />
<div class="outline-text-5" id="text-1-5-4-1">
<ol class="org-ol">
<li>OpenJDK 编译说明 <a href="https://openjdk.org/groups/build/">link</a></li>
<li>JDK 8 编译说明 <a href="https://hg.openjdk.org/jdk8/jdk8/raw-file/tip/README-builds.html">link</a></li>
</ol>
<div class="org-src-container">
<pre class="src src-sh">git clone git@github.com:openjdk/jdk.git
git checkout -b jh/jdk8-b99 jdk8-b99

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#37197;&#32622; &amp; &#32534;&#35793;</span>
<span style="color: #e7c547;">MAKE</span>=/usr/bin/make ./configure
<span style="color: #e7c547;">JOBS</span>=12 /usr/bin/make all
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org55af708" class="outline-4">
<h4 id="org55af708"><span class="section-number-4">1.5.5.</span> Hive</h4>
<div class="outline-text-4" id="text-1-5-5">
<p>
配置 <a href="https://hadoop.apache.org/docs/r2.6.2/hadoop-project-dist/hadoop-common/SingleCluster.html#Standalone_Operation">hadoop</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c397d8;">export</span> <span style="color: #e7c547;">HADOOP_HOME</span>=/opt/local/hack/hadoop-2.6.0
<span style="color: #c397d8;">export</span> <span style="color: #e7c547;">PATH</span>=<span style="color: #70c0b1;">"$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$PATH"</span>
<span style="color: #c397d8;">export</span> <span style="color: #e7c547;">HIVE_HOME</span>=/opt/local/hack/apache-hive-1.2.2-bin
<span style="color: #c397d8;">export</span> <span style="color: #e7c547;">PATH</span>=<span style="color: #70c0b1;">"$HIVE_HOME/bin:$PATH"</span>
</pre>
</div>

<p>
配置 core-site.xml
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #e78c45;">configuration</span>&gt;
   &lt;<span style="color: #e78c45;">property</span>&gt;
      &lt;<span style="color: #e78c45;">name</span>&gt;fs.defaultFS&lt;/<span style="color: #e78c45;">name</span>&gt;
      &lt;<span style="color: #e78c45;">value</span>&gt;hdfs://localhost:9000&lt;/<span style="color: #e78c45;">value</span>&gt;
   &lt;/<span style="color: #e78c45;">property</span>&gt;
&lt;/<span style="color: #e78c45;">configuration</span>&gt;
</pre>
</div>

<p>
配置 hdfs-site.xml
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #e78c45;">configuration</span>&gt;
  &lt;<span style="color: #e78c45;">property</span>&gt;
    &lt;<span style="color: #e78c45;">name</span>&gt;dfs.replication&lt;/<span style="color: #e78c45;">name</span>&gt;
    &lt;<span style="color: #e78c45;">value</span>&gt;1&lt;/<span style="color: #e78c45;">value</span>&gt;
  &lt;/<span style="color: #e78c45;">property</span>&gt;

  &lt;<span style="color: #e78c45;">property</span>&gt;
    &lt;<span style="color: #e78c45;">name</span>&gt;dfs.namenode.name.dir&lt;/<span style="color: #e78c45;">name</span>&gt;
    &lt;<span style="color: #e78c45;">value</span>&gt;/opt/local/hdfs/namenode&lt;/<span style="color: #e78c45;">value</span>&gt;
  &lt;/<span style="color: #e78c45;">property</span>&gt;

  &lt;<span style="color: #e78c45;">property</span>&gt;
    &lt;<span style="color: #e78c45;">name</span>&gt;dfs.datanode.data.dir&lt;/<span style="color: #e78c45;">name</span>&gt;
    &lt;<span style="color: #e78c45;">value</span>&gt;/opt/local/hdfs/datanode&lt;/<span style="color: #e78c45;">value</span>&gt;
  &lt;/<span style="color: #e78c45;">property</span>&gt;
&lt;/<span style="color: #e78c45;">configuration</span>&gt;
</pre>
</div>

<p>
初始化命令
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#26684;&#24335;&#21270; namenode</span>
hdfs namenode -format
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#21551;&#21160;/&#20851;&#38381; dfs</span>
start-dfs.sh
stop-dfs.sh
</pre>
</div>

<p>
<a href="https://cwiki.apache.org/confluence/display/Hive/GettingStarted#GettingStarted-InstallationandConfiguration">hive</a> 需要有 /tmp, /user/hive/warehouse 目录, 并且配置 g+w 权限
</p>
<ul class="org-ul">
<li>配置元数据存放目录 hive.metastore.warehouse.dir</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh">hadoop fs -mkdir       /tmp
hadoop fs -mkdir -p    /user/hive/warehouse
hadoop fs -chmod g+w   /tmp
hadoop fs -chmod g+w   /user/hive/warehouse
</pre>
</div>

<p>
解决 [ERROR] Terminal initialization failed; falling back to unsupported 问题
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c397d8;">export</span> <span style="color: #e7c547;">HADOOP_USER_CLASSPATH_FIRST</span>=true
</pre>
</div>
</div>
</div>
<div id="outline-container-org28408c5" class="outline-4">
<h4 id="org28408c5"><span class="section-number-4">1.5.6.</span> SDK Man</h4>
<div class="outline-text-4" id="text-1-5-6">
<ol class="org-ol">
<li>官网 <a href="https://sdkman.io/">link</a></li>
</ol>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#23433;&#35013; SDK Man</span>
curl -s <span style="color: #70c0b1;">"https://get.sdkman.io"</span> | bash

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#23433;&#35013; JDK</span>
sdk list java
sdk install java 11.0.19-tem
sdk install java 8.0.302-open
sdk install java 17.0.7-tem

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#31163;&#32447;&#23433;&#35013;, &#21019;&#24314; SDK &#21253;&#20026; 8.0.191-online</span>
sdk install java 8.0.191-online /opt/admin/java
<span style="color: #c397d8;">export</span> <span style="color: #e7c547;">JAVA_HOME</span>=/opt/admin/java

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#20462;&#25913;&#40664;&#35748; SDK &#29256;&#26412;</span>
sdk list java | grep installed
sdk default java 11.0.19-zulu

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#29615;&#22659;</span>
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#21021;&#22987;&#21270;&#29615;&#22659;, &#29983;&#25104; .sdkmanrc</span>
sdk env init
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#23433;&#35013;&#29615;&#22659;</span>
sdk env install
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#20999;&#25442;&#29615;&#22659;</span>
sdk env
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#28165;&#38500;&#29615;&#22659;</span>
sdk env clear


<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#23433;&#35013;&#20854;&#20182; SDK &#24037;&#20855;</span>
sdk install gradle
sdk install java
sdk install hadoop
sdk install ant

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#24378;&#21046;&#26356;&#26032; SDK Man</span>
sdk selfupdate force
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org48a862e" class="outline-3">
<h3 id="org48a862e"><span class="section-number-3">1.6.</span> 云原生</h3>
<div class="outline-text-3" id="text-1-6">
</div>
<div id="outline-container-orgdef28c1" class="outline-4">
<h4 id="orgdef28c1"><span class="section-number-4">1.6.1.</span> IDL</h4>
<div class="outline-text-4" id="text-1-6-1">
<p>
定义的结果如下
</p>
<ol class="org-ol">
<li><a href="https://thrift.apache.org/">Apache Thrift</a></li>
<li><a href="https://diwakergupta.github.io/thrift-missing-guide/">Thrift: The Missing Guide</a></li>
</ol>
</div>
</div>
<div id="outline-container-org7924b80" class="outline-4">
<h4 id="org7924b80"><span class="section-number-4">1.6.2.</span> hertz</h4>
<div class="outline-text-4" id="text-1-6-2">
<p>
操作手册 <a href="https://www.cloudwego.io/zh/docs/hertz/tutorials/toolkit/usage/usage-thrift/">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">hz new -module $(MODULE) -idl idl/aps_core_api.thrift
hz update -idl idl/aps_core_api.thrift
go mod edit -replace github.com/apache/thrift=github.com/apache/thrift@v0.13.0
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbf286f0" class="outline-4">
<h4 id="orgbf286f0"><span class="section-number-4">1.6.3.</span> kitex</h4>
<div class="outline-text-4" id="text-1-6-3">
<p>
Kitex 微服务架构工具 <a href="https://www.cloudwego.io/zh/docs/kitex/">kitex</a>
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org7de6591" class="outline-2">
<h2 id="org7de6591"><span class="section-number-2">2.</span> 系统运维</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org61d72eb" class="outline-3">
<h3 id="org61d72eb"><span class="section-number-3">2.1.</span> Docker</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-org6ff7a77" class="outline-4">
<h4 id="org6ff7a77"><span class="section-number-4">2.1.1.</span> Engine 配置</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
安装文档 <a href="https://docs.docker.com/engine/install/ubuntu/">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">vim /etc/docker/daemon.json
systemctl restart docker
</pre>
</div>

<p>
daemon.json 配置
</p>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #8d5649;">{</span>
  <span style="color: #b9ca4a;">"insecure-registries"</span>: <span style="color: #d8241f;">[</span>
    <span style="color: #70c0b1;">"gitana.jeanhwea.io:5000"</span>
  <span style="color: #d8241f;">]</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orga18a941" class="outline-4">
<h4 id="orga18a941"><span class="section-number-4">2.1.2.</span> 国内镜像</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
daemon.json 配置
</p>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #8d5649;">{</span>
  <span style="color: #b9ca4a;">"registry-mirrors"</span>: <span style="color: #d8241f;">[</span>
    <span style="color: #70c0b1;">"https://registry.docker-cn.com"</span>,
    <span style="color: #70c0b1;">"https://docker.mirrors.ustc.edu.cn"</span>,
    <span style="color: #70c0b1;">"http://hub-mirror.c.163.com"</span>
  <span style="color: #d8241f;">]</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1444fec" class="outline-3">
<h3 id="org1444fec"><span class="section-number-3">2.2.</span> Kubernetes</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-org4929a5a" class="outline-4">
<h4 id="org4929a5a"><span class="section-number-4">2.2.1.</span> minikube</h4>
<div class="outline-text-4" id="text-2-2-1">
<ol class="org-ol">
<li><a href="https://minikube.sigs.k8s.io/docs/">文档中心</a></li>
</ol>
<p>
配置
</p>
<div class="org-src-container">
<pre class="src src-sh">brew install minikube
minikube start
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">minikube dashboard
</pre>
</div>
</div>
</div>
<div id="outline-container-org0201c66" class="outline-4">
<h4 id="org0201c66"><span class="section-number-4">2.2.2.</span> kubeadm</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
系统安装
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#21019;&#24314; master &#38598;&#32676;</span>
kubeadm init --apiserver-advertise-address=192.168.0.210 <span style="color: #70c0b1;">\</span>
        --pod-network-cidr=10.244.0.0/16 <span style="color: #70c0b1;">\</span>
        --kubernetes-version 1.27.2 <span style="color: #70c0b1;">\</span>
        --image-repository registry.aliyuncs.com/google_containers

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#36935;&#21040;&#38169;&#35823;&#37325;&#32622;</span>
kubeadm reset
</pre>
</div>

<p>
查看使用到的镜像
</p>
<div class="org-src-container">
<pre class="src src-sh">kubeadm config images list
kubeadm config images pull --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers
kubeadm config images pull --image-repository registry.aliyuncs.com/google_containers
</pre>
</div>

<p>
新增 node 节点
</p>
<div class="org-src-container">
<pre class="src src-sh">kubeadm token create --print-join-command
</pre>
</div>
</div>
</div>

<div id="outline-container-org5f7e3f2" class="outline-4">
<h4 id="org5f7e3f2"><span class="section-number-4">2.2.3.</span> kubectl</h4>
<div class="outline-text-4" id="text-2-2-3">
</div>
<ol class="org-ol">
<li><a id="org7555bce"></a>快速开始<br />
<div class="outline-text-5" id="text-2-2-3-1">
<p>
快速启动一个测试服务
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#21019;&#24314;&#37096;&#32626;</span>
kubectl create deployment sayhello --image=jeanhwea/sayhello:v1.0.0
kubectl create deployment sayhello --image=jeanhwea/sayhello:v1.0.0 -r 4

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#36890;&#36807; NodePort &#26292;&#38706;&#26381;&#21153;</span>
kubectl expose deployment sayhello --port=80 --type=NodePort

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#21160;&#24577;&#25193;&#23481;</span>
kubectl scale  deployment sayhello --replicas=4
</pre>
</div>

<p>
获取启动的 Service
</p>
<div class="org-src-container">
<pre class="src src-sh">kubectl get svc
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#30331;&#24405;&#21040; minikube shell</span>
minikube ssh
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#22312; NameNode &#20013;&#33719;&#21462;&#39029;&#38754;</span>
curl http://0.0.0.0:31151
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">Service &#23545;&#35937;&#30340;&#22495;&#21517;&#23436;&#20840;&#24418;&#24335;&#26159; "&#23545;&#35937;.&#21517;&#23383;&#31354;&#38388;.svc.cluster.local"</span>
wget -qO- sayhello.default.svc.cluster.local
</pre>
</div>
</div>
</li>
<li><a id="orgd9ec1c1"></a>配置 DashBoard<br />
<div class="outline-text-5" id="text-2-2-3-2">
<div class="org-src-container">
<pre class="src src-sh">wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#23433;&#35013; dashboard</span>
kubectl apply -f recommended.yaml
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#21368;&#36733; dashboard</span>
kubectl delete -f recommended.yaml
kubectl get pods,svc -n kubernetes-dashboard
</pre>
</div>
</div>
</li>

<li><a id="org0a08ea4"></a>查看 Pod<br />
<div class="outline-text-5" id="text-2-2-3-3">
<div class="org-src-container">
<pre class="src src-sh">kubectl get pods -A
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#30331;&#24405;&#21040; pod &#19978;&#25490;&#26597;&#38382;&#39064;</span>
kubectl exec -it sayhello-847d5df547-4bk9z -- /bin/bash
</pre>
</div>
</div>
</li>

<li><a id="org28dd286"></a>创建 Job<br />
<div class="outline-text-5" id="text-2-2-3-4">
<p>
获取一个基础的 yaml
</p>
<div class="org-src-container">
<pre class="src src-sh">kubectl create job echo-job --image=busybox --dry-run=client -o yaml
</pre>
</div>

<p>
修改得到配置
</p>
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #e7c547;">apiVersion</span>: batch/v1
<span style="color: #e7c547;">kind</span>: Job
<span style="color: #e7c547;">metadata</span>:
  <span style="color: #e7c547;">name</span>: echo-job

<span style="color: #e7c547;">spec</span>:
  <span style="color: #e7c547;">template</span>:
   <span style="color: #e7c547;">spec</span>:
      <span style="color: #e7c547;">restartPolicy</span>: OnFailure
      <span style="color: #e7c547;">containers</span>:
      - <span style="color: #e7c547;">image</span>: busybox
        <span style="color: #e7c547;">name</span>: echo-job
        <span style="color: #e7c547;">imagePullPolicy</span>: IfNotPresent
        <span style="color: #e7c547;">command</span>: [<span style="color: #70c0b1;">"/bin/echo"</span>]
        <span style="color: #e7c547;">args</span>: [<span style="color: #70c0b1;">"hello"</span>, <span style="color: #70c0b1;">"world"</span>]
</pre>
</div>
</div>
</li>

<li><a id="org67f4b04"></a>配置 ConfigMap<br />
<div class="outline-text-5" id="text-2-2-3-5">
<div class="org-src-container">
<pre class="src src-sh">kubectl get cm
kubectl describe cm config01
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org7e8153a" class="outline-4">
<h4 id="org7e8153a"><span class="section-number-4">2.2.4.</span> 管理工具</h4>
<div class="outline-text-4" id="text-2-2-4">
<ol class="org-ol">
<li><p>
k8s 包管理器: helm <a href="https://helm.sh/">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update
helm install bitnami/mysql --generate-name
helm show all bitnami/mysql
helm list
helm uninstall mysql-1686374196
</pre>
</div></li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org1eda9c6" class="outline-3">
<h3 id="org1eda9c6"><span class="section-number-3">2.3.</span> 磁盘管理</h3>
<div class="outline-text-3" id="text-2-3">
</div>
<div id="outline-container-org96db653" class="outline-4">
<h4 id="org96db653"><span class="section-number-4">2.3.1.</span> 启动盘制作</h4>
<div class="outline-text-4" id="text-2-3-1">
<ol class="org-ol">
<li>启动盘制作工具 rufus <a href="https://rufus.ie/zh/">link</a> | <a href="https://github.com/pbatard/rufus">code</a></li>
<li>光盘提取工具 InfraRecorder <a href="http://infrarecorder.org/">link</a> | <a href="https://github.com/kindahl/infrarecorder">code</a></li>
</ol>
</div>
</div>
<div id="outline-container-org3584945" class="outline-4">
<h4 id="org3584945"><span class="section-number-4">2.3.2.</span> Ubuntu 磁盘分区扩容</h4>
<div class="outline-text-4" id="text-2-3-2">
<p>
使用 parted, resize2fs 命令行工具进行操作
</p>
<div class="org-src-container">
<pre class="src src-sh">root@ubuntu201:/home/ubuntu# parted
GNU Parted 3.4
Using /dev/sda
Welcome to GNU Parted! Type <span style="color: #70c0b1;">'help'</span> to view a list of commands.
(parted) <span style="color: #c397d8;">print</span>                 <span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">==&gt; &#26597;&#30475;&#24403;&#21069;&#30913;&#30424;&#20998;&#21306;&#20449;&#24687;</span>
Model: VMware Virtual disk (scsi)
Disk /dev/sda: 215GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system  Name  Flags
 1      1049kB  2097kB  1049kB                     bios_grub
 2      2097kB  53.7GB  53.7GB  ext4

(parted) resizepart            <span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">==&gt; &#25193;&#23481;&#20998;&#21306; 2</span>
Partition number? 2
Warning: Partition /dev/sda2 is being used. Are you sure you want to continue?
Yes/No? Yes
End?  [53.7GB]? 215GB          <span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">==&gt; &#36825;&#37324;&#25193;&#23481;&#21040;&#26368;&#22823;&#21487;&#35265;&#20998;&#21306;</span>
(parted) <span style="color: #c397d8;">print</span>                 <span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">==&gt; &#25193;&#23481;&#21518;&#30340;&#20998;&#21306; 2 &#21464;&#25104; 215G</span>
Model: VMware Virtual disk (scsi)
Disk /dev/sda: 215GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system  Name  Flags
 1      1049kB  2097kB  1049kB                     bios_grub
 2      2097kB  215GB   215GB   ext4

(parted)

Information: You may need to update /etc/fstab.

root@ubuntu201:/home/ubuntu# df -h <span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">==&gt; &#25991;&#20214;&#31995;&#32479;&#24182;&#26410;&#25193;&#23481;</span>
Filesystem      Size  Used Avail Use% Mounted on
tmpfs           1.6G  1.2M  1.6G   1% /run
/dev/sda2        49G   44G  3.1G  94% /
tmpfs           7.8G     0  7.8G   0% /dev/shm
tmpfs           5.0M     0  5.0M   0% /run/lock
tmpfs           1.6G  4.0K  1.6G   1% /run/user/1000
root@ubuntu201:/home/ubuntu# resize2fs /dev/sda2 <span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">==&gt; &#35843;&#25972;&#25991;&#20214;&#31995;&#32479;&#22823;&#23567;</span>
resize2fs 1.46.5 (30-Dec-2021)
Filesystem at /dev/sda2 is mounted on /; on-line resizing required
<span style="color: #e7c547;">old_desc_blocks</span> = 7, <span style="color: #e7c547;">new_desc_blocks</span> = 25
The filesystem on /dev/sda2 is now 52428283 (4k) blocks long.

root@ubuntu201:/home/ubuntu# df -h
Filesystem      Size  Used Avail Use% Mounted on
tmpfs           1.6G  1.2M  1.6G   1% /run
/dev/sda2       197G   44G  145G  24% /
tmpfs           7.8G     0  7.8G   0% /dev/shm
tmpfs           5.0M     0  5.0M   0% /run/lock
tmpfs           1.6G  4.0K  1.6G   1% /run/user/1000
root@ubuntu201:/home/ubuntu# reboot
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org2101fc8" class="outline-2">
<h2 id="org2101fc8"><span class="section-number-2">3.</span> 研发效率</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org67bce4c" class="outline-3">
<h3 id="org67bce4c"><span class="section-number-3">3.1.</span> GDB &amp; LLDB</h3>
<div class="outline-text-3" id="text-3-1">
</div>
<div id="outline-container-org9889091" class="outline-4">
<h4 id="org9889091"><span class="section-number-4">3.1.1.</span> 参考资料及链接</h4>
<div class="outline-text-4" id="text-3-1-1">
<ol class="org-ol">
<li><a href="https://lldb.llvm.org/use/map.html">LLDB &lt;-&gt; GDB</a></li>
<li><a href="https://github.com/hellogcc/100-gdb-tips">GDB 小技巧</a> | <a href="https://sourceware.org/gdb/onlinedocs/gdb/">GDB 在线手册</a></li>
<li>视频 <a href="https://www.youtube.com/watch?v=svG6OPyKsrw">GDB Tutorial</a></li>
</ol>
</div>
</div>
<div id="outline-container-org05ef2ea" class="outline-4">
<h4 id="org05ef2ea"><span class="section-number-4">3.1.2.</span> 进程启动: run &amp; attach</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
方法一：使用 attach 模式调试。首先正常启动重新，然后使用 attach 命令附属到进程上
</p>
<div class="org-src-container">
<pre class="src src-sh">(lldb) attach -p 18616
(gdb) attach 18616
</pre>
</div>

<p>
方法二：直接 run 启动进程
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#25351;&#23450;&#21551;&#21160;&#25991;&#20214;</span>
(lldb/gdb) file &lt;binary&gt;

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#30452;&#25509; run &#21551;&#21160;&#36827;&#31243;</span>
(lldb/gdb) <span style="color: #c397d8;">r</span>
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#28155;&#21152;&#21551;&#21160;&#21442;&#25968;</span>
(lldb/gdb) <span style="color: #c397d8;">r</span> args1 args2 ...
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#26597;&#30475;&#21442;&#25968;</span>
(gdb) show args
(lldb) settings show target.run-args
</pre>
</div>

<div id="org51aea84" class="figure">
<p><img src="../static/image/2023/0205/131917.png" alt="131917.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org8d75bdd" class="outline-4">
<h4 id="org8d75bdd"><span class="section-number-4">3.1.3.</span> 调试流程控制</h4>
<div class="outline-text-4" id="text-3-1-3">
</div>
<ol class="org-ol">
<li><a id="org42e8121"></a>设置断点 breakpoint<br />
<div class="outline-text-5" id="text-3-1-3-1">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#26222;&#36890;&#26029;&#28857;</span>
b main
b main.cc:12
b 12
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#26465;&#20214;&#26029;&#28857;</span>
(gdb) b 34 if <span style="color: #e7c547;">i</span> = 10
(gdb) <span style="color: #b9ca4a;">break</span> foo if strcmp(y,<span style="color: #70c0b1;">"hello"</span>) == 0
(lldb) breakpoint set --name foo --condition <span style="color: #70c0b1;">'(int)strcmp(y,"hello") == 0'</span>
(lldb) br s -n foo -c <span style="color: #70c0b1;">'(int)strcmp(y,"hello") == 0'</span>
(lldb) br s -n read_page -c <span style="color: #70c0b1;">'m_page_id.space()==56'</span>
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#20020;&#26102;&#26029;&#28857;: &#20020;&#26102;&#26029;&#28857;&#25191;&#34892;&#19968;&#27425;&#21518;&#33258;&#21160;&#38144;&#27585;</span>
tb main
</pre>
</div>
</div>
</li>

<li><a id="org372f027"></a>流程控制 step &amp; next &amp; continue<br />
<div class="outline-text-5" id="text-3-1-3-2">
<ol class="org-ol">
<li>step 单步调试，不进入函数</li>
<li>next 单步调试，进入函数</li>
<li><p>
continue 继续执行
</p>
<div class="org-src-container">
<pre class="src src-sh">s <span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">step</span>
n <span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">next</span>
c <span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">continue</span>

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">until &#30452;&#25509;&#25191;&#34892;&#21040;&#34892;&#25968;</span>
(gdb) <span style="color: #b9ca4a;">until</span> 12
(lldb) thread until 12
</pre>
</div></li>
<li>跳转到指定行
<ul class="org-ul">
<li>条件断点 <code>tb</code> temp breakpoint</li>
<li>until <code>until &lt;line&gt;</code></li>
</ul></li>
<li><p>
返回当前值
</p>
<div class="org-src-container">
<pre class="src src-sh">(gdb) <span style="color: #b9ca4a;">return</span> &lt;return expression&gt;
(lldb) thread return &lt;return expression&gt;
</pre>
</div></li>
</ol>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgb29964e" class="outline-4">
<h4 id="orgb29964e"><span class="section-number-4">3.1.4.</span> 保持断点 &amp; 现场恢复</h4>
<div class="outline-text-4" id="text-3-1-4">
<p>
GDB 保存断点的方式比较方便，直接保持成一个文本文件后，再应用代码
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#20445;&#25345;&#26029;&#28857;&#21040;&#25991;&#20214;&#20013;</span>
(gdb) save breakpoint mybreak.txt
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#37325;&#26032;&#21152;&#36733;&#20445;&#23384;&#30340;&#26029;&#28857;</span>
(gdb) <span style="color: #c397d8;">source</span> mybreak.txt
</pre>
</div>

<p>
LLDB 保存断点也有类似的命令，但是保存结果是一个 JSON
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#20445;&#23384;&#26029;&#28857;&#21040; json &#26684;&#24335;&#25991;&#20214;</span>
(lldb) breakpoint write -f dbg001
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#35835;&#21462;&#26029;&#28857;&#21040; json &#26684;&#24335;&#25991;&#20214;</span>
(lldb) breakpoint read -f dbg001
</pre>
</div>

<p>
也可以参考这个答案优化流程 <a href="https://stackoverflow.com/questions/24638515/save-breakpoints-in-lldb">SO</a>
</p>


<div id="orgce527b8" class="figure">
<p><img src="../static/image/2023/0205/100837.png" alt="100837.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org906431c" class="outline-4">
<h4 id="org906431c"><span class="section-number-4">3.1.5.</span> 查看/修改变量和内存数据</h4>
<div class="outline-text-4" id="text-3-1-5">
<ol class="org-ol">
<li><p>
打印变量 print
</p>
<div class="org-src-container">
<pre class="src src-sh">(lldb) p thd-&gt;m_thread_id
(my_thread_id) $<span style="color: #e7c547;">1</span> = 10
(lldb) x/w &amp;$<span style="color: #e7c547;">1</span>
0x7fbdc1240188: 0x0000000a
(lldb)
</pre>
</div></li>
<li><p>
查看内存地址中的数据
</p>
<div class="org-src-container">
<pre class="src src-sh">(lldb) x/8w $<span style="color: #e7c547;">0</span> =&gt; &#25171;&#21360;&#22320;&#22336;&#30340;&#25968;&#25454;, &#25171;&#21360; 8 &#26465;&#25968;&#25454;, [w, b] &#34920;&#31034;&#19981;&#21516;&#30340;&#25171;&#21360;&#26041;&#24335;
0x7fbdc123dc00: 0x0916f4d8 0x00000001 0x0916f548 0x00000001
0x7fbdc123dc10: 0x00000000 0x00000000 0xc1240440 0x00007fbd
(lldb) x/8b $<span style="color: #e7c547;">0</span>
0x7fbdc123dc00: 0xd8 0xf4 0x16 0x09 0x01 0x00 0x00 0x00
(lldb) x/8x $<span style="color: #e7c547;">0</span>
0x7fbdc123dc00: 0xd8 0xf4 0x16 0x09 0x01 0x00 0x00 0x00
</pre>
</div></li>
<li><p>
查看 frame 中变量
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#26597;&#30475;&#23616;&#37096;&#21464;&#37327;</span>
(lldb) frame variable
(lldb) fr v
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#26597;&#30475;&#20840;&#23616;&#21464;&#37327;</span>
(lldb) target variable
(lldb) ta v
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#26597;&#30475;&#35843;&#29992;&#26632; thread backtrace</span>
(lldb/gdb) bt
</pre>
</div></li>
</ol>
</div>
</div>

<div id="outline-container-orgb0be268" class="outline-4">
<h4 id="orgb0be268"><span class="section-number-4">3.1.6.</span> MacOS: 证书错误问题 <a href="https://timnash.co.uk/getting-gdb-to-semi-reliably-work-on-mojave-macos/">(^-^)</a></h4>
<div class="outline-text-4" id="text-3-1-6">
<blockquote>
<p>
please check gdb is codesigned - see taskgated(8)
</p>
</blockquote>
<p>
手工编写 gdb.xml
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #b9ca4a;">?xml</span> <span style="color: #e7c547;">version</span>="1.0" <span style="color: #e7c547;">encoding</span>="UTF-8"?&gt;
&lt;<span style="color: #b9ca4a;">!DOCTYPE</span> plist PUBLIC "-//Apple//DTD PLIST 1.0//EN"
"http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;<span style="color: #e78c45;">plist</span> <span style="color: #e7c547;">version</span>=<span style="color: #70c0b1;">"1.0"</span>&gt;
&lt;<span style="color: #e78c45;">dict</span>&gt;
    &lt;<span style="color: #e78c45;">key</span>&gt;com.apple.security.cs.allow-jit&lt;/<span style="color: #e78c45;">key</span>&gt;
    &lt;<span style="color: #e78c45;">true</span>/&gt;
    &lt;<span style="color: #e78c45;">key</span>&gt;com.apple.security.cs.allow-unsigned-executable-memory&lt;/<span style="color: #e78c45;">key</span>&gt;
    &lt;<span style="color: #e78c45;">true</span>/&gt;
    &lt;<span style="color: #e78c45;">key</span>&gt;com.apple.security.cs.allow-dyld-environment-variables&lt;/<span style="color: #e78c45;">key</span>&gt;
    &lt;<span style="color: #e78c45;">true</span>/&gt;
    &lt;<span style="color: #e78c45;">key</span>&gt;com.apple.security.cs.disable-library-validation&lt;/<span style="color: #e78c45;">key</span>&gt;
    &lt;<span style="color: #e78c45;">true</span>/&gt;
    &lt;<span style="color: #e78c45;">key</span>&gt;com.apple.security.cs.disable-executable-page-protection&lt;/<span style="color: #e78c45;">key</span>&gt;
    &lt;<span style="color: #e78c45;">true</span>/&gt;
    &lt;<span style="color: #e78c45;">key</span>&gt;com.apple.security.cs.debugger&lt;/<span style="color: #e78c45;">key</span>&gt;
    &lt;<span style="color: #e78c45;">true</span>/&gt;
    &lt;<span style="color: #e78c45;">key</span>&gt;com.apple.security.get-task-allow&lt;/<span style="color: #e78c45;">key</span>&gt;
    &lt;<span style="color: #e78c45;">true</span>/&gt;
&lt;/<span style="color: #e78c45;">dict</span>&gt;
&lt;/<span style="color: #e78c45;">plist</span>&gt;
</pre>
</div>
<p>
使用命令给 gdb 添加证书
</p>
<div class="org-src-container">
<pre class="src src-sh">codesign --entitlements gdb.xml -fs gdb-cert /usr/local/bin/gdb
</pre>
</div>
</div>
</div>

<div id="outline-container-org9032245" class="outline-4">
<h4 id="org9032245"><span class="section-number-4">3.1.7.</span> 交叉编译</h4>
<div class="outline-text-4" id="text-3-1-7">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c397d8;">export</span> <span style="color: #e7c547;">PREFIX</span>=<span style="color: #70c0b1;">"/opt/i386-elf-toolchain"</span>
<span style="color: #c397d8;">export</span> <span style="color: #e7c547;">TARGET</span>=i386-elf
<span style="color: #c397d8;">export</span> <span style="color: #e7c547;">PATH</span>=<span style="color: #70c0b1;">"$PREFIX/bin:$PATH"</span>

wget -c https://mirrors.tuna.tsinghua.edu.cn/gnu/gcc/gcc-11.4.0/gcc-11.4.0.tar.gz
wget -c https://mirrors.tuna.tsinghua.edu.cn/gnu/binutils/binutils-2.40.tar.gz
wget -c https://mirrors.tuna.tsinghua.edu.cn/gnu/gdb/gdb-11.2.tar.gz

tar xzvf binutils-2.40.tar.gz
tar xzvf gcc-11.4.0.tar.gz
<span style="color: #c397d8;">cd</span> gcc-11.4.0
./contrib/download_prerequisites


<span style="color: #e7c547;">DIR</span>=$<span style="color: #e7c547;">PWD</span>

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">rm -rf $DIR/build-binutils</span>
mkdir -p $<span style="color: #e7c547;">DIR</span>/build-binutils
<span style="color: #c397d8;">cd</span> $<span style="color: #e7c547;">DIR</span>/build-binutils
../binutils-2.40/configure --target=$<span style="color: #e7c547;">TARGET</span> --prefix=$<span style="color: #e7c547;">PREFIX</span> --enable-interwork --enable-multilib --disable-nls --disable-werror 2&gt;&amp;1 | tee configure.log
make all -j4 2&gt;&amp;1 | tee make.log
sudo make install 2&gt;&amp;1 | tee install.log


<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">rm -rf $DIR/build-gcc</span>
mkdir -p $<span style="color: #e7c547;">DIR</span>/build-gcc
<span style="color: #c397d8;">cd</span> $<span style="color: #e7c547;">DIR</span>/build-gcc
../gcc-11.4.0/configure --target=$<span style="color: #e7c547;">TARGET</span> --prefix=$<span style="color: #e7c547;">PREFIX</span> --disable-nls --disable-libssp --enable-languages=c --without-headers 2&gt;&amp;1 | tee configure.log
make all-gcc -j4 2&gt;&amp;1 | tee make-all-gcc.log
make all-target-libgcc -j4 2&gt;&amp;1 | tee make-all-target-libgcc.log
sudo make install-gcc 2&gt;&amp;1 | tee make-install-gcc.log
sudo make install-target-libgcc 2&gt;&amp;1 | tee make-install-target-libgcc.log


<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">rm -rf $DIR/build-gdb</span>
mkdir -p $<span style="color: #e7c547;">DIR</span>/build-gdb
<span style="color: #c397d8;">cd</span> $<span style="color: #e7c547;">DIR</span>/build-gdb
../gdb-11.2/configure --target=$<span style="color: #e7c547;">TARGET</span> --prefix=$<span style="color: #e7c547;">PREFIX</span> --program-prefix=i386-elf-
make -j4 2&gt;&amp;1 | tee make.log
sudo make install 2&gt;&amp;1 | tee install.log
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgda54c5e" class="outline-3">
<h3 id="orgda54c5e"><span class="section-number-3">3.2.</span> SSH 配置</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-org91136cc" class="outline-4">
<h4 id="org91136cc"><span class="section-number-4">3.2.1.</span> forward 端口转发</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
本地转发
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">-N &#19981;&#25191;&#34892;&#21629;&#20196;, -L local &#36716;&#21457; &lt;remote-port&gt;:&lt;local-host&gt;:&lt;local-port&gt;</span>
ssh -N -L 9092:127.0.0.1:9092 user@host
</pre>
</div>

<p>
远端转发
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">-N &#19981;&#25191;&#34892;&#21629;&#20196;, -R remote &#36716;&#21457; &lt;local-port&gt;:&lt;remote-host&gt;:&lt;remote-port&gt;</span>
ssh -N -R 9092:127.0.0.1:9092 user@host
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgcdc642c" class="outline-3">
<h3 id="orgcdc642c"><span class="section-number-3">3.3.</span> Git</h3>
<div class="outline-text-3" id="text-3-3">
</div>
<div id="outline-container-orga2a4aac" class="outline-4">
<h4 id="orga2a4aac"><span class="section-number-4">3.3.1.</span> 配置用户信息</h4>
<div class="outline-text-4" id="text-3-3-1">
<div class="org-src-container">
<pre class="src src-sh">git config --global user.email <span style="color: #70c0b1;">"hujinghui@buaa.edu.cn"</span>
git config --global user.name <span style="color: #70c0b1;">"Jinghui Hu"</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org0bc5b1f" class="outline-3">
<h3 id="org0bc5b1f"><span class="section-number-3">3.4.</span> Docker 环境</h3>
<div class="outline-text-3" id="text-3-4">
<p>
安装参考链接 <a href="https://docs.docker.com/engine/install/centos/#install-using-the-repository">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">yum install -y yum-utils
yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo

yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb41066e" class="outline-3">
<h3 id="orgb41066e"><span class="section-number-3">3.5.</span> CentOS 工具链</h3>
<div class="outline-text-3" id="text-3-5">
</div>
<div id="outline-container-org8e6ac57" class="outline-4">
<h4 id="org8e6ac57"><span class="section-number-4">3.5.1.</span> SCL (Software Collection)</h4>
<div class="outline-text-4" id="text-3-5-1">
<p>
SCL 提供一下较新的工具集 <a href="https://wiki.centos.org/AdditionalResources/Repositories/SCL">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sql">yum install centos-release-scl

yum makecache
yum repolist
</pre>
</div>
</div>
</div>

<div id="outline-container-org0108325" class="outline-4">
<h4 id="org0108325"><span class="section-number-4">3.5.2.</span> Red Hat Developer Toolset</h4>
<div class="outline-text-4" id="text-3-5-2">
<ol class="org-ol">
<li><p>
使用手册 <a href="https://access.redhat.com/documentation/en-us/red_hat_developer_toolset/11/html-single/user_guide/index#doc-wrapper">User Guide</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">yum install scl-utils centos-release-scl

yum list all --enablerepo=<span style="color: #70c0b1;">'centos-sclo-rh'</span> | grep <span style="color: #70c0b1;">"devtoolset"</span>
yum install devtoolset-11-toolchain
</pre>
</div></li>
<li><p>
配置并启用 scl 工具集
</p>
<div class="org-src-container">
<pre class="src src-sh">scl --list
scl enable devtoolset-11 bash
</pre>
</div></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org11fa285" class="outline-3">
<h3 id="org11fa285"><span class="section-number-3">3.6.</span> WSL</h3>
<div class="outline-text-3" id="text-3-6">
</div>
<div id="outline-container-org2fc4ef9" class="outline-4">
<h4 id="org2fc4ef9"><span class="section-number-4">3.6.1.</span> Ubuntu 安装并迁移到其他盘</h4>
<div class="outline-text-4" id="text-3-6-1">
<ol class="org-ol">
<li>安装说明 <a href="https://learn.microsoft.com/zh-cn/windows/wsl/install-manual">link</a></li>
<li><p>
移动数据文件到非系统盘
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#26597;&#30475;&#24403;&#21069;&#30340; wsl &#23481;&#22120;</span>
wsl -l -v

wsl --export Ubuntu ubuntu2204.tar
wsl --unregister Ubuntu

mkdir data
wsl --import Ubuntu-22.04 data ubuntu2204.tar
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-org05eb6b3" class="outline-4">
<h4 id="org05eb6b3"><span class="section-number-4">3.6.2.</span> Docker 无法启动</h4>
<div class="outline-text-4" id="text-3-6-2">
<p>
/usr/sbin/iptables-nft 网络管理 WSL2 不支持，需要修改一下
</p>
<div class="org-src-container">
<pre class="src src-sh">$ sudo update-alternatives --config iptables
There are 2 choices for the alternative iptables (providing /usr/sbin/iptables).

  Selection    Path                       Priority   Status
------------------------------------------------------------
* 0            /usr/sbin/iptables-nft      20        auto mode
  1            /usr/sbin/iptables-legacy   10        manual mode
  2            /usr/sbin/iptables-nft      20        manual mode

Press &lt;enter&gt; to keep the current choice[*], or type selection number: 1
update-alternatives: using /usr/sbin/iptables-legacy to provide /usr/sbin/iptables (iptables) <span style="color: #b9ca4a;">in</span> manual mode
$ sudo service docker start
 * Starting Docker: docker                                                                                                                                            [ OK ]
$ docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf37b464" class="outline-4">
<h4 id="orgf37b464"><span class="section-number-4">3.6.3.</span> 缺失字体</h4>
<div class="outline-text-4" id="text-3-6-3">
<p>
默认添加 Windows 自带的字体来显示缺失字体
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo ln -s /mnt/c/Windows/Fonts /usr/share/fonts/host
fc-cache -fv
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdff1f42" class="outline-4">
<h4 id="orgdff1f42"><span class="section-number-4">3.6.4.</span> 解决提示符错误</h4>
<div class="outline-text-4" id="text-3-6-4">
<p>
Windows Terminal 在安装 zsh-autosuggestions 时会显示的有问题，这里修改一下 <code>PS1</code>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #e7c547;">ZSH_THEME</span>=<span style="color: #70c0b1;">"none"</span>
<span style="color: #c397d8;">export</span> <span style="color: #e7c547;">PS1</span>=<span style="color: #70c0b1;">'WSL(%3~)%# '</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgdcd4f9a" class="outline-2">
<h2 id="orgdcd4f9a"><span class="section-number-2">4.</span> 效率工具</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org6c100ed" class="outline-3">
<h3 id="org6c100ed"><span class="section-number-3">4.1.</span> Perl</h3>
<div class="outline-text-3" id="text-4-1">
</div>
<div id="outline-container-org5620f3e" class="outline-4">
<h4 id="org5620f3e"><span class="section-number-4">4.1.1.</span> 环境配置</h4>
<div class="outline-text-4" id="text-4-1-1">
</div>
<ol class="org-ol">
<li><a id="org39e1bbf"></a>包管理工具配置 CPAN<br />
<div class="outline-text-5" id="text-4-1-1-1">
<ol class="org-ol">
<li>官网 <a href="https://metacpan.org/">CPAN</a></li>
<li><p>
镜像 <a href="https://mirrors.tuna.tsinghua.edu.cn/help/CPAN/">TUNA</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #e7c547;">PERL_MM_USE_DEFAULT</span>=1 perl -MCPAN -e <span style="color: #70c0b1;">'CPAN::HandleConfig-&gt;edit("pushy_https", 0); CPAN::HandleConfig-&gt;edit("urllist", "unshift", "https://mirrors.tuna.tsinghua.edu.cn/CPAN/"); mkmyconfig'</span>
</pre>
</div></li>
<li>CPAN 的配置文件: <code>~/.cpan/CPAN/MyConfig.pm</code></li>
</ol>
</div>
</li>
<li><a id="orgb7e1dac"></a>包管理命令<br />
<div class="outline-text-5" id="text-4-1-1-2">
<div class="org-src-container">
<pre class="src src-sh">perl -MCPAN -e <span style="color: #70c0b1;">'install Excel::Writer::XLSX'</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org73b8c4f" class="outline-4">
<h4 id="org73b8c4f"><span class="section-number-4">4.1.2.</span> 基本使用</h4>
<div class="outline-text-4" id="text-4-1-2">
</div>
<ol class="org-ol">
<li><a id="org90bc738"></a>Hello world<br />
<div class="outline-text-5" id="text-4-1-2-1">
<p>
创建 <code>hello.pl</code> 文件写以下代码
</p>
<div class="org-src-container">
<pre class="src src-perl">print(<span style="color: #70c0b1;">"hello world\n"</span>);
</pre>
</div>

<p>
使用 perl 命令运行代码
</p>
<div class="org-src-container">
<pre class="src src-sh">perl hello.pl
</pre>
</div>

<div id="orgafe0b77" class="figure">
<p><img src="../static/image/2023/0129/192740.png" alt="192740.png" />
</p>
</div>
</div>
</li>

<li><a id="org7439d0a"></a>过滤 MySQL trace 日志<br />
<div class="outline-text-5" id="text-4-1-2-2">
<div class="org-src-container">
<pre class="src src-perl"><span style="color: #b9ca4a;">use</span> <span style="color: #7aa6da;">strict</span>;
<span style="color: #b9ca4a;">use</span> <span style="color: #7aa6da;">warnings</span>;

<span style="color: #b9ca4a;">my</span> $<span style="color: #e7c547;">cid</span> = 8;
<span style="color: #b9ca4a;">my</span> $<span style="color: #e7c547;">fout</span> = <span style="color: #70c0b1;">"/tmp/mysqld-thd-$cid.txt"</span>;
open(FIN, <span style="color: #70c0b1;">'&lt;:encoding(UTF-8)'</span>, <span style="color: #70c0b1;">"/tmp/mysqld.trace"</span>) or <span style="color: #b9ca4a;">die</span>;
open(FOUT, <span style="color: #70c0b1;">'&gt;'</span>, $<span style="color: #e7c547;">fout</span>) or <span style="color: #b9ca4a;">die</span>;

<span style="color: #b9ca4a;">while</span> (<span style="color: #b9ca4a;">my</span> $<span style="color: #e7c547;">line</span> = &lt;<span style="color: #7aa6da;">FIN</span>&gt;) {
    <span style="color: #b9ca4a;">if</span> ($<span style="color: #e7c547;">line</span> =~ <span style="color: #70c0b1;">/^T\@$cid/</span>) {
        print FOUT $<span style="color: #e7c547;">line</span>;
    }
}

close(FOUT);
$<span style="color: #e7c547;">fout</span>;
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org38bd7b2" class="outline-3">
<h3 id="org38bd7b2"><span class="section-number-3">4.2.</span> Python</h3>
</div>

<div id="outline-container-org880c309" class="outline-3">
<h3 id="org880c309"><span class="section-number-3">4.3.</span> Ruby</h3>
<div class="outline-text-3" id="text-4-3">
<ol class="org-ol">
<li>配置国内 GEM 镜像 <a href="https://gems.ruby-china.com/">Ruby China</a></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org3adb560" class="outline-2">
<h2 id="org3adb560"><span class="section-number-2">5.</span> 问题排查</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org820ad49" class="outline-3">
<h3 id="org820ad49"><span class="section-number-3">5.1.</span> 科学上网</h3>
<div class="outline-text-3" id="text-5-1">
</div>
<div id="outline-container-orgea7588b" class="outline-4">
<h4 id="orgea7588b"><span class="section-number-4">5.1.1.</span> githubusercontent 链接失败</h4>
<div class="outline-text-4" id="text-5-1-1">
<p>
/etc/hosts
</p>
<div class="org-src-container">
<pre class="src src-sh">185.199.108.133 raw.githubusercontent.com
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb214967" class="outline-3">
<h3 id="orgb214967"><span class="section-number-3">5.2.</span> 使用体验</h3>
<div class="outline-text-3" id="text-5-2">
</div>
<div id="outline-container-org61bdc4a" class="outline-4">
<h4 id="org61bdc4a"><span class="section-number-4">5.2.1.</span> Esc 键有延迟</h4>
<div class="outline-text-4" id="text-5-2-1">
<p>
问题说明 <a href="https://www.johnhawthorn.com/2012/09/vi-escape-delays/">Eliminating delays on ESC in vim and zsh</a>
尝试按照以下思路解决这个问题
vim
</p>
<div class="org-src-container">
<pre class="src src-text">set timeoutlen=1000 ttimeoutlen=0
</pre>
</div>
<p>
zsh
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">10ms for key sequences</span>
<span style="color: #e7c547;">KEYTIMEOUT</span>=1
</pre>
</div>
<p>
tmux
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">.tmux.conf</span>
<span style="color: #c397d8;">set</span> -s escape-time 0
<span style="color: #c397d8;">echo</span> <span style="color: #70c0b1;">'set -s escape-time 0'</span> &gt;&gt; ~/.tmux.conf
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org26b0f44" class="outline-3">
<h3 id="org26b0f44"><span class="section-number-3">5.3.</span> CentOS</h3>
<div class="outline-text-3" id="text-5-3">
</div>
<div id="outline-container-orgf71a976" class="outline-4">
<h4 id="orgf71a976"><span class="section-number-4">5.3.1.</span> 硬件时钟 hwclock</h4>
<div class="outline-text-4" id="text-5-3-1">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">Display hwclock</span>
hwclock --show

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">Sync hwclock to system</span>
hwclock --hctosys

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">Save clock, for reboot</span>
clock -w
hwclock -w
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org2c2e9cd" class="outline-3">
<h3 id="org2c2e9cd"><span class="section-number-3">5.4.</span> MySQL</h3>
<div class="outline-text-3" id="text-5-4">
</div>
<div id="outline-container-org46ce1c3" class="outline-4">
<h4 id="org46ce1c3"><span class="section-number-4">5.4.1.</span> Public Key Retrieval is not allowed</h4>
<div class="outline-text-4" id="text-5-4-1">
<p>
在设置数据库添加如下的链接选项
</p>
<div class="org-src-container">
<pre class="src src-text">employees?allowPublicKeyRetrieval=true
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd8001bb" class="outline-3">
<h3 id="orgd8001bb"><span class="section-number-3">5.5.</span> Docker</h3>
<div class="outline-text-3" id="text-5-5">
</div>
<div id="outline-container-orgd8b24ba" class="outline-4">
<h4 id="orgd8b24ba"><span class="section-number-4">5.5.1.</span> 文件夹递归复制</h4>
<div class="outline-text-4" id="text-5-5-1">
<div class="org-src-container">
<pre class="src src-dockerfile"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#27491;&#30830;&#22320;&#36882;&#24402;&#22797;&#21046;&#25991;&#20214;&#22841;&#26041;&#26696;</span>
<span style="color: #b9ca4a;">COPY</span> src/  target/

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#20197;&#19979;&#20004;&#31181;&#19981;&#21644;&#36882;&#24402;&#22797;&#21046;</span>
<span style="color: #b9ca4a;">COPY</span> src/* target
<span style="color: #b9ca4a;">COPY</span> src   target
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org09bfad5" class="outline-2">
<h2 id="org09bfad5"><span class="section-number-2">6.</span> 基础知识</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org5e8c9fa" class="outline-3">
<h3 id="org5e8c9fa"><span class="section-number-3">6.1.</span> 数据结构</h3>
<div class="outline-text-3" id="text-6-1">
<ol class="org-ol">
<li>红黑树 <a href="https://www.cs.usfca.edu/~galles/visualization/RedBlack.html">rbtree</a></li>
</ol>
</div>
</div>
<div id="outline-container-orgb7536e5" class="outline-3">
<h3 id="orgb7536e5"><span class="section-number-3">6.2.</span> 操作系统</h3>
<div class="outline-text-3" id="text-6-2">
</div>
<div id="outline-container-orgac69fbd" class="outline-4">
<h4 id="orgac69fbd"><span class="section-number-4">6.2.1.</span> 课程 <a href="https://pdos.csail.mit.edu/6.828/2019/index.html">MIT 6.828</a></h4>
<div class="outline-text-4" id="text-6-2-1">
</div>
<ol class="org-ol">
<li><a id="orgd43a010"></a>环境准备<br />
<div class="outline-text-5" id="text-6-2-1-1">
<ol class="org-ol">
<li><a href="https://pdos.csail.mit.edu/6.828/2019/tools.html">工具链</a> risc-v</li>
<li>课程视频 <a href="https://www.bilibili.com/video/BV19k4y1C7kA">BILI</a></li>
<li>中文课程整理 <a href="http://xv6.dgs.zone/">中文介绍</a></li>
</ol>
</div>
</li>
</ol>
</div>
<div id="outline-container-org7d4430b" class="outline-4">
<h4 id="org7d4430b"><span class="section-number-4">6.2.2.</span> Minix</h4>
<div class="outline-text-4" id="text-6-2-2">
</div>
<ol class="org-ol">
<li><a id="org14dbc0f"></a>配置环境<br />
<div class="outline-text-5" id="text-6-2-2-1">
<p>
<a href="https://wiki.minix3.org/doku.php?id=developersguide:crosscompiling">交叉编译文档</a>
</p>

<p>
下载代码
</p>
<div class="org-src-container">
<pre class="src src-sh">mkdir minix
<span style="color: #c397d8;">cd</span> minix
git clone git://git.minix3.org/minix src
<span style="color: #c397d8;">cd</span> src
</pre>
</div>

<p>
安装依赖
</p>
<div class="org-src-container">
<pre class="src src-sql">sudo apt-<span style="color: #b9ca4a;">get</span> install build-essential curl git zlibc zlib1g zlib1g-dev g++
</pre>
</div>

<p>
编译内存镜像
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #e7c547;">JOBS</span>=8 ./releasetools/x86_hdimage.sh
</pre>
</div>

<p>
启动镜像
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c397d8;">cd</span> ../obj.i386/destdir.i386/boot/minix/.temp

qemu-system-i386 -display none <span style="color: #70c0b1;">\</span>
                 -serial stdio <span style="color: #70c0b1;">\</span>
                 -kernel kernel <span style="color: #70c0b1;">\</span>
                 -append <span style="color: #70c0b1;">"console=tty00 rootdevname=c0d0p1"</span> <span style="color: #70c0b1;">\</span>
                 -initrd <span style="color: #70c0b1;">"mod01_ds,mod02_rs,mod03_pm,mod04_sched,mod05_vfs,mod06_memory,mod07_tty,mod08_mfs,mod09_vm,mod10_pfs,mod11_init"</span> <span style="color: #70c0b1;">\</span>
                 -hda /opt/local/hack/minix/src/minix_x86.img --enable-kvm
</pre>
</div>


<div id="orge6192c0" class="figure">
<p><img src="../static/image/2023/0315/112736.png" alt="112736.png" />
</p>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgd4e68c9" class="outline-4">
<h4 id="orgd4e68c9"><span class="section-number-4">6.2.3.</span> Linux</h4>
<div class="outline-text-4" id="text-6-2-3">
</div>
<ol class="org-ol">
<li><a id="org5eee445"></a>编译内核<br />
<div class="outline-text-5" id="text-6-2-3-1">
<ol class="org-ol">
<li><p>
一些依赖安装
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo apt install ncurses-dev flex bison libelf-dev libssl-dev dwarves
</pre>
</div></li>
<li>定制内核 <a href="https://wiki.centos.org/HowTos/Custom_Kernel">CentOS Wiki</a></li>
</ol>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#19979;&#36733;&#28304;&#30721;</span>
wget -c https://mirrors.tuna.tsinghua.edu.cn/kernel/v5.x/linux-5.15.115.tar.gz
tar xvzf linux-5.15.115.tar.gz
<span style="color: #c397d8;">cd</span> linux-5.15.115

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#20934;&#22791;&#37197;&#32622;&#25991;&#20214;</span>
cp /boot/config-<span style="color: #c397d8;">`uname -r`</span> .config
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#24320;&#21551;&#25110;&#20851;&#38381;&#37197;&#32622;&#36873;&#39033;</span>
make menuconfig

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#30830;&#20445; CONFIG_SYSTEM_TRUSTED_KEYS &#20026;&#31354;</span>
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">cat .config | grep CONFIG_SYSTEM_TRUSTED_KEYS</span>
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">CONFIG_SYSTEM_TRUSTED_KEYS=""</span>

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#32534;&#35793;&#20869;&#26680;</span>
make -j12

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#23433;&#35013;&#27169;&#22359;</span>
sudo make modules_install

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#23433;&#35013;&#20869;&#26680;</span>
sudo make install

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#37325;&#21551;&#31995;&#32479;, &#26597;&#30475;&#20869;&#26680;&#26159;&#21542;&#36816;&#34892;&#27491;&#24120;</span>
reboot
uname -r
</pre>
</div>

<p>
修改 grub 代码
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#26597;&#30475;&#40664;&#35748;&#30340; grub &#36873;&#39033;</span>
grub2-editenv list
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#26356;&#25913;&#40664;&#35748;&#21551;&#21160;&#36873;&#39033;</span>
grub2-set-default <span style="color: #70c0b1;">'5.16.0-1.el7.elrepo.x86_64) 7 (Core)'</span>
</pre>
</div>
</div>
</li>

<li><a id="orgbb63059"></a>Linux 资料网站<br />
<div class="outline-text-5" id="text-6-2-3-2">
<ol class="org-ol">
<li>Linux From Scratch <a href="https://www.linuxfromscratch.org/">LFS</a></li>
<li>老版本 Linux 研究网站 <a href="http://www.oldlinux.org/">oldlinux</a></li>
</ol>
</div>
</li>

<li><a id="org8d26f49"></a>Ubuntu 22.04 编译 linux 0.11<br />
<div class="outline-text-5" id="text-6-2-3-3">
<div class="org-src-container">
<pre class="src src-sh">apt install bin86
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org19b13a2" class="outline-3">
<h3 id="org19b13a2"><span class="section-number-3">6.3.</span> 极客时光</h3>
<div class="outline-text-3" id="text-6-3">
</div>
<div id="outline-container-orgba69a29" class="outline-4">
<h4 id="orgba69a29"><span class="section-number-4">6.3.1.</span> 专栏 <a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/22%20%E8%AE%B2%E9%80%9A%E5%85%B3%20Go%20%E8%AF%AD%E8%A8%80-%E5%AE%8C">22 讲通关 Go 语言</a></h4>
</div>
<div id="outline-container-orgf102041" class="outline-4">
<h4 id="orgf102041"><span class="section-number-4">6.3.2.</span> 专栏 <a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/24%E8%AE%B2%E5%90%83%E9%80%8F%E5%88%86%E5%B8%83%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%AE%8C">24 讲吃透分布式数据库</a></h4>
</div>
<div id="outline-container-org96867b6" class="outline-4">
<h4 id="org96867b6"><span class="section-number-4">6.3.3.</span> 专栏 <a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E9%AB%98%E6%89%8B%E8%AF%BE">消息队列高手课</a></h4>
<div class="outline-text-4" id="text-6-3-3">
</div>
<ol class="org-ol">
<li><a id="org01a6569"></a>分布式事务<br />
<div class="outline-text-5" id="text-6-3-3-1">
<ol class="org-ol">
<li>订单系统在消息队列上开启一个事务</li>
<li>然后订单系统给消息服务器发送一个 <b>半消息</b></li>
<li>这个半消息不是说消息内容不完整，它包含的内容就是完整的消息内容，半消息和普通
消息的唯一区别是，在事务提交之前，对于消费者来说，这个消息是不可见的</li>
<li>半消息发送成功后，订单系统就可以执行本地事务</li>
</ol>


<div id="org1da3bf4" class="figure">
<p><img src="../static/image/2023/0308/224741.png" alt="224741.png" />
</p>
</div>

<p>
如果 <b>半消息</b> 提交失败，不同队列会有不同处理方式
</p>
<ol class="org-ol">
<li>Kafka 的解决方案比较简单粗暴，直接抛出异常，让用户自行处理。我们可以在业务代
码中反复重试提交，直到提交成功，或者删除之前创建的订单进行补偿</li>
<li><p>
RocketMQ 中的事务实现中，增加了事务反查的机制来解决事务消息提交失败的问题
</p>


<div id="orgeffa737" class="figure">
<p><img src="../static/image/2023/0308/225054.png" alt="225054.png" />
</p>
</div>

<p>
为了支撑这个事务反查机制，我们的业务代码需要实现一个反查本地事务状态的接口，
告知 RocketMQ 本地事务是成功还是失败
</p></li>
</ol>
</div>
</li>
<li><a id="org184b451"></a>重复消费<br />
<div class="outline-text-5" id="text-6-3-3-2">
<p>
在 MQTT 协议中，给出了三种传递消息时能够提供的服务质量标准，这三种服务质量从低到
高依次是：
</p>

<ol class="org-ol">
<li>At most once: 至多一次。消息在传递时，最多会被送达一次。换一个说法就是，没什
么消息可靠性保证，允许丢消息。一般都是一些对消息可靠性要求不太高的监控场景使
用，比如每分钟上报一次机房温度数据，可以接受数据少量丢失。</li>
<li>At least once: 至少一次。消息在传递时，至少会被送达一次。也就是说，不允许丢消
息，但是允许有少量重复消息出现。</li>
<li>Exactly once：恰好一次。消息在传递时，只会被送达一次，不允许丢失也不允许重复，
这个是最高的等级。</li>
</ol>

<p>
用幂等性解决重复消息问题
</p>
<ol class="org-ol">
<li>利用数据库的唯一约束实现幂等</li>
<li>为更新的数据设置前置条件</li>
<li>记录并检查操作</li>
</ol>
</div>
</li>

<li><a id="orgf5c7bf7"></a>消息积压<br />
<div class="outline-text-5" id="text-6-3-3-3">
<ol class="org-ol">
<li>优化消息收发性能，预防消息积压的方法有两种，
<ul class="org-ul">
<li>增加批量或者是增加并发，在发送端这两种方法都可以使用</li>
<li>在消费端需要注意的是，增加并发需要同步扩容分区数量，否则是起不到效果的</li>
</ul></li>
<li>对于系统发生消息积压的情况，需要先解决积压，再分析原因
<ul class="org-ul">
<li>快速解决积压的方法就是通过水平扩容增加 Consumer 的实例数量</li>
</ul></li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org1762b5d" class="outline-2">
<h2 id="org1762b5d"><span class="section-number-2">7.</span> 学习计划</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-orgfdc78e2" class="outline-3">
<h3 id="orgfdc78e2"><span class="section-number-3">7.1.</span> 制作操作系统</h3>
<div class="outline-text-3" id="text-7-1">
<ol class="org-ol">
<li>c/c++ 编写一个操作系统 <a href="https://samypesse.gitbook.io/how-to-create-an-operating-system/chapter-2">link</a></li>
<li>Linux 内核完全注释 <a href="http://www.oldlinux.org/download/CLK-5.0-WithCover.pdf">book</a></li>
<li>os-tutorial</li>
</ol>
</div>
</div>
<div id="outline-container-org3eec5a0" class="outline-3">
<h3 id="org3eec5a0"><span class="section-number-3">7.2.</span> 操作系统实验</h3>
<div class="outline-text-3" id="text-7-2">
<ol class="org-ol">
<li><p>
AUR 编译说明文档 <a href="https://wiki.manjaro.org/index.php/Arch_User_Repository/zh-cn">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">clone build repository</span>
git clone https://aur.archlinux.org/i386-elf-binutils.git
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">make binary package</span>
makepkg -s
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">install package</span>
sudo pacman -U i386-elf-binutils-2.40-1-x86_64.pkg.tar.zst
</pre>
</div></li>
<li><p>
c 语言交叉编译
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#20132;&#21449;&#32534;&#35793;, -ffreestanding &#19981;&#38656;&#35201;&#26631;&#20934;&#24211;&#25903;&#25345;&#65292;&#29983;&#25104;&#30446;&#26631;&#26159;&#19968;&#20010;&#29420;&#31435;&#29615;&#22659;</span>
i386-elf-gcc -ffreestanding -c function.c -o function.o
<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#21453;&#27719;&#32534;</span>
i386-elf-objdump -d function.o

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#38142;&#25509;, -Ttext 0x0 &#34920;&#31034;&#20195;&#30721;&#27573;&#30340;&#36215;&#22987;&#22320;&#22336;</span>
i386-elf-ld -o function.bin -Ttext 0x0 --oformat binary function.o

<span style="color: #969896; font-style: italic;"># </span><span style="color: #969896; font-style: italic;">&#21453;&#27719;&#32534;&#27979;&#35797;&#29983;&#25104;&#30340;&#20108;&#36827;&#21046;&#25991;&#20214;</span>
ndisasm -b 32 function.bin
</pre>
</div></li>
</ol>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Last Updated 2023-06-26 Mon 10:03. Created by Jinghui Hu at 2023-01-29 Sun 10:55.</p>
</div>
</body>
</html>
