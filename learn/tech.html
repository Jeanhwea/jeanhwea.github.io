<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-09-27 Wed 22:09 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>技术文档汇总</title>
<meta name="author" content="Jinghui Hu" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">技术文档汇总</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgbfff8a3">1. 研发日常</a>
<ul>
<li><a href="#org23a4751">1.1. 体验优化</a>
<ul>
<li><a href="#org3415b4f">1.1.1. Esc 键有延迟</a></li>
<li><a href="#org5793ec7">1.1.2. 交叉编译环境配置</a></li>
<li><a href="#org04cd474">1.1.3. Tmux 管理终端会话</a></li>
<li><a href="#org9aaf3bf">1.1.4. 处理 json 字符串</a></li>
<li><a href="#org32296a9">1.1.5. qemu</a></li>
<li><a href="#orgd951825">1.1.6. bochs</a></li>
<li><a href="#orgd92ec58">1.1.7. pandoc 文档格式转换</a></li>
</ul>
</li>
<li><a href="#org672654c">1.2. Emacs</a>
<ul>
<li><a href="#orge3e97f4">1.2.1. 参考资料</a></li>
<li><a href="#org747678f">1.2.2. 任务管理</a></li>
<li><a href="#orgb5f726f">1.2.3. graphviz 参考连接</a></li>
<li><a href="#org4be658b">1.2.4. 无向图</a></li>
<li><a href="#org038968e">1.2.5. 有向图</a></li>
<li><a href="#org634a8d9">1.2.6. 支持中文</a></li>
<li><a href="#orgcaac8dc">1.2.7. 系统交互图</a></li>
<li><a href="#orgd298f15">1.2.8. plantuml 绘图</a></li>
<li><a href="#orgc338271">1.2.9. 批量删除 ^M 方法</a></li>
<li><a href="#orgedcddb4">1.2.10. tramp ssh 到远程</a></li>
<li><a href="#orgb2e21a5">1.2.11. 设置文件类型</a></li>
<li><a href="#org40f6286">1.2.12. 设置本地文件配置</a></li>
<li><a href="#orgaab7d06">1.2.13. 编辑二进制文件</a></li>
<li><a href="#org2fecc8f">1.2.14. elisp 函数增强</a></li>
<li><a href="#org2ed35e8">1.2.15. 设置文件显示自动换行</a></li>
<li><a href="#orgf326a80">1.2.16. evil 使用 mark 标记来快速跳转</a></li>
<li><a href="#org2e32c4f">1.2.17. libvterm 编译失败</a></li>
<li><a href="#org94fb7a3">1.2.18. profiler 启动性能分析</a></li>
</ul>
</li>
<li><a href="#org28e11ae">1.3. WSL</a>
<ul>
<li><a href="#org9320257">1.3.1. Ubuntu 安装并迁移到其他盘</a></li>
<li><a href="#orga55015c">1.3.2. Docker 无法启动</a></li>
<li><a href="#org8aff357">1.3.3. 缺失字体</a></li>
<li><a href="#org285e55d">1.3.4. 挂载共享服务器</a></li>
<li><a href="#org2e20aad">1.3.5. 解决提示符错误</a></li>
<li><a href="#org7bfbbda">1.3.6. 下载 firefox</a></li>
</ul>
</li>
<li><a href="#org805912a">1.4. CentOS</a>
<ul>
<li><a href="#orgf14452f">1.4.1. 配置网络</a></li>
<li><a href="#orgdc98b63">1.4.2. 设置防火墙 firewall</a></li>
<li><a href="#org417f726">1.4.3. SCL (Software Collection)</a></li>
<li><a href="#orgac0fbfc">1.4.4. Red Hat Developer Toolset</a></li>
<li><a href="#orgf912e46">1.4.5. yum 代理</a></li>
<li><a href="#orgf2b506e">1.4.6. nodejs</a></li>
<li><a href="#orgc1df497">1.4.7. 编译安装 openssl</a></li>
<li><a href="#orgf65bf83">1.4.8. 代理服务器 squid</a></li>
<li><a href="#org0833c74">1.4.9. DNS Server 配置 dnsmasq</a></li>
<li><a href="#org40a6b69">1.4.10. NTP 时间服务器设置</a></li>
<li><a href="#orgacabcf5">1.4.11. 硬件时钟 hwclock</a></li>
<li><a href="#org534b8a6">1.4.12. 安装中文字体</a></li>
<li><a href="#org8c12418">1.4.13. 文件挂载</a></li>
</ul>
</li>
<li><a href="#orgb643160">1.5. 工具链</a>
<ul>
<li><a href="#org81b5716">1.5.1. ohmyzsh</a></li>
<li><a href="#org49f5db4">1.5.2. HomeBrew</a></li>
<li><a href="#org1b90de6">1.5.3. LSP</a></li>
<li><a href="#orgfbcfc92">1.5.4. autossh</a></li>
<li><a href="#orga40dc29">1.5.5. ctags &amp; cscope</a></li>
<li><a href="#orgf10b4e6">1.5.6. gdb &amp; lldb</a></li>
</ul>
</li>
<li><a href="#org83cab7d">1.6. Java</a>
<ul>
<li><a href="#orge1bf851">1.6.1. Maven</a></li>
<li><a href="#orgeeba219">1.6.2. Spring Framework</a></li>
<li><a href="#orgde4ef31">1.6.3. Spring Boot</a></li>
<li><a href="#orgdc8c3bc">1.6.4. JVM</a></li>
<li><a href="#org0495617">1.6.5. SDK Man</a></li>
</ul>
</li>
<li><a href="#orge8b9546">1.7. Golang</a>
<ul>
<li><a href="#org156e27d">1.7.1. go module 初始化项目</a></li>
<li><a href="#org3bc93b5">1.7.2. 使用私有仓库</a></li>
<li><a href="#org506a088">1.7.3. 使用本地仓库</a></li>
<li><a href="#org72e328b">1.7.4. IDL</a></li>
<li><a href="#org3b7422a">1.7.5. hertz</a></li>
<li><a href="#org50fdca8">1.7.6. kitex</a></li>
<li><a href="#org5758d18">1.7.7. profile 性能分析</a></li>
<li><a href="#orgaf31a88">1.7.8. 源码编译</a></li>
<li><a href="#orgcf7217f">1.7.9. 泛型写法</a></li>
<li><a href="#org178a12f">1.7.10. 垃圾回收</a></li>
<li><a href="#org1c36863">1.7.11. 常用 API</a></li>
</ul>
</li>
<li><a href="#org799b5d6">1.8. Perl</a>
<ul>
<li><a href="#orgf428ee0">1.8.1. 环境配置</a></li>
<li><a href="#org6f53dc6">1.8.2. 基本使用</a></li>
</ul>
</li>
<li><a href="#orgca13da1">1.9. Python</a>
<ul>
<li><a href="#orgb0b0552">1.9.1. 安装 python 的开发包</a></li>
<li><a href="#org88b9a1b">1.9.2. pyenv 管理 python 版本</a></li>
</ul>
</li>
<li><a href="#org25338fa">1.10. Ruby</a></li>
<li><a href="#org2a7e872">1.11. Rust</a>
<ul>
<li><a href="#org2f7d2f8">1.11.1. 安装配置</a></li>
<li><a href="#org793ed2b">1.11.2. 使用笔记</a></li>
<li><a href="#org4d437f5">1.11.3. cargo</a></li>
</ul>
</li>
<li><a href="#org4d35bef">1.12. SSH</a>
<ul>
<li><a href="#orgcb84879">1.12.1. ~/.ssh/config</a></li>
<li><a href="#org3e46732">1.12.2. 配置 host 别名</a></li>
<li><a href="#org45a36f1">1.12.3. 直接转发远端流量</a></li>
<li><a href="#orga9d4d0b">1.12.4. 暴露本机服务配置, 两跳登录</a></li>
<li><a href="#org3f2888b">1.12.5. 代理登录</a></li>
<li><a href="#org0b0ec32">1.12.6. 连接 socket 重用</a></li>
<li><a href="#org7b80b15">1.12.7. forward 端口转发</a></li>
<li><a href="#org5250806">1.12.8. ssh 双跳登录</a></li>
<li><a href="#org2696bf7">1.12.9. scp 双跳传输</a></li>
</ul>
</li>
<li><a href="#org248a2a2">1.13. Git</a>
<ul>
<li><a href="#org1fcd959">1.13.1. 配置用户信息</a></li>
<li><a href="#orgd34fc23">1.13.2. 递归克隆子模块</a></li>
<li><a href="#orga7cf52c">1.13.3. 忽略换行符 ^M</a></li>
<li><a href="#org5e9c322">1.13.4. 代码发布相关</a></li>
<li><a href="#org3d8458d">1.13.5. 添加添加生成 TAGS 的 git-hooks</a></li>
</ul>
</li>
<li><a href="#org78cd1cd">1.14. Linux &amp; Shell</a>
<ul>
<li><a href="#org3471814">1.14.1. 后台运行命令 cmd</a></li>
<li><a href="#orgb0d8f9b">1.14.2. 比较 semver 版本号</a></li>
<li><a href="#org08c1fd8">1.14.3. heredoc 定义变量</a></li>
<li><a href="#org2e8d6d6">1.14.4. 检测命令返回值是否正确</a></li>
<li><a href="#org74f50f7">1.14.5. 检测当前是否 root 用户</a></li>
<li><a href="#orgda4a0bd">1.14.6. 临时提权设置目录权限</a></li>
<li><a href="#org401b0fb">1.14.7. tar 压缩/解压</a></li>
<li><a href="#org595da17">1.14.8. 启动盘制作</a></li>
<li><a href="#org8b3c4b5">1.14.9. Ubuntu 磁盘分区扩容</a></li>
</ul>
</li>
<li><a href="#orgf25e2e0">1.15. ORACLE</a>
<ul>
<li><a href="#org6086061">1.15.1. 参考资料</a></li>
<li><a href="#org512e5ad">1.15.2. 开发环境配置</a></li>
<li><a href="#orge834e5a">1.15.3. 运维相关</a></li>
</ul>
</li>
<li><a href="#org1e20817">1.16. MySQL</a>
<ul>
<li><a href="#org749c7e6">1.16.1. 参考资料</a></li>
<li><a href="#org65af72f">1.16.2. 主从架构实验环境</a></li>
<li><a href="#org42475a6">1.16.3. 运维主题</a></li>
<li><a href="#orgf228cb4">1.16.4. 源码研究</a></li>
</ul>
</li>
<li><a href="#orga3a6985">1.17. Redis</a>
<ul>
<li><a href="#org9ed9a5e">1.17.1. 系统监控</a></li>
</ul>
</li>
<li><a href="#orge374ff1">1.18. PostgreSQL</a>
<ul>
<li><a href="#org16fce1e">1.18.1. 前置环境变量</a></li>
<li><a href="#org34c8baf">1.18.2. 编译调试 &amp; 初始化数据</a></li>
<li><a href="#org6d1e5f8">1.18.3. 调试命令</a></li>
</ul>
</li>
<li><a href="#org903c87f">1.19. ClickHouse</a>
<ul>
<li><a href="#org2c31257">1.19.1. 安装步骤</a></li>
</ul>
</li>
<li><a href="#orgdfdf6d2">1.20. nginx</a>
<ul>
<li><a href="#orgc341f58">1.20.1. 文件配置</a></li>
</ul>
</li>
<li><a href="#orgfd724c4">1.21. Kafka</a>
<ul>
<li><a href="#orgf6f4b5f">1.21.1. 资源链接</a></li>
<li><a href="#orgb7a9329">1.21.2. 环境配置</a></li>
</ul>
</li>
<li><a href="#org9e69e26">1.22. RocketMQ</a>
<ul>
<li><a href="#org6944519">1.22.1. 资源链接</a></li>
</ul>
</li>
<li><a href="#org7eefb90">1.23. Hive</a></li>
<li><a href="#orgd100770">1.24. Docker</a>
<ul>
<li><a href="#orgc01ad1c">1.24.1. Docker 安装过程</a></li>
<li><a href="#org674f9a6">1.24.2. Engine 配置</a></li>
<li><a href="#org1851f1c">1.24.3. 国内镜像</a></li>
<li><a href="#org3ba35ac">1.24.4. 配置代理</a></li>
<li><a href="#org61726a5">1.24.5. 文件夹递归复制</a></li>
</ul>
</li>
<li><a href="#org527d292">1.25. Harbor</a>
<ul>
<li><a href="#orgd58fab4">1.25.1. 安装教程</a></li>
<li><a href="#org798ce7b">1.25.2. syslog 问题修复</a></li>
</ul>
</li>
<li><a href="#org8bc428f">1.26. Kubernetes</a>
<ul>
<li><a href="#org3ed0957">1.26.1. minikube</a></li>
<li><a href="#org4aec821">1.26.2. kubeadm</a></li>
<li><a href="#org21367da">1.26.3. kubectl</a></li>
<li><a href="#orgb1d7a56">1.26.4. 包管理工具 helm</a></li>
</ul>
</li>
<li><a href="#orgfaeee01">1.27. Prometheus</a></li>
</ul>
</li>
<li><a href="#org8e7e1f7">2. 学习计划</a>
<ul>
<li><a href="#orgbad304c">2.1. 操作系统</a>
<ul>
<li><a href="#org559b262">2.1.1. 制作操作系统资源</a></li>
<li><a href="#orgb638ea9">2.1.2. 课程 MIT 6.828</a></li>
<li><a href="#org66c8b32">2.1.3. 实模式</a></li>
<li><a href="#orgd471991">2.1.4. 保护模式</a></li>
<li><a href="#org930736b">2.1.5. Minix</a></li>
<li><a href="#orgd1de922">2.1.6. 实验环境准备</a></li>
<li><a href="#orgfc94b12">2.1.7. 自制操作系统</a></li>
</ul>
</li>
<li><a href="#org96e866f">2.2. Linux</a>
<ul>
<li><a href="#org54b9df1">2.2.1. Linux 资源链接</a></li>
<li><a href="#org877157c">2.2.2. 编译内核示例</a></li>
<li><a href="#org840f300">2.2.3. 编译 Linux 0.11 需要的工具</a></li>
<li><a href="#orgff0aa00">2.2.4. <span class="todo TODO">TODO</span> 内存检测工具 valgrind</a></li>
</ul>
</li>
<li><a href="#org93979a6">2.3. Rust</a>
<ul>
<li><a href="#orgbe00465">2.3.1. 资源链接</a></li>
</ul>
</li>
<li><a href="#org50c7845">2.4. 极客时光</a>
<ul>
<li><a href="#org4aef576">2.4.1. 专栏 22 讲通关 Go 语言</a></li>
<li><a href="#org05dea5f">2.4.2. 专栏 24 讲吃透分布式数据库</a></li>
<li><a href="#orgc41954a">2.4.3. 专栏 消息队列高手课</a></li>
</ul>
</li>
<li><a href="#orge958540">2.5. 数据结构</a></li>
</ul>
</li>
<li><a href="#org99dd23a">3. 问题排查</a>
<ul>
<li><a href="#org8b9f35b">3.1. Java 系统 CPU 飙高排查&#xa0;&#xa0;&#xa0;<span class="tag"><span class="java">java</span></span></a></li>
<li><a href="#org6f1b58d">3.2. digital envelope routines::unsupported&#xa0;&#xa0;&#xa0;<span class="tag"><span class="nodejs">nodejs</span></span></a></li>
<li><a href="#orgb7e9f25">3.3. RuntimeError: 'cryptography' package is required for sha256<sub>password</sub>&#xa0;&#xa0;&#xa0;<span class="tag"><span class="python">python</span></span></a></li>
<li><a href="#org07da009">3.4. githubusercontent 链接失败</a></li>
<li><a href="#org168eafe">3.5. Public Key Retrieval is not allowed&#xa0;&#xa0;&#xa0;<span class="tag"><span class="mysql">mysql</span></span></a></li>
<li><a href="#orgdd9fb0c">3.6. tar: time stamp XXX in the future&#xa0;&#xa0;&#xa0;<span class="tag"><span class="linux">linux</span></span></a></li>
</ul>
</li>
<li><a href="#org798f5ba">4. 前端调研</a>
<ul>
<li><a href="#orgf96f9d3">4.1. Node &amp; nvm</a></li>
<li><a href="#orgfe65ff1">4.2. Node Windows 配置</a></li>
<li><a href="#orgb209a9e">4.3. 淘宝国内 NPM 镜像</a></li>
<li><a href="#org1f414b1">4.4. 前端 UI 组件库</a>
<ul>
<li><a href="#orgfc90168">4.4.1. Ant Design</a></li>
<li><a href="#org41ef9fd">4.4.2. Ant Design Pro</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<a href="https://cheatsheets.zip/">cheatsheets.zip</a>
</p>
<ul class="org-ul">
<li>python <a href="https://cheatsheets.zip/python">link</a></li>
<li>golang <a href="https://cheatsheets.zip/go">link</a></li>
</ul>

<div id="outline-container-orgbfff8a3" class="outline-2">
<h2 id="orgbfff8a3"><span class="section-number-2">1.</span> 研发日常</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org23a4751" class="outline-3">
<h3 id="org23a4751"><span class="section-number-3">1.1.</span> 体验优化</h3>
<div class="outline-text-3" id="text-1-1">
</div>
<div id="outline-container-org3415b4f" class="outline-4">
<h4 id="org3415b4f"><span class="section-number-4">1.1.1.</span> Esc 键有延迟</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
问题说明 <a href="https://www.johnhawthorn.com/2012/09/vi-escape-delays/">Eliminating delays on ESC in vim and zsh</a>
尝试按照以下思路解决这个问题
vim
</p>
<div class="org-src-container">
<pre class="src src-text">set timeoutlen=1000 ttimeoutlen=0
</pre>
</div>
<p>
zsh
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">10ms for key sequences</span>
<span style="color: #ffc9e8;">KEYTIMEOUT</span>=1
</pre>
</div>
<p>
tmux
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">.tmux.conf</span>
<span style="color: #ffb86c;">set</span> -s escape-time 0
<span style="color: #ffb86c;">echo</span> <span style="color: #f1fa8c;">'set -s escape-time 0'</span> &gt;&gt; ~/.tmux.conf
</pre>
</div>
</div>
</div>
<div id="outline-container-org5793ec7" class="outline-4">
<h4 id="org5793ec7"><span class="section-number-4">1.1.2.</span> 交叉编译环境配置</h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
安装前置依赖项目
</p>
<div class="org-src-container">
<pre class="src src-sh">yum install -y texinfo
</pre>
</div>

<p>
下载所需的依赖
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#19979;&#36733;&#25152;&#38656;&#30340;&#23433;&#35013;&#21253;</span>
wget -c https://mirrors.tuna.tsinghua.edu.cn/gnu/gcc/gcc-11.4.0/gcc-11.4.0.tar.gz
wget -c https://mirrors.tuna.tsinghua.edu.cn/gnu/binutils/binutils-2.40.tar.gz
wget -c https://mirrors.tuna.tsinghua.edu.cn/gnu/gdb/gdb-11.2.tar.gz

tar xzvf binutils-2.40.tar.gz
tar xzvf gcc-11.4.0.tar.gz
tar xzvf gdb-11.2.tar.gz

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">gcc &#38656;&#35201;&#20381;&#36182; gmp mpfr libmpc &#24211;, &#21487;&#20197;&#30452;&#25509;&#20351;&#29992; gcc &#37324;&#38754;&#30340;&#36741;&#21161;&#33050;&#26412;&#19979;&#36733;</span>
<span style="color: #ffb86c;">cd</span> gcc-11.4.0
./contrib/download_prerequisites
</pre>
</div>

<p>
保存脚本开始编译
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">PREFIX</span>=<span style="color: #f1fa8c;">"/opt/i386-elf-toolchain"</span>
<span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">TARGET</span>=i386-elf
<span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">PATH</span>=<span style="color: #f1fa8c;">"$PREFIX/bin:$PATH"</span>

<span style="color: #ffc9e8;">DIR</span>=$<span style="color: #ffc9e8;">PWD</span>

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">rm -rf $DIR/build-binutils</span>
mkdir -p $<span style="color: #ffc9e8;">DIR</span>/build-binutils
<span style="color: #ffb86c;">cd</span> $<span style="color: #ffc9e8;">DIR</span>/build-binutils
../binutils-2.40/configure --target=$<span style="color: #ffc9e8;">TARGET</span> --prefix=$<span style="color: #ffc9e8;">PREFIX</span> --enable-interwork --enable-multilib --disable-nls --disable-werror |&amp; tee configure.log
make all -j4 |&amp; tee make.log
sudo make install |&amp; tee install.log


<span style="color: #6272a4;"># </span><span style="color: #6272a4;">rm -rf $DIR/build-gcc</span>
mkdir -p $<span style="color: #ffc9e8;">DIR</span>/build-gcc
<span style="color: #ffb86c;">cd</span> $<span style="color: #ffc9e8;">DIR</span>/build-gcc
../gcc-11.4.0/configure --target=$<span style="color: #ffc9e8;">TARGET</span> --prefix=$<span style="color: #ffc9e8;">PREFIX</span> --disable-nls --disable-libssp --enable-languages=c --without-headers |&amp; tee configure.log
make all-gcc -j4 |&amp; tee make-all-gcc.log
make all-target-libgcc -j4 |&amp; tee make-all-target-libgcc.log
sudo make install-gcc |&amp; tee make-install-gcc.log
sudo make install-target-libgcc |&amp; tee make-install-target-libgcc.log


<span style="color: #6272a4;"># </span><span style="color: #6272a4;">rm -rf $DIR/build-gdb</span>
mkdir -p $<span style="color: #ffc9e8;">DIR</span>/build-gdb
<span style="color: #ffb86c;">cd</span> $<span style="color: #ffc9e8;">DIR</span>/build-gdb
../gdb-11.2/configure --target=$<span style="color: #ffc9e8;">TARGET</span> --prefix=$<span style="color: #ffc9e8;">PREFIX</span> --program-prefix=i386-elf-
make -j4 |&amp; tee make.log
sudo make install |&amp; tee install.log
</pre>
</div>
</div>
</div>

<div id="outline-container-org04cd474" class="outline-4">
<h4 id="org04cd474"><span class="section-number-4">1.1.3.</span> Tmux 管理终端会话</h4>
<div class="outline-text-4" id="text-1-1-3">
<p>
基本配置 ~/.tmux.conf
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">set</span> -g mouse on
<span style="color: #ffb86c;">set</span> -g default-terminal <span style="color: #f1fa8c;">"xterm-256color"</span>
<span style="color: #ffb86c;">set</span> -g escape-time 0
</pre>
</div>

<p>
使用 <code>Ctrl-b :</code> 可以进入命令模式执行命令
使用 <code>Ctrl-b ?</code> 可以进入查看快捷键绑定
</p>
</div>
</div>

<div id="outline-container-org9aaf3bf" class="outline-4">
<h4 id="org9aaf3bf"><span class="section-number-4">1.1.4.</span> 处理 json 字符串</h4>
<div class="outline-text-4" id="text-1-1-4">
<ul class="org-ul">
<li>fromjson 字符串 =&gt; 对象</li>
<li>tojson 对象 =&gt; 字符串</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh">cat a.json | jq <span style="color: #f1fa8c;">'.str | fromjson | .[0] | tojson'</span>
</pre>
</div>

<p>
unqoute string, jq 使用 <code>-r</code> 选项可以去掉字符串中的双引号, <a href="https://github.com/jqlang/jq/issues/1735">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">echo</span> <span style="color: #f1fa8c;">'{"a": "val01", "b": 1}'</span> | jq <span style="color: #f1fa8c;">'.a'</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">echo</span> <span style="color: #f1fa8c;">'{"a": "val01", "b": 1}'</span> | jq -r <span style="color: #f1fa8c;">'.a'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org32296a9" class="outline-4">
<h4 id="org32296a9"><span class="section-number-4">1.1.5.</span> qemu</h4>
<div class="outline-text-4" id="text-1-1-5">
<ul class="org-ul">
<li>qemu 使用示例教程 <a href="https://www.poftut.com/qemu-tutorial/">link</a></li>
</ul>

<p>
安装 qemu
</p>
<div class="org-src-container">
<pre class="src src-sh">apt install -y qemu-system
</pre>
</div>

<p>
创建硬盘镜像文件
</p>
<div class="org-src-container">
<pre class="src src-sh">qemu-img create myvm.qcow2 16G
</pre>
</div>

<p>
安装 minix 系统
</p>
<div class="org-src-container">
<pre class="src src-sh">qemu-system-x86_64 -boot d -cdrom minix_R3.3.0-588a35b.iso -m 1024 -hda myvm.qcow2
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">Ctrl-A x &#36864;&#20986; QEMU &#30028;&#38754;</span>
qemu-system-x86_64 -nographic -boot d -cdrom minix_R3.3.0-588a35b.iso -m 1024 -hda myvm.qcow2
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd951825" class="outline-4">
<h4 id="orgd951825"><span class="section-number-4">1.1.6.</span> bochs</h4>
<div class="outline-text-4" id="text-1-1-6">
</div>
<ol class="org-ol">
<li><a id="org7ac1317"></a>bochs 安装及配置<br />
<div class="outline-text-5" id="text-1-1-6-1">
<p>
源码编译安装 <a href="https://wiki.osdev.org/Bochs">OSDev link</a> | <a href="https://github.com/bochs-emu/Bochs">Github</a> | <a href="https://sourceforge.net/projects/bochs/files/bochs/2.7/">bochs 2.7</a>
官方编译手册 <a href="https://bochs.sourceforge.io/doc/docbook/user/compiling.html">Compiling Bochs</a> | <a href="https://rayanfam.com/topics/bochs-config-and-build-on-windows-and-os-x/">build on macosx</a>
</p>

<p>
ubuntu 下编译
</p>
<div class="org-src-container">
<pre class="src src-sh">wget -c https://jaist.dl.sourceforge.net/project/bochs/bochs/2.7/bochs-2.7.tar.gz

sudo apt-get install libsdl2-dev

./configure --prefix=/opt/bochs <span style="color: #f1fa8c;">\</span>
            --enable-smp <span style="color: #f1fa8c;">\</span>
            --enable-cpu-level=6 <span style="color: #f1fa8c;">\</span>
            --enable-all-optimizations <span style="color: #f1fa8c;">\</span>
            --enable-x86-64 <span style="color: #f1fa8c;">\</span>
            --enable-pci <span style="color: #f1fa8c;">\</span>
            --enable-vmx <span style="color: #f1fa8c;">\</span>
            --enable-debugger <span style="color: #f1fa8c;">\</span>
            --enable-debugger-gui <span style="color: #f1fa8c;">\</span>
            --enable-logging <span style="color: #f1fa8c;">\</span>
            --enable-fpu <span style="color: #f1fa8c;">\</span>
            --enable-3dnow <span style="color: #f1fa8c;">\</span>
            --enable-sb16=dummy <span style="color: #f1fa8c;">\</span>
            --enable-ne2000 <span style="color: #f1fa8c;">\</span>
            --enable-cdrom <span style="color: #f1fa8c;">\</span>
            --enable-x86-debugger <span style="color: #f1fa8c;">\</span>
            --enable-iodebug <span style="color: #f1fa8c;">\</span>
            --disable-plugins <span style="color: #f1fa8c;">\</span>
            --disable-docbook <span style="color: #f1fa8c;">\</span>
            --with-x --with-x11 --with-term

make

sudo make install
</pre>
</div>

<p>
macos 下编译
</p>
<div class="org-src-container">
<pre class="src src-sh">wget -c https://jaist.dl.sourceforge.net/project/bochs/bochs/2.7/bochs-2.7.tar.gz

brew install sdl2

./configure --prefix=/opt/bochs <span style="color: #f1fa8c;">\</span>
            --enable-smp <span style="color: #f1fa8c;">\</span>
            --enable-cpu-level=6 <span style="color: #f1fa8c;">\</span>
            --enable-all-optimizations <span style="color: #f1fa8c;">\</span>
            --enable-x86-64 <span style="color: #f1fa8c;">\</span>
            --enable-pci <span style="color: #f1fa8c;">\</span>
            --enable-vmx <span style="color: #f1fa8c;">\</span>
            --enable-debugger <span style="color: #f1fa8c;">\</span>
            --enable-debugger-gui <span style="color: #f1fa8c;">\</span>
            --enable-logging <span style="color: #f1fa8c;">\</span>
            --enable-fpu <span style="color: #f1fa8c;">\</span>
            --enable-3dnow <span style="color: #f1fa8c;">\</span>
            --enable-sb16=dummy <span style="color: #f1fa8c;">\</span>
            --enable-cdrom <span style="color: #f1fa8c;">\</span>
            --enable-x86-debugger <span style="color: #f1fa8c;">\</span>
            --enable-iodebug <span style="color: #f1fa8c;">\</span>
            --disable-plugins <span style="color: #f1fa8c;">\</span>
            --disable-docbook <span style="color: #f1fa8c;">\</span>
            --with-term --with-sdl2

make
sudo make install
</pre>
</div>

<p>
添加共享配置
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">BXSHARE</span>=<span style="color: #f1fa8c;">"/opt/bochs/share/bochs"</span>
</pre>
</div>

<p>
bochsrc 配置文件, 设置启动未 1.44 存软盘, 启动镜像名称为 Image
</p>
<div class="org-src-container">
<pre class="src src-text">boot: floppy
floppy_bootsig_check: disabled=0
floppya: 1_44=Image, status=inserted
</pre>
</div>

<p>
全部的配置文件参考如下说明
</p>
<div class="org-src-container">
<pre class="src src-sh">vim /opt/bochs/share/doc/bochs/bochsrc-sample.txt
</pre>
</div>
</div>
</li>

<li><a id="org7c7ef8f"></a>开启图形调试器<br />
<div class="outline-text-5" id="text-1-1-6-2">
<p>
修改配置文件 bochsrc.bxrc
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">Linux</span>
display_library: x, <span style="color: #ffc9e8;">options</span>=<span style="color: #f1fa8c;">"gui_debug"</span>
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">Windows</span>
display_library: win32, <span style="color: #ffc9e8;">options</span>=<span style="color: #f1fa8c;">"gui_debug"</span>
</pre>
</div>
</div>
</li>

<li><a id="orgb0cc585"></a>提取系统文件<br />
<div class="outline-text-5" id="text-1-1-6-3">
<div class="org-src-container">
<pre class="src src-text">[/root]# mdir b:
 Volume in drive B has no label
 Directory for B:/

FIND-3X2 TAZ      218243    2-24-105   2:49p
COMPRESS           74756    2-27-105   2:54p
BOOT     S           335    2-27-105   3:20p
PS012    TAZ       75393    2-28-105  10:15p
HELLO    C            74    7-23-123  12:18a
       5 File(s)     1086976 bytes free
[/root]# mcopy hello.c b:
File "HELLO.C" exists, overwrite (y/n) ? y
Copying HELLO.C
[/root]#
</pre>
</div>

<p>
挂载文件镜像
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo mount -t msdos -o loop diskb.img /mnt
sudo mount -t minix -o loop rootimage-hd.img /mnt
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgd92ec58" class="outline-4">
<h4 id="orgd92ec58"><span class="section-number-4">1.1.7.</span> pandoc 文档格式转换</h4>
<div class="outline-text-4" id="text-1-1-7">
<div class="org-src-container">
<pre class="src src-sh">pandoc --pdf-engine=xelatex <span style="color: #f1fa8c;">\</span>
       --toc --number-sections <span style="color: #f1fa8c;">\</span>
       -V <span style="color: #ffc9e8;">date</span>=<span style="color: #f1fa8c;">"$(date +'%Y-%m-%d %H:%M:%S')"</span> <span style="color: #f1fa8c;">\</span>
       -V <span style="color: #ffc9e8;">author</span>=<span style="color: #f1fa8c;">"Jinghui Hu"</span> <span style="color: #f1fa8c;">\</span>
       -V <span style="color: #ffc9e8;">mainfont</span>=<span style="color: #f1fa8c;">"SimSun"</span> <span style="color: #f1fa8c;">\</span>
       -V <span style="color: #ffc9e8;">documentclass</span>=ctexart <span style="color: #f1fa8c;">\</span>
       -V geometry:<span style="color: #ffc9e8;">margin</span>=<span style="color: #f1fa8c;">'1in'</span> <span style="color: #f1fa8c;">\</span>
       -o tech.pdf tech.org
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org672654c" class="outline-3">
<h3 id="org672654c"><span class="section-number-3">1.2.</span> Emacs</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-orge3e97f4" class="outline-4">
<h4 id="orge3e97f4"><span class="section-number-4">1.2.1.</span> 参考资料</h4>
<div class="outline-text-4" id="text-1-2-1">
<ol class="org-ol">
<li>精选插件列表 <a href="https://github.com/emacs-tw/awesome-emacs">Awesome Emcas</a></li>
<li>Emacs Windows Binary <a href="http://mirrors.ustc.edu.cn/gnu/emacs/windows/">emacs-windows</a></li>
</ol>
</div>
</div>
<div id="outline-container-org747678f" class="outline-4">
<h4 id="org747678f"><span class="section-number-4">1.2.2.</span> 任务管理</h4>
<div class="outline-text-4" id="text-1-2-2">
<ol class="org-ol">
<li>表格 <a href="https://www.gnu.org/software/emacs/manual/html_mono/org.html#The-Spreadsheet">org#The Spreadsheet</a>
<ul class="org-ul">
<li>单元格公式: 输入 <code>:=</code> 后在单元格中直接编辑公式，或者 <code>C-u C-c =</code></li>
<li>列公式: 输入 <code>=</code> 后在单元格中直接编辑公式，或者 <code>C-c =</code></li>
<li>显示坐标: <code>C-c }</code></li>
</ul></li>
<li>绘图 <a href="https://www.gnu.org/software/emacs/manual/html_mono/org.html#Org-Plot">org#Org Plot</a></li>
<li>待办实现管理 <a href="https://www.gnu.org/software/emacs/manual/html_mono/org.html#TODO-dependencies">org#TODO dependencies</a></li>
<li>标签系统 <a href="https://www.gnu.org/software/emacs/manual/html_mono/org.html#Tags">org#Tags</a></li>
<li>代码管理 <a href="https://www.gnu.org/software/emacs/manual/html_mono/org.html#Working-with-Source-Code">org#Working with Source Code</a></li>
<li>buffer 设置 <a href="https://www.gnu.org/software/emacs/manual/html_mono/org.html#In_002dbuffer-Settings">org#In-buffer Settings</a>
<ul class="org-ul">
<li><p>
#+STARTUP: 启动设置
</p>
<blockquote>
</blockquote></li>
</ul></li>
</ol>
</div>
</div>
<div id="outline-container-orgb5f726f" class="outline-4">
<h4 id="orgb5f726f"><span class="section-number-4">1.2.3.</span> graphviz 参考连接</h4>
<div class="outline-text-4" id="text-1-2-3">
<ol class="org-ol">
<li>图库 <a href="http://graphviz.org/gallery/">Gallery</a></li>
<li><a href="../article/drawing-graphs-with-dot.html#MissingReference">文章</a> | 快速入门 <a href="https://www.graphviz.org/pdf/dotguide.pdf">Drawing graphs with dot</a></li>
<li>属性参考文档 <a href="http://www.graphviz.org/doc/info/attrs.html">Attrs</a></li>
</ol>
</div>
</div>

<div id="outline-container-org4be658b" class="outline-4">
<h4 id="org4be658b"><span class="section-number-4">1.2.4.</span> 无向图</h4>
<div class="outline-text-4" id="text-1-2-4">

<div id="orgfa4bb4c" class="figure">
<p><img src="../static/image/2023/0201/000024.png" alt="000024.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org038968e" class="outline-4">
<h4 id="org038968e"><span class="section-number-4">1.2.5.</span> 有向图</h4>
<div class="outline-text-4" id="text-1-2-5">

<div id="org1789c52" class="figure">
<p><img src="../static/image/2023/0201/000219.png" alt="000219.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org634a8d9" class="outline-4">
<h4 id="org634a8d9"><span class="section-number-4">1.2.6.</span> 支持中文</h4>
<div class="outline-text-4" id="text-1-2-6">

<div id="orga15eaaa" class="figure">
<p><img src="../static/image/2023/0201/001233.png" alt="001233.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgcaac8dc" class="outline-4">
<h4 id="orgcaac8dc"><span class="section-number-4">1.2.7.</span> 系统交互图</h4>
<div class="outline-text-4" id="text-1-2-7">

<div id="org2a8a52e" class="figure">
<p><img src="../static/image/2023/0201/001954.png" alt="001954.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-orgd298f15" class="outline-4">
<h4 id="orgd298f15"><span class="section-number-4">1.2.8.</span> plantuml 绘图</h4>
<div class="outline-text-4" id="text-1-2-8">
<p>
<a href="http://eschulte.github.io/babel-dev/DONE-integrate-plantuml-support.html">Tutor</a> | <a href="https://orgmode.org/worg/org-contrib/babel/languages/ob-doc-plantuml.html">Official</a>
</p>
</div>
</div>

<div id="outline-container-orgc338271" class="outline-4">
<h4 id="orgc338271"><span class="section-number-4">1.2.9.</span> 批量删除 ^M 方法</h4>
<div class="outline-text-4" id="text-1-2-9">
<pre class="example" id="orga02a4fd">
M-x replace-string RET C-q C-m RET RET
</pre>
</div>
</div>

<div id="outline-container-orgedcddb4" class="outline-4">
<h4 id="orgedcddb4"><span class="section-number-4">1.2.10.</span> tramp ssh 到远程</h4>
<div class="outline-text-4" id="text-1-2-10">
<p>
配置远端 ~/.ssh/config, 添加别名
</p>
<div class="org-src-container">
<pre class="src src-text">Host gitana
    Hostname gitana.jeanhwea.io
    Port 2222
    User admin
</pre>
</div>

<p>
或者使用如下的 scheme 来访问, <a href="https://www.gnu.org/software/emacs/manual/html_mono/tramp.html#File-name-syntax">tramp#File name syntax</a>
</p>
<pre class="example" id="orge28a445">
M-x find-file /sshx:user@host#port:/path
</pre>
</div>
</div>

<div id="outline-container-orgb2e21a5" class="outline-4">
<h4 id="orgb2e21a5"><span class="section-number-4">1.2.11.</span> 设置文件类型</h4>
<div class="outline-text-4" id="text-1-2-11">
<div class="org-src-container">
<pre class="src src-text"># -*- mode: conf; -*-
</pre>
</div>
</div>
</div>

<div id="outline-container-org40f6286" class="outline-4">
<h4 id="org40f6286"><span class="section-number-4">1.2.12.</span> 设置本地文件配置</h4>
<div class="outline-text-4" id="text-1-2-12">
<p>
.dir-locals.el
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #8d5649;">(</span><span style="color: #d8241f;">(</span>java-mode . <span style="color: #9564bf;">(</span><span style="color: #24a222;">(</span>eval . <span style="color: #ff7f00;">(</span>eglot-ensure<span style="color: #ff7f00;">)</span><span style="color: #24a222;">)</span><span style="color: #9564bf;">)</span><span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaab7d06" class="outline-4">
<h4 id="orgaab7d06"><span class="section-number-4">1.2.13.</span> 编辑二进制文件</h4>
<div class="outline-text-4" id="text-1-2-13">
<pre class="example" id="org41a3532">
M-x hexl-mode
</pre>
</div>
</div>

<div id="outline-container-org2fecc8f" class="outline-4">
<h4 id="org2fecc8f"><span class="section-number-4">1.2.14.</span> elisp 函数增强</h4>
<div class="outline-text-4" id="text-1-2-14">
<ol class="org-ol">
<li>增强 defadvice <a href="https://www.gnu.org/software/emacs/manual/html_mono/elisp.html#Advising-Functions">elisp#Advising Functions</a></li>
<li>闭包 <a href="https://www.gnu.org/software/emacs/manual/html_mono/elisp.html#Closures">elisp#Closures</a></li>
</ol>
</div>
</div>

<div id="outline-container-org2ed35e8" class="outline-4">
<h4 id="org2ed35e8"><span class="section-number-4">1.2.15.</span> 设置文件显示自动换行</h4>
<div class="outline-text-4" id="text-1-2-15">
<pre class="example" id="orgb683020">
M-x toggle-truncate-lines
</pre>
</div>
</div>

<div id="outline-container-orgf326a80" class="outline-4">
<h4 id="orgf326a80"><span class="section-number-4">1.2.16.</span> evil 使用 mark 标记来快速跳转</h4>
<div class="outline-text-4" id="text-1-2-16">
<p>
使用 evil 的 mark 来快速完成文件跳转
</p>
<ul class="org-ul">
<li>m&lt;reg&gt; 设置 mark, 例如: ma, mm</li>
<li>'&lt;reg&gt; 跳转到 mark, 例如: 'a, 'm</li>
<li>:marks 显示所有的 mark</li>
</ul>

<p>
注意: &lt;reg&gt; 区分大小写，小写字母只能在本文件内跳转，大写字母可以实现跨文件跳转
</p>
</div>
</div>

<div id="outline-container-org2e32c4f" class="outline-4">
<h4 id="org2e32c4f"><span class="section-number-4">1.2.17.</span> libvterm 编译失败</h4>
<div class="outline-text-4" id="text-1-2-17">
<pre class="example" id="org7e1266b">
-- System libvterm not found: libvterm will be downloaded and compiled as part of the build process
CMake Error at CMakeLists.txt:71 (message):
  libtool not found.  Please install libtool


-- Configuring incomplete, errors occurred!
See also "/home/jeffrey/.emacs.d/elpa/vterm-20230417.424/build/CMakeFiles/CMakeOutput.log".
make: *** No targets specified and no makefile found.  Stop.
/home/jeffrey/.emacs.d/elpa/vterm-20230417.424
</pre>

<p>
解决方法，安装对应库
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo apt install cmake libtool libtool-bin
</pre>
</div>
</div>
</div>

<div id="outline-container-org94fb7a3" class="outline-4">
<h4 id="org94fb7a3"><span class="section-number-4">1.2.18.</span> profiler 启动性能分析</h4>
<div class="outline-text-4" id="text-1-2-18">
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #6272a4;">;; </span><span style="color: #6272a4;">~/.emacs.d/init.el &#24320;&#22987;</span>
<span style="color: #8d5649;">(</span>profiler-start 'cpu<span style="color: #8d5649;">)</span>

<span style="color: #6272a4;">;; </span><span style="color: #6272a4;">~/.emacs.d/init.el &#32467;&#26463;</span>
<span style="color: #8d5649;">(</span>profiler-stop<span style="color: #8d5649;">)</span>
<span style="color: #8d5649;">(</span>profiler-report<span style="color: #8d5649;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org28e11ae" class="outline-3">
<h3 id="org28e11ae"><span class="section-number-3">1.3.</span> WSL</h3>
<div class="outline-text-3" id="text-1-3">
</div>
<div id="outline-container-org9320257" class="outline-4">
<h4 id="org9320257"><span class="section-number-4">1.3.1.</span> Ubuntu 安装并迁移到其他盘</h4>
<div class="outline-text-4" id="text-1-3-1">
<ol class="org-ol">
<li>安装说明 <a href="https://learn.microsoft.com/zh-cn/windows/wsl/install-manual">link</a></li>
<li><p>
移动数据文件到非系统盘
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#26597;&#30475;&#24403;&#21069;&#30340; wsl &#23481;&#22120;</span>
wsl -l -v

wsl --export Ubuntu ubuntu2204.tar
wsl --unregister Ubuntu

mkdir data
wsl --import Ubuntu-22.04 data ubuntu2204.tar
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-orga55015c" class="outline-4">
<h4 id="orga55015c"><span class="section-number-4">1.3.2.</span> Docker 无法启动</h4>
<div class="outline-text-4" id="text-1-3-2">
<p>
/usr/sbin/iptables-nft 网络管理 WSL2 不支持，需要修改一下
</p>
<div class="org-src-container">
<pre class="src src-sh">$ sudo update-alternatives --config iptables
There are 2 choices for the alternative iptables (providing /usr/sbin/iptables).

  Selection    Path                       Priority   Status
------------------------------------------------------------
* 0            /usr/sbin/iptables-nft      20        auto mode
  1            /usr/sbin/iptables-legacy   10        manual mode
  2            /usr/sbin/iptables-nft      20        manual mode

Press &lt;enter&gt; to keep the current choice[*], or type selection number: 1
update-alternatives: using /usr/sbin/iptables-legacy to provide /usr/sbin/iptables (iptables) <span style="color: #ff79c6;">in</span> manual mode
$ sudo service docker start
 * Starting Docker: docker                                                                                                                                            [ OK ]
$ docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
<div id="outline-container-org8aff357" class="outline-4">
<h4 id="org8aff357"><span class="section-number-4">1.3.3.</span> 缺失字体</h4>
<div class="outline-text-4" id="text-1-3-3">
<p>
默认添加 Windows 自带的字体来显示缺失字体
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo ln -s /mnt/c/Windows/Fonts /usr/share/fonts/host
fc-cache -fv
</pre>
</div>
</div>
</div>

<div id="outline-container-org285e55d" class="outline-4">
<h4 id="org285e55d"><span class="section-number-4">1.3.4.</span> 挂载共享服务器</h4>
<div class="outline-text-4" id="text-1-3-4">
<div class="org-src-container">
<pre class="src src-sh">sudo mount -t drvfs <span style="color: #f1fa8c;">'\\192.168.0.201\&#24320;&#21457;&#26381;&#21153;&#22120;&#20849;&#20139;'</span> /mnt/share
</pre>
</div>
</div>
</div>
<div id="outline-container-org2e20aad" class="outline-4">
<h4 id="org2e20aad"><span class="section-number-4">1.3.5.</span> 解决提示符错误</h4>
<div class="outline-text-4" id="text-1-3-5">
<p>
Windows Terminal 在安装 zsh-autosuggestions 时会显示的有问题，这里修改一下 <code>PS1</code>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffc9e8;">ZSH_THEME</span>=<span style="color: #f1fa8c;">"none"</span>
<span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">PS1</span>=<span style="color: #f1fa8c;">'WSL(%3~)%# '</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org7bfbbda" class="outline-4">
<h4 id="org7bfbbda"><span class="section-number-4">1.3.6.</span> 下载 firefox</h4>
<div class="outline-text-4" id="text-1-3-6">
<p>
删除 snap 组件
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo snap remove firefox
sudo apt remove firefox
sudo add-apt-repository ppa:mozillateam/ppa
</pre>
</div>

<p>
配置下载 firefox 的配置
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">Create a new file, it should be empty as it opens:</span>
sudo vi /etc/apt/preferences.d/mozillateamppa

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">Insert these lines, then save and exit</span>
Package: firefox*
Pin: release <span style="color: #ffc9e8;">o</span>=LP-PPA-mozillateam
Pin-Priority: 501
</pre>
</div>

<p>
下载 firefox
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo apt update
sudo apt install firefox <span style="color: #6272a4;"># </span><span style="color: #6272a4;">or firefox-esr</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org805912a" class="outline-3">
<h3 id="org805912a"><span class="section-number-3">1.4.</span> CentOS</h3>
<div class="outline-text-3" id="text-1-4">
</div>
<div id="outline-container-orgf14452f" class="outline-4">
<h4 id="orgf14452f"><span class="section-number-4">1.4.1.</span> 配置网络</h4>
<div class="outline-text-4" id="text-1-4-1">
<p>
/etc/sysconfig/network-scripts
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #ffc9e8;">TYPE</span>=Ethernet
<span style="color: #ffc9e8;">PROXY_METHOD</span>=none
<span style="color: #ffc9e8;">BROWSER_ONLY</span>=no
<span style="color: #ffc9e8;">BOOTPROTO</span>=none
<span style="color: #ffc9e8;">DEFROUTE</span>=yes
<span style="color: #ffc9e8;">IPV4_FAILURE_FATAL</span>=no
<span style="color: #ffc9e8;">IPV6INIT</span>=yes
<span style="color: #ffc9e8;">IPV6_AUTOCONF</span>=yes
<span style="color: #ffc9e8;">IPV6_DEFROUTE</span>=yes
<span style="color: #ffc9e8;">IPV6_FAILURE_FATAL</span>=no
<span style="color: #ffc9e8;">IPV6_ADDR_GEN_MODE</span>=stable-privacy
<span style="color: #ffc9e8;">NAME</span>=eno1
<span style="color: #ffc9e8;">DEVICE</span>=eno1
<span style="color: #ffc9e8;">ONBOOT</span>=yes
<span style="color: #ffc9e8;">IPADDR</span>=192.168.0.123
<span style="color: #ffc9e8;">PREFIX</span>=24
<span style="color: #ffc9e8;">GATEWAY</span>=192.168.0.1
<span style="color: #ffc9e8;">IPV6_PRIVACY</span>=no
<span style="color: #ffc9e8;">DNS1</span>=192.168.0.1
<span style="color: #ffc9e8;">DNS2</span>=114.114.114.114
</pre>
</div>

<p>
配置网络工具
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">TUI &#24037;&#20855;</span>
nmtui
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21629;&#20196;&#34892;&#24037;&#20855;</span>
nmcli
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdc98b63" class="outline-4">
<h4 id="orgdc98b63"><span class="section-number-4">1.4.2.</span> 设置防火墙 firewall</h4>
<div class="outline-text-4" id="text-1-4-2">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#33719;&#21462; zone</span>
firewall-cmd --get-active-zones
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#26597;&#30475;&#35268;&#21017;</span>
firewall-cmd --list-all
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#28155;&#21152;&#32593;&#32476;&#25509;&#21475;&#30333;&#21517;&#21333;</span>
firewall-cmd --permanent --zone=block --change-interface=enp1s0
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#28155;&#21152; tcp &#31471;&#21475;&#30333;&#21517;&#21333;</span>
firewall-cmd --permanent --zone=public --add-port=3306/tcp
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#24212;&#29992;&#37197;&#32622;</span>
firewall-cmd --reload
</pre>
</div>
</div>
</div>
<div id="outline-container-org417f726" class="outline-4">
<h4 id="org417f726"><span class="section-number-4">1.4.3.</span> SCL (Software Collection)</h4>
<div class="outline-text-4" id="text-1-4-3">
<p>
SCL 提供一下较新的工具集 <a href="https://wiki.centos.org/AdditionalResources/Repositories/SCL">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sql">yum install centos-release-scl

yum makecache
yum repolist
</pre>
</div>
</div>
</div>

<div id="outline-container-orgac0fbfc" class="outline-4">
<h4 id="orgac0fbfc"><span class="section-number-4">1.4.4.</span> Red Hat Developer Toolset</h4>
<div class="outline-text-4" id="text-1-4-4">
<ol class="org-ol">
<li><p>
使用手册 <a href="https://access.redhat.com/documentation/en-us/red_hat_developer_toolset/11/html-single/user_guide/index#doc-wrapper">User Guide</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">yum install scl-utils centos-release-scl

yum list all --enablerepo=<span style="color: #f1fa8c;">'centos-sclo-rh'</span> | grep <span style="color: #f1fa8c;">"devtoolset"</span>
yum install devtoolset-11-toolchain
</pre>
</div></li>
<li><p>
配置并启用 scl 工具集
</p>
<div class="org-src-container">
<pre class="src src-sh">scl --list
scl enable devtoolset-11 bash
</pre>
</div></li>
</ol>
</div>
</div>

<div id="outline-container-orgf912e46" class="outline-4">
<h4 id="orgf912e46"><span class="section-number-4">1.4.5.</span> yum 代理</h4>
<div class="outline-text-4" id="text-1-4-5">
<p>
在配置文件中直接添加代理到对应发服务器中
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">/etc/yum.conf</span>
[<span style="color: #bd93f9;">main</span>]
<span style="color: #ffc9e8;">proxy</span>=http://192.168.0.100:3128
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf2b506e" class="outline-4">
<h4 id="orgf2b506e"><span class="section-number-4">1.4.6.</span> nodejs</h4>
<div class="outline-text-4" id="text-1-4-6">
<p>
centos 7 中编译安装 nodejs
</p>
<div class="org-src-container">
<pre class="src src-sh">wget -c https://registry.npmmirror.com/-/binary/node/v18.17.1/node-v18.17.1.tar.gz

tar xzvf ~/down/node-v18.17.1.tar.gz

scl enable devtoolset-11 bash

<span style="color: #ffb86c;">cd</span> node-v18.17.1
<span style="color: #ffc9e8;">PREFIX</span>=/opt/node ./configure
make -j4
sudo make install
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc1df497" class="outline-4">
<h4 id="orgc1df497"><span class="section-number-4">1.4.7.</span> 编译安装 openssl</h4>
<div class="outline-text-4" id="text-1-4-7">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#32534;&#35793;&#23433;&#35013;</span>
wget -c https://www.openssl.org/source/openssl-1.1.1w.tar.gz
tar xzvf ~/down/openssl-1.1.1w.tar.gz
<span style="color: #ffb86c;">cd</span> openssl-1.1.1w/
./config --prefix=/usr/local/openssl --openssldir=/usr/local/openssl
make
sudo make install

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#37197;&#32622; ldconfig</span>
sudo echo <span style="color: #f1fa8c;">"/usr/local/openssl/lib"</span> &gt; /etc/ld.so.conf.d/openssl.conf
sudo ldconfig
</pre>
</div>

<p>
配置环境变量
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">PATH</span>=/usr/local/openssl/bin:$<span style="color: #ffc9e8;">PATH</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf65bf83" class="outline-4">
<h4 id="orgf65bf83"><span class="section-number-4">1.4.8.</span> 代理服务器 squid</h4>
<div class="outline-text-4" id="text-1-4-8">
<p>
http proxy server
其配置文件 /etc/squid/squid.conf
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">Squid normally listens to port 3128</span>
http_port 3128

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">Example rule allowing access from your local networks.</span>
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">Adapt to list your (internal) IP networks from where browsing</span>
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">should be allowed</span>
acl localnet src 10.0.0.0/8             <span style="color: #6272a4;"># </span><span style="color: #6272a4;">RFC 1918 local private network (LAN)</span>
acl localnet src 100.64.0.0/10          <span style="color: #6272a4;"># </span><span style="color: #6272a4;">RFC 6598 shared address space (CGN)</span>
acl localnet src 192.168.0.0/16         <span style="color: #6272a4;"># </span><span style="color: #6272a4;">RFC 1918 local private network (LAN)</span>
</pre>
</div>

<p>
在宿主机进行代理设置
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">proxy</span>=http://0.0.0.0:3128
<span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">http_proxy</span>=http://0.0.0.0:3128
<span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">https_proxy</span>=http://0.0.0.0:3128
</pre>
</div>
</div>
</div>

<div id="outline-container-org0833c74" class="outline-4">
<h4 id="org0833c74"><span class="section-number-4">1.4.9.</span> DNS Server 配置 dnsmasq</h4>
<div class="outline-text-4" id="text-1-4-9">
<p>
配置上游的 DNS 服务器
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">/etc/dnsmasq.conf</span>
<span style="color: #ffc9e8;">server</span>=/localnet/192.168.1.1
</pre>
</div>

<p>
开启服务
</p>
<div class="org-src-container">
<pre class="src src-sh">systemctl enable dnsmasq
systemctl restart dnsmasq
</pre>
</div>
</div>
</div>

<div id="outline-container-org40a6b69" class="outline-4">
<h4 id="org40a6b69"><span class="section-number-4">1.4.10.</span> NTP 时间服务器设置</h4>
<div class="outline-text-4" id="text-1-4-10">
<p>
配置自动同步时间
</p>
<div class="org-src-container">
<pre class="src src-sh">timedatectl set-timezone <span style="color: #f1fa8c;">'Asia/Shanghai'</span>
timedatectl set-ntp yes

timedatectl
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">ntpq -p</span>
</pre>
</div>

<p>
离线手工同步时间
</p>
<div class="org-src-container">
<pre class="src src-sh">timedatectl set-ntp no
timedatectl set-time <span style="color: #f1fa8c;">'08:12:21'</span>

hwclock -w
</pre>
</div>
</div>
</div>

<div id="outline-container-orgacabcf5" class="outline-4">
<h4 id="orgacabcf5"><span class="section-number-4">1.4.11.</span> 硬件时钟 hwclock</h4>
<div class="outline-text-4" id="text-1-4-11">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">Display hwclock</span>
hwclock --show

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">Sync hwclock to system</span>
hwclock --hctosys

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">Save clock, for reboot</span>
clock -w
hwclock -w
</pre>
</div>
</div>
</div>

<div id="outline-container-org534b8a6" class="outline-4">
<h4 id="org534b8a6"><span class="section-number-4">1.4.12.</span> 安装中文字体</h4>
<div class="outline-text-4" id="text-1-4-12">
<p>
修改配置文件
</p>
<div class="org-src-container">
<pre class="src src-sh">vim /etc/fonts/fonts.conf
</pre>
</div>

<p>
添加字体文件目录配置
</p>
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #6272a4;">&lt;!-- </span><span style="color: #6272a4;">Font directory list</span><span style="color: #6272a4;"> --&gt;</span>

        &lt;<span style="color: #50fa7b;">dir</span>&gt;/usr/share/fonts&lt;/<span style="color: #50fa7b;">dir</span>&gt;
        &lt;<span style="color: #50fa7b;">dir</span>&gt;/usr/share/fonts/Fonts/&lt;/<span style="color: #50fa7b;">dir</span>&gt;
        &lt;<span style="color: #50fa7b;">dir</span>&gt;/usr/share/X11/fonts/Type1&lt;/<span style="color: #50fa7b;">dir</span>&gt;
        &lt;<span style="color: #50fa7b;">dir</span>&gt;/usr/share/X11/fonts/TTF&lt;/<span style="color: #50fa7b;">dir</span>&gt;
        &lt;<span style="color: #50fa7b;">dir</span>&gt;/usr/local/share/fonts&lt;/<span style="color: #50fa7b;">dir</span>&gt;
        &lt;<span style="color: #50fa7b;">dir</span> <span style="color: #ffc9e8;">prefix</span>=<span style="color: #f1fa8c;">"xdg"</span>&gt;fonts&lt;/<span style="color: #50fa7b;">dir</span>&gt;
        <span style="color: #6272a4;">&lt;!-- </span><span style="color: #6272a4;">the following element will be removed in the future</span><span style="color: #6272a4;"> --&gt;</span>
        &lt;<span style="color: #50fa7b;">dir</span>&gt;~/.fonts&lt;/<span style="color: #50fa7b;">dir</span>&gt;
</pre>
</div>

<p>
使用命令刷新字体缓存
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">cd</span> /usr/share/fonts
tar xzvf fonts.tar.gz
fc-cache -fv
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#26597;&#30475;&#20013;&#25991;&#23383;&#20307;</span>
fc-list :<span style="color: #ffc9e8;">lang</span>=zh
</pre>
</div>

<p>
如果发现找不到字体配置文件，需要手工添加环境变量
Fontconfig error: Cannot load default config file
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">FONTCONFIG_PATH</span>=/etc/fonts
</pre>
</div>
</div>
</div>

<div id="outline-container-org8c12418" class="outline-4">
<h4 id="org8c12418"><span class="section-number-4">1.4.13.</span> 文件挂载</h4>
<div class="outline-text-4" id="text-1-4-13">
<p>
编辑 /etc/fstab 配置系统启动挂载文件配置
</p>
<div class="org-src-container">
<pre class="src src-conf">/dev/sdb1       /data ext4      defaults        0       0
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb643160" class="outline-3">
<h3 id="orgb643160"><span class="section-number-3">1.5.</span> 工具链</h3>
<div class="outline-text-3" id="text-1-5">
</div>
<div id="outline-container-org81b5716" class="outline-4">
<h4 id="org81b5716"><span class="section-number-4">1.5.1.</span> ohmyzsh</h4>
<div class="outline-text-4" id="text-1-5-1">
<ol class="org-ol">
<li><p>
源码安装 <a href="https://ohmyz.sh">ohmyz.sh</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">git clone https://githubfast.com/ohmyzsh/ohmyzsh.git
./tools/install.sh
</pre>
</div></li>
<li><p>
一些配置备忘
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">source</span> ~/code/jeanhwea/dome/env/env.sh
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-org49f5db4" class="outline-4">
<h4 id="org49f5db4"><span class="section-number-4">1.5.2.</span> HomeBrew</h4>
<div class="outline-text-4" id="text-1-5-2">
<ol class="org-ol">
<li><p>
安装 <a href="https://brew.sh">brew.sh</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#26041;&#26696;&#19968;</span>
/bin/bash -c <span style="color: #f1fa8c;">"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"</span>
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#26041;&#26696;&#20108;</span>
git clone https://github.com/Homebrew/install.git
./install/install.sh
</pre>
</div></li>
<li><p>
清华镜像 <a href="https://mirrors.tuna.tsinghua.edu.cn/help/homebrew-bottles/">tuna</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">HOMEBREW_BOTTLE_DOMAIN</span>=<span style="color: #f1fa8c;">"https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles"</span>
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-org1b90de6" class="outline-4">
<h4 id="org1b90de6"><span class="section-number-4">1.5.3.</span> LSP</h4>
<div class="outline-text-4" id="text-1-5-3">
<p>
Java LSP 服务
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#23433;&#35013; jdtls</span>
git clone https://github.com/eruizc-dev/jdtls-launcher.git
./install.sh

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#26356;&#26032; jdtls</span>
jdtls --update
jdtls --version

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#28165;&#29702; jdtls &#32531;&#23384;&#30446;&#24405;</span>
rm -rvf ~/.cache/jdtls-workspace
</pre>
</div>

<p>
TypeScript LSP 服务 | <a href="https://githubfast.com/typescript-language-server/typescript-language-server">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">npm install -g typescript-language-server typescript
</pre>
</div>

<p>
Python LSP 服务
</p>
<div class="org-src-container">
<pre class="src src-sh">pip install --user yapf
pip install --user <span style="color: #f1fa8c;">"python-lsp-server[yapf]"</span>
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#19968;&#27425;&#23433;&#35013;&#25152;&#26377;&#30340; LSP &#20381;&#36182;</span>
pip install --user <span style="color: #f1fa8c;">"python-lsp-server[all]"</span>
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#25991;&#20214;&#26684;&#24335;&#21270;</span>
pip install --user black
pip install --user isort
</pre>
</div>

<p>
MacOS 上安装过后出现一些诡异问题, pylsp 命令找不到，发现是 brew install python3
时对应的 bin 文件夹在一个奇怪的位置
</p>
<div class="org-src-container">
<pre class="src src-sh">$ pylsp
zsh: command not found: pylsp
$ pip uninstall  <span style="color: #f1fa8c;">"python-lsp-server[all]"</span>

Found existing installation: python-lsp-server 1.7.4
Uninstalling python-lsp-server-1.7.4:
  Would remove:
    /Users/hujinghui/Library/Python/3.11/bin/pylsp
    /Users/hujinghui/Library/Python/3.11/lib/python/site-packages/pylsp/*
    /Users/hujinghui/Library/Python/3.11/lib/python/site-packages/python_lsp_server-1.7.4.dist-info/*
<span style="color: #50fa7b;">Proceed</span> (Y/n)? n
$ ls /Users/hujinghui/Library/Python/3.11/bin/
autopep8  flake8     get_objgraph  isort-identify-imports  pydocstyle  pylint         pylsp      symilar  yapf
epylint   get_gprof  isort         pycodestyle             pyflakes    pylint-config  pyreverse  undill   yapf-diff
$
</pre>
</div>

<p>
修改 PATH 解决
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">PATH</span>=~/Library/Python/3.11/bin:$<span style="color: #ffc9e8;">PATH</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfbcfc92" class="outline-4">
<h4 id="orgfbcfc92"><span class="section-number-4">1.5.4.</span> autossh</h4>
<div class="outline-text-4" id="text-1-5-4">
<p>
下载源码编译安装 | <a href="https://github.com/Autossh/autossh.git">github</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">git clone https://githubfast.com/Autossh/autossh.git
<span style="color: #ffb86c;">cd</span> autossh
./configure
make
make install
</pre>
</div>

<p>
一些常用命令
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21551;&#21160; ssh</span>
autossh -M monitor_port <span style="color: #f1fa8c;">"ssh_command"</span>
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">do fork</span>
autossh -f -M monitor_port -N <span style="color: #f1fa8c;">"ssh_command"</span>
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">debug</span>
<span style="color: #ffc9e8;">autossh_DEBUG</span>=1 <span style="color: #ffc9e8;">AUTOSSH_LOGFILE</span>=path/to/autossh_log_file.log autossh -f -M monitor_port -v -E path/to/ssh_log_file.log ssh_command
</pre>
</div>
</div>
</div>

<div id="outline-container-orga40dc29" class="outline-4">
<h4 id="orga40dc29"><span class="section-number-4">1.5.5.</span> ctags &amp; cscope</h4>
<div class="outline-text-4" id="text-1-5-5">
</div>
<ol class="org-ol">
<li><a id="org82be035"></a>ctags<br />
<div class="outline-text-5" id="text-1-5-5-1">
<p>
使用命令生成 TAGS 文件
</p>
<div class="org-src-container">
<pre class="src src-sh">ctags -e -R --languages=c,c++ .
</pre>
</div>
</div>
</li>
<li><a id="org32ffbe1"></a>cscope<br />
<div class="outline-text-5" id="text-1-5-5-2">
<p>
生成数据库文件 | <a href="https://cscope.sourceforge.net/">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">find . -name <span style="color: #f1fa8c;">"*.c"</span> -o -name <span style="color: #f1fa8c;">"*.cpp"</span> -o -name <span style="color: #f1fa8c;">"*.h"</span> -o -name <span style="color: #f1fa8c;">"*.hpp"</span> &gt; cscope.files
cscope -q -R -b -i cscope.files
</pre>
</div>

<p>
查询相关的数据
</p>
<div class="org-src-container">
<pre class="src src-sh">cscope -d
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgf10b4e6" class="outline-4">
<h4 id="orgf10b4e6"><span class="section-number-4">1.5.6.</span> gdb &amp; lldb</h4>
<div class="outline-text-4" id="text-1-5-6">
</div>
<ol class="org-ol">
<li><a id="orgb292a3f"></a>参考资料及链接<br />
<div class="outline-text-5" id="text-1-5-6-1">
<ol class="org-ol">
<li><a href="https://lldb.llvm.org/use/map.html">LLDB &lt;-&gt; GDB</a></li>
<li><a href="https://github.com/hellogcc/100-gdb-tips">GDB 小技巧</a> | <a href="https://sourceware.org/gdb/onlinedocs/gdb/">GDB 在线手册</a></li>
<li>视频 <a href="https://www.youtube.com/watch?v=svG6OPyKsrw">GDB Tutorial</a></li>
</ol>
</div>
</li>
<li><a id="orgd45bb4d"></a>gdb 开启 TUI<br />
<div class="outline-text-5" id="text-1-5-6-2">
<ol class="org-ol">
<li>开启汇编窗口 layout asm</li>
<li>开启寄存器窗口 layout regs</li>
<li>布局循环 layout next/prev</li>
<li>打印 32 个汇编指令 x/32i $pc</li>
</ol>
</div>
</li>
<li><a id="orga256f78"></a>进程启动: run &amp; attach<br />
<div class="outline-text-5" id="text-1-5-6-3">
<p>
直接在命令行参数 attach 进程
</p>
<div class="org-src-container">
<pre class="src src-sh">gdb -p pid
</pre>
</div>

<p>
方法一：使用 attach 模式调试。首先正常启动重新，然后使用 attach 命令附属到进程上
</p>
<div class="org-src-container">
<pre class="src src-sh">(lldb) attach -p 18616
(gdb) attach 18616
</pre>
</div>

<p>
方法二：直接 run 启动进程
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#25351;&#23450;&#21551;&#21160;&#25991;&#20214;</span>
(lldb/gdb) file &lt;binary&gt;

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#30452;&#25509; run &#21551;&#21160;&#36827;&#31243;</span>
(lldb/gdb) <span style="color: #ffb86c;">r</span>
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#28155;&#21152;&#21551;&#21160;&#21442;&#25968;</span>
(lldb/gdb) <span style="color: #ffb86c;">r</span> args1 args2 ...
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#26597;&#30475;&#21442;&#25968;</span>
(gdb) show args
(lldb) settings show target.run-args
</pre>
</div>

<div id="org95e02a8" class="figure">
<p><img src="../static/image/2023/0205/131917.png" alt="131917.png" />
</p>
</div>
</div>
</li>

<li><a id="orgdf7b7c3"></a>设置断点 breakpoint<br />
<div class="outline-text-5" id="text-1-5-6-4">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#26222;&#36890;&#26029;&#28857;</span>
b main
b main.cc:12
b 12
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#26465;&#20214;&#26029;&#28857;</span>
(gdb) b 34 if <span style="color: #ffc9e8;">i</span> = 10
(gdb) <span style="color: #ff79c6;">break</span> foo if strcmp(y,<span style="color: #f1fa8c;">"hello"</span>) == 0
(lldb) breakpoint set --name foo --condition <span style="color: #f1fa8c;">'(int)strcmp(y,"hello") == 0'</span>
(lldb) br s -n foo -c <span style="color: #f1fa8c;">'(int)strcmp(y,"hello") == 0'</span>
(lldb) br s -n read_page -c <span style="color: #f1fa8c;">'m_page_id.space()==56'</span>
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#20020;&#26102;&#26029;&#28857;: &#20020;&#26102;&#26029;&#28857;&#25191;&#34892;&#19968;&#27425;&#21518;&#33258;&#21160;&#38144;&#27585;</span>
tb main
</pre>
</div>

<p>
启用/禁用断点 disable/enable
</p>
<pre class="example" id="org40086ff">
(gdb) info b
Num     Type           Disp Enb Address            What
1       breakpoint     keep y   0x000000000331276b in dispatch_command(THD*, COM_DATA const*, enum_server_command)
(gdb) dis 1 # 禁用断点
(gdb) info b
Num     Type           Disp Enb Address            What
1       breakpoint     keep n   0x000000000331276b in dispatch_command(THD*, COM_DATA const*, enum_server_command)
(gdb) ena 1 # 启用断点
(gdb) i b
Num     Type           Disp Enb Address            What
1       breakpoint     keep y   0x000000000331276b in dispatch_command(THD*, COM_DATA const*, enum_server_command)
</pre>
</div>
</li>

<li><a id="org0ab0c68"></a>流程控制 step &amp; next &amp; continue<br />
<div class="outline-text-5" id="text-1-5-6-5">
<ol class="org-ol">
<li>step 单步调试，不进入函数</li>
<li>next 单步调试，进入函数</li>
<li><p>
continue 继续执行
</p>
<div class="org-src-container">
<pre class="src src-sh">s <span style="color: #6272a4;"># </span><span style="color: #6272a4;">step</span>
n <span style="color: #6272a4;"># </span><span style="color: #6272a4;">next</span>
c <span style="color: #6272a4;"># </span><span style="color: #6272a4;">continue</span>

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">until &#30452;&#25509;&#25191;&#34892;&#21040;&#34892;&#25968;</span>
(gdb) <span style="color: #ff79c6;">until</span> 12
(lldb) thread until 12
</pre>
</div></li>
<li>跳转到指定行
<ul class="org-ul">
<li>条件断点 <code>tb</code> temp breakpoint</li>
<li>until <code>until &lt;line&gt;</code></li>
</ul></li>
<li><p>
返回当前值
</p>
<div class="org-src-container">
<pre class="src src-sh">(gdb) <span style="color: #ff79c6;">return</span> &lt;return expression&gt;
(lldb) thread return &lt;return expression&gt;
</pre>
</div></li>
</ol>
</div>
</li>

<li><a id="org7219b6d"></a>保持断点 &amp; 现场恢复<br />
<div class="outline-text-5" id="text-1-5-6-6">
<p>
GDB 保存断点的方式比较方便，直接保持成一个文本文件后，再应用代码
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#20445;&#25345;&#26029;&#28857;&#21040;&#25991;&#20214;&#20013;</span>
(gdb) save breakpoint mybreak.txt
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#37325;&#26032;&#21152;&#36733;&#20445;&#23384;&#30340;&#26029;&#28857;</span>
(gdb) <span style="color: #ffb86c;">source</span> mybreak.txt
</pre>
</div>

<p>
LLDB 保存断点也有类似的命令，但是保存结果是一个 JSON
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#20445;&#23384;&#26029;&#28857;&#21040; json &#26684;&#24335;&#25991;&#20214;</span>
(lldb) breakpoint write -f dbg001
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#35835;&#21462;&#26029;&#28857;&#21040; json &#26684;&#24335;&#25991;&#20214;</span>
(lldb) breakpoint read -f dbg001
</pre>
</div>

<p>
也可以参考这个答案优化流程 <a href="https://stackoverflow.com/questions/24638515/save-breakpoints-in-lldb">SO</a>
</p>


<div id="org55b5828" class="figure">
<p><img src="../static/image/2023/0205/100837.png" alt="100837.png" />
</p>
</div>
</div>
</li>

<li><a id="orgfb94350"></a>查看/修改变量和内存数据<br />
<div class="outline-text-5" id="text-1-5-6-7">
<ol class="org-ol">
<li><p>
打印变量 print / <a href="https://visualgdb.com/gdbreference/commands/x%20">x-command</a>
</p>
<div class="org-src-container">
<pre class="src src-text">(lldb) p thd-&gt;m_thread_id
(my_thread_id) $1 = 10
(lldb) x/w &amp;$1
0x7fbdc1240188: 0x0000000a
(lldb)
</pre>
</div>
<ul class="org-ul">
<li>o octal</li>
<li>x hexadecimal</li>
<li>d decimal</li>
<li>u unsigned decimal</li>
<li>t binary</li>
<li>f floating point</li>
<li>a address</li>
<li>c char</li>
<li>s string</li>
<li>i instruction</li>
<li>b byte</li>
<li>h halfword (16-bit value)</li>
<li>w word (32-bit value)</li>
<li>g giant word (64-bit value)</li>
</ul></li>
<li><p>
查看内存地址中的数据
</p>
<div class="org-src-container">
<pre class="src src-sh">(lldb) x/8w $<span style="color: #ffc9e8;">0</span> =&gt; &#25171;&#21360;&#22320;&#22336;&#30340;&#25968;&#25454;, &#25171;&#21360; 8 &#26465;&#25968;&#25454;, [w, b] &#34920;&#31034;&#19981;&#21516;&#30340;&#25171;&#21360;&#26041;&#24335;
0x7fbdc123dc00: 0x0916f4d8 0x00000001 0x0916f548 0x00000001
0x7fbdc123dc10: 0x00000000 0x00000000 0xc1240440 0x00007fbd
(lldb) x/8b $<span style="color: #ffc9e8;">0</span>
0x7fbdc123dc00: 0xd8 0xf4 0x16 0x09 0x01 0x00 0x00 0x00
(lldb) x/8x $<span style="color: #ffc9e8;">0</span>
0x7fbdc123dc00: 0xd8 0xf4 0x16 0x09 0x01 0x00 0x00 0x00
</pre>
</div></li>
<li><p>
查看 frame 中变量
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#26597;&#30475;&#23616;&#37096;&#21464;&#37327;</span>
(lldb) frame variable
(lldb) fr v
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#26597;&#30475;&#20840;&#23616;&#21464;&#37327;</span>
(lldb) target variable
(lldb) ta v
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#26597;&#30475;&#35843;&#29992;&#26632; thread backtrace</span>
(lldb/gdb) bt
</pre>
</div></li>
</ol>
</div>
</li>

<li><a id="orgde4331a"></a>调试时显示下一条汇编<br />
<div class="outline-text-5" id="text-1-5-6-8">
<p>
开启显示下一条汇编
</p>
<pre class="example" id="org233f535">
set disassemble-next-line on
</pre>

<p>
查看是否开启成功
</p>
<pre class="example" id="orgffd880b">
show disassemble-next-line
</pre>
</div>
</li>

<li><a id="org7f8819c"></a>命令行启动时执行命令 -ex<br />
<div class="outline-text-5" id="text-1-5-6-9">
<div class="org-src-container">
<pre class="src src-sh">gdb -ex <span style="color: #f1fa8c;">"target remote :1234"</span> -ex <span style="color: #f1fa8c;">"b *0x7c00"</span> -ex <span style="color: #f1fa8c;">"c"</span>
</pre>
</div>
</div>
</li>

<li><a id="orgf79dd7b"></a>MacOS: 证书错误问题 <a href="https://timnash.co.uk/getting-gdb-to-semi-reliably-work-on-mojave-macos/">(^-^)</a><br />
<div class="outline-text-5" id="text-1-5-6-10">
<blockquote>
<p>
please check gdb is codesigned - see taskgated(8)
</p>
</blockquote>
<p>
手工编写 gdb.xml
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #ff79c6;">?xml</span> <span style="color: #ffc9e8;">version</span>="1.0" <span style="color: #ffc9e8;">encoding</span>="UTF-8"?&gt;
&lt;<span style="color: #ff79c6;">!DOCTYPE</span> plist PUBLIC "-//Apple//DTD PLIST 1.0//EN"
"http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;<span style="color: #50fa7b;">plist</span> <span style="color: #ffc9e8;">version</span>=<span style="color: #f1fa8c;">"1.0"</span>&gt;
&lt;<span style="color: #50fa7b;">dict</span>&gt;
    &lt;<span style="color: #50fa7b;">key</span>&gt;com.apple.security.cs.allow-jit&lt;/<span style="color: #50fa7b;">key</span>&gt;
    &lt;<span style="color: #50fa7b;">true</span>/&gt;
    &lt;<span style="color: #50fa7b;">key</span>&gt;com.apple.security.cs.allow-unsigned-executable-memory&lt;/<span style="color: #50fa7b;">key</span>&gt;
    &lt;<span style="color: #50fa7b;">true</span>/&gt;
    &lt;<span style="color: #50fa7b;">key</span>&gt;com.apple.security.cs.allow-dyld-environment-variables&lt;/<span style="color: #50fa7b;">key</span>&gt;
    &lt;<span style="color: #50fa7b;">true</span>/&gt;
    &lt;<span style="color: #50fa7b;">key</span>&gt;com.apple.security.cs.disable-library-validation&lt;/<span style="color: #50fa7b;">key</span>&gt;
    &lt;<span style="color: #50fa7b;">true</span>/&gt;
    &lt;<span style="color: #50fa7b;">key</span>&gt;com.apple.security.cs.disable-executable-page-protection&lt;/<span style="color: #50fa7b;">key</span>&gt;
    &lt;<span style="color: #50fa7b;">true</span>/&gt;
    &lt;<span style="color: #50fa7b;">key</span>&gt;com.apple.security.cs.debugger&lt;/<span style="color: #50fa7b;">key</span>&gt;
    &lt;<span style="color: #50fa7b;">true</span>/&gt;
    &lt;<span style="color: #50fa7b;">key</span>&gt;com.apple.security.get-task-allow&lt;/<span style="color: #50fa7b;">key</span>&gt;
    &lt;<span style="color: #50fa7b;">true</span>/&gt;
&lt;/<span style="color: #50fa7b;">dict</span>&gt;
&lt;/<span style="color: #50fa7b;">plist</span>&gt;
</pre>
</div>
<p>
使用命令给 gdb 添加证书
</p>
<div class="org-src-container">
<pre class="src src-sh">codesign --entitlements gdb.xml -fs gdb-cert /usr/local/bin/gdb
</pre>
</div>

<p>
官网说明 <a href="https://sourceware.org/gdb/wiki/PermissionsDarwin">gdb permission</a>
</p>
</div>
</li>

<li><a id="orga7070af"></a>Remote 'g' packet reply is too long<br />
<div class="outline-text-5" id="text-1-5-6-11">
<p>
解决方法参考 <a href="https://wiki.osdev.org/QEMU_and_GDB_in_long_mode#:~:text=When%20the%20break%20point%20is%20hit%20and%20the,architecture%20names%20in%20those%20two%20%22set%20arch%22%20commands.">link</a>
</p>

<p>
方案一，启动时配置
</p>
<div class="org-src-container">
<pre class="src src-sh">$ gdb
(gdb) <span style="color: #ffb86c;">set</span> arch i386:x86-64:intel
(gdb) target remote localhost:1234
(gdb) symbol-file YOUR_KERNEL_FILE
(gdb) <span style="color: #ff79c6;">break</span> SOME_FUNCTION_IN_LONG_MODE
(gdb) <span style="color: #ff79c6;">continue</span>
</pre>
</div>

<p>
方案二，修补源码, 修改 gdb/remote.c 的代码后重新编译
</p>
<div class="org-src-container">
<pre class="src src-text">--- gdb/remote.c        2016-04-14 11:13:49.962628700 +0300
+++ gdb/remote.c        2016-04-14 11:15:38.257783400 +0300
@@ -7181,8 +7181,28 @@
   buf_len = strlen (rs-&gt;buf);

   /* Further sanity checks, with knowledge of the architecture.  */
+// HACKFIX for changing architectures for qemu. It's ugly. Don't use, unless you have to.
+  // Just a tiny modification of the patch of Matias Vara (http://forum.osdev.org/viewtopic.php?f=13&amp;p=177644)
   if (buf_len &gt; 2 * rsa-&gt;sizeof_g_packet)
-    error (_("Remote 'g' packet reply is too long: %s"), rs-&gt;buf);
+    {
+      warning (_("Assuming long-mode change. [Remote 'g' packet reply is too long: %s]"), rs-&gt;buf);
+      rsa-&gt;sizeof_g_packet = buf_len ;
+
+      for (i = 0; i &lt; gdbarch_num_regs (gdbarch); i++)
+        {
+          if (rsa-&gt;regs[i].pnum == -1)
+            continue;
+
+          if (rsa-&gt;regs[i].offset &gt;= rsa-&gt;sizeof_g_packet)
+            rsa-&gt;regs[i].in_g_packet = 0;
+          else
+            rsa-&gt;regs[i].in_g_packet = 1;
+        }
+
+      // HACKFIX: Make sure at least the lower half of EIP is set correctly, so the proper
+      // breakpoint is recognized (and triggered).
+      rsa-&gt;regs[8].offset = 16*8;
+    }

   /* Save the size of the packet sent to us by the target.  It is used
      as a heuristic when determining the max size of packets that the
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org83cab7d" class="outline-3">
<h3 id="org83cab7d"><span class="section-number-3">1.6.</span> Java</h3>
<div class="outline-text-3" id="text-1-6">
</div>
<div id="outline-container-orge1bf851" class="outline-4">
<h4 id="orge1bf851"><span class="section-number-4">1.6.1.</span> Maven</h4>
<div class="outline-text-4" id="text-1-6-1">
</div>
<ol class="org-ol">
<li><a id="orgf224aee"></a>配置国内下载镜像源<br />
<div class="outline-text-5" id="text-1-6-1-1">
<p>
~/.m2/settings.xml | <a href="https://developer.aliyun.com/mvn/guide">link</a>
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #50fa7b;">servers</span>&gt;
  &lt;<span style="color: #50fa7b;">server</span>&gt;
    &lt;<span style="color: #50fa7b;">id</span>&gt;nexus&lt;/<span style="color: #50fa7b;">id</span>&gt;
    &lt;<span style="color: #50fa7b;">username</span>&gt;user01&lt;/<span style="color: #50fa7b;">username</span>&gt;
    &lt;<span style="color: #50fa7b;">password</span>&gt;passwd&lt;/<span style="color: #50fa7b;">password</span>&gt;
  &lt;/<span style="color: #50fa7b;">server</span>&gt;
&lt;/<span style="color: #50fa7b;">servers</span>&gt;

&lt;<span style="color: #50fa7b;">mirrors</span>&gt;
  &lt;<span style="color: #50fa7b;">mirror</span>&gt;
    &lt;<span style="color: #50fa7b;">id</span>&gt;aliyun&lt;/<span style="color: #50fa7b;">id</span>&gt;
    &lt;<span style="color: #50fa7b;">mirrorOf</span>&gt;*&lt;/<span style="color: #50fa7b;">mirrorOf</span>&gt;
    &lt;<span style="color: #50fa7b;">name</span>&gt;Aliyun Public Repository&lt;/<span style="color: #50fa7b;">name</span>&gt;
    &lt;<span style="color: #50fa7b;">url</span>&gt;https://maven.aliyun.com/repository/public&lt;/<span style="color: #50fa7b;">url</span>&gt;
  &lt;/<span style="color: #50fa7b;">mirror</span>&gt;
&lt;/<span style="color: #50fa7b;">mirrors</span>&gt;
</pre>
</div>
</div>
</li>

<li><a id="org3e43bbc"></a>Nexus 依赖包上传<br />
<div class="outline-text-5" id="text-1-6-1-2">
<p>
新建一个 <code>mavenimport.sh</code> 脚本放到 repository 文件夹下
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;">#</span><span style="color: #6272a4;">!/bin/</span><span style="color: #ff79c6;">bash</span>
<span style="color: #ff79c6;">while </span><span style="color: #ffb86c;">getopts</span> <span style="color: #f1fa8c;">":r:u:p:"</span> opt; <span style="color: #ff79c6;">do</span>
  <span style="color: #ff79c6;">case</span> $<span style="color: #ffc9e8;">opt</span><span style="color: #ff79c6;"> in</span>
    <span style="color: #ffb86c;">r</span>) <span style="color: #ffc9e8;">REPO_URL</span>=<span style="color: #f1fa8c;">"$OPTARG"</span>
       ;;
    u) <span style="color: #ffc9e8;">USERNAME</span>=<span style="color: #f1fa8c;">"$OPTARG"</span>
       ;;
    p) <span style="color: #ffc9e8;">PASSWORD</span>=<span style="color: #f1fa8c;">"$OPTARG"</span>
       ;;
  <span style="color: #ff79c6;">esac</span>
<span style="color: #ff79c6;">done</span>

find . -type f <span style="color: #f1fa8c;">\</span>
     -not -path <span style="color: #f1fa8c;">'*/\.*'</span> <span style="color: #f1fa8c;">\</span>
     -not -path <span style="color: #f1fa8c;">'*/\^archetype\-catalog\.xml*'</span> <span style="color: #f1fa8c;">\</span>
     -not -path <span style="color: #f1fa8c;">'*/\maven\-metadata\-local**\.xml'</span> <span style="color: #f1fa8c;">\</span>
     -not -path <span style="color: #f1fa8c;">'*/\^maven\-metadata\-deployment*\.xml'</span> <span style="color: #f1fa8c;">\</span>
     -exec curl -u $<span style="color: #ffc9e8;">USERNAME</span>:$<span style="color: #ffc9e8;">PASSWORD</span> -X PUT -v -T {} $<span style="color: #ffc9e8;">REPO_URL</span>{} <span style="color: #f1fa8c;">\;</span>

</pre>
</div>

<p>
一般需要上传 release 和 snapshot 两个仓库
</p>
<div class="org-src-container">
<pre class="src src-sh">sh mavenimport.sh -u user -p pass123 -r http://192.168.0.123:8081/repository/maven-releases/
sh mavenimport.sh -u user -p pass123 -r http://192.168.0.123:8081/repository/maven-snapshots/
</pre>
</div>
</div>
</li>
<li><a id="orgb805c32"></a>添加本地 JAR 包<br />
<div class="outline-text-5" id="text-1-6-1-3">
<p>
在 pom.xml 文件中直接添加引用
</p>
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #6272a4;">&lt;!-- </span><span style="color: #6272a4;">&#28155;&#21152;&#25968;&#25454;&#24211;&#39537;&#21160;&#23433;&#35013;&#21253;</span><span style="color: #6272a4;"> --&gt;</span>
&lt;<span style="color: #50fa7b;">dependency</span>&gt;
  &lt;<span style="color: #50fa7b;">groupId</span>&gt;com.oracle&lt;/<span style="color: #50fa7b;">groupId</span>&gt;
  &lt;<span style="color: #50fa7b;">artifactId</span>&gt;ojdbc6&lt;/<span style="color: #50fa7b;">artifactId</span>&gt;
  &lt;<span style="color: #50fa7b;">version</span>&gt;11.2.0.4.0&lt;/<span style="color: #50fa7b;">version</span>&gt;
  &lt;<span style="color: #50fa7b;">scope</span>&gt;system&lt;/<span style="color: #50fa7b;">scope</span>&gt;
  &lt;<span style="color: #50fa7b;">systemPath</span>&gt;${project.basedir}/src/main/resources/lib/ojdbc6.jar&lt;/<span style="color: #50fa7b;">systemPath</span>&gt;
&lt;/<span style="color: #50fa7b;">dependency</span>&gt;
</pre>
</div>
</div>
</li>

<li><a id="org36df19f"></a>添加项目过滤<br />
<div class="outline-text-5" id="text-1-6-1-4">
<p>
在 pom.xml 文件中开启编译过滤
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #50fa7b;">build</span>&gt;
  &lt;<span style="color: #50fa7b;">resources</span>&gt;
    &lt;<span style="color: #50fa7b;">resource</span>&gt;
      &lt;<span style="color: #50fa7b;">directory</span>&gt;src/main/resources&lt;/<span style="color: #50fa7b;">directory</span>&gt;
      &lt;<span style="color: #50fa7b;">filtering</span>&gt;true&lt;/<span style="color: #50fa7b;">filtering</span>&gt;
    &lt;/<span style="color: #50fa7b;">resource</span>&gt;
  &lt;/<span style="color: #50fa7b;">resources</span>&gt;
&lt;/<span style="color: #50fa7b;">build</span>&gt;
</pre>
</div>

<p>
引用 pom.xml 文件中的配置
</p>
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #ffc9e8;">spring</span>:
  <span style="color: #ffc9e8;">application</span>:
    <span style="color: #ffc9e8;">version</span>: @project.version@
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgeeba219" class="outline-4">
<h4 id="orgeeba219"><span class="section-number-4">1.6.2.</span> Spring Framework</h4>
<div class="outline-text-4" id="text-1-6-2">
<ol class="org-ol">
<li>代码 <a href="https://github.com/spring-projects/spring-framework">Source</a> | <a href="https://github.com/Jeanhwea/spring-framework/tree/jh/5.3.25">jh/5.3.25</a></li>
<li><p>
编译 <a href="https://github.com/spring-projects/spring-framework/wiki/Build-from-Source">BUILD</a> =&gt; Java8 切到 5.3 分支
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#32534;&#35793;</span>
./gradlew build
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#36339;&#36807;&#27979;&#35797;&#29992;&#20363;</span>
./gradlew build -x test
</pre>
</div></li>
<li><p>
编译文档, 依赖 asciidoctor
</p>
<div class="org-src-container">
<pre class="src src-sh">./gradlew asciidoctor
</pre>
</div></li>
<li><p>
查看 tasks
</p>
<div class="org-src-container">
<pre class="src src-sh">./gradlew tasks
</pre>
</div></li>
<li><p>
生成代码流量跳转 TAGS
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#29983;&#25104;&#36339;&#36716;&#30340; TAG</span>
ctags -e -R --languages=java .
</pre>
</div></li>
</ol>
</div>
</div>

<div id="outline-container-orgde4ef31" class="outline-4">
<h4 id="orgde4ef31"><span class="section-number-4">1.6.3.</span> Spring Boot</h4>
<div class="outline-text-4" id="text-1-6-3">
</div>
<ol class="org-ol">
<li><a id="org690ee1a"></a>启动传参<br />
<div class="outline-text-5" id="text-1-6-3-1">
<div class="org-src-container">
<pre class="src src-sh">mvn spring-boot:run -Dspring-boot.run.jvmArguments=<span style="color: #f1fa8c;">"-Xdebug -Dfile.encoding=UTF-8"</span>
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgdc8c3bc" class="outline-4">
<h4 id="orgdc8c3bc"><span class="section-number-4">1.6.4.</span> JVM</h4>
<div class="outline-text-4" id="text-1-6-4">
</div>
<ol class="org-ol">
<li><a id="org34317ea"></a>编译 JDK<br />
<div class="outline-text-5" id="text-1-6-4-1">
<ol class="org-ol">
<li>OpenJDK 编译说明 <a href="https://openjdk.org/groups/build/">link</a></li>
<li>JDK 8 编译说明 <a href="https://hg.openjdk.org/jdk8/jdk8/raw-file/tip/README-builds.html">link</a></li>
</ol>
<div class="org-src-container">
<pre class="src src-sh">git clone git@github.com:openjdk/jdk.git
git checkout -b jh/jdk8-b99 jdk8-b99

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#37197;&#32622; &amp; &#32534;&#35793;</span>
<span style="color: #ffc9e8;">MAKE</span>=/usr/bin/make ./configure
<span style="color: #ffc9e8;">JOBS</span>=12 /usr/bin/make all
</pre>
</div>
</div>
</li>
<li><a id="org550e355"></a>垃圾回收<br />
<div class="outline-text-5" id="text-1-6-4-2">
<p>
控制堆内存
</p>
<div class="org-src-container">
<pre class="src src-sh">java -Xss256M -Xms4G -Xmx4G -jar app.jar
</pre>
</div>

<p>
使用 G1 垃圾收集器 (Garbage-First)
</p>
<ul class="org-ul">
<li>MaxGCPauseMillis 回收暂停时间 300 毫秒</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh">java -XX:+UseG1GC -XX:<span style="color: #ffc9e8;">MaxGCPauseMillis</span>=300 -jar app.jar
</pre>
</div>

<p>
打印 GC 日志，方便调试
</p>
<div class="org-src-container">
<pre class="src src-sh">java -Xloggc:/app/log/gc.log -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+PrintGCDetails -jar app.jar
</pre>
</div>

<p>
G1 打印的日志举例
</p>
<pre class="example" id="org7268221">
OpenJDK 64-Bit Server VM (25.342-b07) for linux-amd64 JRE (1.8.0_342-b07), built on Jul 16 2022 09:19:19 by "openjdk" with gcc 4.4.7 20120313 (Red Hat 4.4.7-23)
Memory: 4k page, physical 32945904k(5742728k free), swap 8257532k(8213756k free)
CommandLine flags: -XX:InitialHeapSize=2147483648 -XX:MaxGCPauseMillis=300 -XX:MaxHeapSize=2147483648 -XX:+PrintGC -XX:+PrintGCDateStamps -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:ThreadStackSize=131072 -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseG1GC
2023-09-22T11:52:27.442+0800: 0.703: [GC pause (G1 Evacuation Pause) (young), 0.0108449 secs]
....
2023-09-22T11:52:31.179+0800: 4.440: [GC remark 2023-09-22T11:52:31.179+0800: 4.440: [Finalize Marking, 0.0026141 secs] 2023-09-22T11:52:31.182+0800: 4.443: [GC ref-proc, 0.0011447 secs] 2023-09-22T11:52:31.183+0800: 4.444: [Unloading, 0.0061893 secs], 0.0105824 secs]
 [Times: user=0.04 sys=0.00, real=0.01 secs]
2023-09-22T11:52:31.190+0800: 4.451: [GC cleanup 16895K-&gt;16895K(2048M), 0.0028270 secs]
 [Times: user=0.01 sys=0.01, real=0.00 secs]
2023-09-22T11:52:34.081+0800: 7.342: [GC pause (Metadata GC Threshold) (young) (initial-mark), 0.0320499 secs]
   [Parallel Time: 26.9 ms, GC Workers: 8]
      [GC Worker Start (ms): Min: 7342.4, Avg: 7343.4, Max: 7346.0, Diff: 3.6]
      [Ext Root Scanning (ms): Min: 5.4, Avg: 7.6, Max: 9.4, Diff: 4.0, Sum: 60.7]
      [Update RS (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.0]
         [Processed Buffers: Min: 0, Avg: 0.0, Max: 0, Diff: 0, Sum: 0]
      [Scan RS (ms): Min: 0.1, Avg: 0.1, Max: 0.3, Diff: 0.2, Sum: 1.1]
      [Code Root Scanning (ms): Min: 0.0, Avg: 3.7, Max: 14.8, Diff: 14.8, Sum: 29.5]
      [Object Copy (ms): Min: 1.8, Avg: 13.9, Max: 17.8, Diff: 16.1, Sum: 111.1]
      [Termination (ms): Min: 0.0, Avg: 0.1, Max: 0.2, Diff: 0.2, Sum: 1.1]
         [Termination Attempts: Min: 1, Avg: 129.5, Max: 186, Diff: 185, Sum: 1036]
      [GC Worker Other (ms): Min: 0.0, Avg: 0.0, Max: 0.1, Diff: 0.0, Sum: 0.2]
      [GC Worker Total (ms): Min: 22.8, Avg: 25.5, Max: 26.4, Diff: 3.6, Sum: 203.8]
      [GC Worker End (ms): Min: 7368.8, Avg: 7368.8, Max: 7368.9, Diff: 0.0]
   [Code Root Fixup: 0.3 ms]
   [Code Root Purge: 0.0 ms]
   [Clear CT: 0.4 ms]
   [Other: 4.5 ms]
      [Choose CSet: 0.0 ms]
      [Ref Proc: 2.8 ms]
      [Ref Enq: 0.1 ms]
      [Redirty Cards: 0.3 ms]
      [Humongous Register: 0.1 ms]
      [Humongous Reclaim: 0.0 ms]
      [Free CSet: 0.7 ms]
   [Eden: 643.0M(1212.0M)-&gt;0.0B(1200.0M) Survivors: 16384.0K-&gt;28672.0K Heap: 658.0M(2048.0M)-&gt;28160.0K(2048.0M)]
 [Times: user=0.14 sys=0.01, real=0.03 secs]
</pre>
</div>
</li>
</ol>
</div>

<div id="outline-container-org0495617" class="outline-4">
<h4 id="org0495617"><span class="section-number-4">1.6.5.</span> SDK Man</h4>
<div class="outline-text-4" id="text-1-6-5">
<ol class="org-ol">
<li>官网 <a href="https://sdkman.io/">link</a></li>
</ol>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#23433;&#35013; SDK Man</span>
curl -s <span style="color: #f1fa8c;">"https://get.sdkman.io"</span> | bash

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#23433;&#35013; JDK</span>
sdk list java
sdk install java 11.0.19-tem
sdk install java 8.0.372-tem
sdk install java 17.0.7-tem

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#31163;&#32447;&#23433;&#35013;, &#21019;&#24314; SDK &#21253;&#20026; 8.0.191-online</span>
sdk install java 8.0.191-online /opt/admin/java
<span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">JAVA_HOME</span>=/opt/admin/java

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#20462;&#25913;&#40664;&#35748; SDK &#29256;&#26412;</span>
sdk list java | grep installed
sdk default java 11.0.19-zulu

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#29615;&#22659;</span>
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21021;&#22987;&#21270;&#29615;&#22659;, &#29983;&#25104; .sdkmanrc</span>
sdk env init
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#23433;&#35013;&#29615;&#22659;</span>
sdk env install
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#20999;&#25442;&#29615;&#22659;</span>
sdk env
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#28165;&#38500;&#29615;&#22659;</span>
sdk env clear


<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#23433;&#35013;&#20854;&#20182; SDK &#24037;&#20855;</span>
sdk install gradle
sdk install java
sdk install hadoop
sdk install ant

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#24378;&#21046;&#26356;&#26032; SDK Man</span>
sdk selfupdate force
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge8b9546" class="outline-3">
<h3 id="orge8b9546"><span class="section-number-3">1.7.</span> Golang</h3>
<div class="outline-text-3" id="text-1-7">
</div>
<div id="outline-container-org156e27d" class="outline-4">
<h4 id="org156e27d"><span class="section-number-4">1.7.1.</span> go module 初始化项目</h4>
<div class="outline-text-4" id="text-1-7-1">
<div class="org-src-container">
<pre class="src src-sh">mkdir genco
<span style="color: #ffb86c;">cd</span> genco
go mod init genco
</pre>
</div>
</div>
</div>

<div id="outline-container-org3bc93b5" class="outline-4">
<h4 id="org3bc93b5"><span class="section-number-4">1.7.2.</span> 使用私有仓库</h4>
<div class="outline-text-4" id="text-1-7-2">
<p>
配置私有仓库环境变量
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">GOINSECURE</span>=<span style="color: #f1fa8c;">"gitana.jeanhwea.io"</span>
<span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">GOPRIVATE</span>=<span style="color: #f1fa8c;">"*.jeanhwea.io"</span>
</pre>
</div>

<p>
配置 ~/.gitconfig
</p>
<div class="org-src-container">
<pre class="src src-conf">[url <span style="color: #f1fa8c;">"ssh://git@gitana.jeanhwea.io/"</span>]
    <span style="color: #ffc9e8;">insteadOf</span> = http://gitana.jeanhwea.io/
</pre>
</div>

<p>
获取对应的包
</p>
<div class="org-src-container">
<pre class="src src-sh">go get gitana.jeanhwea.io/stock/common
</pre>
</div>
</div>
</div>

<div id="outline-container-org506a088" class="outline-4">
<h4 id="org506a088"><span class="section-number-4">1.7.3.</span> 使用本地仓库</h4>
<div class="outline-text-4" id="text-1-7-3">
<p>
参考官网介绍 <a href="https://go.dev/doc/modules/managing-dependencies#local_directory">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">go mod edit -replace=example.com/theirmodule@v0.0.0-unpublished=../theirmodule
</pre>
</div>

<p>
或者直接在 go.mod 文件中添加
</p>
<div class="org-src-container">
<pre class="src src-text">replace gitana.jeanhwea.io/stock/common =&gt; ../common
</pre>
</div>
</div>
</div>

<div id="outline-container-org72e328b" class="outline-4">
<h4 id="org72e328b"><span class="section-number-4">1.7.4.</span> IDL</h4>
<div class="outline-text-4" id="text-1-7-4">
<p>
定义的结果如下
</p>
<ol class="org-ol">
<li><a href="https://thrift.apache.org/">Apache Thrift</a></li>
<li><a href="https://diwakergupta.github.io/thrift-missing-guide/">Thrift: The Missing Guide</a></li>
</ol>

<p>
Java 配置 thrift | <a href="https://thrift.apache.org/docs/BuildingFromSource">build</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">wget -c https://dlcdn.apache.org/thrift/0.19.0/thrift-0.19.0.tar.gz
./bootstrap.sh
./configure --with-java=yes --with-nodejs=no --with-go=no --with-cpp=no --with-lua=no --with-python=no
make
sudo make install
</pre>
</div>

<p>
生成 Java 代码
</p>
<div class="org-src-container">
<pre class="src src-sh">thrift -r --gen java tutorial.thrift
</pre>
</div>

<p>
IDL 格式化工具 <a href="https://github.com/thrift-labs/thrift-fmt">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">pip install thrift-fmt
</pre>
</div>
</div>
</div>

<div id="outline-container-org3b7422a" class="outline-4">
<h4 id="org3b7422a"><span class="section-number-4">1.7.5.</span> hertz</h4>
<div class="outline-text-4" id="text-1-7-5">
<p>
操作手册 <a href="https://www.cloudwego.io/docs/hertz/">hertz</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">hz new -module github.com/jeanhwea/appname -idl idl/appname.thrift
hz update -idl idl/appname.thrift
go mod edit -replace github.com/apache/thrift=github.com/apache/thrift@v0.13.0
</pre>
</div>
</div>
</div>

<div id="outline-container-org50fdca8" class="outline-4">
<h4 id="org50fdca8"><span class="section-number-4">1.7.6.</span> kitex</h4>
<div class="outline-text-4" id="text-1-7-6">
<p>
Kitex 微服务架构工具 <a href="https://www.cloudwego.io/zh/docs/kitex/">kitex</a>
</p>
</div>
</div>
<div id="outline-container-org5758d18" class="outline-4">
<h4 id="org5758d18"><span class="section-number-4">1.7.7.</span> profile 性能分析</h4>
<div class="outline-text-4" id="text-1-7-7">
<p>
通过如下命令生成分析文件，官网工具介绍 <a href="https://go.dev/doc/diagnostics">diagnostics</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">cpu &#24615;&#33021;&#20998;&#26512;</span>
go test -cpuprofile ./output/cpu.prof -run TestSched01 ./app/sched
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#20869;&#23384; &#24615;&#33021;&#20998;&#26512;</span>
go test -memprofile ./output/mem.prof -run TestSched01 ./app/sched
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">cpu &#20869;&#23384;&#24615;&#33021;&#20998;&#26512;</span>
go test -cpuprofile ./output/cpu.prof -memprofile ./output/mem.prof -run TestSched01 ./app/sched
</pre>
</div>

<p>
使用 go tool 查看文件
</p>
<div class="org-src-container">
<pre class="src src-sh">go tool pprof ./output/cpu.prof
</pre>
</div>

<p>
查看 cpu 性能分析结果
</p>
<pre class="example" id="org928fb8c">
$ go tool pprof ./output/cpu.prof
File: sched.test
Type: cpu
Time: Aug 30, 2023 at 8:51am (CST)
Duration: 201.60ms, Total samples = 70ms (34.72%)
Entering interactive mode (type "help" for commands, "o" for options)
(pprof) top 5
Showing nodes accounting for 70ms, 100% of 70ms total
Showing top 5 nodes out of 32
      flat  flat%   sum%        cum   cum%
      40ms 57.14% 57.14%       40ms 57.14%  runtime/internal/syscall.Syscall6
      10ms 14.29% 71.43%       10ms 14.29%  github.com/sirupsen/logrus.(*TextFormatter).Format
      10ms 14.29% 85.71%       10ms 14.29%  runtime.heapBitsSetType
      10ms 14.29%   100%       10ms 14.29%  time.Now
         0     0%   100%       60ms 85.71%  github.com/sirupsen/logrus.(*Entry).Info
(pprof) top 5 -cum
Showing nodes accounting for 0, 0% of 70ms total
Showing top 5 nodes out of 32
      flat  flat%   sum%        cum   cum%
         0     0%     0%       70ms   100%  mtiisl.cn/gitlab/xifei/patok/app/sched.(*Sched).StartSched
         0     0%     0%       70ms   100%  mtiisl.cn/gitlab/xifei/patok/app/sched.TestSched01
         0     0%     0%       70ms   100%  testing.tRunner
         0     0%     0%       60ms 85.71%  github.com/sirupsen/logrus.(*Entry).Info (inline)
         0     0%     0%       60ms 85.71%  github.com/sirupsen/logrus.(*Entry).Log
(pprof)
</pre>

<p>
查看内存性能分析结果
</p>
<pre class="example" id="orgcf5c112">
$ go tool pprof ./output/mem.prof
File: sched.test
Type: alloc_space
Time: Aug 30, 2023 at 8:47am (CST)
Entering interactive mode (type "help" for commands, "o" for options)
(pprof) top
Showing nodes accounting for 3693.94kB, 100% of 3693.94kB total
Showing top 10 nodes out of 29
      flat  flat%   sum%        cum   cum%
 1184.27kB 32.06% 32.06%  1184.27kB 32.06%  runtime/pprof.StartCPUProfile
  902.59kB 24.43% 56.49%  1485.59kB 40.22%  compress/flate.NewWriter (inline)
  583.01kB 15.78% 72.28%   583.01kB 15.78%  compress/flate.newDeflateFast (inline)
  512.07kB 13.86% 86.14%   512.07kB 13.86%  fmt.Sprintf
  512.01kB 13.86%   100%   512.01kB 13.86%  fmt.Sprint
         0     0%   100%   583.01kB 15.78%  compress/flate.(*compressor).init
         0     0%   100%  1485.59kB 40.22%  compress/gzip.(*Writer).Write
         0     0%   100%  1024.08kB 27.72%  github.com/sirupsen/logrus.(*Entry).Info
         0     0%   100%  1024.08kB 27.72%  github.com/sirupsen/logrus.(*Entry).Log
         0     0%   100%   512.07kB 13.86%  github.com/sirupsen/logrus.(*Entry).log
(pprof) top -cum
Showing nodes accounting for 2086.86kB, 56.49% of 3693.94kB total
Showing top 10 nodes out of 29
      flat  flat%   sum%        cum   cum%
  902.59kB 24.43% 24.43%  1485.59kB 40.22%  compress/flate.NewWriter (inline)
         0     0% 24.43%  1485.59kB 40.22%  compress/gzip.(*Writer).Write
         0     0% 24.43%  1485.59kB 40.22%  runtime/pprof.(*profileBuilder).build
         0     0% 24.43%  1485.59kB 40.22%  runtime/pprof.profileWriter
         0     0% 24.43%  1184.27kB 32.06%  main.main
         0     0% 24.43%  1184.27kB 32.06%  runtime.main
 1184.27kB 32.06% 56.49%  1184.27kB 32.06%  runtime/pprof.StartCPUProfile
         0     0% 56.49%  1184.27kB 32.06%  testing.(*M).Run
         0     0% 56.49%  1184.27kB 32.06%  testing.(*M).before
         0     0% 56.49%  1184.27kB 32.06%  testing/internal/testdeps.TestDeps.StartCPUProfile
(pprof)
</pre>

<p>
产出 PDF 性能分析报告
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#23433;&#35013;&#22270;&#20687;&#29983;&#25104;&#24037;&#20855;</span>
sudo apt install graphviz
sudo brew install graphviz
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#29983;&#25104; PDF &#25253;&#21578;</span>
go tool pprof --pdf ./output/cpu.prof &gt; cpu.pdf
go tool pprof --pdf ./output/mem.prof &gt; mem.pdf
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaf31a88" class="outline-4">
<h4 id="orgaf31a88"><span class="section-number-4">1.7.8.</span> 源码编译</h4>
<div class="outline-text-4" id="text-1-7-8">
<p>
下载代码后直接执行如下命令进行编译
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">cd</span> src
<span style="color: #ffc9e8;">GOOS</span>=linux <span style="color: #ffc9e8;">GOARCH</span>=amd64 ./bootstrap.bash
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcf7217f" class="outline-4">
<h4 id="orgcf7217f"><span class="section-number-4">1.7.9.</span> 泛型写法</h4>
<div class="outline-text-4" id="text-1-7-9">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #ff79c6;">import</span> <span style="color: #8d5649;">(</span>
        <span style="color: #f1fa8c;">"sort"</span>
<span style="color: #8d5649;">)</span>

<span style="color: #6272a4;">// </span><span style="color: #6272a4;">~string &#34920;&#31034;&#24213;&#23618;&#26102; string &#31867;&#22411;&#30340;&#38598;&#21512;</span>
<span style="color: #ff79c6;">func</span> <span style="color: #50fa7b;">IterMap</span><span style="color: #8d5649;">[</span>K ~string, V <span style="color: #bd93f9;">any</span><span style="color: #8d5649;">](</span>m <span style="color: #ff79c6;">map</span><span style="color: #d8241f;">[</span><span style="color: #bd93f9;">K</span><span style="color: #d8241f;">]</span><span style="color: #bd93f9;">V</span>, fn <span style="color: #ff79c6;">func</span><span style="color: #d8241f;">(</span><span style="color: #ffc9e8;">k</span> <span style="color: #bd93f9;">K</span>, <span style="color: #ffc9e8;">v</span> <span style="color: #bd93f9;">V</span><span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span>
        <span style="color: #ffc9e8;">keys</span> := <span style="color: #ffb86c;">make</span><span style="color: #d8241f;">(</span><span style="color: #9564bf;">[]</span><span style="color: #bd93f9;">string</span>, 0, <span style="color: #ffb86c;">len</span><span style="color: #9564bf;">(</span>m<span style="color: #9564bf;">)</span><span style="color: #d8241f;">)</span>
        <span style="color: #ff79c6;">for</span> <span style="color: #ffc9e8;">k</span> := <span style="color: #ff79c6;">range</span> m <span style="color: #d8241f;">{</span>
                keys = <span style="color: #ffb86c;">append</span><span style="color: #9564bf;">(</span>keys, <span style="color: #50fa7b;">string</span><span style="color: #24a222;">(</span>k<span style="color: #24a222;">)</span><span style="color: #9564bf;">)</span>
        <span style="color: #d8241f;">}</span>
        sort.<span style="color: #50fa7b;">Strings</span><span style="color: #d8241f;">(</span>keys<span style="color: #d8241f;">)</span>
        <span style="color: #ff79c6;">for</span> <span style="color: #ffc9e8;">_</span>, <span style="color: #ffc9e8;">k</span> := <span style="color: #ff79c6;">range</span> keys <span style="color: #d8241f;">{</span>
                <span style="color: #50fa7b;">fn</span><span style="color: #9564bf;">(</span><span style="color: #50fa7b;">K</span><span style="color: #24a222;">(</span>k<span style="color: #24a222;">)</span>, m<span style="color: #24a222;">[</span><span style="color: #50fa7b;">K</span><span style="color: #ff7f00;">(</span>k<span style="color: #ff7f00;">)</span><span style="color: #24a222;">]</span><span style="color: #9564bf;">)</span>
        <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org178a12f" class="outline-4">
<h4 id="org178a12f"><span class="section-number-4">1.7.10.</span> 垃圾回收</h4>
<div class="outline-text-4" id="text-1-7-10">
<p>
通过环境变量来开启打印 gc
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffc9e8;">GODEBUG</span>=<span style="color: #f1fa8c;">'gctrace=1'</span> ./app
</pre>
</div>

<p>
日志样例
</p>
<pre class="example" id="org60dc381">
gc 7 @722.445s 0%: 0.099+2.3+0.017 ms clock, 0.79+0/4.5/0+0.13 ms cpu, 1-&gt;1-&gt;1 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 8 P
GC forced
gc 8 @842.465s 0%: 0.084+1.7+0.006 ms clock, 0.67+0/3.3/0+0.049 ms cpu, 1-&gt;1-&gt;1 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 8 P
GC forced
gc 9 @962.486s 0%: 0.10+2.3+0.008 ms clock, 0.84+0/4.4/0+0.065 ms cpu, 1-&gt;1-&gt;1 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 8 P
GC forced
</pre>
</div>
</div>

<div id="outline-container-org1c36863" class="outline-4">
<h4 id="org1c36863"><span class="section-number-4">1.7.11.</span> 常用 API</h4>
<div class="outline-text-4" id="text-1-7-11">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #ffc9e8;">ok</span> := strings.<span style="color: #50fa7b;">HasPrefix</span><span style="color: #8d5649;">(</span>msg, <span style="color: #f1fa8c;">"ERROR["</span><span style="color: #8d5649;">)</span>
<span style="color: #ffc9e8;">i</span> := strings.<span style="color: #50fa7b;">Index</span><span style="color: #8d5649;">(</span>msg, <span style="color: #f1fa8c;">"]"</span><span style="color: #8d5649;">)</span>
<span style="color: #ffc9e8;">code</span>, <span style="color: #ffc9e8;">err1</span> := strconv.<span style="color: #50fa7b;">Atoi</span><span style="color: #8d5649;">(</span>msg<span style="color: #d8241f;">[</span>6:i<span style="color: #d8241f;">]</span><span style="color: #8d5649;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org799b5d6" class="outline-3">
<h3 id="org799b5d6"><span class="section-number-3">1.8.</span> Perl</h3>
<div class="outline-text-3" id="text-1-8">
</div>
<div id="outline-container-orgf428ee0" class="outline-4">
<h4 id="orgf428ee0"><span class="section-number-4">1.8.1.</span> 环境配置</h4>
<div class="outline-text-4" id="text-1-8-1">
</div>
<ol class="org-ol">
<li><a id="orgb679c96"></a>包管理工具配置 CPAN<br />
<div class="outline-text-5" id="text-1-8-1-1">
<ol class="org-ol">
<li>官网 <a href="https://metacpan.org/">CPAN</a></li>
<li><p>
镜像 <a href="https://mirrors.tuna.tsinghua.edu.cn/help/CPAN/">TUNA</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffc9e8;">PERL_MM_USE_DEFAULT</span>=1 perl -MCPAN -e <span style="color: #f1fa8c;">'CPAN::HandleConfig-&gt;edit("pushy_https", 0); CPAN::HandleConfig-&gt;edit("urllist", "unshift", "https://mirrors.tuna.tsinghua.edu.cn/CPAN/"); mkmyconfig'</span>
</pre>
</div></li>
<li>CPAN 的配置文件: <code>~/.cpan/CPAN/MyConfig.pm</code></li>
</ol>
</div>
</li>
<li><a id="orgf2c9c11"></a>包管理命令<br />
<div class="outline-text-5" id="text-1-8-1-2">
<div class="org-src-container">
<pre class="src src-sh">perl -MCPAN -e <span style="color: #f1fa8c;">'install Excel::Writer::XLSX'</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org6f53dc6" class="outline-4">
<h4 id="org6f53dc6"><span class="section-number-4">1.8.2.</span> 基本使用</h4>
<div class="outline-text-4" id="text-1-8-2">
</div>
<ol class="org-ol">
<li><a id="orgba35eab"></a>Hello world<br />
<div class="outline-text-5" id="text-1-8-2-1">
<p>
创建 <code>hello.pl</code> 文件写以下代码
</p>
<div class="org-src-container">
<pre class="src src-perl">print(<span style="color: #f1fa8c;">"hello world\n"</span>);
</pre>
</div>

<p>
使用 perl 命令运行代码
</p>
<div class="org-src-container">
<pre class="src src-sh">perl hello.pl
</pre>
</div>
</div>
</li>

<li><a id="org3916871"></a>过滤 MySQL trace 日志<br />
<div class="outline-text-5" id="text-1-8-2-2">
<div class="org-src-container">
<pre class="src src-perl"><span style="color: #ff79c6;">use</span> <span style="color: #8be9fd;">strict</span>;
<span style="color: #ff79c6;">use</span> <span style="color: #8be9fd;">warnings</span>;

<span style="color: #ff79c6;">my</span> $<span style="color: #ffc9e8;">cid</span> = 8;
<span style="color: #ff79c6;">my</span> $<span style="color: #ffc9e8;">fout</span> = <span style="color: #f1fa8c;">"/tmp/mysqld-thd-$cid.txt"</span>;
open(FIN, <span style="color: #f1fa8c;">'&lt;:encoding(UTF-8)'</span>, <span style="color: #f1fa8c;">"/tmp/mysqld.trace"</span>) or <span style="color: #ff79c6;">die</span>;
open(FOUT, <span style="color: #f1fa8c;">'&gt;'</span>, $<span style="color: #ffc9e8;">fout</span>) or <span style="color: #ff79c6;">die</span>;

<span style="color: #ff79c6;">while</span> (<span style="color: #ff79c6;">my</span> $<span style="color: #ffc9e8;">line</span> = &lt;<span style="color: #8be9fd;">FIN</span>&gt;) {
    <span style="color: #ff79c6;">if</span> ($<span style="color: #ffc9e8;">line</span> =~ <span style="color: #f1fa8c;">/^T\@$cid/</span>) {
        print FOUT $<span style="color: #ffc9e8;">line</span>;
    }
}

close(FOUT);
$<span style="color: #ffc9e8;">fout</span>;
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-orgca13da1" class="outline-3">
<h3 id="orgca13da1"><span class="section-number-3">1.9.</span> Python</h3>
<div class="outline-text-3" id="text-1-9">
</div>
<div id="outline-container-orgb0b0552" class="outline-4">
<h4 id="orgb0b0552"><span class="section-number-4">1.9.1.</span> 安装 python 的开发包</h4>
<div class="outline-text-4" id="text-1-9-1">
<div class="org-src-container">
<pre class="src src-sh">pip install --user pandas
pip install --user sqlalchemy
pip install --user pymysql
</pre>
</div>

<p>
源码编译安装
</p>
<div class="org-src-container">
<pre class="src src-sh">wget -c https://www.python.org/ftp/python/3.11.5/Python-3.11.5.tgz
tar xzvf ~/Python-3.11.5.tgz

sudo yum install openssl openssl-devel
sudo yum install libffi libffi-devel

./configure <span style="color: #ffc9e8;">prefix</span>=/opt/python3
make
sudo make install
</pre>
</div>

<p>
配置国内下载源地址 <a href="https://mirrors.tuna.tsinghua.edu.cn/help/pypi/">tuna</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">pip install pip -U -i https://pypi.tuna.tsinghua.edu.cn/simple
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
pip config set install.trusted-host pypi.tuna.tsinghua.edu.cn
</pre>
</div>
</div>
</div>

<div id="outline-container-org88b9a1b" class="outline-4">
<h4 id="org88b9a1b"><span class="section-number-4">1.9.2.</span> pyenv 管理 python 版本</h4>
<div class="outline-text-4" id="text-1-9-2">
<p>
安装如下
</p>
<div class="org-src-container">
<pre class="src src-sh">git clone https://github.com/pyenv/pyenv.git ~/.pyenv
</pre>
</div>

<p>
配置环境变量
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">PYTHON_BUILD_MIRROR_URL</span>=<span style="color: #f1fa8c;">"https://registry.npmmirror.com/-/binary/python"</span>
<span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">PYTHON_BUILD_MIRROR_URL_SKIP_CHECKSUM</span>=1

<span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">PYENV_ROOT</span>=<span style="color: #f1fa8c;">"$HOME/.pyenv"</span>
command -v pyenv &gt;/dev/null || <span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">PATH</span>=<span style="color: #f1fa8c;">"$PYENV_ROOT/bin:$PATH"</span>
<span style="color: #ffb86c;">eval</span> <span style="color: #f1fa8c;">"$(pyenv init -)"</span>
</pre>
</div>

<p>
centos7 指定 openssl 安装路径后编译安装 <a href="https://github.com/pyenv/pyenv/wiki/Common-build-problems#error-the-python-ssl-extension-was-not-compiled-missing-the-openssl-lib">link</a>
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffc9e8;">CPPFLAGS</span>=<span style="color: #f1fa8c;">"$(pkg-config --cflags openssl11)"</span> <span style="color: #f1fa8c;">\</span>
<span style="color: #ffc9e8;">LDFLAGS</span>=<span style="color: #f1fa8c;">"$(pkg-config --libs openssl11)"</span> <span style="color: #f1fa8c;">\</span>
pyenv install -v 3.10.6

pyenv global 3.10.6
</pre>
</div>

<p>
无法找到系统 ssl 库，解决方法使用源码方式安装
</p>
<pre class="example" id="org661d8b8">
File "/home/admin/.pyenv/versions/3.10.6/lib/python3.10/ssl.py", line 99, in &lt;module&gt;
  import _ssl             # if we can't import it, let the error propagate ModuleNotFoundError: No module named '_ssl'
</pre>

<div class="org-src-container">
<pre class="src src-sh">tar xvf Python-3.10.13.tar.xz

./configure --prefix=/usr/local/python3 <span style="color: #f1fa8c;">\</span>
            --with-openssl=/usr/local/openssl <span style="color: #f1fa8c;">\</span>
            --with-openssl-rpath=auto <span style="color: #f1fa8c;">\</span>
            --enable-optimizations

make -j4
sudo make altinstall
</pre>
</div>

<p>
配置国内源，如下的命令直接设置
</p>
<div class="org-src-container">
<pre class="src src-shell">pip install pip -U -i https://pypi.tuna.tsinghua.edu.cn/simple
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
pip config set install.trusted-host pypi.tuna.tsinghua.edu.cn
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org25338fa" class="outline-3">
<h3 id="org25338fa"><span class="section-number-3">1.10.</span> Ruby</h3>
<div class="outline-text-3" id="text-1-10">
<ol class="org-ol">
<li>配置国内 GEM 镜像 <a href="https://gems.ruby-china.com/">Ruby China</a></li>
</ol>
</div>
</div>
<div id="outline-container-org2a7e872" class="outline-3">
<h3 id="org2a7e872"><span class="section-number-3">1.11.</span> Rust</h3>
<div class="outline-text-3" id="text-1-11">
</div>
<div id="outline-container-org2f7d2f8" class="outline-4">
<h4 id="org2f7d2f8"><span class="section-number-4">1.11.1.</span> 安装配置</h4>
<div class="outline-text-4" id="text-1-11-1">
<p>
安装页面 <a href="https://www.rust-lang.org/tools/install">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">curl --proto <span style="color: #f1fa8c;">'=https'</span> --tlsv1.2 -sSf https://sh.rustup.rs | sh
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#23433;&#35013;&#24037;&#20855;&#38142;</span>
rustup component add rust-src
</pre>
</div>

<p>
设置国内镜像 | <a href="http://rsproxy.cn/#getStarted">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">RUSTUP_DIST_SERVER</span>=<span style="color: #f1fa8c;">"https://rsproxy.cn"</span>
<span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">RUSTUP_UPDATE_ROOT</span>=<span style="color: #f1fa8c;">"https://rsproxy.cn/rustup"</span>
</pre>
</div>

<p>
安装 rust
</p>
<div class="org-src-container">
<pre class="src src-sh">curl --proto <span style="color: #f1fa8c;">'=https'</span> --tlsv1.2 -sSf https://rsproxy.cn/rustup-init.sh | sh
</pre>
</div>

<p>
~/.cargo/config
</p>
<div class="org-src-container">
<pre class="src src-conf">[<span style="color: #bd93f9;">source.crates-io</span>]
<span style="color: #ffc9e8;">replace-with</span> = <span style="color: #f1fa8c;">'rsproxy'</span>
[<span style="color: #bd93f9;">source.rsproxy</span>]
<span style="color: #ffc9e8;">registry</span> = <span style="color: #f1fa8c;">"https://rsproxy.cn/crates.io-index"</span>
[<span style="color: #bd93f9;">source.rsproxy-sparse</span>]
<span style="color: #ffc9e8;">registry</span> = <span style="color: #f1fa8c;">"sparse+https://rsproxy.cn/index/"</span>
[<span style="color: #bd93f9;">registries.rsproxy</span>]
<span style="color: #ffc9e8;">index</span> = <span style="color: #f1fa8c;">"https://rsproxy.cn/crates.io-index"</span>
[<span style="color: #bd93f9;">net</span>]
<span style="color: #ffc9e8;">git-fetch-with-cli</span> = true
</pre>
</div>
</div>
</div>

<div id="outline-container-org793ed2b" class="outline-4">
<h4 id="org793ed2b"><span class="section-number-4">1.11.2.</span> 使用笔记</h4>
<div class="outline-text-4" id="text-1-11-2">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #bd93f9; font-weight: bold;">#![allow(dead_code)]</span>
<span style="color: #bd93f9; font-weight: bold;">#![allow(unused_variables)]</span>
</pre>
</div>

<p>
结构体
</p>
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #ff79c6;">struct</span> <span style="color: #bd93f9;">Point</span> {
    <span style="color: #ffc9e8;">x</span>: <span style="color: #bd93f9;">f64</span>,
    <span style="color: #ffc9e8;">y</span>: <span style="color: #bd93f9;">f64</span>,
}

<span style="color: #ff79c6;">struct</span> <span style="color: #bd93f9;">Line</span> {
    <span style="color: #ffc9e8;">beg</span>: <span style="color: #bd93f9;">Point</span>,
    <span style="color: #ffc9e8;">end</span>: <span style="color: #bd93f9;">Point</span>,
}

<span style="color: #ff79c6;">impl</span> <span style="color: #bd93f9;">Line</span> {
    <span style="color: #6272a4;">// </span><span style="color: #6272a4;">&#26041;&#27861;</span>
    <span style="color: #ff79c6;">fn</span> <span style="color: #50fa7b;">len</span>(<span style="color: #f8f8f2; background-color: #282a36;">&amp;</span><span style="color: #ff79c6;">self</span>) -&gt; <span style="color: #bd93f9;">f64</span> {
        <span style="color: #ff79c6;">let</span> <span style="color: #ffc9e8;">dx</span> = <span style="color: #ff79c6;">self</span>.end.x - <span style="color: #ff79c6;">self</span>.beg.x;
        <span style="color: #ff79c6;">let</span> <span style="color: #ffc9e8;">dy</span> = <span style="color: #ff79c6;">self</span>.end.y - <span style="color: #ff79c6;">self</span>.beg.y;
        (dx * dx + dy * dy).sqrt()
    }
}
</pre>
</div>

<p>
匿名函数及闭包
</p>
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #ff79c6;">fn</span> <span style="color: #50fa7b;">use_closure</span>() {
    <span style="color: #ff79c6;">let</span> <span style="color: #ffc9e8;">plus_one</span> = |x| -&gt; <span style="color: #bd93f9;">i32</span> { x + 1 };
    <span style="color: #ff79c6;">let</span> <span style="color: #ffc9e8;">x</span> = 1;
    <span style="color: #ffb86c;">println!</span>(<span style="color: #f1fa8c;">"</span><span style="color: #f1fa8c; font-style: italic;">{}</span><span style="color: #f1fa8c;"> + 1 = </span><span style="color: #f1fa8c; font-style: italic;">{}</span><span style="color: #f1fa8c;">"</span>, x, plus_one(x));
}
</pre>
</div>

<p>
match 关键字
</p>
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #ff79c6;">fn</span> <span style="color: #50fa7b;">match_statement</span>(<span style="color: #ffc9e8;">x</span>: <span style="color: #bd93f9;">i32</span>) -&gt; <span style="color: #f8f8f2; background-color: #282a36;">&amp;</span>'<span style="color: #ff79c6;">static</span> <span style="color: #bd93f9;">str</span> {
    <span style="color: #ff79c6;">return</span> <span style="color: #ff79c6;">match</span> x {
        8 =&gt; <span style="color: #f1fa8c;">"China"</span>,
        1..=10 =&gt; <span style="color: #f1fa8c;">"VALID"</span>,
        _ =&gt; <span style="color: #f1fa8c;">"INVALID"</span>,
    };
}
</pre>
</div>

<p>
使用 trait
</p>
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #ff79c6;">trait</span> <span style="color: #bd93f9;">Animal</span> {
    <span style="color: #ff79c6;">fn</span> <span style="color: #50fa7b;">name</span>(<span style="color: #f8f8f2; background-color: #282a36;">&amp;</span><span style="color: #ff79c6;">self</span>) -&gt; <span style="color: #f8f8f2; background-color: #282a36;">&amp;</span>'<span style="color: #ff79c6;">static</span> <span style="color: #bd93f9;">str</span>;

    <span style="color: #ff79c6;">fn</span> <span style="color: #50fa7b;">talk</span>(<span style="color: #f8f8f2; background-color: #282a36;">&amp;</span><span style="color: #ff79c6;">self</span>) {
        <span style="color: #ffb86c;">println!</span>(<span style="color: #f1fa8c;">"</span><span style="color: #f1fa8c; font-style: italic;">{}</span><span style="color: #f1fa8c;"> cannot talk!"</span>, <span style="color: #ff79c6;">self</span>.name());
    }
}

<span style="color: #ff79c6;">struct</span> <span style="color: #bd93f9;">Cat</span> {
    <span style="color: #ffc9e8;">name</span>: <span style="color: #f8f8f2; background-color: #282a36;">&amp;</span>'<span style="color: #ff79c6;">static</span> <span style="color: #bd93f9;">str</span>,
}

<span style="color: #ff79c6;">struct</span> <span style="color: #bd93f9;">Human</span> {
    <span style="color: #ffc9e8;">name</span>: <span style="color: #f8f8f2; background-color: #282a36;">&amp;</span>'<span style="color: #ff79c6;">static</span> <span style="color: #bd93f9;">str</span>,
}

<span style="color: #ff79c6;">impl</span> <span style="color: #bd93f9;">Animal</span> <span style="color: #ff79c6;">for</span> <span style="color: #bd93f9;">Cat</span> {
    <span style="color: #ff79c6;">fn</span> <span style="color: #50fa7b;">name</span>(<span style="color: #f8f8f2; background-color: #282a36;">&amp;</span><span style="color: #ff79c6;">self</span>) -&gt; <span style="color: #f8f8f2; background-color: #282a36;">&amp;</span>'<span style="color: #ff79c6;">static</span> <span style="color: #bd93f9;">str</span> {
        <span style="color: #ff79c6;">self</span>.name
    }
}

<span style="color: #ff79c6;">impl</span> <span style="color: #bd93f9;">Animal</span> <span style="color: #ff79c6;">for</span> <span style="color: #bd93f9;">Human</span> {
    <span style="color: #ff79c6;">fn</span> <span style="color: #50fa7b;">name</span>(<span style="color: #f8f8f2; background-color: #282a36;">&amp;</span><span style="color: #ff79c6;">self</span>) -&gt; <span style="color: #f8f8f2; background-color: #282a36;">&amp;</span>'<span style="color: #ff79c6;">static</span> <span style="color: #bd93f9;">str</span> {
        <span style="color: #ff79c6;">self</span>.name
    }

    <span style="color: #ff79c6;">fn</span> <span style="color: #50fa7b;">talk</span>(<span style="color: #f8f8f2; background-color: #282a36;">&amp;</span><span style="color: #ff79c6;">self</span>) {
        <span style="color: #ffb86c;">println!</span>(<span style="color: #f1fa8c;">"</span><span style="color: #f1fa8c; font-style: italic;">{}</span><span style="color: #f1fa8c;"> says hello."</span>, <span style="color: #ff79c6;">self</span>.name());
    }
}

<span style="color: #ff79c6;">fn</span> <span style="color: #50fa7b;">use_trait</span>() {
    <span style="color: #ff79c6;">let</span> <span style="color: #ffc9e8;">john</span> = <span style="color: #bd93f9;">Human</span> { <span style="color: #ffc9e8;">name</span>: <span style="color: #f1fa8c;">"John"</span> };
    john.talk();

    <span style="color: #ff79c6;">let</span> <span style="color: #ffc9e8;">pet</span> = <span style="color: #bd93f9;">Cat</span> { <span style="color: #ffc9e8;">name</span>: <span style="color: #f1fa8c;">"MiMi"</span> };
    pet.talk();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4d437f5" class="outline-4">
<h4 id="org4d437f5"><span class="section-number-4">1.11.3.</span> cargo</h4>
<div class="outline-text-4" id="text-1-11-3">
<p>
创建项目
</p>
<div class="org-src-container">
<pre class="src src-sh">cargo new myapp
cargo new --lib mylib
</pre>
</div>

<p>
添加包
</p>
<div class="org-src-container">
<pre class="src src-sh">cargo add config
cargo add clap --features derive
</pre>
</div>

<p>
编译运行
</p>
<div class="org-src-container">
<pre class="src src-sh">cargo build
cargo build --release
cargo run -- -h
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4d35bef" class="outline-3">
<h3 id="org4d35bef"><span class="section-number-3">1.12.</span> SSH</h3>
<div class="outline-text-3" id="text-1-12">
</div>
<div id="outline-container-orgcb84879" class="outline-4">
<h4 id="orgcb84879"><span class="section-number-4">1.12.1.</span> ~/.ssh/config</h4>
<div class="outline-text-4" id="text-1-12-1">
<p>
创建配置文件
</p>
<div class="org-src-container">
<pre class="src src-sh">touch ~/.ssh/config
chmod 600 ~/.ssh/config
</pre>
</div>

<p>
查看配置文件
</p>
<div class="org-src-container">
<pre class="src src-sh">man ssh_config 5
</pre>
</div>

<p>
基本配置
</p>
<ul class="org-ul">
<li>ServerAliveInterval 心跳时间</li>
</ul>
<div class="org-src-container">
<pre class="src src-conf">Host *
    ServerAliveInterval 0
</pre>
</div>

<p>
解决 ssh 一段时间后自动断线
</p>
<div class="org-src-container">
<pre class="src src-sh">Host *
    ServerAliveInterval 60
    ServerAliveCountMax 1
</pre>
</div>
</div>
</div>

<div id="outline-container-org3e46732" class="outline-4">
<h4 id="org3e46732"><span class="section-number-4">1.12.2.</span> 配置 host 别名</h4>
<div class="outline-text-4" id="text-1-12-2">
<p>
在配置文件 ~/.ssh/config 方便后续直接在 ssh 命令中使用
</p>
<div class="org-src-container">
<pre class="src src-conf">Host gitana
    Hostname gitana.jeanhwea.io
    Port 2222
    User admin

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">match 123, 212 etc</span>
Host 1?? 2??
    Hostname 192.168.0.%h
    Port 22
    User admin

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">match all</span>
Host *
    Hostname 192.168.0.%h
    Port 22
    User admin
</pre>
</div>
</div>
</div>

<div id="outline-container-org45a36f1" class="outline-4">
<h4 id="org45a36f1"><span class="section-number-4">1.12.3.</span> 直接转发远端流量</h4>
<div class="outline-text-4" id="text-1-12-3">
<p>
通过 ssh<sub>config</sub> 的配置来转发远端 5432
</p>
<div class="org-src-container">
<pre class="src src-conf">Host db
    HostName db.example.com
    LocalForward 5433 localhost:5432
</pre>
</div>

<p>
登录到远端, 然后就可以在本地连接
</p>
<ul class="org-ul">
<li>-f 后台运行命令</li>
<li>-C 传输启用压缩</li>
<li>-N 不登录主机</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh">ssh -fCN db
psql -h localhost -p 5433 orders
</pre>
</div>
</div>
</div>

<div id="outline-container-orga9d4d0b" class="outline-4">
<h4 id="orga9d4d0b"><span class="section-number-4">1.12.4.</span> 暴露本机服务配置, 两跳登录</h4>
<div class="outline-text-4" id="text-1-12-4">
<div class="org-src-container">
<pre class="src src-conf">Host hoppin
    Hostname remote-server
    Port 22
    User root
    RemoteForward 2222 localhost:22
</pre>
</div>

<p>
两跳登录配置
</p>
<div class="org-src-container">
<pre class="src src-conf">Host gitana
    Hostname 127.0.0.1
    Port 2222
    User admin
    IdentityFile ~/.ssh/id_rsa
    ProxyCommand ssh -W %h:%p proxy-host
</pre>
</div>

<p>
使用 ProxyJump 实现两条登录
</p>
<div class="org-src-container">
<pre class="src src-conf">Host target
    Hostname target-server
    User admin
    ProxyJump proxy-server
</pre>
</div>
</div>
</div>

<div id="outline-container-org3f2888b" class="outline-4">
<h4 id="org3f2888b"><span class="section-number-4">1.12.5.</span> 代理登录</h4>
<div class="outline-text-4" id="text-1-12-5">
<p>
添加代理登录的配置, 需要通过 ProxyCommand 来设置代理命令
</p>
<div class="org-src-container">
<pre class="src src-conf">Host gateway
    HostName proxy.example.com
    User root
Host db
    HostName db.internal.example.com                  <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#30446;&#26631;&#26381;&#21153;&#22120;&#22320;&#22336;</span>
    User root                                         <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#29992;&#25143;&#21517;</span>
    <span style="color: #6272a4;"># </span><span style="color: #6272a4;">IdentityFile ~/.ssh/id_ecdsa                    # &#35748;&#35777;&#25991;&#20214;</span>
    ProxyCommand ssh gateway netcat -q 600 %h %p      <span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#20195;&#29702;&#21629;&#20196;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0b0ec32" class="outline-4">
<h4 id="org0b0ec32"><span class="section-number-4">1.12.6.</span> 连接 socket 重用</h4>
<div class="outline-text-4" id="text-1-12-6">
<div class="org-src-container">
<pre class="src src-conf">Host example.org
  ControlMaster    auto
  ControlPath      ~/.ssh/cp-%r@%h:%p.sock
  ControlPersist   yes
</pre>
</div>
</div>
</div>

<div id="outline-container-org7b80b15" class="outline-4">
<h4 id="org7b80b15"><span class="section-number-4">1.12.7.</span> forward 端口转发</h4>
<div class="outline-text-4" id="text-1-12-7">
<p>
本地转发
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">-N &#19981;&#25191;&#34892;&#21629;&#20196;, -L local &#36716;&#21457; &lt;remote-port&gt;:&lt;local-host&gt;:&lt;local-port&gt;</span>
ssh -N -L 9092:127.0.0.1:9092 user@host
</pre>
</div>

<p>
远端转发
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">-N &#19981;&#25191;&#34892;&#21629;&#20196;, -R remote &#36716;&#21457; &lt;local-port&gt;:&lt;remote-host&gt;:&lt;remote-port&gt;</span>
ssh -N -R 9092:127.0.0.1:9092 user@host
</pre>
</div>
</div>
</div>

<div id="outline-container-org5250806" class="outline-4">
<h4 id="org5250806"><span class="section-number-4">1.12.8.</span> ssh 双跳登录</h4>
<div class="outline-text-4" id="text-1-12-8">
<div class="org-src-container">
<pre class="src src-sh">ssh -p9998 -i ~/.ssh/id_s1 user1@175.0.0.20 -t ssh -p9999 -i ~/.ssh/id_s2 user2@213.0.0.30
</pre>
</div>
</div>
</div>

<div id="outline-container-org2696bf7" class="outline-4">
<h4 id="org2696bf7"><span class="section-number-4">1.12.9.</span> scp 双跳传输</h4>
<div class="outline-text-4" id="text-1-12-9">
<div class="org-src-container">
<pre class="src src-sh">scp -o <span style="color: #ffc9e8;">ProxyCommand</span>=<span style="color: #f1fa8c;">"ssh -p9998 user1@175.0.0.20 nc 213.0.0.30 9999"</span> <span style="color: #f1fa8c;">\</span>
    -o <span style="color: #ffc9e8;">IdentityFile</span>=<span style="color: #f1fa8c;">"~/.ssh/id_s2"</span> /opt/file user2@213.0.0.30:/tmp/file
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org248a2a2" class="outline-3">
<h3 id="org248a2a2"><span class="section-number-3">1.13.</span> Git</h3>
<div class="outline-text-3" id="text-1-13">
<ol class="org-ol">
<li>taobao git 下载 <a href="https://registry.npmmirror.com/binary.html?path=git-for-windows/">git-for-windows</a></li>
<li>taobao 二进制下载 <a href="https://registry.npmmirror.com/binary.html">taobao binary</a></li>
<li><p>
github 加速
</p>
<ul class="org-ul">
<li><a href="https://githubfast.com/Jeanhwea/jeanhwea.github.io.git">githubfast</a></li>
<li><a href="https://github.com/Jeanhwea/jeanhwea.github.io.git">ghproxy</a></li>
</ul>
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">~/.gitconfig</span>
[url <span style="color: #f1fa8c;">"https://githubfast.com/"</span>]
        <span style="color: #ffc9e8;">insteadOf</span> = https://github.com/
</pre>
</div></li>
</ol>
</div>
<div id="outline-container-org1fcd959" class="outline-4">
<h4 id="org1fcd959"><span class="section-number-4">1.13.1.</span> 配置用户信息</h4>
<div class="outline-text-4" id="text-1-13-1">
<div class="org-src-container">
<pre class="src src-sh">git config --global user.email <span style="color: #f1fa8c;">"hujinghui@buaa.edu.cn"</span>
git config --global user.name <span style="color: #f1fa8c;">"Jinghui Hu"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd34fc23" class="outline-4">
<h4 id="orgd34fc23"><span class="section-number-4">1.13.2.</span> 递归克隆子模块</h4>
<div class="outline-text-4" id="text-1-13-2">
<div class="org-src-container">
<pre class="src src-sh">git clone --recurse-submodules url
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7cf52c" class="outline-4">
<h4 id="orga7cf52c"><span class="section-number-4">1.13.3.</span> 忽略换行符 ^M</h4>
<div class="outline-text-4" id="text-1-13-3">
<div class="org-src-container">
<pre class="src src-sh">git config core.autocrlf true
</pre>
</div>
</div>
</div>

<div id="outline-container-org5e9c322" class="outline-4">
<h4 id="org5e9c322"><span class="section-number-4">1.13.4.</span> 代码发布相关</h4>
<div class="outline-text-4" id="text-1-13-4">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21160;&#24577;&#29983;&#25104;&#26631;&#31614;</span>
git describe --tags --always --dirty=<span style="color: #f1fa8c;">'-dev'</span>
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21019;&#24314;&#20195;&#30721;&#21253;</span>
git archive -o output.tgz HEAD
</pre>
</div>
</div>
</div>

<div id="outline-container-org3d8458d" class="outline-4">
<h4 id="org3d8458d"><span class="section-number-4">1.13.5.</span> 添加添加生成 TAGS 的 git-hooks</h4>
<div class="outline-text-4" id="text-1-13-5">
<div class="org-src-container">
<pre class="src src-sh">cp .git/hooks/pre-commit.sample .git/hooks/pre-commit
<span style="color: #ffb86c;">echo</span> <span style="color: #f1fa8c;">'ctags -e -R . &gt;/dev/null 2&gt;&amp;1 &amp;'</span> &gt; .git/hooks/pre-commit
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org78cd1cd" class="outline-3">
<h3 id="org78cd1cd"><span class="section-number-3">1.14.</span> Linux &amp; Shell</h3>
<div class="outline-text-3" id="text-1-14">
</div>
<div id="outline-container-org3471814" class="outline-4">
<h4 id="org3471814"><span class="section-number-4">1.14.1.</span> 后台运行命令 cmd</h4>
<div class="outline-text-4" id="text-1-14-1">
<div class="org-src-container">
<pre class="src src-sh">nohup cmd &gt;/dev/null 2&gt;&amp;1 &amp;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb0d8f9b" class="outline-4">
<h4 id="orgb0d8f9b"><span class="section-number-4">1.14.2.</span> 比较 semver 版本号</h4>
<div class="outline-text-4" id="text-1-14-2">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #50fa7b;">vge</span>() {
    <span style="color: #ffb86c;">local</span> <span style="color: #ffc9e8;">v1</span>=$<span style="color: #ffc9e8;">1</span>
    <span style="color: #ffb86c;">local</span> <span style="color: #ffc9e8;">v2</span>=$<span style="color: #ffc9e8;">2</span>
    <span style="color: #ffb86c;">local</span> <span style="color: #ffc9e8;">small</span>=$(printf <span style="color: #f1fa8c;">"%s\n"</span>, $<span style="color: #ffc9e8;">1</span>, $<span style="color: #ffc9e8;">2</span> | sort -V | head -n 1)
    <span style="color: #ff79c6;">if</span> [ <span style="color: #f1fa8c;">"$v1"</span> == <span style="color: #f1fa8c;">"$small"</span> ]; <span style="color: #ff79c6;">then</span>
        <span style="color: #ffb86c;">echo</span> <span style="color: #f1fa8c;">"true"</span>
    <span style="color: #ff79c6;">else</span>
        <span style="color: #ffb86c;">echo</span> <span style="color: #f1fa8c;">"false"</span>
    <span style="color: #ff79c6;">fi</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org08c1fd8" class="outline-4">
<h4 id="org08c1fd8"><span class="section-number-4">1.14.3.</span> heredoc 定义变量</h4>
<div class="outline-text-4" id="text-1-14-3">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">read</span> -d <span style="color: #f1fa8c;">''</span> TEXT &lt;&lt;EOF
<span style="color: #f1fa8c;">this is a</span>
<span style="color: #f1fa8c;">multiple line</span>
<span style="color: #f1fa8c;">text</span>
<span style="color: #f1fa8c;">EOF</span>

<span style="color: #ffb86c;">echo</span> $<span style="color: #ffc9e8;">TEXT</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e8d6d6" class="outline-4">
<h4 id="org2e8d6d6"><span class="section-number-4">1.14.4.</span> 检测命令返回值是否正确</h4>
<div class="outline-text-4" id="text-1-14-4">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">run a command or ./run.sh</span>
<span style="color: #ff79c6;">if</span> [ <span style="color: #f1fa8c;">"$?"</span> != <span style="color: #f1fa8c;">"0"</span> ]; <span style="color: #ff79c6;">then</span>
  <span style="color: #ff79c6;">exit</span> $<span style="color: #ffc9e8;">?</span>
<span style="color: #ff79c6;">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org74f50f7" class="outline-4">
<h4 id="org74f50f7"><span class="section-number-4">1.14.5.</span> 检测当前是否 root 用户</h4>
<div class="outline-text-4" id="text-1-14-5">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ff79c6;">if</span> [ $<span style="color: #ffc9e8;">UID</span> -ne 0 ]; <span style="color: #ff79c6;">then</span>
    <span style="color: #ffb86c;">echo</span> <span style="color: #f1fa8c;">"permission deny, sudo ..."</span>
    <span style="color: #ff79c6;">exit</span> 13 <span style="color: #6272a4;"># </span><span style="color: #6272a4;">EACCES</span>
<span style="color: #ff79c6;">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda4a0bd" class="outline-4">
<h4 id="orgda4a0bd"><span class="section-number-4">1.14.6.</span> 临时提权设置目录权限</h4>
<div class="outline-text-4" id="text-1-14-6">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">echo</span> <span style="color: #f1fa8c;">'password'</span> | sudo -S chmod -R a+rX dist
</pre>
</div>
</div>
</div>

<div id="outline-container-org401b0fb" class="outline-4">
<h4 id="org401b0fb"><span class="section-number-4">1.14.7.</span> tar 压缩/解压</h4>
<div class="outline-text-4" id="text-1-14-7">
<p>
解压
</p>
<div class="org-src-container">
<pre class="src src-sh">tar xjvf node-v18.16.1-linux-x64.tar.bz2
tar xzvf node-v18.16.1-linux-x64.tar.gz
tar xJvf node-v18.16.1-linux-x64.tar.xz
gzip -d app.log.2023-07-07.0.gz
</pre>
</div>

<p>
压缩
</p>
<div class="org-src-container">
<pre class="src src-sh">tar czvf pack.tar.gz pack
gzip app.log.2023-07-07.0
</pre>
</div>
</div>
</div>

<div id="outline-container-org595da17" class="outline-4">
<h4 id="org595da17"><span class="section-number-4">1.14.8.</span> 启动盘制作</h4>
<div class="outline-text-4" id="text-1-14-8">
<ol class="org-ol">
<li>启动盘制作工具 rufus <a href="https://rufus.ie/zh/">link</a> | <a href="https://github.com/pbatard/rufus">code</a></li>
<li>光盘提取工具 InfraRecorder <a href="http://infrarecorder.org/">link</a> | <a href="https://github.com/kindahl/infrarecorder">code</a></li>
</ol>
</div>
</div>

<div id="outline-container-org8b3c4b5" class="outline-4">
<h4 id="org8b3c4b5"><span class="section-number-4">1.14.9.</span> Ubuntu 磁盘分区扩容</h4>
<div class="outline-text-4" id="text-1-14-9">
<p>
使用 parted, resize2fs 命令行工具进行操作
</p>
<div class="org-src-container">
<pre class="src src-sh">root@ubuntu201:/home/ubuntu# parted
GNU Parted 3.4
Using /dev/sda
Welcome to GNU Parted! Type <span style="color: #f1fa8c;">'help'</span> to view a list of commands.
(parted) <span style="color: #ffb86c;">print</span>                 <span style="color: #6272a4;"># </span><span style="color: #6272a4;">==&gt; &#26597;&#30475;&#24403;&#21069;&#30913;&#30424;&#20998;&#21306;&#20449;&#24687;</span>
Model: VMware Virtual disk (scsi)
Disk /dev/sda: 215GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system  Name  Flags
 1      1049kB  2097kB  1049kB                     bios_grub
 2      2097kB  53.7GB  53.7GB  ext4

(parted) resizepart            <span style="color: #6272a4;"># </span><span style="color: #6272a4;">==&gt; &#25193;&#23481;&#20998;&#21306; 2</span>
Partition number? 2
Warning: Partition /dev/sda2 is being used. Are you sure you want to continue?
Yes/No? Yes
End?  [53.7GB]? 215GB          <span style="color: #6272a4;"># </span><span style="color: #6272a4;">==&gt; &#36825;&#37324;&#25193;&#23481;&#21040;&#26368;&#22823;&#21487;&#35265;&#20998;&#21306;</span>
(parted) <span style="color: #ffb86c;">print</span>                 <span style="color: #6272a4;"># </span><span style="color: #6272a4;">==&gt; &#25193;&#23481;&#21518;&#30340;&#20998;&#21306; 2 &#21464;&#25104; 215G</span>
Model: VMware Virtual disk (scsi)
Disk /dev/sda: 215GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system  Name  Flags
 1      1049kB  2097kB  1049kB                     bios_grub
 2      2097kB  215GB   215GB   ext4

(parted)

Information: You may need to update /etc/fstab.

root@ubuntu201:/home/ubuntu# df -h <span style="color: #6272a4;"># </span><span style="color: #6272a4;">==&gt; &#25991;&#20214;&#31995;&#32479;&#24182;&#26410;&#25193;&#23481;</span>
Filesystem      Size  Used Avail Use% Mounted on
tmpfs           1.6G  1.2M  1.6G   1% /run
/dev/sda2        49G   44G  3.1G  94% /
tmpfs           7.8G     0  7.8G   0% /dev/shm
tmpfs           5.0M     0  5.0M   0% /run/lock
tmpfs           1.6G  4.0K  1.6G   1% /run/user/1000
root@ubuntu201:/home/ubuntu# resize2fs /dev/sda2 <span style="color: #6272a4;"># </span><span style="color: #6272a4;">==&gt; &#35843;&#25972;&#25991;&#20214;&#31995;&#32479;&#22823;&#23567;</span>
resize2fs 1.46.5 (30-Dec-2021)
Filesystem at /dev/sda2 is mounted on /; on-line resizing required
<span style="color: #ffc9e8;">old_desc_blocks</span> = 7, <span style="color: #ffc9e8;">new_desc_blocks</span> = 25
The filesystem on /dev/sda2 is now 52428283 (4k) blocks long.

root@ubuntu201:/home/ubuntu# df -h
Filesystem      Size  Used Avail Use% Mounted on
tmpfs           1.6G  1.2M  1.6G   1% /run
/dev/sda2       197G   44G  145G  24% /
tmpfs           7.8G     0  7.8G   0% /dev/shm
tmpfs           5.0M     0  5.0M   0% /run/lock
tmpfs           1.6G  4.0K  1.6G   1% /run/user/1000
root@ubuntu201:/home/ubuntu# reboot
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf25e2e0" class="outline-3">
<h3 id="orgf25e2e0"><span class="section-number-3">1.15.</span> ORACLE</h3>
<div class="outline-text-3" id="text-1-15">
</div>
<div id="outline-container-org6086061" class="outline-4">
<h4 id="org6086061"><span class="section-number-4">1.15.1.</span> 参考资料</h4>
<div class="outline-text-4" id="text-1-15-1">
<ol class="org-ol">
<li>Oracle 关系数据库 <a href="../database/oracle.html#MissingReference">参考链接</a></li>
</ol>
</div>
</div>
<div id="outline-container-org512e5ad" class="outline-4">
<h4 id="org512e5ad"><span class="section-number-4">1.15.2.</span> 开发环境配置</h4>
<div class="outline-text-4" id="text-1-15-2">
</div>
<ol class="org-ol">
<li><a id="org73f7c2e"></a>CentOS 7 镜像启动<br />
<div class="outline-text-5" id="text-1-15-2-1">
<ol class="org-ol">
<li><a href="https://hub.docker.com/_/centos/">docker container</a></li>
<li><p>
启动 centos7 镜像
</p>
<div class="org-src-container">
<pre class="src src-sh">docker run -d -it --restart always <span style="color: #f1fa8c;">\</span>
       -v ~/srv/pence/data:/data <span style="color: #f1fa8c;">\</span>
       --hostname pence --name pence centos:7
</pre>
</div></li>
<li><p>
重新进入进行容器
</p>
<div class="org-src-container">
<pre class="src src-sh">docker exec -it pence bash
</pre>
</div></li>
<li><p>
删除容器
</p>
<div class="org-src-container">
<pre class="src src-sh">docker rm -f pence
</pre>
</div></li>
</ol>
</div>
</li>
<li><a id="org0775abd"></a>配置主机开发环境<br />
<div class="outline-text-5" id="text-1-15-2-2">
<p>
安装一波系统依赖库
</p>
<div class="org-src-container">
<pre class="src src-sh">yum update

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">common tools</span>
yum install -y net-tools vim tmux tree kernel-devel kernel-doc kernel-headers <span style="color: #f1fa8c;">\</span>
    samba samba-client ntp rsync curl git

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">for oracle 11g install</span>
yum install -y binutils compat-libcap1 compat-libstdc++-33 gcc gcc-c++ glibc <span style="color: #f1fa8c;">\</span>
    glibc-devel ksh libgcc libstdc++ libstdc++-devel libaio libaio-devel libXi <span style="color: #f1fa8c;">\</span>
    libXtst make sysstat unixODBC unixODBC-devel oracleasm-support

yum install -y gcc gcc-c++ cmake automake zip unzip python3 python3-devel <span style="color: #f1fa8c;">\</span>
    python-devel python rpm-build redhat-rpm-config asciidoc hmaccalc <span style="color: #f1fa8c;">\</span>
    perl-ExtUtils-Embed pesign xmlto audit-libs-devel binutils-devel <span style="color: #f1fa8c;">\</span>
    elfutils-devel elfutils-libelf-devel ncurses-devel bison-devel newt-devel <span style="color: #f1fa8c;">\</span>
    numactl-devel pciutils-devel python-devel zlib-devel readline-devel

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">for mysql</span>
yum install -y cmake ncurses ncurses-devel bison bison-devel openssl openssl-devel

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">for openGauss</span>
yum install -y libaio-devel flex bison bison-devel ncurses-devel glibc-devel <span style="color: #f1fa8c;">\</span>
    patch redhat-lsb-core readline-devel

</pre>
</div>
</div>
</li>

<li><a id="org0930637"></a>设置时区<br />
<div class="outline-text-5" id="text-1-15-2-3">
<div class="org-src-container">
<pre class="src src-sh">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</pre>
</div>
</div>
</li>

<li><a id="orgd7e155f"></a>安装数据库的前置准备<br />
<div class="outline-text-5" id="text-1-15-2-4">
<ol class="org-ol">
<li><a href="../article/install-oracle-11g-on-linux.html">安装 Oracle 11g</a></li>
<li>配置系统内存以及 swap</li>
</ol>
</div>
</li>
</ol>
</div>

<div id="outline-container-orge834e5a" class="outline-4">
<h4 id="orge834e5a"><span class="section-number-4">1.15.3.</span> 运维相关</h4>
<div class="outline-text-4" id="text-1-15-3">
</div>
<ol class="org-ol">
<li><a id="org46e0f56"></a>表空间及数据文件<br />
<div class="outline-text-5" id="text-1-15-3-1">
<p>
查看数据
</p>
<div class="org-src-container">
<pre class="src src-sh">
</pre>
</div>

<p>
修改数据
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #6272a4;">-- </span><span style="color: #6272a4;">&#28155;&#21152;&#25968;&#25454;&#25991;&#20214;&#21040;&#34920;&#31354;&#38388;</span>
<span style="color: #ff79c6;">alter</span> tablespace TBS_PART01 <span style="color: #ff79c6;">add</span> datafile <span style="color: #f1fa8c;">'/u01/part01.dbf'</span> <span style="color: #ff79c6;">size</span> 4G;
<span style="color: #6272a4;">-- </span><span style="color: #6272a4;">&#20462;&#25913;&#25968;&#25454;&#25991;&#20214;&#23646;&#24615;</span>
<span style="color: #ff79c6;">alter</span> database datafile <span style="color: #f1fa8c;">'/u01/part01.dbf'</span> autoextend <span style="color: #ff79c6;">off</span>;
<span style="color: #ff79c6;">alter</span> database datafile <span style="color: #f1fa8c;">'/u01/part01.dbf'</span> autoextend <span style="color: #ff79c6;">on</span> <span style="color: #ff79c6;">next</span> 100M maxsize 10G;
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org1e20817" class="outline-3">
<h3 id="org1e20817"><span class="section-number-3">1.16.</span> MySQL</h3>
<div class="outline-text-3" id="text-1-16">
</div>
<div id="outline-container-org749c7e6" class="outline-4">
<h4 id="org749c7e6"><span class="section-number-4">1.16.1.</span> 参考资料</h4>
<div class="outline-text-4" id="text-1-16-1">
<ol class="org-ol">
<li>MySQL 开发文档 8.0.30  <a href="https://dev.mysql.com/doc/dev/mysql-server/8.0.30/PAGE_GET_STARTED.html#start_source">Source Code Documents</a></li>
<li>MySQL 使用文档 <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html">InnoDB Storage Engine</a></li>
<li>专栏 <a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/MySQL%E5%AE%9E%E6%88%9845%E8%AE%B2">MySQL 实战 45 讲</a></li>
<li>三方库 <a href="https://gorm.io/docs/index.html">GORM</a> | <a href="https://docs.spring.io/spring-data/jpa/docs/2.7.7/reference/html/">JPA</a> | <a href="https://github.com/mybatis/mybatis-3">mybatis-3</a></li>
</ol>
</div>
</div>

<div id="outline-container-org65af72f" class="outline-4">
<h4 id="org65af72f"><span class="section-number-4">1.16.2.</span> 主从架构实验环境</h4>
<div class="outline-text-4" id="text-1-16-2">
</div>
<ol class="org-ol">
<li><a id="org838f30f"></a>配置 Docker 环境<br />
<div class="outline-text-5" id="text-1-16-2-1">
<ol class="org-ol">
<li>安装 Docker Server</li>
<li>参考文档 <a href="https://docs.docker.com/compose/install/other">Install the Compose standalone</a> 安装 docker-compose</li>
<li>编写启动配置文件 <a href="env-mysql/">MySQL 主备配置</a></li>
<li>docker hub <a href="https://hub.docker.com/_/mysql">mysql 镜像</a></li>
<li>启动服务</li>
</ol>
<div class="org-src-container">
<pre class="src src-sh">docker-compose up -d
</pre>
</div>
</div>
</li>

<li><a id="org6f2f71c"></a>配置主备环境<br />
<ol class="org-ol">
<li><a id="org37c1c92"></a>查看主备网络配置<br />
<div class="outline-text-6" id="text-1-16-2-2-1">
<div class="org-src-container">
<pre class="src src-sh">docker inspect mysql-master | jq <span style="color: #f1fa8c;">'.[0].NetworkSettings.Networks.dbnet.IPAddress'</span>
docker inspect mysql-slave  | jq <span style="color: #f1fa8c;">'.[0].NetworkSettings.Networks.dbnet.IPAddress'</span>
</pre>
</div>

<p>
查看主机网络
</p>
<div class="org-src-container">
<pre class="src src-sh">docker network ls
</pre>
</div>
</div>
</li>

<li><a id="orgad7512e"></a>主库配置备库用户的访问权限<br />
<div class="outline-text-6" id="text-1-16-2-2-2">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #ff79c6;">create</span> <span style="color: #ffb86c;">user</span> "user02"@"%" identified <span style="color: #ff79c6;">by</span> "user02";
<span style="color: #ff79c6;">grant</span> replication slave <span style="color: #ff79c6;">on</span> *.* <span style="color: #ff79c6;">to</span> "user02"@"%";
flush <span style="color: #ff79c6;">privileges</span>;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql">show master status
</pre>
</div>
</div>
</li>

<li><a id="orgc9b2caf"></a>备库同步配置<br />
<div class="outline-text-6" id="text-1-16-2-2-3">
<div class="org-src-container">
<pre class="src src-sql"># &#36825;&#37324;&#30340; <span style="color: #ff79c6;">host</span> &#31561;&#21442;&#25968;&#38656;&#35201;&#26681;&#25454;&#20027;&#24211;&#30340;&#37197;&#32622;&#20462;&#25913;
<span style="color: #6272a4;">-- </span><span style="color: #6272a4;">change master to master_host='172.20.0.100', master_user='user02', master_password='user02', master_log_file='1.000003', master_log_pos=823;</span>
<span style="color: #6272a4;">-- </span><span style="color: #6272a4;">change master to master_host='mysql-master', master_user='user02', master_password='user02', master_log_file='mysql-bin.000003', master_log_pos=0;</span>
change master <span style="color: #ff79c6;">to</span> master_host=<span style="color: #f1fa8c;">'mysql-master'</span>, master_user=<span style="color: #f1fa8c;">'user02'</span>, master_password=<span style="color: #f1fa8c;">'user02'</span>, master_log_file=<span style="color: #f1fa8c;">'mysql-bin.000003'</span>, master_log_pos=841;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #ff79c6;">start</span> slave;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql">show slave status\G
</pre>
</div>

<p>
如果出现这样的两行表示结果是正确的
</p>
<blockquote>
<p>
Slave<sub>IO</sub><sub>Running</sub>: Yes
Slave<sub>SQL</sub><sub>Running</sub>: Yes
</p>
</blockquote>

<p>
重置 slave
</p>
<div class="org-src-container">
<pre class="src src-sql">stop slave;
reset slave;
</pre>
</div>
</div>
</li>

<li><a id="org6c01993"></a>主库建表<br />
<div class="outline-text-6" id="text-1-16-2-2-4">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #ff79c6;">create</span> <span style="color: #ff79c6;">table</span> <span style="color: #50fa7b;">t</span> (
  id <span style="color: #bd93f9;">int</span> <span style="color: #ff79c6;">primary</span> <span style="color: #ff79c6;">key</span> auto_increment,
  c <span style="color: #bd93f9;">int</span>
);
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #ff79c6;">insert</span> <span style="color: #ff79c6;">into</span> t(c) <span style="color: #ff79c6;">values</span> (1), (2), (3);
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #ff79c6;">delete</span> <span style="color: #ff79c6;">from</span> t <span style="color: #ff79c6;">where</span> id &lt; 10;
</pre>
</div>
</div>
</li>

<li><a id="orga6794e3"></a>备库查询<br />
<div class="outline-text-6" id="text-1-16-2-2-5">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #ff79c6;">select</span> * <span style="color: #ff79c6;">from</span> t;
</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="org36ff543"></a>设置登录别名<br />
<div class="outline-text-5" id="text-1-16-2-3">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">alias</span> <span style="color: #ffc9e8;">my1</span>=<span style="color: #f1fa8c;">"MYSQL_PWD=p111   mysql -h127.0.0.1 -uroot -P9001"</span>
<span style="color: #ffb86c;">alias</span> <span style="color: #ffc9e8;">my2</span>=<span style="color: #f1fa8c;">"MYSQL_PWD=p222   mysql -h127.0.0.1 -uroot -P9002"</span>
<span style="color: #ffb86c;">alias</span> <span style="color: #ffc9e8;">u01</span>=<span style="color: #f1fa8c;">"MYSQL_PWD=user01 mysql -h127.0.0.1 -uuser01 -P9001 test01"</span>
<span style="color: #ffb86c;">alias</span> <span style="color: #ffc9e8;">u02</span>=<span style="color: #f1fa8c;">"MYSQL_PWD=user02 mysql -h127.0.0.1 -uuser02 -P9002 test01"</span>
<span style="color: #ffb86c;">alias</span> <span style="color: #ffc9e8;">m100</span>=<span style="color: #f1fa8c;">'docker exec -it mysql-master /bin/bash'</span>
<span style="color: #ffb86c;">alias</span> <span style="color: #ffc9e8;">m101</span>=<span style="color: #f1fa8c;">'docker exec -it mysql-slave /bin/bash'</span>
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org42475a6" class="outline-4">
<h4 id="org42475a6"><span class="section-number-4">1.16.3.</span> 运维主题</h4>
<div class="outline-text-4" id="text-1-16-3">
</div>
<ol class="org-ol">
<li><a id="org9e7b589"></a>创建用户 &amp; 授权访问数据库<br />
<div class="outline-text-5" id="text-1-16-3-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #ff79c6;">create</span> <span style="color: #ffb86c;">user</span> <span style="color: #f1fa8c;">'jeffrey'</span>@<span style="color: #f1fa8c;">'%'</span> identified <span style="color: #ff79c6;">by</span> <span style="color: #f1fa8c;">'hello'</span>;
<span style="color: #ff79c6;">grant</span> <span style="color: #ff79c6;">all</span> <span style="color: #ff79c6;">privileges</span> <span style="color: #ff79c6;">on</span> employees.* <span style="color: #ff79c6;">to</span> <span style="color: #f1fa8c;">'jeffrey'</span>@<span style="color: #f1fa8c;">'%'</span>;
flush <span style="color: #ff79c6;">privileges</span>;
</pre>
</div>
</div>
</li>

<li><a id="org34ff391"></a>查看当前用户权限<br />
<div class="outline-text-5" id="text-1-16-3-2">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #ff79c6;">select</span> <span style="color: #ffb86c;">user</span>, <span style="color: #ff79c6;">host</span> <span style="color: #ff79c6;">from</span> mysql.<span style="color: #ffb86c;">user</span>;
</pre>
</div>
</div>
</li>
<li><a id="org749a849"></a>修改用户密码<br />
<div class="outline-text-5" id="text-1-16-3-3">
<div class="org-src-container">
<pre class="src src-sql">use mysql;
<span style="color: #ff79c6;">set</span> password <span style="color: #ff79c6;">for</span> <span style="color: #f1fa8c;">'jeffrey'</span>@<span style="color: #f1fa8c;">'%'</span> = password(<span style="color: #f1fa8c;">'root'</span>);
<span style="color: #ff79c6;">update</span> <span style="color: #ffb86c;">user</span> <span style="color: #ff79c6;">set</span> password = password(<span style="color: #f1fa8c;">'new.password'</span>) <span style="color: #ff79c6;">where</span> <span style="color: #ffb86c;">user</span> = <span style="color: #f1fa8c;">'jeffrey'</span> <span style="color: #ff79c6;">and</span> <span style="color: #ff79c6;">host</span> = <span style="color: #f1fa8c;">'%'</span>;
<span style="color: #ff79c6;">update</span> <span style="color: #ffb86c;">user</span> <span style="color: #ff79c6;">set</span> <span style="color: #ff79c6;">host</span> = <span style="color: #f1fa8c;">'%'</span> <span style="color: #ff79c6;">where</span> <span style="color: #ffb86c;">user</span> = <span style="color: #f1fa8c;">'root'</span>;
flush <span style="color: #ff79c6;">privileges</span>;

<span style="color: #ff79c6;">alter</span> <span style="color: #ffb86c;">user</span> <span style="color: #f1fa8c;">'jeffrey'</span>@<span style="color: #f1fa8c;">'%'</span> identified <span style="color: #ff79c6;">by</span> <span style="color: #f1fa8c;">'mypass'</span>;
</pre>
</div>
</div>
</li>
<li><a id="org7461c73"></a>重建表<br />
<div class="outline-text-5" id="text-1-16-3-4">
<p>
InnoDB 不支持直接优化表
</p>
<pre class="example" id="orgedf0481">
mysql&gt; optimize table price_daily;
+-----------------------------+----------+----------+-------------------------------------------------------------------+
| Table                       | Op       | Msg_type | Msg_text                                                          |
+-----------------------------+----------+----------+-------------------------------------------------------------------+
| prod_alpen_dict.price_daily | optimize | note     | Table does not support optimize, doing recreate + analyze instead |
| prod_alpen_dict.price_daily | optimize | status   | OK                                                                |
+-----------------------------+----------+----------+-------------------------------------------------------------------+
</pre>

<p>
InnoDB 需要重建后分析来优化表，对应 SQL 如下
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #6272a4;">-- </span><span style="color: #6272a4;">recreate</span>
<span style="color: #ff79c6;">alter</span> <span style="color: #ff79c6;">table</span> <span style="color: #50fa7b;">price_daily</span> engine=innodb;
<span style="color: #6272a4;">-- </span><span style="color: #6272a4;">analyze</span>
analyze <span style="color: #ff79c6;">table</span> price_daily;
</pre>
</div>

<pre class="example" id="orga61bd8e">
mysql&gt; alter table price_daily engine=innodb;
Query OK, 0 rows affected (3 min 2.06 sec)
Records: 0  Duplicates: 0  Warnings: 0
mysql&gt; analyze table price_daily;
+-----------------------------+---------+----------+----------+
| Table                       | Op      | Msg_type | Msg_text |
+-----------------------------+---------+----------+----------+
| prod_alpen_dict.price_daily | analyze | status   | OK       |
+-----------------------------+---------+----------+----------+
1 row in set (0.04 sec)
</pre>
</div>
</li>

<li><a id="org872c34a"></a>高可用部署方案<br />
<div class="outline-text-5" id="text-1-16-3-5">
<ol class="org-ol">
<li>全同步复制 5.7.17 后版本
<ul class="org-ul">
<li>GTID 模式下运行</li>
<li>日志为 row 格式</li>
</ul></li>
<li>MGR
<ul class="org-ul">
<li>基于 raft 算法自动选主</li>
<li>保证 N/2 + 1 节点可用</li>
<li>基于 MySQL 插件实现，部分方便</li>
</ul></li>
</ol>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgf228cb4" class="outline-4">
<h4 id="orgf228cb4"><span class="section-number-4">1.16.4.</span> 源码研究</h4>
<div class="outline-text-4" id="text-1-16-4">
<ol class="org-ol">
<li>专栏 <a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/MySQL%E5%AE%9E%E6%88%9845%E8%AE%B2">MySQL45</a> | <a href="https://blog.jcole.us/innodb/">Data Structure</a> | <a href="http://www.unofficialmysqlguide.com/introduction.html">Unofficial Optimizer Guide</a></li>
<li><a href="mysql-source-code.html">MySQL 源码笔记</a></li>
<li>示例数据库 <a href="https://dev.mysql.com/doc/employee/en/employees-installation.html">Employees Sample Database</a> | <a href="https://github.com/datacharmer/test_db">Github</a> | <a href="https://dev.mysql.com/doc/index-other.html">Example DB: world, sakila</a></li>
<li>代码阅读分享
<ul class="org-ul">
<li><a href="../mysql/share-01-mysql-group-by-analysis.html">GroupBy 语句实现原理探索</a></li>
<li><a href="../mysql/share-02-mysql-optimize.html">MySQL 优化器实现原理探索</a></li>
</ul></li>
</ol>
</div>
<ol class="org-ol">
<li><a id="org16f772d"></a>安装编译调试环境<br />
<div class="outline-text-5" id="text-1-16-4-1">
<ol class="org-ol">
<li><p>
系统依赖安装
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#23433;&#35013;&#20381;&#36182;&#21253;</span>
yum update

yum install -y net-tools vim tmux tree kernel-devel kernel-doc kernel-headers <span style="color: #f1fa8c;">\</span>
    samba samba-client ntp rsync curl git wget

yum install -y binutils compat-libcap1 compat-libstdc++-33 gcc gcc-c++ glibc <span style="color: #f1fa8c;">\</span>
    glibc-devel ksh libgcc libstdc++ libstdc++-devel libaio libaio-devel libXi <span style="color: #f1fa8c;">\</span>
    libXtst make sysstat unixODBC unixODBC-devel oracleasm-support zip unzip <span style="color: #f1fa8c;">\</span>
    python-devel python rpm-build redhat-rpm-config asciidoc hmaccalc <span style="color: #f1fa8c;">\</span>
    perl-ExtUtils-Embed pesign xmlto audit-libs-devel binutils-devel <span style="color: #f1fa8c;">\</span>
    elfutils-devel elfutils-libelf-devel ncurses-devel bison-devel newt-devel <span style="color: #f1fa8c;">\</span>
    python3 python3-devel <span style="color: #f1fa8c;">\</span>
    numactl-devel pciutils-devel python-devel zlib-devel readline-devel
</pre>
</div></li>
<li><p>
编译工具安装 <a href="https://gcc.gnu.org/install/">GCC</a> | <a href="https://www.sourceware.org/gdb/">GDB</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">gcc</span>
wget https://mirrors.tuna.tsinghua.edu.cn/gnu/gcc/gcc-12.1.0/gcc-12.1.0.tar.gz
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#19979;&#36733; gcc &#30340;&#20381;&#36182;</span>
./contrib/download_prerequisites
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">--enable-multilib &#24320;&#21551; 32 &#20301;&#24211;&#25903;&#25345;</span>
./configure --prefix=/usr/local/gcc --disable-multilib
make
make install

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">gdb</span>
wget https://mirrors.tuna.tsinghua.edu.cn/gnu/gdb/gdb-12.1.tar.gz
./configure --prefix=/usr/local/gdb
make
make install
</pre>
</div>
<p>
添加环境变量
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">PATH</span>=/usr/local/gcc/bin:$<span style="color: #ffc9e8;">PATH</span>
<span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">LD_LIBRARY_PATH</span>=/usr/local/gcc/lib64:$<span style="color: #ffc9e8;">LD_LIBRARY_PATH</span>
<span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">PATH</span>=/usr/local/gdb/bin:$<span style="color: #ffc9e8;">PATH</span>
</pre>
</div></li>
<li><p>
cmake 安装 <a href="https://cmake.org/install/">CMake Install</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#19979;&#36733;&#20195;&#30721;</span>
curl -OL https://github.com/Kitware/CMake/releases/download/v3.25.2/cmake-3.25.2.tar.gz
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#32534;&#35793;&#23433;&#35013;</span>
./bootstrap --prefix=/usr/local/cmake
make
make install
</pre>
</div>
<p>
添加环境变量
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">PATH</span>=/usr/local/cmake/bin:$<span style="color: #ffc9e8;">PATH</span>
</pre>
</div></li>
<li><p>
boost 下载并安装
</p>
<div class="org-src-container">
<pre class="src src-sh">wget -c https://boostorg.jfrog.io/artifactory/main/release/1.77.0/source/boost_1_77_0.tar.bz2
tar xjvf boost_1_77_0.tar.bz2
</pre>
</div></li>
</ol>
</div>
</li>
<li><a id="orgfb996e3"></a>编译代码及初始数据库<br />
<div class="outline-text-5" id="text-1-16-4-2">
<ol class="org-ol">
<li>参考资料 <a href="https://dev.mysql.com/doc/refman/8.0/en/source-installation.html">源代码安装文档</a> | <a href="https://dev.mysql.com/doc/refman/8.0/en/making-trace-files.html">TRACE 文件</a> | <a href="https://dev.mysql.com/doc/refman/8.0/en/using-gdb-on-mysqld.html">&#x2013;gdb</a> | <a href="https://dev.mysql.com/doc/dev/mysql-server/8.0.30/PAGE_OPT_TRACE.html">The Optimizer Trace</a></li>
<li><p>
配置文件 <code>/etc/my.cnf</code>
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">-*- mode: conf; -*-</span>

[<span style="color: #bd93f9;">mysqld</span>]
<span style="color: #ffc9e8;">basedir</span>=/opt/local/mysql
<span style="color: #ffc9e8;">datadir</span>=/opt/local/mysql/data
<span style="color: #ffc9e8;">log-error</span>=/tmp/mysql-error.log
<span style="color: #ffc9e8;">pid-file</span>=/tmp/mysql.pid
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">debug=d,info,error,query,general,where:O,/tmp/mysqld.trace</span>
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">debug=+d,info,error,query,general,enter,where:O,/tmp/mysqld.trace</span>
debug

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">autocommit=0</span>
<span style="color: #ffc9e8;">innodb_lock_wait_timeout</span>=3600
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">long_query_time = 0</span>
<span style="color: #ffc9e8;">slow_query_log</span> = on
<span style="color: #ffc9e8;">slow_query_log_file</span> = /tmp/mysql-slow.log
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">secure_file_priv = /tmp</span>

[<span style="color: #bd93f9;">client</span>]
<span style="color: #ffc9e8;">user</span>=root
</pre>
</div></li>
<li><p>
编译源代码
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#20934;&#22791;&#20195;&#30721;&#32534;&#35793;&#30446;&#24405;, &#36755;&#20986;&#30446;&#24405;&#20026; out</span>
mkdir out
<span style="color: #ffb86c;">cd</span> out
cmake -DCMAKE_INSTALL_PREFIX=/opt/local/mysql -DWITH_BOOST=../../boost/boost_1_77_0 -DWITH_DEBUG=1 -DWITH_UNIT_TESTS=0 ..
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#32534;&#35793;&#20195;&#30721;</span>
<span style="color: #ffb86c;">cd</span> out
make -j8
make install
</pre>
</div></li>
<li><p>
初始化数据库
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21021;&#22987;&#21270;&#25968;&#25454;&#24211;</span>
mysqld --defaults-file=/etc/my.cnf --initialize-insecure

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">https://dev.mysql.com/doc/refman/8.0/en/starting-server.html</span>
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21551;&#21160;&#25968;&#25454;&#24211;&#25968;&#25454;&#24211;, --gdb &#26159;&#24320;&#21551; gdb &#35843;&#35797;&#25903;&#25345;</span>
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">--debug=d,info,error,query,general,where:O,/tmp/mysqld.trace</span>
mysqld --gdb &gt;/dev/null 2&gt;&amp;1 &amp;

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#38142;&#25509;&#25968;&#25454;&#24211;</span>
mysql
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#20851;&#38381;&#25968;&#25454;&#24211;</span>
mysqladmin shutdown
</pre>
</div></li>
</ol>
</div>
</li>
<li><a id="orgb9e6bdd"></a>代码阅读配置<br />
<div class="outline-text-5" id="text-1-16-4-3">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#29983;&#25104;&#36339;&#36716;&#30340; TAG</span>
ctags -e -R --languages=c,c++ .
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-orga3a6985" class="outline-3">
<h3 id="orga3a6985"><span class="section-number-3">1.17.</span> Redis</h3>
<div class="outline-text-3" id="text-1-17">
</div>
<div id="outline-container-org9ed9a5e" class="outline-4">
<h4 id="org9ed9a5e"><span class="section-number-4">1.17.1.</span> 系统监控</h4>
<div class="outline-text-4" id="text-1-17-1">
<p>
查看内存
</p>
<pre class="example" id="org8382e64">
0.0.0.0:6379&gt; info memory
# Memory
used_memory:96005008
used_memory_rss:101408768 # Redis 占用操作系统的内存
used_memory_peak:96270784
used_memory_peak_perc:99.72%
used_memory_overhead:61210584
used_memory_startup:812096
used_memory_dataset:34794424
used_memory_dataset_perc:36.55%
allocator_allocated:96049840
allocator_active:96358400
allocator_resident:100630528
total_system_memory:67385872384
used_memory_lua:30720
used_memory_scripts:0
number_of_cached_scripts:0
maxmemory:0 # 设置的最大内存
maxmemory_policy:noeviction
allocator_frag_ratio:1.00
allocator_frag_bytes:308560
allocator_rss_ratio:1.04
allocator_rss_bytes:4272128
rss_overhead_ratio:1.01
rss_overhead_bytes:778240
mem_fragmentation_ratio:1.06 # 内存碎片比例 = used_memory_rss/used_memory
mem_fragmentation_bytes:5444784
mem_not_counted_for_evict:0
mem_replication_backlog:0
mem_clients_slaves:0
mem_clients_normal:184592
mem_aof_buffer:0
mem_allocator:jemalloc-5.1.0
active_defrag_running:0
lazyfree_pending_objects:0
lazyfreed_objects:0
</pre>

<p>
查看容量
</p>
<pre class="example" id="org40741aa">
0.0.0.0:6379&gt; info keyspace
# Keyspace
db0:keys=25,expires=0,avg_ttl=0
db2:keys=1085884,expires=0,avg_ttl=0
0.0.0.0:6379&gt;
</pre>

<p>
观测当前的执行命令
</p>
<pre class="example" id="org2248c91">
0.0.0.0:6379&gt; monitor
OK
</pre>
</div>
</div>
</div>

<div id="outline-container-orge374ff1" class="outline-3">
<h3 id="orge374ff1"><span class="section-number-3">1.18.</span> PostgreSQL</h3>
<div class="outline-text-3" id="text-1-18">
</div>
<div id="outline-container-org16fce1e" class="outline-4">
<h4 id="org16fce1e"><span class="section-number-4">1.18.1.</span> 前置环境变量</h4>
<div class="outline-text-4" id="text-1-18-1">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">PGDATA</span>=/opt/local/pgsql/data
</pre>
</div>
</div>
</div>
<div id="outline-container-org34c8baf" class="outline-4">
<h4 id="org34c8baf"><span class="section-number-4">1.18.2.</span> 编译调试 &amp; 初始化数据</h4>
<div class="outline-text-4" id="text-1-18-2">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#37197;&#32622;&#35843;&#35797;&#29615;&#22659;</span>
./configure --prefix=/opt/local/pgsql --enable-cassert --enable-debug <span style="color: #ffc9e8;">CFLAGS</span>=<span style="color: #f1fa8c;">"-ggdb -O0 -fno-omit-frame-pointer"</span>
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#32534;&#35793;, &#23433;&#35013;</span>
make -j8
make install
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21021;&#22987;&#21270;&#25968;&#25454;&#24211;</span>
initdb -D /opt/local/pgsql/data
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21551;&#21160;&#25968;&#25454;&#24211;</span>
pg_ctl -D /opt/local/pgsql/data -l logfile start
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21019;&#24314;&#24211;</span>
createdb test01
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#38142;&#25509;&#24211;</span>
psql test01
</pre>
</div>
</div>
</div>
<div id="outline-container-org6d1e5f8" class="outline-4">
<h4 id="org6d1e5f8"><span class="section-number-4">1.18.3.</span> 调试命令</h4>
<div class="outline-text-4" id="text-1-18-3">
<p>
找到对应的进程
</p>
<div class="org-src-container">
<pre class="src src-sh">$ ps aux | grep postgres
jinghuihu        87208   0.0  0.0 34130524    676 s006  S+   12:13PM   0:00.00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn --exclude-dir=.idea --exclude-dir=.tox postgres
jinghuihu        82329   0.0  0.2 34313316  36860   ??  Ss   10:51AM   0:00.16 postgres: jinghuihu test01 [local] idle
jinghuihu        82278   0.0  0.0 34309036   1792   ??  Ss   10:51AM   0:00.00 postgres: logical replication launcher
jinghuihu        82277   0.0  0.0 34310060   2136   ??  Ss   10:51AM   0:00.02 postgres: autovacuum launcher
jinghuihu        82276   0.0  0.0 34307820   5152   ??  Ss   10:51AM   0:00.04 postgres: walwriter
jinghuihu        82275   0.0  0.0 34307820   2212   ??  Ss   10:51AM   0:00.06 postgres: background writer
jinghuihu        82274   0.0  0.0 34307820   2788   ??  Ss   10:51AM   0:00.01 postgres: checkpointer
jinghuihu        80299   0.0  0.1 34309108  14920   ??  Ss   10:41AM   0:00.13 /opt/local/pgsql/bin/postgres -D /opt/local/pgsql/data
</pre>
</div>

<p>
找到对应的进程，然后使用 lldb attach 上，打断点
</p>
<div class="org-src-container">
<pre class="src src-text">(lldb) attach -p 82329
Process 82329 stopped
* thread #1, queue = 'com.apple.main-thread', stop reason = signal SIGSTOP
    frame #0: 0x00007ff810e892fe libsystem_kernel.dylib`kevent + 10
libsystem_kernel.dylib`kevent:
-&gt;  0x7ff810e892fe &lt;+10&gt;: jae    0x7ff810e89308            ; &lt;+20&gt;
    0x7ff810e89300 &lt;+12&gt;: movq   %rax, %rdi
    0x7ff810e89303 &lt;+15&gt;: jmp    0x7ff810e84dc2            ; cerror_nocancel
    0x7ff810e89308 &lt;+20&gt;: retq
Target 0: (postgres) stopped.
Executable module set to "/opt/local/pgsql/bin/postgres".
Architecture set to: x86_64h-apple-macosx-.
(lldb) b exec_simple_query
Breakpoint 1: where = postgres`exec_simple_query + 29 at postgres.c:994:21, address = 0x000000010f17af6d
(lldb) c
Process 82329 resuming
Process 82329 stopped
* thread #1, queue = 'com.apple.main-thread', stop reason = breakpoint 1.1
    frame #0: 0x000000010f17af6d postgres`exec_simple_query + 29 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/tcop/postgres.c:994
   991  static void
   992  exec_simple_query(const char *query_string)
   993  {
-&gt; 994      CommandDest dest = whereToSendOutput;
                               ^
   995      MemoryContext oldcontext;
   996      List           *parsetree_list;
   997      ListCell   *parsetree_item;
Target 0: (postgres) stopped.
(lldb)  bt
* thread #1, queue = 'com.apple.main-thread', stop reason = breakpoint 1.1
  * frame #0: 0x000000010f17af6d postgres`exec_simple_query + 29 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/tcop/postgres.c:994
    frame #1: 0x000000010f17a633 postgres`PostgresMain + 2243 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/tcop/postgres.c:4593
    frame #2: 0x000000010f08d0d2 postgres`BackendRun + 50 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/postmaster/postmaster.c:4511
    frame #3: 0x000000010f08c6bc postgres`BackendStartup + 524 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/postmaster/postmaster.c:4239
    frame #4: 0x000000010f08b4ec postgres`ServerLoop + 716 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/postmaster/postmaster.c:1806
    frame #5: 0x000000010f088dc7 postgres`PostmasterMain + 6471 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/postmaster/postmaster.c:1478
    frame #6: 0x000000010ef6eda0 postgres`main + 816 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/main/main.c:202
    frame #7: 0x00007ff810b92310 dyld`start + 2432
(lldb) c
Process 82329 resuming
(lldb) detach
Process 82329 detached
(lldb)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org903c87f" class="outline-3">
<h3 id="org903c87f"><span class="section-number-3">1.19.</span> ClickHouse</h3>
<div class="outline-text-3" id="text-1-19">
</div>
<div id="outline-container-org2c31257" class="outline-4">
<h4 id="org2c31257"><span class="section-number-4">1.19.1.</span> 安装步骤</h4>
<div class="outline-text-4" id="text-1-19-1">
<ol class="org-ol">
<li>官方文档 <a href="https://clickhouse.com/docs/en/install">doc</a></li>
</ol>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">https://clickhouse.com/docs/en/development/build-osx</span>
cmake -G Ninja -DCMAKE_BUILD_TYPE=RelWithDebInfo -S . -B build
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgdfdf6d2" class="outline-3">
<h3 id="orgdfdf6d2"><span class="section-number-3">1.20.</span> nginx</h3>
<div class="outline-text-3" id="text-1-20">
</div>
<div id="outline-container-orgc341f58" class="outline-4">
<h4 id="orgc341f58"><span class="section-number-4">1.20.1.</span> 文件配置</h4>
<div class="outline-text-4" id="text-1-20-1">
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #bd93f9;">location /api</span> {
  client_max_body_size 30000M;
  client_body_buffer_size 200000k;
  proxy_pass  http://api/supercap/pipe;
  client_body_temp_path /media/ss/synology_office/server_Seq-Cap/tmp_nginx;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfd724c4" class="outline-3">
<h3 id="orgfd724c4"><span class="section-number-3">1.21.</span> Kafka</h3>
<div class="outline-text-3" id="text-1-21">
<ol class="org-ol">
<li><a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89">JVM 系列</a></li>
</ol>
</div>
<div id="outline-container-orgf6f4b5f" class="outline-4">
<h4 id="orgf6f4b5f"><span class="section-number-4">1.21.1.</span> 资源链接</h4>
<div class="outline-text-4" id="text-1-21-1">
<ol class="org-ol">
<li>说明文档 <a href="https://kafka.apache.org/documentation/">link</a></li>
</ol>
</div>
</div>
<div id="outline-container-orgb7a9329" class="outline-4">
<h4 id="orgb7a9329"><span class="section-number-4">1.21.2.</span> 环境配置</h4>
<div class="outline-text-4" id="text-1-21-2">
</div>
<ol class="org-ol">
<li><a id="orgbad66dc"></a>官网快速使用手册<br />
<div class="outline-text-5" id="text-1-21-2-1">
<ol class="org-ol">
<li><a href="https://kafka.apache.org/quickstart">quickstart</a></li>
</ol>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21551;&#21160; zk</span>
./bin/zookeeper-server-start.sh config/zookeeper.properties
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21551;&#21160; kafka</span>
./bin/kafka-server-start.sh config/server.properties

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21019;&#24314; topic</span>
./bin/kafka-topics.sh --bootstrap-server localhost:9092 --create --topic quickstart-events
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#26174;&#31034; topic &#21015;&#34920;</span>
./bin/kafka-topics.sh --bootstrap-server localhost:9092 --list
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#26597;&#30475;&#25351;&#23450; topic &#29366;&#24577;</span>
./bin/kafka-topics.sh --bootstrap-server localhost:9092 --describe --topic quickstart-events

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#29983;&#20135;&#32773; &amp; &#28040;&#36153;&#32773;</span>
./bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --from-beginning --topic quickstart-events
./bin/kafka-console-producer.sh --bootstrap-server localhost:9092 --topic quickstart-events
</pre>
</div>

<p>
配置相关
</p>
<div class="org-src-container">
<pre class="src src-sh">./bin/kafka-configs.sh --zookeeper localhost:2181 --all
</pre>
</div>
</div>
</li>

<li><a id="orge299b6f"></a>docker 版本配置<br />
<div class="outline-text-5" id="text-1-21-2-2">
<ol class="org-ol">
<li><a href="https://hub.docker.com/r/bitnami/kafka/">docker hub</a></li>
<li><p>
配置文件 <a href="env-kafka/docker-compose.yaml">docker-compose.yaml</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">docker-compose up -d
</pre>
</div></li>
</ol>
</div>
</li>

<li><a id="orgc78232d"></a>源代码<br />
<div class="outline-text-5" id="text-1-21-2-3">
<p>
跳过测试编译
</p>
<div class="org-src-container">
<pre class="src src-sh">./gradlew build -x test
</pre>
</div>

<p>
编译发布包
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#32534;&#35793;&#21253;</span>
./gradlew clean releaseTarGz

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#32534;&#35793;&#20135;&#29289;</span>
ls ./core/build/distributions/
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org9e69e26" class="outline-3">
<h3 id="org9e69e26"><span class="section-number-3">1.22.</span> RocketMQ</h3>
<div class="outline-text-3" id="text-1-22">
</div>
<div id="outline-container-org6944519" class="outline-4">
<h4 id="org6944519"><span class="section-number-4">1.22.1.</span> 资源链接</h4>
<div class="outline-text-4" id="text-1-22-1">
<ol class="org-ol">
<li>官网文档 <a href="https://rocketmq.apache.org/docs/4.x/introduction/02quickstart">link</a></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org7eefb90" class="outline-3">
<h3 id="org7eefb90"><span class="section-number-3">1.23.</span> Hive</h3>
<div class="outline-text-3" id="text-1-23">
<p>
配置 <a href="https://hadoop.apache.org/docs/r2.6.2/hadoop-project-dist/hadoop-common/SingleCluster.html#Standalone_Operation">hadoop</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">HADOOP_HOME</span>=/opt/local/hack/hadoop-2.6.0
<span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">PATH</span>=<span style="color: #f1fa8c;">"$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$PATH"</span>
<span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">HIVE_HOME</span>=/opt/local/hack/apache-hive-1.2.2-bin
<span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">PATH</span>=<span style="color: #f1fa8c;">"$HIVE_HOME/bin:$PATH"</span>
</pre>
</div>

<p>
配置 core-site.xml
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #50fa7b;">configuration</span>&gt;
   &lt;<span style="color: #50fa7b;">property</span>&gt;
      &lt;<span style="color: #50fa7b;">name</span>&gt;fs.defaultFS&lt;/<span style="color: #50fa7b;">name</span>&gt;
      &lt;<span style="color: #50fa7b;">value</span>&gt;hdfs://localhost:9000&lt;/<span style="color: #50fa7b;">value</span>&gt;
   &lt;/<span style="color: #50fa7b;">property</span>&gt;
&lt;/<span style="color: #50fa7b;">configuration</span>&gt;
</pre>
</div>

<p>
配置 hdfs-site.xml
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #50fa7b;">configuration</span>&gt;
  &lt;<span style="color: #50fa7b;">property</span>&gt;
    &lt;<span style="color: #50fa7b;">name</span>&gt;dfs.replication&lt;/<span style="color: #50fa7b;">name</span>&gt;
    &lt;<span style="color: #50fa7b;">value</span>&gt;1&lt;/<span style="color: #50fa7b;">value</span>&gt;
  &lt;/<span style="color: #50fa7b;">property</span>&gt;

  &lt;<span style="color: #50fa7b;">property</span>&gt;
    &lt;<span style="color: #50fa7b;">name</span>&gt;dfs.namenode.name.dir&lt;/<span style="color: #50fa7b;">name</span>&gt;
    &lt;<span style="color: #50fa7b;">value</span>&gt;/opt/local/hdfs/namenode&lt;/<span style="color: #50fa7b;">value</span>&gt;
  &lt;/<span style="color: #50fa7b;">property</span>&gt;

  &lt;<span style="color: #50fa7b;">property</span>&gt;
    &lt;<span style="color: #50fa7b;">name</span>&gt;dfs.datanode.data.dir&lt;/<span style="color: #50fa7b;">name</span>&gt;
    &lt;<span style="color: #50fa7b;">value</span>&gt;/opt/local/hdfs/datanode&lt;/<span style="color: #50fa7b;">value</span>&gt;
  &lt;/<span style="color: #50fa7b;">property</span>&gt;
&lt;/<span style="color: #50fa7b;">configuration</span>&gt;
</pre>
</div>

<p>
初始化命令
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#26684;&#24335;&#21270; namenode</span>
hdfs namenode -format
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21551;&#21160;/&#20851;&#38381; dfs</span>
start-dfs.sh
stop-dfs.sh
</pre>
</div>

<p>
<a href="https://cwiki.apache.org/confluence/display/Hive/GettingStarted#GettingStarted-InstallationandConfiguration">hive</a> 需要有 /tmp, /user/hive/warehouse 目录, 并且配置 g+w 权限
</p>
<ul class="org-ul">
<li>配置元数据存放目录 hive.metastore.warehouse.dir</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh">hadoop fs -mkdir       /tmp
hadoop fs -mkdir -p    /user/hive/warehouse
hadoop fs -chmod g+w   /tmp
hadoop fs -chmod g+w   /user/hive/warehouse
</pre>
</div>

<p>
解决 [ERROR] Terminal initialization failed; falling back to unsupported 问题
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">HADOOP_USER_CLASSPATH_FIRST</span>=true
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd100770" class="outline-3">
<h3 id="orgd100770"><span class="section-number-3">1.24.</span> Docker</h3>
<div class="outline-text-3" id="text-1-24">
</div>
<div id="outline-container-orgc01ad1c" class="outline-4">
<h4 id="orgc01ad1c"><span class="section-number-4">1.24.1.</span> Docker 安装过程</h4>
<div class="outline-text-4" id="text-1-24-1">
<p>
安装参考链接 <a href="https://docs.docker.com/engine/install/centos/#install-using-the-repository">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">yum install -y yum-utils
yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo

yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
</pre>
</div>
</div>
</div>
<div id="outline-container-org674f9a6" class="outline-4">
<h4 id="org674f9a6"><span class="section-number-4">1.24.2.</span> Engine 配置</h4>
<div class="outline-text-4" id="text-1-24-2">
<p>
安装文档 <a href="https://docs.docker.com/engine/install/ubuntu/">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">vim /etc/docker/daemon.json
systemctl restart docker
</pre>
</div>

<p>
daemon.json 配置
</p>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #8d5649;">{</span>
  <span style="color: #ff79c6;">"insecure-registries"</span>: <span style="color: #d8241f;">[</span>
    <span style="color: #f1fa8c;">"gitana.jeanhwea.io:5000"</span>
  <span style="color: #d8241f;">]</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1851f1c" class="outline-4">
<h4 id="org1851f1c"><span class="section-number-4">1.24.3.</span> 国内镜像</h4>
<div class="outline-text-4" id="text-1-24-3">
<p>
daemon.json 配置
</p>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #8d5649;">{</span>
  <span style="color: #ff79c6;">"registry-mirrors"</span>: <span style="color: #d8241f;">[</span>
    <span style="color: #f1fa8c;">"https://registry.docker-cn.com"</span>,
    <span style="color: #f1fa8c;">"https://docker.mirrors.ustc.edu.cn"</span>,
    <span style="color: #f1fa8c;">"http://hub-mirror.c.163.com"</span>
  <span style="color: #d8241f;">]</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3ba35ac" class="outline-4">
<h4 id="org3ba35ac"><span class="section-number-4">1.24.4.</span> 配置代理</h4>
<div class="outline-text-4" id="text-1-24-4">
<p>
docker proxy <a href="https://docs.docker.com/network/proxy/">link</a>
</p>

<p>
设置客户端代理 ~/.docker/config.json
</p>
<div class="org-src-container">
<pre class="src src-conf">{
 <span style="color: #f1fa8c;">"proxies"</span>: {
   <span style="color: #f1fa8c;">"default"</span>: {
     <span style="color: #f1fa8c;">"httpProxy"</span>: <span style="color: #f1fa8c;">"http://proxy.example.com:3128"</span>,
     <span style="color: #f1fa8c;">"httpsProxy"</span>: <span style="color: #f1fa8c;">"https://proxy.example.com:3129"</span>,
     <span style="color: #f1fa8c;">"noProxy"</span>: <span style="color: #f1fa8c;">"*.test.example.com,.example.org,127.0.0.0/8"</span>
   }
 }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org61726a5" class="outline-4">
<h4 id="org61726a5"><span class="section-number-4">1.24.5.</span> 文件夹递归复制</h4>
<div class="outline-text-4" id="text-1-24-5">
<div class="org-src-container">
<pre class="src src-dockerfile"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#27491;&#30830;&#22320;&#36882;&#24402;&#22797;&#21046;&#25991;&#20214;&#22841;&#26041;&#26696;</span>
<span style="color: #ff79c6;">COPY</span> src/  target/

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#20197;&#19979;&#20004;&#31181;&#19981;&#21644;&#36882;&#24402;&#22797;&#21046;</span>
<span style="color: #ff79c6;">COPY</span> src/* target
<span style="color: #ff79c6;">COPY</span> src   target
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org527d292" class="outline-3">
<h3 id="org527d292"><span class="section-number-3">1.25.</span> Harbor</h3>
<div class="outline-text-3" id="text-1-25">
</div>
<div id="outline-container-orgd58fab4" class="outline-4">
<h4 id="orgd58fab4"><span class="section-number-4">1.25.1.</span> 安装教程</h4>
<div class="outline-text-4" id="text-1-25-1">
<p>
安装参考教程 <a href="https://goharbor.io/docs/2.9.0/install-config/">doc</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">wget -c https://github.com/goharbor/harbor/releases/download/v2.9.0/harbor-offline-installer-v2.9.0.tgz
</pre>
</div>

<p>
解压安装文件
</p>
<div class="org-src-container">
<pre class="src src-sh">tar xzvf ~/down/harbor-offline-installer-v2.9.0.tar.gz
<span style="color: #ffb86c;">cd</span> harbor
cp harbor.yml.tmpl harbor.yml
</pre>
</div>

<p>
配置 yaml 文件
</p>
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">harbor.yml</span>
<span style="color: #ffc9e8;">hostname</span>: 192.168.0.123
<span style="color: #ffc9e8;">http</span>:
  <span style="color: #ffc9e8;">port</span>: 8000
<span style="color: #ffc9e8;">data_volume</span>: /srv/harbor/data
</pre>
</div>

<p>
启动服务
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo ./install.sh
</pre>
</div>

<p>
登录服务，用户名: admin, 密码默认：Harbor12345
</p>
</div>
</div>

<div id="outline-container-org798ce7b" class="outline-4">
<h4 id="org798ce7b"><span class="section-number-4">1.25.2.</span> syslog 问题修复</h4>
<div class="outline-text-4" id="text-1-25-2">
<p>
WARNING: no logs are available with the 'syslog' log driver
</p>

<p>
查看 log 驱动
</p>
<div class="org-src-container">
<pre class="src src-sh">docker info | grep -i driver
</pre>
</div>

<p>
修改 docker-compose.yml 文件中的 driver 配置
</p>
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #ffc9e8;">driver</span>: <span style="color: #f1fa8c;">"json-file"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8bc428f" class="outline-3">
<h3 id="org8bc428f"><span class="section-number-3">1.26.</span> Kubernetes</h3>
<div class="outline-text-3" id="text-1-26">
</div>
<div id="outline-container-org3ed0957" class="outline-4">
<h4 id="org3ed0957"><span class="section-number-4">1.26.1.</span> minikube</h4>
<div class="outline-text-4" id="text-1-26-1">
<ol class="org-ol">
<li><a href="https://minikube.sigs.k8s.io/docs/">文档中心</a></li>
</ol>
<p>
配置
</p>
<div class="org-src-container">
<pre class="src src-sh">brew install minikube
minikube start
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">minikube dashboard
</pre>
</div>
</div>
</div>
<div id="outline-container-org4aec821" class="outline-4">
<h4 id="org4aec821"><span class="section-number-4">1.26.2.</span> kubeadm</h4>
<div class="outline-text-4" id="text-1-26-2">
<p>
系统安装
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21019;&#24314; master &#38598;&#32676;</span>
kubeadm init --apiserver-advertise-address=192.168.0.210 <span style="color: #f1fa8c;">\</span>
        --pod-network-cidr=10.244.0.0/16 <span style="color: #f1fa8c;">\</span>
        --kubernetes-version 1.27.2 <span style="color: #f1fa8c;">\</span>
        --image-repository registry.aliyuncs.com/google_containers

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#36935;&#21040;&#38169;&#35823;&#37325;&#32622;</span>
kubeadm reset
</pre>
</div>

<p>
查看使用到的镜像
</p>
<div class="org-src-container">
<pre class="src src-sh">kubeadm config images list
kubeadm config images pull --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers
kubeadm config images pull --image-repository registry.aliyuncs.com/google_containers
</pre>
</div>

<p>
新增 node 节点
</p>
<div class="org-src-container">
<pre class="src src-sh">kubeadm token create --print-join-command
</pre>
</div>
</div>
</div>

<div id="outline-container-org21367da" class="outline-4">
<h4 id="org21367da"><span class="section-number-4">1.26.3.</span> kubectl</h4>
<div class="outline-text-4" id="text-1-26-3">
</div>
<ol class="org-ol">
<li><a id="orgbcd6817"></a>快速开始<br />
<div class="outline-text-5" id="text-1-26-3-1">
<p>
快速启动一个测试服务
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21019;&#24314;&#37096;&#32626;</span>
kubectl create deployment sayhello --image=jeanhwea/sayhello:v1.0.0
kubectl create deployment sayhello --image=jeanhwea/sayhello:v1.0.0 -r 4

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#36890;&#36807; NodePort &#26292;&#38706;&#26381;&#21153;</span>
kubectl expose deployment sayhello --port=80 --type=NodePort

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21160;&#24577;&#25193;&#23481;</span>
kubectl scale  deployment sayhello --replicas=4
</pre>
</div>

<p>
获取启动的 Service
</p>
<div class="org-src-container">
<pre class="src src-sh">kubectl get svc
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#30331;&#24405;&#21040; minikube shell</span>
minikube ssh
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#22312; NameNode &#20013;&#33719;&#21462;&#39029;&#38754;</span>
curl http://0.0.0.0:31151
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">Service &#23545;&#35937;&#30340;&#22495;&#21517;&#23436;&#20840;&#24418;&#24335;&#26159; "&#23545;&#35937;.&#21517;&#23383;&#31354;&#38388;.svc.cluster.local"</span>
wget -qO- sayhello.default.svc.cluster.local
</pre>
</div>
</div>
</li>
<li><a id="org3957f89"></a>配置 DashBoard<br />
<div class="outline-text-5" id="text-1-26-3-2">
<div class="org-src-container">
<pre class="src src-sh">wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#23433;&#35013; dashboard</span>
kubectl apply -f recommended.yaml
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21368;&#36733; dashboard</span>
kubectl delete -f recommended.yaml
kubectl get pods,svc -n kubernetes-dashboard
</pre>
</div>
</div>
</li>

<li><a id="org5602179"></a>查看 Pod<br />
<div class="outline-text-5" id="text-1-26-3-3">
<div class="org-src-container">
<pre class="src src-sh">kubectl get pods -A
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#30331;&#24405;&#21040; pod &#19978;&#25490;&#26597;&#38382;&#39064;</span>
kubectl exec -it sayhello-847d5df547-4bk9z -- /bin/bash
</pre>
</div>
</div>
</li>

<li><a id="org7759f9c"></a>创建 Job<br />
<div class="outline-text-5" id="text-1-26-3-4">
<p>
获取一个基础的 yaml
</p>
<div class="org-src-container">
<pre class="src src-sh">kubectl create job echo-job --image=busybox --dry-run=client -o yaml
</pre>
</div>

<p>
修改得到配置
</p>
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #ffc9e8;">apiVersion</span>: batch/v1
<span style="color: #ffc9e8;">kind</span>: Job
<span style="color: #ffc9e8;">metadata</span>:
  <span style="color: #ffc9e8;">name</span>: echo-job

<span style="color: #ffc9e8;">spec</span>:
  <span style="color: #ffc9e8;">template</span>:
   <span style="color: #ffc9e8;">spec</span>:
      <span style="color: #ffc9e8;">restartPolicy</span>: OnFailure
      <span style="color: #ffc9e8;">containers</span>:
      - <span style="color: #ffc9e8;">image</span>: busybox
        <span style="color: #ffc9e8;">name</span>: echo-job
        <span style="color: #ffc9e8;">imagePullPolicy</span>: IfNotPresent
        <span style="color: #ffc9e8;">command</span>: [<span style="color: #f1fa8c;">"/bin/echo"</span>]
        <span style="color: #ffc9e8;">args</span>: [<span style="color: #f1fa8c;">"hello"</span>, <span style="color: #f1fa8c;">"world"</span>]
</pre>
</div>
</div>
</li>

<li><a id="org0435f03"></a>配置 ConfigMap<br />
<div class="outline-text-5" id="text-1-26-3-5">
<div class="org-src-container">
<pre class="src src-sh">kubectl get cm
kubectl describe cm config01
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgb1d7a56" class="outline-4">
<h4 id="orgb1d7a56"><span class="section-number-4">1.26.4.</span> 包管理工具 helm</h4>
<div class="outline-text-4" id="text-1-26-4">
<ol class="org-ol">
<li><p>
k8s 包管理器: helm <a href="https://helm.sh/">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update
helm install bitnami/mysql --generate-name
helm show all bitnami/mysql
helm list
helm uninstall mysql-1686374196
</pre>
</div></li>
</ol>
</div>
</div>
</div>

<div id="outline-container-orgfaeee01" class="outline-3">
<h3 id="orgfaeee01"><span class="section-number-3">1.27.</span> Prometheus</h3>
<div class="outline-text-3" id="text-1-27">
<p>
<a href="https://prometheus.io/docs/introduction/overview/">link</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org8e7e1f7" class="outline-2">
<h2 id="org8e7e1f7"><span class="section-number-2">2.</span> 学习计划</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orgbad304c" class="outline-3">
<h3 id="orgbad304c"><span class="section-number-3">2.1.</span> 操作系统</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-org559b262" class="outline-4">
<h4 id="org559b262"><span class="section-number-4">2.1.1.</span> 制作操作系统资源</h4>
<div class="outline-text-4" id="text-2-1-1">
<ol class="org-ol">
<li>os-tutorial 编写操作系统的入门代码 os-dev.pdf | <a href="https://github.com/cfenollosa/os-tutorial">link</a></li>
<li>rust 操作系统 <a href="https://rcore.gitbook.io/rust-os-docs/kai-fa-huan-jing-pei-zhi">rust os</a> | <a href="https://github.com/rcore-os/rCore">rCore</a></li>
<li>Writing an OS in Rust <a href="https://os.phil-opp.com/zh-CN/">link</a></li>
<li>c/c++ 编写一个操作系统 <a href="https://samypesse.gitbook.io/how-to-create-an-operating-system/chapter-2">link</a></li>
<li>James kernel development tutorial <a href="http://www.jamesmolloy.co.uk/tutorial_html/index.html">link</a></li>
<li>《x86 汇编语言：从实模式到保护模式》 <a href="http://www.lizhongc.com/index.php/archives/10/">BOOK</a> | <a href="https://www.bilibili.com/video/BV1xE411N74T/?spm_id_from=333.337.search-card.all.click&amp;vd_source=3a56932406d5df288a20eff532848982">BTV</a> | <a href="http://www.lizhongc.com/">李忠</a></li>
<li>BUAA OS 2022 <a href="https://github.com/MaxLong2001/BUAA_OS_2022.git">link</a></li>
</ol>
</div>
</div>
<div id="outline-container-orgb638ea9" class="outline-4">
<h4 id="orgb638ea9"><span class="section-number-4">2.1.2.</span> 课程 <a href="https://pdos.csail.mit.edu/6.828/2019/index.html">MIT 6.828</a></h4>
<div class="outline-text-4" id="text-2-1-2">
<ol class="org-ol">
<li>riscv <a href="https://pdos.csail.mit.edu/6.828/2019/tools.html">工具链</a></li>
<li>课程视频 <a href="https://www.bilibili.com/video/BV19k4y1C7kA">BTV</a></li>
<li>中文课程整理 <a href="http://xv6.dgs.zone/">中文介绍</a></li>
</ol>
</div>
</div>
<div id="outline-container-org66c8b32" class="outline-4">
<h4 id="org66c8b32"><span class="section-number-4">2.1.3.</span> 实模式</h4>
<div class="outline-text-4" id="text-2-1-3">
</div>
<ol class="org-ol">
<li><a id="org3932fa7"></a>寄存器<br />
<div class="outline-text-5" id="text-2-1-3-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">分类</th>
<th scope="col" class="org-left">名称</th>
<th scope="col" class="org-left">全称</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">通用寄存器</td>
<td class="org-left">AX</td>
<td class="org-left">Accumulator</td>
</tr>

<tr>
<td class="org-left">通用寄存器</td>
<td class="org-left">BX</td>
<td class="org-left">Base</td>
</tr>

<tr>
<td class="org-left">通用寄存器</td>
<td class="org-left">CX</td>
<td class="org-left">Counter</td>
</tr>

<tr>
<td class="org-left">通用寄存器</td>
<td class="org-left">DX</td>
<td class="org-left">Data</td>
</tr>

<tr>
<td class="org-left">指针寄存器</td>
<td class="org-left">SP</td>
<td class="org-left">Stack Pointer</td>
</tr>

<tr>
<td class="org-left">指针寄存器</td>
<td class="org-left">BP</td>
<td class="org-left">Base Pointer</td>
</tr>

<tr>
<td class="org-left">变地址寄存器</td>
<td class="org-left">SI</td>
<td class="org-left">Source Index</td>
</tr>

<tr>
<td class="org-left">变地址寄存器</td>
<td class="org-left">DI</td>
<td class="org-left">Destination Index</td>
</tr>

<tr>
<td class="org-left">控制寄存器</td>
<td class="org-left">IP</td>
<td class="org-left">Instruction Pointer</td>
</tr>

<tr>
<td class="org-left">控制寄存器</td>
<td class="org-left">FLAG</td>
<td class="org-left">Flag</td>
</tr>

<tr>
<td class="org-left">段寄存器</td>
<td class="org-left">CS</td>
<td class="org-left">Code Segment</td>
</tr>

<tr>
<td class="org-left">段寄存器</td>
<td class="org-left">DS</td>
<td class="org-left">Data Segment</td>
</tr>

<tr>
<td class="org-left">段寄存器</td>
<td class="org-left">SS</td>
<td class="org-left">Stack Segment</td>
</tr>

<tr>
<td class="org-left">段寄存器</td>
<td class="org-left">ES</td>
<td class="org-left">Extra Segment</td>
</tr>
</tbody>
</table>
</div>
</li>

<li><a id="org9720712"></a>栈 bp, sp<br />
<div class="outline-text-5" id="text-2-1-3-2">
<ol class="org-ol">
<li>sp 指向栈的顶端 stack pointer</li>
<li>bp 指向栈的基地址 base pointer</li>
<li>push 操作时, sp = sp - 2, bp 不变</li>
<li>pop 操作时, sp = sp + 2, bp 不变</li>
</ol>

<div class="org-src-container">
<pre class="src src-asm"><span style="color: #ff79c6;">.code16</span>                         <span style="color: #6272a4;">; </span><span style="color: #6272a4;">16 bits mode</span>

<span style="color: #6272a4;">;;; </span><span style="color: #6272a4;">&#21021;&#22987;&#21270;&#26632;&#25351;&#38024;</span>
<span style="color: #50fa7b;">mov</span> <span style="color: #ff79c6;">bp</span>, 0x8000
<span style="color: #50fa7b;">mov</span> <span style="color: #ff79c6;">sp</span>, bp                      <span style="color: #6272a4;">; </span><span style="color: #6272a4;">sp = bp &#26102;, &#26632;&#20026;&#31354;</span>

<span style="color: #6272a4;">;;; </span><span style="color: #6272a4;">&#21387;&#20837; 3 &#20010;&#27979;&#35797;&#25968;&#25454;</span>
<span style="color: #6272a4;">;;; </span><span style="color: #6272a4;">sp = 0x8000, bp = 0x8000</span>
<span style="color: #50fa7b;">push</span> 'A'
<span style="color: #6272a4;">;;; </span><span style="color: #6272a4;">sp = 0x7ffe, bp = 0x8000</span>
<span style="color: #50fa7b;">push</span> 'B'
<span style="color: #6272a4;">;;; </span><span style="color: #6272a4;">sp = 0x7ffc, bp = 0x8000</span>
<span style="color: #50fa7b;">push</span> 'C'

<span style="color: #6272a4;">;;; </span><span style="color: #6272a4;">&#26597;&#30475;&#25968;&#25454;</span>
<span style="color: #50fa7b;">mov</span> <span style="color: #ff79c6;">bx</span>, bp
<span style="color: #50fa7b;">mov</span> <span style="color: #ff79c6;">al</span>, [bx-2]
<span style="color: #50fa7b;">int</span> <span style="color: #ff79c6;">0x10</span>                        <span style="color: #6272a4;">; </span><span style="color: #6272a4;">&#25171;&#21360; A</span>

<span style="color: #50fa7b;">mov</span> <span style="color: #ff79c6;">bx</span>, spp
<span style="color: #50fa7b;">mov</span> <span style="color: #ff79c6;">al</span>, [bx]
<span style="color: #50fa7b;">int</span> <span style="color: #ff79c6;">0x10</span>                        <span style="color: #6272a4;">; </span><span style="color: #6272a4;">&#25171;&#21360; C</span>

<span style="color: #6272a4;">;;; </span><span style="color: #6272a4;">&#24377;&#20986;&#25968;&#25454;</span>
<span style="color: #50fa7b;">pop</span> <span style="color: #ff79c6;">bx</span>
<span style="color: #6272a4;">;;; </span><span style="color: #6272a4;">sp = 0x7ffc, bp = 0x8000</span>
<span style="color: #50fa7b;">mov</span> <span style="color: #ff79c6;">al</span>, bl
<span style="color: #50fa7b;">int</span> <span style="color: #ff79c6;">0x10</span>                        <span style="color: #6272a4;">; </span><span style="color: #6272a4;">&#25171;&#21360; C</span>

<span style="color: #50fa7b;">pop</span> <span style="color: #ff79c6;">bx</span>
<span style="color: #6272a4;">;;; </span><span style="color: #6272a4;">sp = 0x7ffe, bp = 0x8000</span>
<span style="color: #50fa7b;">mov</span> <span style="color: #ff79c6;">al</span>, bl
<span style="color: #50fa7b;">int</span> <span style="color: #ff79c6;">0x10</span>                        <span style="color: #6272a4;">; </span><span style="color: #6272a4;">&#25171;&#21360; B</span>

<span style="color: #50fa7b;">pop</span> <span style="color: #ff79c6;">bx</span>
<span style="color: #6272a4;">;;; </span><span style="color: #6272a4;">sp = 0x8000, bp = 0x8000</span>
<span style="color: #50fa7b;">mov</span> <span style="color: #ff79c6;">al</span>, bl
<span style="color: #50fa7b;">int</span> <span style="color: #ff79c6;">0x10</span>                        <span style="color: #6272a4;">; </span><span style="color: #6272a4;">&#25171;&#21360; A</span>
</pre>
</div>
</div>
</li>
<li><a id="org91adf36"></a>中断<br />
<div class="outline-text-5" id="text-2-1-3-3">
<p>
BIOS 通过中断提供一下操作硬件的基本程序，具体中断参考手册见 <a href="https://stanislavs.org/helppc/idx_interrupt.html">link</a>
</p>
</div>
</li>

<li><a id="orgc079c6b"></a>分支<br />
<div class="outline-text-5" id="text-2-1-3-4">
<p>
<code>jmp $</code>, $ 表示当前标号, 该指令会死循环
</p>

<p>
通常汇编的跳转通过 <code>cmp</code>, <code>je</code>, <code>jmp</code> 等指令配合实现，例如
</p>
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #50fa7b;">cmp</span> <span style="color: #ff79c6;">ax</span>, 4      <span style="color: #6272a4;">; </span><span style="color: #6272a4;">if ax = 4</span>
<span style="color: #50fa7b;">je</span> <span style="color: #ff79c6;">ax</span>_is_four  <span style="color: #6272a4;">; </span><span style="color: #6272a4;">do something (by jumping to that label)</span>
<span style="color: #50fa7b;">jmp</span> <span style="color: #ff79c6;">else</span>       <span style="color: #6272a4;">; </span><span style="color: #6272a4;">else, do another thing</span>
<span style="color: #50fa7b;">jmp</span> <span style="color: #ff79c6;">endif</span>      <span style="color: #6272a4;">; </span><span style="color: #6272a4;">finally, resume the normal flow</span>

<span style="color: #50fa7b;">ax_is_four</span>:
    .....
    <span style="color: #ff79c6;">jmp</span> endif

<span style="color: #50fa7b;">else</span>:
    .....
    <span style="color: #ff79c6;">jmp</span> endif  <span style="color: #6272a4;">; </span><span style="color: #6272a4;">not actually necessary but printed here for completeness</span>

<span style="color: #50fa7b;">endif</span>:
</pre>
</div>

<p>
函数调用也属于简单的跳转指令, 例如
</p>
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #50fa7b;">mov</span> <span style="color: #ff79c6;">al</span>, 'X'
<span style="color: #50fa7b;">jmp</span> <span style="color: #ff79c6;">print</span>
<span style="color: #50fa7b;">endprint</span>:

<span style="color: #50fa7b;">print</span>:
    <span style="color: #ff79c6;">mov</span> ah, 0x0e                <span style="color: #6272a4;">; </span><span style="color: #6272a4;">tty code</span>
    <span style="color: #ff79c6;">int</span> 0x10                    <span style="color: #6272a4;">; </span><span style="color: #6272a4;">&#25171;&#21360; al &#30340;&#23383;&#31526;</span>
    <span style="color: #ff79c6;">jmp</span> endprint                <span style="color: #6272a4;">; </span><span style="color: #6272a4;">&#36820;&#22238;</span>
</pre>
</div>

<p>
由于函数调用非常常见, 会有一些指令来简化函数调用实现过程
</p>
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #50fa7b;">mov</span> <span style="color: #ff79c6;">al</span>, 'X'
<span style="color: #50fa7b;">call</span> <span style="color: #ff79c6;">print</span>

<span style="color: #50fa7b;">print</span>:
    <span style="color: #ff79c6;">mov</span> ah, 0x0e                <span style="color: #6272a4;">; </span><span style="color: #6272a4;">tty code</span>
    <span style="color: #ff79c6;">int</span> 0x10                    <span style="color: #6272a4;">; </span><span style="color: #6272a4;">&#25171;&#21360; al &#30340;&#23383;&#31526;</span>
    <span style="color: #ff79c6;">ret</span>
</pre>
</div>
</div>
</li>

<li><a id="org528937a"></a>分段<br />
<div class="outline-text-5" id="text-2-1-3-5">
<p>
8086 寄存器是 16 位的, 真实地址 = 段地址 &lt;&lt; 4 + address
</p>
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #6272a4;">;;; </span><span style="color: #6272a4;">&#35774;&#32622; ds &#27573;&#23492;&#23384;&#22120;</span>
<span style="color: #50fa7b;">mov</span> <span style="color: #ff79c6;">bx</span>, 0x7c0
<span style="color: #50fa7b;">mov</span> <span style="color: #ff79c6;">ds</span>, bx
<span style="color: #6272a4;">;;; </span><span style="color: #6272a4;">&#40664;&#35748;&#20351;&#29992; ds &#27573;&#23492;&#23384;&#22120;&#20316;&#20026;&#22522;&#22320;&#22336;</span>
<span style="color: #50fa7b;">mov</span> <span style="color: #ff79c6;">al</span>, [msg]
<span style="color: #50fa7b;">int</span> <span style="color: #ff79c6;">0x10</span>

<span style="color: #6272a4;">;;; </span><span style="color: #6272a4;">&#20351;&#29992; es &#27573;&#23492;&#23384;&#22120;&#36827;&#34892;&#23547;&#22336;</span>
<span style="color: #50fa7b;">mov</span> <span style="color: #ff79c6;">bx</span>, 0x7c0
<span style="color: #50fa7b;">mov</span> <span style="color: #ff79c6;">es</span>, bx
<span style="color: #50fa7b;">mov</span> <span style="color: #ff79c6;">al</span>, [es:the_secret]
<span style="color: #50fa7b;">int</span> <span style="color: #ff79c6;">0x10</span>
</pre>
</div>
</div>
</li>

<li><a id="orgf6cbdd4"></a>磁盘<br />
<div class="outline-text-5" id="text-2-1-3-6">
<p>
磁盘加载数据到内存采用 CHS 的寻址方式 (cylinder-head-sector), 读取磁盘的指令需要
将 <code>al</code> 设置成 <code>0x02</code> , 通过寄存器传入起始 CHS 地址和需要读取到的扇区数量，然后
调用中断 <code>int 0x13</code>, 其中详细的中断参数见 <a href="https://stanislavs.org/helppc/int_13-2.html">link</a>
</p>

<div class="org-src-container">
<pre class="src src-text">AH = 02                                        &#35835;&#21462;&#25805;&#20316;&#30340;&#32534;&#30721;
AL = number of sectors to read  (1-128 dec.)
CH = track/cylinder number  (0-1023 dec., see below)
CL = sector number  (1-17 dec.)
DH = head number  (0-15 dec.)
DL = drive number (0=A:, 1=2nd floppy, 80h=drive 0, 81h=drive 1)
ES:BX = pointer to buffer                      &#25968;&#25454;&#35013;&#36733;&#30340;&#20869;&#23384;&#36215;&#22987;&#22320;&#22336;


on return:
AH = status  (see INT 13,STATUS)
AL = number of sectors read
CF = 0 if successful
   = 1 if error


- BIOS disk reads should be retried at least three times and the
  controller should be reset upon error detection
- be sure ES:BX does not cross a 64K segment boundary or a
  DMA boundary error will occur
- many programming references list only floppy disk register values
- only the disk number is checked for validity
- the parameters in CX change depending on the number of cylinders;
  the track/cylinder number is a 10 bit value taken from the 2 high
  order bits of CL and the 8 bits in CH (low order 8 bits of track):

  |F|E|D|C|B|A|9|8|7|6|5-0|  CX
   | | | | | | | | | |  `-----  sector number
   | | | | | | | | `---------  high order 2 bits of track/cylinder
   `------------------------  low order 8 bits of track/cyl number
</pre>
</div>

<p>
<code>carry bit</code> 是用来记录操作是否溢出，例如
</p>
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #50fa7b;">mov</span> <span style="color: #ff79c6;">ax</span>, 0xFFFF
<span style="color: #50fa7b;">add</span> <span style="color: #ff79c6;">ax</span>, 1                       <span style="color: #6272a4;">; </span><span style="color: #6272a4;">ax = 0x0000 and carry = 1, &#35774;&#32622;&#20102;&#28322;&#20986;&#20301;</span>
<span style="color: #50fa7b;">jc</span> <span style="color: #ff79c6;">label</span>                        <span style="color: #6272a4;">; </span><span style="color: #6272a4;">&#22914;&#26524;&#28322;&#20986;&#20301;&#35774;&#32622;&#20102;&#21017;&#36339;&#36716;</span>
</pre>
</div>

<p>
加载磁盘数据的汇编代码
</p>
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #6272a4;">; </span><span style="color: #6272a4;">load 'dh' sectors from drive 'dl' into ES:BX</span>
<span style="color: #50fa7b;">disk_load</span>:
    <span style="color: #ff79c6;">pusha</span>
    <span style="color: #6272a4;">; </span><span style="color: #6272a4;">reading from disk requires setting specific values in all registers</span>
    <span style="color: #6272a4;">; </span><span style="color: #6272a4;">so we will overwrite our input parameters from 'dx'. Let's save it</span>
    <span style="color: #6272a4;">; </span><span style="color: #6272a4;">to the stack for later use.</span>
    <span style="color: #ff79c6;">push</span> dx

    <span style="color: #ff79c6;">mov</span> ah, 0x02 <span style="color: #6272a4;">; </span><span style="color: #6272a4;">ah &lt;- int 0x13 function. 0x02 = 'read'</span>
    <span style="color: #ff79c6;">mov</span> al, dh   <span style="color: #6272a4;">; </span><span style="color: #6272a4;">al &lt;- number of sectors to read (0x01 .. 0x80)</span>
    <span style="color: #ff79c6;">mov</span> cl, 0x02 <span style="color: #6272a4;">; </span><span style="color: #6272a4;">cl &lt;- sector (0x01 .. 0x11)</span>
                 <span style="color: #6272a4;">; </span><span style="color: #6272a4;">0x01 is our boot sector, 0x02 is the first 'available' sector</span>
    <span style="color: #ff79c6;">mov</span> ch, 0x00 <span style="color: #6272a4;">; </span><span style="color: #6272a4;">ch &lt;- cylinder (0x0 .. 0x3FF, upper 2 bits in 'cl')</span>
    <span style="color: #6272a4;">; </span><span style="color: #6272a4;">dl &lt;- drive number. Our caller sets it as a parameter and gets it from BIOS</span>
    <span style="color: #6272a4;">; </span><span style="color: #6272a4;">(0 = floppy, 1 = floppy2, 0x80 = hdd, 0x81 = hdd2)</span>
    <span style="color: #ff79c6;">mov</span> dh, 0x00 <span style="color: #6272a4;">; </span><span style="color: #6272a4;">dh &lt;- head number (0x0 .. 0xF)</span>

    <span style="color: #6272a4;">; </span><span style="color: #6272a4;">[es:bx] &lt;- pointer to buffer where the data will be stored</span>
    <span style="color: #6272a4;">; </span><span style="color: #6272a4;">caller sets it up for us, and it is actually the standard location for int 13h</span>
    <span style="color: #ff79c6;">int</span> 0x13      <span style="color: #6272a4;">; </span><span style="color: #6272a4;">BIOS interrupt</span>
    <span style="color: #ff79c6;">jc</span> disk_error <span style="color: #6272a4;">; </span><span style="color: #6272a4;">if error (stored in the carry bit)</span>

    <span style="color: #ff79c6;">pop</span> dx
    <span style="color: #ff79c6;">cmp</span> al, dh    <span style="color: #6272a4;">; </span><span style="color: #6272a4;">BIOS also sets 'al' to the # of sectors read. Compare it.</span>
    <span style="color: #ff79c6;">jne</span> sectors_error
    <span style="color: #ff79c6;">popa</span>
    <span style="color: #ff79c6;">ret</span>


<span style="color: #50fa7b;">disk_error</span>:
    <span style="color: #ff79c6;">mov</span> bx, DISK_ERROR
    <span style="color: #ff79c6;">call</span> print
    <span style="color: #ff79c6;">call</span> print_nl
    <span style="color: #ff79c6;">mov</span> dh, ah <span style="color: #6272a4;">; </span><span style="color: #6272a4;">ah = error code, dl = disk drive that dropped the error</span>
    <span style="color: #ff79c6;">call</span> print_hex <span style="color: #6272a4;">; </span><span style="color: #6272a4;">check out the code at http://stanislavs.org/helppc/int_13-1.html</span>
    <span style="color: #ff79c6;">jmp</span> disk_loop

<span style="color: #50fa7b;">sectors_error</span>:
    <span style="color: #ff79c6;">mov</span> bx, SECTORS_ERROR
    <span style="color: #ff79c6;">call</span> print

<span style="color: #50fa7b;">disk_loop</span>:
    <span style="color: #ff79c6;">jmp</span> $

<span style="color: #50fa7b;">DISK_ERROR</span>: <span style="color: #ff79c6;">db</span> <span style="color: #f1fa8c;">"Disk read error"</span>, 0
<span style="color: #50fa7b;">SECTORS_ERROR</span>: <span style="color: #ff79c6;">db</span> <span style="color: #f1fa8c;">"Incorrect number of sectors read"</span>, 0
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgd471991" class="outline-4">
<h4 id="orgd471991"><span class="section-number-4">2.1.4.</span> 保护模式</h4>
<div class="outline-text-4" id="text-2-1-4">
</div>
<ol class="org-ol">
<li><a id="org9ebc92b"></a>保护模式下的字符显示<br />
<div class="outline-text-5" id="text-2-1-4-1">
<ol class="org-ol">
<li>保护模式是 32 位运行的</li>
<li>可以直接通过显存写入数据来显示字符
<ul class="org-ul">
<li>显存地址 0xb8000</li>
<li>一次显示需要两个参数，低 16 位传入字符, 高 16 位传入显示模式</li>
</ul></li>
</ol>

<div class="org-src-container">
<pre class="src src-asm">[bits 32] <span style="color: #6272a4;">; </span><span style="color: #6272a4;">using 32-bit protected mode</span>

<span style="color: #6272a4;">; </span><span style="color: #6272a4;">this is how constants are defined</span>
<span style="color: #50fa7b;">VIDEO_MEMORY</span> <span style="color: #ff79c6;">equ</span> 0xb8000
<span style="color: #50fa7b;">WHITE_ON_BLACK</span> <span style="color: #ff79c6;">equ</span> 0x0f <span style="color: #6272a4;">; </span><span style="color: #6272a4;">the color byte for each character</span>

<span style="color: #50fa7b;">print_string_pm</span>:
    <span style="color: #ff79c6;">pusha</span>
    <span style="color: #ff79c6;">mov</span> edx, VIDEO_MEMORY

<span style="color: #50fa7b;">print_string_pm_loop</span>:
    <span style="color: #ff79c6;">mov</span> al, [ebx] <span style="color: #6272a4;">; </span><span style="color: #6272a4;">[ebx] is the address of our character</span>
    <span style="color: #ff79c6;">mov</span> ah, WHITE_ON_BLACK

    <span style="color: #ff79c6;">cmp</span> al, 0 <span style="color: #6272a4;">; </span><span style="color: #6272a4;">check if end of string</span>
    <span style="color: #ff79c6;">je</span> print_string_pm_done

    <span style="color: #ff79c6;">mov</span> [edx], ax <span style="color: #6272a4;">; </span><span style="color: #6272a4;">store character + attribute in video memory</span>
    <span style="color: #ff79c6;">add</span> ebx, 1 <span style="color: #6272a4;">; </span><span style="color: #6272a4;">next char</span>
    <span style="color: #ff79c6;">add</span> edx, 2 <span style="color: #6272a4;">; </span><span style="color: #6272a4;">next video memory position</span>

    <span style="color: #ff79c6;">jmp</span> print_string_pm_loop

<span style="color: #50fa7b;">print_string_pm_done</span>:
    <span style="color: #ff79c6;">popa</span>
    <span style="color: #ff79c6;">ret</span>
</pre>
</div>
</div>
</li>

<li><a id="org9bc0417"></a>保护模式下的 GDT<br />
<div class="outline-text-5" id="text-2-1-4-2">
<ol class="org-ol">
<li>GDT 主要保护以下信息, 总共 64 位, <a href="https://files.osdev.org/mirrors/geezer/os/pm.htm">link</a>
<ul class="org-ul">
<li>base  = low(16) + middle(8) + high(8)</li>
<li>limit = low(16) + high(4)</li>
<li>flags = (12)</li>
</ul></li>
<li>GDT 的第一项必须全是 <code>0x00</code></li>
<li>GDT 加载通过 <code>lgdt</code> 指令</li>
</ol>

<p>
下面是一个初始化的 gdt 内存定义，这里先将代码段和数据段合并在一起
</p>
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #50fa7b;">gdt_start</span>: <span style="color: #6272a4;">; </span><span style="color: #6272a4;">don't remove the labels, they're needed to compute sizes and jumps</span>
    <span style="color: #6272a4;">; </span><span style="color: #6272a4;">the GDT starts with a null 8-byte</span>
    <span style="color: #ff79c6;">dd</span> 0x0 <span style="color: #6272a4;">; </span><span style="color: #6272a4;">4 byte</span>
    <span style="color: #ff79c6;">dd</span> 0x0 <span style="color: #6272a4;">; </span><span style="color: #6272a4;">4 byte</span>

<span style="color: #6272a4;">; </span><span style="color: #6272a4;">GDT for code segment. base = 0x00000000, length = 0xfffff</span>
<span style="color: #50fa7b;">gdt_code</span>:
    <span style="color: #ff79c6;">dw</span> 0xffff    <span style="color: #6272a4;">; </span><span style="color: #6272a4;">segment length, bits 0-15                    | limit_low(16)</span>
    <span style="color: #ff79c6;">dw</span> 0x0       <span style="color: #6272a4;">; </span><span style="color: #6272a4;">segment base, bits 0-15                      | base_low(16)</span>
    <span style="color: #ff79c6;">db</span> 0x0       <span style="color: #6272a4;">; </span><span style="color: #6272a4;">segment base, bits 16-23                     | base_middle(8)</span>
    <span style="color: #ff79c6;">db</span> 10011010b <span style="color: #6272a4;">; </span><span style="color: #6272a4;">flags (8 bits)                               | flags1(8)</span>
    <span style="color: #ff79c6;">db</span> 11001111b <span style="color: #6272a4;">; </span><span style="color: #6272a4;">flags (4 bits) + segment length, bits 16-19  | limit_high(4), flags2(4)</span>
    <span style="color: #ff79c6;">db</span> 0x0       <span style="color: #6272a4;">; </span><span style="color: #6272a4;">segment base, bits 24-31                     | base_high(8)</span>

<span style="color: #50fa7b;">gdt_data</span>:
    <span style="color: #ff79c6;">dw</span> 0xffff
    <span style="color: #ff79c6;">dw</span> 0x0
    <span style="color: #ff79c6;">db</span> 0x0
    <span style="color: #ff79c6;">db</span> 10010010b
    <span style="color: #ff79c6;">db</span> 11001111b
    <span style="color: #ff79c6;">db</span> 0x0

<span style="color: #50fa7b;">gdt_end</span>:

<span style="color: #6272a4;">; </span><span style="color: #6272a4;">GDT descriptor, via lgdt [gdt_descriptor]</span>
<span style="color: #50fa7b;">gdt_descriptor</span>:
    <span style="color: #ff79c6;">dw</span> gdt_end - gdt_start - 1 <span style="color: #6272a4;">; </span><span style="color: #6272a4;">size (16 bit), always one less of its true size</span>
    <span style="color: #ff79c6;">dd</span> gdt_start               <span style="color: #6272a4;">; </span><span style="color: #6272a4;">address (32 bit)</span>

<span style="color: #6272a4;">; </span><span style="color: #6272a4;">define some constants for later use</span>
<span style="color: #50fa7b;">CODE_SEG</span> <span style="color: #ff79c6;">equ</span> gdt_code - gdt_start
<span style="color: #50fa7b;">DATA_SEG</span> <span style="color: #ff79c6;">equ</span> gdt_data - gdt_start
</pre>
</div>
</div>
</li>

<li><a id="orga5896cf"></a>实模式到 32 位保护模式切换过程<br />
<div class="outline-text-5" id="text-2-1-4-3">
<ol class="org-ol">
<li>关闭中断</li>
<li>加载 gdt</li>
<li>设置控制寄存器 <code>cr0</code></li>
<li>通过远程调整来 flush 流水线</li>
<li>更新所以的段寄存器</li>
<li>更新系统栈</li>
<li>跳转到 32 位指令出执行</li>
</ol>

<div class="org-src-container">
<pre class="src src-asm"><span style="color: #6272a4;">;;; </span><span style="color: #6272a4;">real mode</span>
[bits 16]
<span style="color: #50fa7b;">switch_to_pm</span>:
    <span style="color: #ff79c6;">cli</span>                         <span style="color: #6272a4;">; </span><span style="color: #6272a4;">1. disable interrupts</span>
    <span style="color: #ff79c6;">lgdt</span> [gdt_descriptor]       <span style="color: #6272a4;">; </span><span style="color: #6272a4;">2. load the GDT descriptor</span>
    <span style="color: #ff79c6;">mov</span> eax, cr0
    <span style="color: #ff79c6;">or</span> eax, 0x1                 <span style="color: #6272a4;">; </span><span style="color: #6272a4;">3. set 32-bit mode bit in cr0</span>
    <span style="color: #ff79c6;">mov</span> cr0, eax
    <span style="color: #ff79c6;">jmp</span> CODE_SEG:init_pm        <span style="color: #6272a4;">; </span><span style="color: #6272a4;">4. far jump by using a different segment</span>

<span style="color: #6272a4;">;;; </span><span style="color: #6272a4;">protected mode is enabled</span>
[bits 32]
<span style="color: #50fa7b;">init_pm</span>:
    <span style="color: #ff79c6;">mov</span> ax, DATA_SEG            <span style="color: #6272a4;">; </span><span style="color: #6272a4;">5. update the segment registers</span>
    <span style="color: #ff79c6;">mov</span> ds, ax
    <span style="color: #ff79c6;">mov</span> ss, ax
    <span style="color: #ff79c6;">mov</span> es, ax
    <span style="color: #ff79c6;">mov</span> fs, ax
    <span style="color: #ff79c6;">mov</span> gs, ax

    <span style="color: #ff79c6;">mov</span> ebp, 0x90000    <span style="color: #6272a4;">; </span><span style="color: #6272a4;">6. update the stack right at the top of the free space</span>
    <span style="color: #ff79c6;">mov</span> esp, ebp

    <span style="color: #ff79c6;">call</span> BEGIN_PM               <span style="color: #6272a4;">; </span><span style="color: #6272a4;">7. Call a well-known label with useful code</span>
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org930736b" class="outline-4">
<h4 id="org930736b"><span class="section-number-4">2.1.5.</span> Minix</h4>
<div class="outline-text-4" id="text-2-1-5">
</div>
<ol class="org-ol">
<li><a id="orge5288df"></a>配置环境<br />
<div class="outline-text-5" id="text-2-1-5-1">
<p>
<a href="https://wiki.minix3.org/doku.php?id=developersguide:crosscompiling">交叉编译文档</a>
</p>

<p>
下载代码
</p>
<div class="org-src-container">
<pre class="src src-sh">mkdir minix
<span style="color: #ffb86c;">cd</span> minix
git clone git://git.minix3.org/minix src
<span style="color: #ffb86c;">cd</span> src
</pre>
</div>

<p>
安装依赖
</p>
<div class="org-src-container">
<pre class="src src-sql">sudo apt-<span style="color: #ff79c6;">get</span> install build-essential curl git zlibc zlib1g zlib1g-dev g++
</pre>
</div>

<p>
编译内存镜像
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffc9e8;">JOBS</span>=8 ./releasetools/x86_hdimage.sh
</pre>
</div>

<p>
启动镜像
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">cd</span> ../obj.i386/destdir.i386/boot/minix/.temp

qemu-system-i386 -display none <span style="color: #f1fa8c;">\</span>
                 -serial stdio <span style="color: #f1fa8c;">\</span>
                 -kernel kernel <span style="color: #f1fa8c;">\</span>
                 -append <span style="color: #f1fa8c;">"console=tty00 rootdevname=c0d0p1"</span> <span style="color: #f1fa8c;">\</span>
                 -initrd <span style="color: #f1fa8c;">"mod01_ds,mod02_rs,mod03_pm,mod04_sched,mod05_vfs,mod06_memory,mod07_tty,mod08_mfs,mod09_vm,mod10_pfs,mod11_init"</span> <span style="color: #f1fa8c;">\</span>
                 -hda /opt/local/hack/minix/src/minix_x86.img --enable-kvm
</pre>
</div>


<div id="org894f2ab" class="figure">
<p><img src="../static/image/2023/0315/112736.png" alt="112736.png" />
</p>
</div>
</div>
</li>

<li><a id="org437869b"></a>安装 Minix 操作系统<br />
<div class="outline-text-5" id="text-2-1-5-2">
<p>
操作系统安装 <a href="https://wiki.minix3.org/doku.php?id=usersguide:runningonqemu">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#35299;&#21387;</span>
bzip2 -d minix_R3.3.0-588a35b.iso.bz2
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#26032;&#24314;&#30828;&#30424;&#38236;&#20687;</span>
qemu-img create minix.img 8G
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#23433;&#35013;&#21551;&#21160;</span>
qemu-system-x86_64 -net user -net nic -m 256 -cdrom minix_R3.3.0-588a35b.iso -hda minix.img -boot d
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21551;&#21160;</span>
qemu-system-x86_64 -net user -net nic -m 256 -hda minix.img
</pre>
</div>

<p>
安装后设置 <a href="https://wiki.minix3.org/doku.php?id=usersguide:postinstallation">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">hostname minix3

pkgin update
pkgin install openssh
cp /usr/pkg/etc/rc.d/sshd /etc/rc.d/
printf <span style="color: #f1fa8c;">'sshd=YES\n'</span> &gt;&gt; /etc/rc.conf
/etc/rc.d/sshd start
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgd1de922" class="outline-4">
<h4 id="orgd1de922"><span class="section-number-4">2.1.6.</span> 实验环境准备</h4>
<div class="outline-text-4" id="text-2-1-6">
<ol class="org-ol">
<li><p>
AUR 编译说明文档 <a href="https://wiki.manjaro.org/index.php/Arch_User_Repository/zh-cn">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">clone build repository</span>
git clone https://aur.archlinux.org/i386-elf-binutils.git
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">make binary package</span>
makepkg -s
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">install package</span>
sudo pacman -U i386-elf-binutils-2.40-1-x86_64.pkg.tar.zst
</pre>
</div></li>

<li><p>
c 语言交叉编译
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#20132;&#21449;&#32534;&#35793;, -ffreestanding &#19981;&#38656;&#35201;&#26631;&#20934;&#24211;&#25903;&#25345;&#65292;&#29983;&#25104;&#30446;&#26631;&#26159;&#19968;&#20010;&#29420;&#31435;&#29615;&#22659;</span>
i386-elf-gcc -ffreestanding -c function.c -o function.o
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21453;&#27719;&#32534;</span>
i386-elf-objdump -d function.o

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#38142;&#25509;, -Ttext 0x0 &#34920;&#31034;&#20195;&#30721;&#27573;&#30340;&#36215;&#22987;&#22320;&#22336;</span>
i386-elf-ld -o function.bin -Ttext 0x0 --oformat binary function.o

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21453;&#27719;&#32534;&#27979;&#35797;&#29983;&#25104;&#30340;&#20108;&#36827;&#21046;&#25991;&#20214;</span>
ndisasm -b 32 function.bin
</pre>
</div></li>

<li><p>
gdb 调试内核
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">-s &#35753; qemu &#20572;&#27490;&#24182;&#30417;&#21548; 1234 &#31471;&#21475;&#31561;&#24453;&#35843;&#35797;</span>
qemu-system-i386 -s -fda os-image.bin &amp;
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#21019;&#24314;&#36830;&#25509;&#31526;&#21495;&#25991;&#20214;</span>
i386-elf-ld -o kernel.elf -Ttext 0x1000 kernel.o obj1.o obj2.o
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">gdb &#25191;&#34892;&#21629;&#20196;&#36827;&#34892;&#35843;&#35797;</span>
i386-elf-gdb -ex <span style="color: #f1fa8c;">"target remote localhost:1234"</span> -ex <span style="color: #f1fa8c;">"symbol-file kernel.elf"</span>
</pre>
</div></li>
</ol>
</div>
</div>

<div id="outline-container-orgfc94b12" class="outline-4">
<h4 id="orgfc94b12"><span class="section-number-4">2.1.7.</span> 自制操作系统</h4>
<div class="outline-text-4" id="text-2-1-7">
<ol class="org-ol">
<li>nasm 手册 <a href="https://www.nasm.us/doc/nasmdoc2.html">link</a></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org96e866f" class="outline-3">
<h3 id="org96e866f"><span class="section-number-3">2.2.</span> Linux</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-org54b9df1" class="outline-4">
<h4 id="org54b9df1"><span class="section-number-4">2.2.1.</span> Linux 资源链接</h4>
<div class="outline-text-4" id="text-2-2-1">
<ol class="org-ol">
<li>Linux 源码在线导读 bootlin <a href="https://elixir.bootlin.com/linux/0.12/source/kernel/fork.c">link</a></li>
<li>Linux 内核完全注释 <a href="http://www.oldlinux.org/download/CLK-5.0-WithCover.pdf">book</a></li>
<li>linux inside <a href="https://0xax.gitbooks.io/linux-insides/content/Booting/linux-bootstrap-1.html">link</a></li>
<li>Linux Documentation Project Guides <a href="https://tldp.org/guides.html">TLDP</a> | <a href="https://tldp.org/LDP/khg/HyperNews/get/khg.html">Linux Kernel Hackers' Guide</a></li>
<li>Linux From Scratch <a href="https://www.linuxfromscratch.org/">LFS</a></li>
<li>老版本 Linux 研究网站 <a href="http://www.oldlinux.org/">oldlinux</a></li>
</ol>
</div>
</div>
<div id="outline-container-org877157c" class="outline-4">
<h4 id="org877157c"><span class="section-number-4">2.2.2.</span> 编译内核示例</h4>
<div class="outline-text-4" id="text-2-2-2">
<ol class="org-ol">
<li><p>
一些依赖安装
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo apt install ncurses-dev flex bison libelf-dev libssl-dev dwarves
</pre>
</div></li>

<li>定制内核 <a href="https://wiki.centos.org/HowTos/Custom_Kernel">CentOS Wiki</a></li>
</ol>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#19979;&#36733;&#28304;&#30721;</span>
wget -c https://mirrors.tuna.tsinghua.edu.cn/kernel/v5.x/linux-5.15.115.tar.gz
tar xvzf linux-5.15.115.tar.gz
<span style="color: #ffb86c;">cd</span> linux-5.15.115

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#20934;&#22791;&#37197;&#32622;&#25991;&#20214;</span>
cp /boot/config-<span style="color: #bd93f9; font-weight: bold;">`uname -r`</span> .config
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#24320;&#21551;&#25110;&#20851;&#38381;&#37197;&#32622;&#36873;&#39033;</span>
make menuconfig

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#30830;&#20445; CONFIG_SYSTEM_TRUSTED_KEYS &#20026;&#31354;</span>
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">cat .config | grep CONFIG_SYSTEM_TRUSTED_KEYS</span>
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">CONFIG_SYSTEM_TRUSTED_KEYS=""</span>

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#32534;&#35793;&#20869;&#26680;</span>
make -j12

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#23433;&#35013;&#27169;&#22359;</span>
sudo make modules_install

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#23433;&#35013;&#20869;&#26680;</span>
sudo make install

<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#37325;&#21551;&#31995;&#32479;, &#26597;&#30475;&#20869;&#26680;&#26159;&#21542;&#36816;&#34892;&#27491;&#24120;</span>
reboot
uname -r
</pre>
</div>

<p>
修改 grub 代码
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#26597;&#30475;&#40664;&#35748;&#30340; grub &#36873;&#39033;</span>
grub2-editenv list
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">&#26356;&#25913;&#40664;&#35748;&#21551;&#21160;&#36873;&#39033;</span>
grub2-set-default <span style="color: #f1fa8c;">'5.16.0-1.el7.elrepo.x86_64) 7 (Core)'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org840f300" class="outline-4">
<h4 id="org840f300"><span class="section-number-4">2.2.3.</span> 编译 Linux 0.11 需要的工具</h4>
<div class="outline-text-4" id="text-2-2-3">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #6272a4;"># </span><span style="color: #6272a4;">as86 ld86</span>
sudo yum install -y dev86
sudo apt install bin86
</pre>
</div>
</div>
</div>

<div id="outline-container-orgff0aa00" class="outline-4">
<h4 id="orgff0aa00"><span class="section-number-4">2.2.4.</span> <span class="todo TODO">TODO</span> 内存检测工具 valgrind</h4>
</div>
</div>

<div id="outline-container-org93979a6" class="outline-3">
<h3 id="org93979a6"><span class="section-number-3">2.3.</span> Rust</h3>
<div class="outline-text-3" id="text-2-3">
</div>
<div id="outline-container-orgbe00465" class="outline-4">
<h4 id="orgbe00465"><span class="section-number-4">2.3.1.</span> 资源链接</h4>
<div class="outline-text-4" id="text-2-3-1">
<ol class="org-ol">
<li class="on"><code>[X]</code> The Rust Programming Language 视频教程 | <a href="https://www.bilibili.com/video/BV1K34y1x7F9">BTV</a> | <a href="https://rust-book.cs.brown.edu/">link</a></li>
<li class="on"><code>[X]</code> Rust by Example | <a href="https://doc.rust-lang.org/rust-by-example/index.html">link</a></li>
<li class="on"><code>[X]</code> 如何快速掌握新的 crates | <a href="https://www.bilibili.com/video/BV12K4y1X7qw/">BTV</a></li>
<li class="off"><code>[&#xa0;]</code> CIS 198: Rust Programming | <a href="http://cis198-2016s.github.io/schedule/">Schedule</a></li>
<li class="off"><code>[&#xa0;]</code> Rust by Practice | <a href="https://zh.practice.rs/why-exercise.html">ZH</a></li>
<li class="off"><code>[&#xa0;]</code> 极客 <a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E9%99%88%E5%A4%A9%20%C2%B7%20Rust%20%E7%BC%96%E7%A8%8B%E7%AC%AC%E4%B8%80%E8%AF%BE">Rust 编程第一课</a></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org50c7845" class="outline-3">
<h3 id="org50c7845"><span class="section-number-3">2.4.</span> 极客时光</h3>
<div class="outline-text-3" id="text-2-4">
</div>
<div id="outline-container-org4aef576" class="outline-4">
<h4 id="org4aef576"><span class="section-number-4">2.4.1.</span> 专栏 <a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/22%20%E8%AE%B2%E9%80%9A%E5%85%B3%20Go%20%E8%AF%AD%E8%A8%80-%E5%AE%8C">22 讲通关 Go 语言</a></h4>
</div>
<div id="outline-container-org05dea5f" class="outline-4">
<h4 id="org05dea5f"><span class="section-number-4">2.4.2.</span> 专栏 <a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/24%E8%AE%B2%E5%90%83%E9%80%8F%E5%88%86%E5%B8%83%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%AE%8C">24 讲吃透分布式数据库</a></h4>
</div>
<div id="outline-container-orgc41954a" class="outline-4">
<h4 id="orgc41954a"><span class="section-number-4">2.4.3.</span> 专栏 <a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E9%AB%98%E6%89%8B%E8%AF%BE">消息队列高手课</a></h4>
<div class="outline-text-4" id="text-2-4-3">
</div>
<ol class="org-ol">
<li><a id="org4d76d59"></a>分布式事务<br />
<div class="outline-text-5" id="text-2-4-3-1">
<ol class="org-ol">
<li>订单系统在消息队列上开启一个事务</li>
<li>然后订单系统给消息服务器发送一个 <b>半消息</b></li>
<li>这个半消息不是说消息内容不完整，它包含的内容就是完整的消息内容，半消息和普通
消息的唯一区别是，在事务提交之前，对于消费者来说，这个消息是不可见的</li>
<li>半消息发送成功后，订单系统就可以执行本地事务</li>
</ol>


<div id="org1e7a4fa" class="figure">
<p><img src="../static/image/2023/0308/224741.png" alt="224741.png" />
</p>
</div>

<p>
如果 <b>半消息</b> 提交失败，不同队列会有不同处理方式
</p>
<ol class="org-ol">
<li>Kafka 的解决方案比较简单粗暴，直接抛出异常，让用户自行处理。我们可以在业务代
码中反复重试提交，直到提交成功，或者删除之前创建的订单进行补偿</li>
<li><p>
RocketMQ 中的事务实现中，增加了事务反查的机制来解决事务消息提交失败的问题
</p>


<div id="org87fa268" class="figure">
<p><img src="../static/image/2023/0308/225054.png" alt="225054.png" />
</p>
</div>

<p>
为了支撑这个事务反查机制，我们的业务代码需要实现一个反查本地事务状态的接口，
告知 RocketMQ 本地事务是成功还是失败
</p></li>
</ol>
</div>
</li>
<li><a id="org27424e5"></a>重复消费<br />
<div class="outline-text-5" id="text-2-4-3-2">
<p>
在 MQTT 协议中，给出了三种传递消息时能够提供的服务质量标准，这三种服务质量从低到
高依次是：
</p>

<ol class="org-ol">
<li>At most once: 至多一次。消息在传递时，最多会被送达一次。换一个说法就是，没什
么消息可靠性保证，允许丢消息。一般都是一些对消息可靠性要求不太高的监控场景使
用，比如每分钟上报一次机房温度数据，可以接受数据少量丢失。</li>
<li>At least once: 至少一次。消息在传递时，至少会被送达一次。也就是说，不允许丢消
息，但是允许有少量重复消息出现。</li>
<li>Exactly once：恰好一次。消息在传递时，只会被送达一次，不允许丢失也不允许重复，
这个是最高的等级。</li>
</ol>

<p>
用幂等性解决重复消息问题
</p>
<ol class="org-ol">
<li>利用数据库的唯一约束实现幂等</li>
<li>为更新的数据设置前置条件</li>
<li>记录并检查操作</li>
</ol>
</div>
</li>

<li><a id="orge2172af"></a>消息积压<br />
<div class="outline-text-5" id="text-2-4-3-3">
<ol class="org-ol">
<li>优化消息收发性能，预防消息积压的方法有两种，
<ul class="org-ul">
<li>增加批量或者是增加并发，在发送端这两种方法都可以使用</li>
<li>在消费端需要注意的是，增加并发需要同步扩容分区数量，否则是起不到效果的</li>
</ul></li>
<li>对于系统发生消息积压的情况，需要先解决积压，再分析原因
<ul class="org-ul">
<li>快速解决积压的方法就是通过水平扩容增加 Consumer 的实例数量</li>
</ul></li>
</ol>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-orge958540" class="outline-3">
<h3 id="orge958540"><span class="section-number-3">2.5.</span> 数据结构</h3>
<div class="outline-text-3" id="text-2-5">
<ol class="org-ol">
<li>Leetcode 刷题 <a href="https://github.com/jeanhwea/golang_tutor">golang</a> | <a href="https://github.com/jeanhwea/annotry">java</a></li>
<li>红黑树 <a href="https://www.cs.usfca.edu/~galles/visualization/RedBlack.html">rbtree</a></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org99dd23a" class="outline-2">
<h2 id="org99dd23a"><span class="section-number-2">3.</span> 问题排查</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org8b9f35b" class="outline-3">
<h3 id="org8b9f35b"><span class="section-number-3">3.1.</span> Java 系统 CPU 飙高排查&#xa0;&#xa0;&#xa0;<span class="tag"><span class="java">java</span></span></h3>
<div class="outline-text-3" id="text-3-1">
<p>
查看线程信息
</p>
<div class="org-src-container">
<pre class="src src-sh">ps -mp 352 -o THREAD,tid,time
</pre>
</div>

<pre class="example" id="orgb44b6d5">
$ ps -mp 352 -o THREAD,tid,time
USER     %CPU PRI SCNT WCHAN  USER SYSTEM   TID     TIME
admin     1.2   -    - -         -      -     - 00:33:48
admin     0.0  19    - futex_    -      -   352 00:00:00
admin     0.0  19    - futex_    -      -   355 00:00:09
admin     0.0  19    - futex_    -      -   360 00:00:02
admin     0.0  19    - futex_    -      -   361 00:00:02
admin     0.1  19    - futex_    -      -   362 00:04:09
admin     0.0  19    - futex_    -      -   364 00:00:00
admin     0.0  19    - futex_    -      -   365 00:00:00
</pre>

<p>
取 tid=360 转 16 进制数
</p>
<pre class="example" id="org25f34a3">
$ printf '%x' 360
168
</pre>

<p>
打印 java 线程执行堆栈
</p>
<pre class="example" id="orgeea8ed0">
$ jstack 352 | grep 168 -A100
"Gang worker#0 (Parallel GC Threads)" os_prio=0 tid=0x00007fbfa4020800 nid=0x168 runnable

"Gang worker#1 (Parallel GC Threads)" os_prio=0 tid=0x00007fbfa4022000 nid=0x169 runnable

"G1 Main Concurrent Mark GC Thread" os_prio=0 tid=0x00007fbfa4046800 nid=0x16e runnable

"Gang worker#0 (G1 Parallel Marking Threads)" os_prio=0 tid=0x00007fbfa4048000 nid=0x172 runnable
</pre>
</div>
</div>

<div id="outline-container-org6f1b58d" class="outline-3">
<h3 id="org6f1b58d"><span class="section-number-3">3.2.</span> digital envelope routines::unsupported&#xa0;&#xa0;&#xa0;<span class="tag"><span class="nodejs">nodejs</span></span></h3>
<div class="outline-text-3" id="text-3-2">
<p>
OpenSSL3.0 对允许算法和密钥大小增加了严格的限制，可能会对生态系统造成一些影响
</p>
<div class="org-src-container">
<pre class="src src-text">node:internal/crypto/hash:67
  this[kHandle] = new _Hash(algorithm, xofLen);
                  ^

Error: error:0308010C:digital envelope routines::unsupported
    at new Hash (node:internal/crypto/hash:67:19)
    at Object.createHash (node:crypto:130:10)
</pre>
</div>

<p>
解决方法
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">NODE_OPTIONS</span>=--openssl-legacy-provider
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb7e9f25" class="outline-3">
<h3 id="orgb7e9f25"><span class="section-number-3">3.3.</span> RuntimeError: 'cryptography' package is required for sha256<sub>password</sub>&#xa0;&#xa0;&#xa0;<span class="tag"><span class="python">python</span></span></h3>
<div class="outline-text-3" id="text-3-3">
<p>
RuntimeError: 'cryptography' package is required for sha256<sub>password</sub> or caching<sub>sha2</sub><sub>password</sub> auth methods
</p>
<pre class="example" id="org5cbd4f0">
  File "/usr/local/lib/python3.11/site-packages/pymysql/_auth.py", line 143, in sha2_rsa_encrypt
    raise RuntimeError(
RuntimeError: 'cryptography' package is required for sha256_password or caching_sha2_password auth methods
</pre>

<p>
缺少 cryptography 包，安装一下
</p>
<div class="org-src-container">
<pre class="src src-sh">pip install cryptography
</pre>
</div>
</div>
</div>

<div id="outline-container-org07da009" class="outline-3">
<h3 id="org07da009"><span class="section-number-3">3.4.</span> githubusercontent 链接失败</h3>
<div class="outline-text-3" id="text-3-4">
<p>
/etc/hosts
</p>
<div class="org-src-container">
<pre class="src src-sh">185.199.108.133 raw.githubusercontent.com
</pre>
</div>
</div>
</div>

<div id="outline-container-org168eafe" class="outline-3">
<h3 id="org168eafe"><span class="section-number-3">3.5.</span> Public Key Retrieval is not allowed&#xa0;&#xa0;&#xa0;<span class="tag"><span class="mysql">mysql</span></span></h3>
<div class="outline-text-3" id="text-3-5">
<p>
在设置数据库添加如下的链接选项
</p>
<div class="org-src-container">
<pre class="src src-text">allowPublicKeyRetrieval=true
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd9fb0c" class="outline-3">
<h3 id="orgdd9fb0c"><span class="section-number-3">3.6.</span> tar: time stamp XXX in the future&#xa0;&#xa0;&#xa0;<span class="tag"><span class="linux">linux</span></span></h3>
<div class="outline-text-3" id="text-3-6">
<p>
如果解压时发现待解压的机器的时间戳较慢，会出现如下报错
</p>
<pre class="example" id="orgd4d9c30">
tar: ./app.jar: time stamp 2023-08-21 08:17:50 is 223.674040911 s in the future
tar: ./version: time stamp 2023-08-21 08:17:50 is 223.673692569 s in the future
</pre>

<p>
可以在 tar 命令中添加 -m 来忽略时间戳问题
</p>
<div class="org-src-container">
<pre class="src src-sh">tar xzmf file.tar.gz
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org798f5ba" class="outline-2">
<h2 id="org798f5ba"><span class="section-number-2">4.</span> 前端调研</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orgf96f9d3" class="outline-3">
<h3 id="orgf96f9d3"><span class="section-number-3">4.1.</span> Node &amp; nvm</h3>
<div class="outline-text-3" id="text-4-1">
<div class="org-src-container">
<pre class="src src-sh">sudo apt install nodejs npm
mkdir ~/.local/node_modules
npm config set prefix <span style="color: #f1fa8c;">'~/.local/node_modules'</span>
</pre>
</div>

<p>
使用 nvm 管理 node
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ffb86c;">export</span> <span style="color: #ffc9e8;">PATH</span>=$<span style="color: #ffc9e8;">HOME</span>/.local/node_modules/bin:$<span style="color: #ffc9e8;">PATH</span>
npm i -g nvm
nvm install node
<span style="color: #6272a4;"># </span><span style="color: #6272a4;">-s &#28304;&#30721;&#32534;&#35793;</span>
nvm install -s node
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfe65ff1" class="outline-3">
<h3 id="orgfe65ff1"><span class="section-number-3">4.2.</span> Node Windows 配置</h3>
<div class="outline-text-3" id="text-4-2">
<ul class="org-ul">
<li>安装 node-v14.21.3-x64.msi <a href="https://npmmirror.com/mirrors/node/">link</a></li>
<li><p>
配置环境变量
</p>
<div class="org-src-container">
<pre class="src src-sh">npm config set prefix <span style="color: #f1fa8c;">"X:\Program Files\nodejs\node_global"</span>
npm config set cache  <span style="color: #f1fa8c;">"X:\Program Files\nodejs\node_cache"</span>
</pre>
</div></li>
<li><p>
安装 yarn
</p>
<div class="org-src-container">
<pre class="src src-sh">npm i -g yarn
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgb209a9e" class="outline-3">
<h3 id="orgb209a9e"><span class="section-number-3">4.3.</span> 淘宝国内 NPM 镜像</h3>
<div class="outline-text-3" id="text-4-3">
<p>
配置 taobao 镜像
</p>
<ul class="org-ul">
<li>旧版 <a href="https://registry.npm.taobao.org">https://registry.npm.taobao.org</a></li>
<li>新版 <a href="http://registry.npmmirror.com">http://registry.npmmirror.com</a></li>
<li>NPM MIRROR 镜像站 <a href="https://npmmirror.com/">link</a></li>
</ul>
<div class="org-src-container">
<pre class="src src-shell">npm config set registry http://registry.npmmirror.com
yarn config set registry http://registry.npmmirror.com
</pre>
</div>

<p>
设置 electron 地址
</p>
<div class="org-src-container">
<pre class="src src-sh">yarn config set <span style="color: #ffc9e8;">electron_mirror</span>=https://npm.taobao.org/mirrors/electron/
yarn config set <span style="color: #ffc9e8;">electron_builder_binaries_mirror</span>=https://npm.taobao.org/mirrors/electron-builder-binaries/
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">yarn config set electron_mirror https://mirrors.huaweicloud.com/electron/
yarn config set electron_builder_binaries_mirror https://mirrors.huaweicloud.com/electron-builder-binaries/
</pre>
</div>
</div>
</div>

<div id="outline-container-org1f414b1" class="outline-3">
<h3 id="org1f414b1"><span class="section-number-3">4.4.</span> 前端 UI 组件库</h3>
<div class="outline-text-3" id="text-4-4">
</div>
<div id="outline-container-orgfc90168" class="outline-4">
<h4 id="orgfc90168"><span class="section-number-4">4.4.1.</span> Ant Design</h4>
<div class="outline-text-4" id="text-4-4-1">
<p>
Ant Design 官网 <a href="https://ant-design.antgroup.com/index-cn">link</a>
</p>
</div>
</div>
<div id="outline-container-org41ef9fd" class="outline-4">
<h4 id="org41ef9fd"><span class="section-number-4">4.4.2.</span> Ant Design Pro</h4>
<div class="outline-text-4" id="text-4-4-2">
<p>
<a href="https://pro.ant.design/zh-CN/docs/getting-started/">Ant Design Pro</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">npm i @ant-design/pro-cli -g
pro create myapp
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Last Updated 2023-09-27 Wed 22:09. Created by Jinghui Hu at 2023-01-29 Sun 10:55.</p>
</div>
</body>
</html>