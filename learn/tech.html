<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-09-21 Thu 12:46 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>技术文档汇总</title>
<meta name="author" content="Jinghui Hu" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="styles/readtheorg/css/readtheorg.css"/>
<script type="text/javascript" src="styles/lib/js/jquery.min.js"></script>
<script type="text/javascript" src="styles/lib/js/bootstrap.min.js"></script>
<script type="text/javascript" src="styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="styles/readtheorg/js/readtheorg.js"></script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="../readme.html"> UP </a>
 |
 <a accesskey="H" href="../index.html"> HOME </a>
</div><div id="content" class="content">
<h1 class="title">技术文档汇总</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org5c85e4c">1. 学习计划</a>
<ul>
<li><a href="#org720bcf2">1.1. 操作系统</a>
<ul>
<li><a href="#org5141b08">1.1.1. 制作操作系统资源</a></li>
<li><a href="#org2e7efc4">1.1.2. 课程 MIT 6.828</a></li>
<li><a href="#org990d8ac">1.1.3. 实模式</a></li>
<li><a href="#org20c290f">1.1.4. 保护模式</a></li>
<li><a href="#org628a63e">1.1.5. Minix</a></li>
<li><a href="#org3d585a2">1.1.6. 实验环境准备</a></li>
<li><a href="#org9eee3f5">1.1.7. 自制操作系统</a></li>
</ul>
</li>
<li><a href="#orge4b7b57">1.2. Linux</a>
<ul>
<li><a href="#org4cd37a9">1.2.1. Linux 资源链接</a></li>
<li><a href="#org3e38d7b">1.2.2. 编译内核示例</a></li>
<li><a href="#org44aa3b4">1.2.3. 编译 Linux 0.11 需要的工具</a></li>
<li><a href="#orgf9b0f5e">1.2.4. <span class="todo TODO">TODO</span> 内存检测工具 valgrind</a></li>
</ul>
</li>
<li><a href="#org494b87a">1.3. Rust</a>
<ul>
<li><a href="#org1fc079e">1.3.1. 资源链接</a></li>
</ul>
</li>
<li><a href="#org622ebd9">1.4. 极客时光</a>
<ul>
<li><a href="#org9601523">1.4.1. 专栏 22 讲通关 Go 语言</a></li>
<li><a href="#org7b7ed51">1.4.2. 专栏 24 讲吃透分布式数据库</a></li>
<li><a href="#org8104b36">1.4.3. 专栏 消息队列高手课</a></li>
</ul>
</li>
<li><a href="#org07366a2">1.5. 数据结构</a></li>
</ul>
</li>
<li><a href="#org9cbfbc9">2. 编程工具</a>
<ul>
<li><a href="#org6584410">2.1. Tool Chain</a>
<ul>
<li><a href="#org49b1f59">2.1.1. ohmyzsh</a></li>
<li><a href="#org124e701">2.1.2. HomeBrew</a></li>
<li><a href="#org49eaee6">2.1.3. LSP</a></li>
</ul>
</li>
<li><a href="#orgafed681">2.2. Cheat Sheets</a></li>
<li><a href="#org09818a6">2.3. Java</a>
<ul>
<li><a href="#org6b9d9e5">2.3.1. Maven</a></li>
<li><a href="#orgf83211b">2.3.2. Spring Framework</a></li>
<li><a href="#orga0ce79b">2.3.3. Spring Boot</a></li>
<li><a href="#orge9c1985">2.3.4. Kafka</a></li>
<li><a href="#org2692ff0">2.3.5. RocketMQ</a></li>
<li><a href="#orga347b1a">2.3.6. JVM</a></li>
<li><a href="#org208a583">2.3.7. Hive</a></li>
<li><a href="#org48f571e">2.3.8. SDK Man</a></li>
</ul>
</li>
<li><a href="#org75c230b">2.4. Golang</a>
<ul>
<li><a href="#org435354d">2.4.1. go module 初始化项目</a></li>
<li><a href="#orga41a4a4">2.4.2. 使用私有仓库</a></li>
<li><a href="#org28100c3">2.4.3. 使用本地仓库</a></li>
<li><a href="#org46177f7">2.4.4. IDL</a></li>
<li><a href="#org0658409">2.4.5. hertz</a></li>
<li><a href="#org553508c">2.4.6. kitex</a></li>
<li><a href="#orgedf4bb8">2.4.7. profile 性能分析</a></li>
<li><a href="#orgb166926">2.4.8. 泛型写法</a></li>
<li><a href="#org41751a4">2.4.9. 垃圾回收</a></li>
</ul>
</li>
<li><a href="#org294a0a8">2.5. Perl</a>
<ul>
<li><a href="#orgdbe06e6">2.5.1. 环境配置</a></li>
<li><a href="#orga158394">2.5.2. 基本使用</a></li>
</ul>
</li>
<li><a href="#org51dc02f">2.6. Python</a>
<ul>
<li><a href="#orgc91d991">2.6.1. 安装 python 的开发包</a></li>
<li><a href="#org8a682c3">2.6.2. pyenv 管理 python 版本</a></li>
</ul>
</li>
<li><a href="#org1942e9a">2.7. Ruby</a></li>
<li><a href="#org160c6ee">2.8. Rust</a>
<ul>
<li><a href="#org13d4c58">2.8.1. 安装配置</a></li>
<li><a href="#orgde93c19">2.8.2. 使用笔记</a></li>
<li><a href="#org7d0879e">2.8.3. cargo</a></li>
</ul>
</li>
<li><a href="#org9d2c557">2.9. GDB &amp; LLDB</a>
<ul>
<li><a href="#orga9a6656">2.9.1. 参考资料及链接</a></li>
<li><a href="#org8b11787">2.9.2. TUI</a></li>
<li><a href="#org10bfe4c">2.9.3. 进程启动: run &amp; attach</a></li>
<li><a href="#orgb5da469">2.9.4. 调试流程控制</a></li>
<li><a href="#orgb1050bb">2.9.5. 保持断点 &amp; 现场恢复</a></li>
<li><a href="#orgb272553">2.9.6. 查看/修改变量和内存数据</a></li>
<li><a href="#org323e40b">2.9.7. 调试时显示下一条汇编</a></li>
<li><a href="#org904c471">2.9.8. 命令行启动时执行命令 -ex</a></li>
</ul>
</li>
<li><a href="#org8db1f0b">2.10. Git</a>
<ul>
<li><a href="#org4bbbb7e">2.10.1. 配置用户信息</a></li>
<li><a href="#org2a9ed9c">2.10.2. 递归克隆子模块</a></li>
<li><a href="#org8f1ae1e">2.10.3. 忽略换行符 ^M</a></li>
<li><a href="#org572c6e2">2.10.4. 代码发布相关</a></li>
<li><a href="#org107ff65">2.10.5. 添加添加生成 TAGS 的 git-hooks</a></li>
</ul>
</li>
<li><a href="#orge49e59a">2.11. SSH</a>
<ul>
<li><a href="#orgd1e7244">2.11.1. ~/.ssh/config</a></li>
<li><a href="#org9817898">2.11.2. 配置 host 别名</a></li>
<li><a href="#orgcc3f22f">2.11.3. 直接转发远端流量</a></li>
<li><a href="#org94b78a7">2.11.4. 暴露本机服务配置, 两跳登录</a></li>
<li><a href="#orgfc09731">2.11.5. 代理登录</a></li>
<li><a href="#org5e3c1a3">2.11.6. 连接 socket 重用</a></li>
<li><a href="#org590b05a">2.11.7. forward 端口转发</a></li>
<li><a href="#orgbb62a8f">2.11.8. ssh 双跳登录</a></li>
<li><a href="#org8cd36f9">2.11.9. scp 双跳传输</a></li>
</ul>
</li>
<li><a href="#orgb0f2202">2.12. Shell</a>
<ul>
<li><a href="#orgdea8715">2.12.1. 后台运行命令 cmd</a></li>
<li><a href="#org6e0c6c6">2.12.2. 比较 semver 版本号</a></li>
<li><a href="#orgdc770b1">2.12.3. heredoc 定义变量</a></li>
<li><a href="#org000d821">2.12.4. 检测命令返回值是否正确</a></li>
<li><a href="#orgc2b56a2">2.12.5. 检测当前是否 root 用户</a></li>
<li><a href="#org209268b">2.12.6. 临时提权设置目录权限</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org3ec36db">3. 研发效率</a>
<ul>
<li><a href="#org066e0bd">3.1. 交叉编译环境配置</a></li>
<li><a href="#orgf129c27">3.2. Tmux 管理终端会话</a></li>
<li><a href="#orgcc5ec3f">3.3. 处理 json 字符串</a></li>
<li><a href="#org5e7c6ae">3.4. qemu</a></li>
<li><a href="#org694ad8f">3.5. bochs</a>
<ul>
<li><a href="#org065462a">3.5.1. bochs 安装及配置</a></li>
<li><a href="#org58b6611">3.5.2. 开启图形调试器</a></li>
<li><a href="#orgad12e3a">3.5.3. 提取系统文件</a></li>
</ul>
</li>
<li><a href="#org213a9b5">3.6. pandoc 文档格式转换</a></li>
</ul>
</li>
<li><a href="#org85427bd">4. 后端研发</a>
<ul>
<li><a href="#org4a19c87">4.1. Oracle</a>
<ul>
<li><a href="#org2692840">4.1.1. 参考资料</a></li>
<li><a href="#org3d4cd76">4.1.2. 开发环境配置</a></li>
<li><a href="#org40e48e8">4.1.3. 运维相关</a></li>
</ul>
</li>
<li><a href="#org64e68d2">4.2. MySQL</a>
<ul>
<li><a href="#org92df610">4.2.1. 参考资料</a></li>
<li><a href="#org9ee7d11">4.2.2. 主从架构实验环境</a></li>
<li><a href="#orgdd7cbfe">4.2.3. 运维主题</a></li>
<li><a href="#org336e6a7">4.2.4. 源码研究</a></li>
</ul>
</li>
<li><a href="#org142e32c">4.3. Postgres</a>
<ul>
<li><a href="#orgfff4a08">4.3.1. 前置环境变量</a></li>
<li><a href="#org244795d">4.3.2. 编译调试 &amp; 初始化数据</a></li>
<li><a href="#org21728b2">4.3.3. 调试命令</a></li>
</ul>
</li>
<li><a href="#org877e6fa">4.4. ClickHouse</a>
<ul>
<li><a href="#org9a1ba0e">4.4.1. 安装步骤</a></li>
</ul>
</li>
<li><a href="#orgd05430e">4.5. nginx</a>
<ul>
<li><a href="#orga526d1b">4.5.1. 文件配置</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org4308766">5. 系统运维</a>
<ul>
<li><a href="#org4c51e36">5.1. Docker</a>
<ul>
<li><a href="#org8fe89a4">5.1.1. Docker 安装过程</a></li>
<li><a href="#orgb0b6d4a">5.1.2. Engine 配置</a></li>
<li><a href="#org9a44386">5.1.3. 国内镜像</a></li>
<li><a href="#org8763d14">5.1.4. 配置代理</a></li>
</ul>
</li>
<li><a href="#org0824e17">5.2. Kubernetes</a>
<ul>
<li><a href="#orgac9f135">5.2.1. minikube</a></li>
<li><a href="#orga33cf2b">5.2.2. kubeadm</a></li>
<li><a href="#orgbe90fc5">5.2.3. kubectl</a></li>
<li><a href="#org9a8bf1d">5.2.4. 包管理工具 helm</a></li>
</ul>
</li>
<li><a href="#orgaab1999">5.3. 磁盘管理</a>
<ul>
<li><a href="#orga84942a">5.3.1. 启动盘制作</a></li>
<li><a href="#org31668fa">5.3.2. Ubuntu 磁盘分区扩容</a></li>
</ul>
</li>
<li><a href="#orgdd1f90c">5.4. 压缩/解压</a></li>
<li><a href="#org012880a">5.5. Prometheus</a></li>
</ul>
</li>
<li><a href="#org811836f">6. 前端研发</a>
<ul>
<li><a href="#org9c77ecb">6.1. Node</a></li>
<li><a href="#orgb6836cb">6.2. Node Windows 配置</a></li>
<li><a href="#org502d024">6.3. 国内镜像</a></li>
<li><a href="#orgb78344a">6.4. UI 库</a></li>
</ul>
</li>
<li><a href="#org7e0c915">7. 日常使用</a>
<ul>
<li><a href="#org3c39661">7.1. 使用体验</a>
<ul>
<li><a href="#orgd39a170">7.1.1. Esc 键有延迟</a></li>
</ul>
</li>
<li><a href="#orgedbd96f">7.2. WSL</a>
<ul>
<li><a href="#org592ad6b">7.2.1. Ubuntu 安装并迁移到其他盘</a></li>
<li><a href="#org86b6f14">7.2.2. Docker 无法启动</a></li>
<li><a href="#org205620c">7.2.3. 缺失字体</a></li>
<li><a href="#org32c7fce">7.2.4. 挂载共享服务器</a></li>
<li><a href="#org669fb4a">7.2.5. 解决提示符错误</a></li>
<li><a href="#orga2b1d63">7.2.6. 下载 firefox</a></li>
</ul>
</li>
<li><a href="#org9f16ab0">7.3. CentOS</a>
<ul>
<li><a href="#orgff960b1">7.3.1. SCL (Software Collection)</a></li>
<li><a href="#org6fdb77b">7.3.2. Red Hat Developer Toolset</a></li>
<li><a href="#org6c05799">7.3.3. yum 代理</a></li>
<li><a href="#org137115b">7.3.4. nodejs</a></li>
<li><a href="#org609c95e">7.3.5. 编译安装 openssl</a></li>
<li><a href="#orgc71309b">7.3.6. 代理服务器 squid</a></li>
<li><a href="#orgccacfca">7.3.7. DNS Server 配置 dnsmasq</a></li>
<li><a href="#orga262aa8">7.3.8. NTP 时间服务器设置</a></li>
<li><a href="#org50a51f4">7.3.9. 硬件时钟 hwclock</a></li>
<li><a href="#orgdb35cc4">7.3.10. 安装中文字体</a></li>
</ul>
</li>
<li><a href="#org3c81fd7">7.4. Manjaro</a></li>
<li><a href="#orgb199fd6">7.5. Emacs</a>
<ul>
<li><a href="#orgdde174c">7.5.1. 参考资料</a></li>
<li><a href="#org774c6f3">7.5.2. 任务管理</a></li>
<li><a href="#org5c57df6">7.5.3. 绘图</a></li>
<li><a href="#orgbc5f7b6">7.5.4. 批量删除 ^M 方法</a></li>
<li><a href="#orged8d648">7.5.5. tramp ssh 到远程</a></li>
<li><a href="#orgd05c39b">7.5.6. 设置文件类型</a></li>
<li><a href="#org6a1308f">7.5.7. 设置本地文件配置</a></li>
<li><a href="#org82ede84">7.5.8. 编辑二进制文件</a></li>
<li><a href="#org3f5dd55">7.5.9. elisp 函数增强</a></li>
<li><a href="#org1edd398">7.5.10. 设置文件显示自动换行</a></li>
<li><a href="#org1b39b9f">7.5.11. libvterm 编译失败</a></li>
<li><a href="#orgfde032e">7.5.12. profiler 启动性能分析</a></li>
</ul>
</li>
<li><a href="#org952a3c1">7.6. Linux</a>
<ul>
<li><a href="#org68f5279">7.6.1. tar: time stamp XXX in the future</a></li>
</ul>
</li>
<li><a href="#orgee85f21">7.7. 前端</a>
<ul>
<li><a href="#orgc83ed5c">7.7.1. digital envelope routines::unsupported</a></li>
</ul>
</li>
<li><a href="#orge90b7ed">7.8. 后端</a>
<ul>
<li><a href="#orgbe99835">7.8.1. RuntimeError: 'cryptography' package is required for sha256<sub>password</sub> or caching<sub>sha2</sub><sub>password</sub> auth methods</a></li>
</ul>
</li>
<li><a href="#org41469d2">7.9. 科学上网</a>
<ul>
<li><a href="#orga707d56">7.9.1. githubusercontent 链接失败</a></li>
</ul>
</li>
<li><a href="#org02dcf04">7.10. MySQL</a>
<ul>
<li><a href="#orgfb5b29c">7.10.1. Public Key Retrieval is not allowed</a></li>
</ul>
</li>
<li><a href="#orgc96762f">7.11. Docker</a>
<ul>
<li><a href="#org53caa1c">7.11.1. 文件夹递归复制</a></li>
</ul>
</li>
<li><a href="#org62d9b5b">7.12. GDB</a>
<ul>
<li><a href="#orgc4b10bc">7.12.1. MacOS: 证书错误问题 (^-^)</a></li>
<li><a href="#orgd9cc5a2">7.12.2. Remote 'g' packet reply is too long</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org5c85e4c" class="outline-2">
<h2 id="org5c85e4c"><span class="section-number-2">1.</span> 学习计划</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org720bcf2" class="outline-3">
<h3 id="org720bcf2"><span class="section-number-3">1.1.</span> 操作系统</h3>
<div class="outline-text-3" id="text-1-1">
</div>
<div id="outline-container-org5141b08" class="outline-4">
<h4 id="org5141b08"><span class="section-number-4">1.1.1.</span> 制作操作系统资源</h4>
<div class="outline-text-4" id="text-1-1-1">
<ol class="org-ol">
<li>os-tutorial 编写操作系统的入门代码 os-dev.pdf | <a href="https://github.com/cfenollosa/os-tutorial">link</a></li>
<li>rust 操作系统 <a href="https://rcore.gitbook.io/rust-os-docs/kai-fa-huan-jing-pei-zhi">rust os</a> | <a href="https://github.com/rcore-os/rCore">rCore</a></li>
<li>Writing an OS in Rust <a href="https://os.phil-opp.com/zh-CN/">link</a></li>
<li>c/c++ 编写一个操作系统 <a href="https://samypesse.gitbook.io/how-to-create-an-operating-system/chapter-2">link</a></li>
<li>James kernel development tutorial <a href="http://www.jamesmolloy.co.uk/tutorial_html/index.html">link</a></li>
<li>《x86 汇编语言：从实模式到保护模式》 <a href="http://www.lizhongc.com/index.php/archives/10/">BOOK</a> | <a href="https://www.bilibili.com/video/BV1xE411N74T/?spm_id_from=333.337.search-card.all.click&amp;vd_source=3a56932406d5df288a20eff532848982">BTV</a> | <a href="http://www.lizhongc.com/">李忠</a></li>
<li>BUAA OS 2022 <a href="https://github.com/MaxLong2001/BUAA_OS_2022.git">link</a></li>
</ol>
</div>
</div>
<div id="outline-container-org2e7efc4" class="outline-4">
<h4 id="org2e7efc4"><span class="section-number-4">1.1.2.</span> 课程 <a href="https://pdos.csail.mit.edu/6.828/2019/index.html">MIT 6.828</a></h4>
<div class="outline-text-4" id="text-1-1-2">
<ol class="org-ol">
<li>riscv <a href="https://pdos.csail.mit.edu/6.828/2019/tools.html">工具链</a></li>
<li>课程视频 <a href="https://www.bilibili.com/video/BV19k4y1C7kA">BTV</a></li>
<li>中文课程整理 <a href="http://xv6.dgs.zone/">中文介绍</a></li>
</ol>
</div>
</div>
<div id="outline-container-org990d8ac" class="outline-4">
<h4 id="org990d8ac"><span class="section-number-4">1.1.3.</span> 实模式</h4>
<div class="outline-text-4" id="text-1-1-3">
</div>
<ol class="org-ol">
<li><a id="org50e84fa"></a>寄存器<br />
<div class="outline-text-5" id="text-1-1-3-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">分类</th>
<th scope="col" class="org-left">名称</th>
<th scope="col" class="org-left">全称</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">通用寄存器</td>
<td class="org-left">AX</td>
<td class="org-left">Accumulator</td>
</tr>

<tr>
<td class="org-left">通用寄存器</td>
<td class="org-left">BX</td>
<td class="org-left">Base</td>
</tr>

<tr>
<td class="org-left">通用寄存器</td>
<td class="org-left">CX</td>
<td class="org-left">Counter</td>
</tr>

<tr>
<td class="org-left">通用寄存器</td>
<td class="org-left">DX</td>
<td class="org-left">Data</td>
</tr>

<tr>
<td class="org-left">指针寄存器</td>
<td class="org-left">SP</td>
<td class="org-left">Stack Pointer</td>
</tr>

<tr>
<td class="org-left">指针寄存器</td>
<td class="org-left">BP</td>
<td class="org-left">Base Pointer</td>
</tr>

<tr>
<td class="org-left">变地址寄存器</td>
<td class="org-left">SI</td>
<td class="org-left">Source Index</td>
</tr>

<tr>
<td class="org-left">变地址寄存器</td>
<td class="org-left">DI</td>
<td class="org-left">Destination Index</td>
</tr>

<tr>
<td class="org-left">控制寄存器</td>
<td class="org-left">IP</td>
<td class="org-left">Instruction Pointer</td>
</tr>

<tr>
<td class="org-left">控制寄存器</td>
<td class="org-left">FLAG</td>
<td class="org-left">Flag</td>
</tr>

<tr>
<td class="org-left">段寄存器</td>
<td class="org-left">CS</td>
<td class="org-left">Code Segment</td>
</tr>

<tr>
<td class="org-left">段寄存器</td>
<td class="org-left">DS</td>
<td class="org-left">Data Segment</td>
</tr>

<tr>
<td class="org-left">段寄存器</td>
<td class="org-left">SS</td>
<td class="org-left">Stack Segment</td>
</tr>

<tr>
<td class="org-left">段寄存器</td>
<td class="org-left">ES</td>
<td class="org-left">Extra Segment</td>
</tr>
</tbody>
</table>
</div>
</li>

<li><a id="org217ecbb"></a>栈 bp, sp<br />
<div class="outline-text-5" id="text-1-1-3-2">
<ol class="org-ol">
<li>sp 指向栈的顶端 stack pointer</li>
<li>bp 指向栈的基地址 base pointer</li>
<li>push 操作时, sp = sp - 2, bp 不变</li>
<li>pop 操作时, sp = sp + 2, bp 不变</li>
</ol>

<div class="org-src-container">
<pre class="src src-asm"><span style="color: #51afef;">.code16</span>                         <span style="color: #525252;">; </span><span style="color: #525252;">16 bits mode</span>

<span style="color: #525252;">;;; </span><span style="color: #525252;">&#21021;&#22987;&#21270;&#26632;&#25351;&#38024;</span>
<span style="color: #c678dd;">mov</span> <span style="color: #51afef;">bp</span>, 0x8000
<span style="color: #c678dd;">mov</span> <span style="color: #51afef;">sp</span>, bp                      <span style="color: #525252;">; </span><span style="color: #525252;">sp = bp &#26102;, &#26632;&#20026;&#31354;</span>

<span style="color: #525252;">;;; </span><span style="color: #525252;">&#21387;&#20837; 3 &#20010;&#27979;&#35797;&#25968;&#25454;</span>
<span style="color: #525252;">;;; </span><span style="color: #525252;">sp = 0x8000, bp = 0x8000</span>
<span style="color: #c678dd;">push</span> 'A'
<span style="color: #525252;">;;; </span><span style="color: #525252;">sp = 0x7ffe, bp = 0x8000</span>
<span style="color: #c678dd;">push</span> 'B'
<span style="color: #525252;">;;; </span><span style="color: #525252;">sp = 0x7ffc, bp = 0x8000</span>
<span style="color: #c678dd;">push</span> 'C'

<span style="color: #525252;">;;; </span><span style="color: #525252;">&#26597;&#30475;&#25968;&#25454;</span>
<span style="color: #c678dd;">mov</span> <span style="color: #51afef;">bx</span>, bp
<span style="color: #c678dd;">mov</span> <span style="color: #51afef;">al</span>, [bx-2]
<span style="color: #c678dd;">int</span> <span style="color: #51afef;">0x10</span>                        <span style="color: #525252;">; </span><span style="color: #525252;">&#25171;&#21360; A</span>

<span style="color: #c678dd;">mov</span> <span style="color: #51afef;">bx</span>, spp
<span style="color: #c678dd;">mov</span> <span style="color: #51afef;">al</span>, [bx]
<span style="color: #c678dd;">int</span> <span style="color: #51afef;">0x10</span>                        <span style="color: #525252;">; </span><span style="color: #525252;">&#25171;&#21360; C</span>

<span style="color: #525252;">;;; </span><span style="color: #525252;">&#24377;&#20986;&#25968;&#25454;</span>
<span style="color: #c678dd;">pop</span> <span style="color: #51afef;">bx</span>
<span style="color: #525252;">;;; </span><span style="color: #525252;">sp = 0x7ffc, bp = 0x8000</span>
<span style="color: #c678dd;">mov</span> <span style="color: #51afef;">al</span>, bl
<span style="color: #c678dd;">int</span> <span style="color: #51afef;">0x10</span>                        <span style="color: #525252;">; </span><span style="color: #525252;">&#25171;&#21360; C</span>

<span style="color: #c678dd;">pop</span> <span style="color: #51afef;">bx</span>
<span style="color: #525252;">;;; </span><span style="color: #525252;">sp = 0x7ffe, bp = 0x8000</span>
<span style="color: #c678dd;">mov</span> <span style="color: #51afef;">al</span>, bl
<span style="color: #c678dd;">int</span> <span style="color: #51afef;">0x10</span>                        <span style="color: #525252;">; </span><span style="color: #525252;">&#25171;&#21360; B</span>

<span style="color: #c678dd;">pop</span> <span style="color: #51afef;">bx</span>
<span style="color: #525252;">;;; </span><span style="color: #525252;">sp = 0x8000, bp = 0x8000</span>
<span style="color: #c678dd;">mov</span> <span style="color: #51afef;">al</span>, bl
<span style="color: #c678dd;">int</span> <span style="color: #51afef;">0x10</span>                        <span style="color: #525252;">; </span><span style="color: #525252;">&#25171;&#21360; A</span>
</pre>
</div>
</div>
</li>
<li><a id="org50bcbfe"></a>中断<br />
<div class="outline-text-5" id="text-1-1-3-3">
<p>
BIOS 通过中断提供一下操作硬件的基本程序，具体中断参考手册见 <a href="https://stanislavs.org/helppc/idx_interrupt.html">link</a>
</p>
</div>
</li>

<li><a id="orgcea521c"></a>分支<br />
<div class="outline-text-5" id="text-1-1-3-4">
<p>
<code>jmp $</code>, $ 表示当前标号, 该指令会死循环
</p>

<p>
通常汇编的跳转通过 <code>cmp</code>, <code>je</code>, <code>jmp</code> 等指令配合实现，例如
</p>
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #c678dd;">cmp</span> <span style="color: #51afef;">ax</span>, 4      <span style="color: #525252;">; </span><span style="color: #525252;">if ax = 4</span>
<span style="color: #c678dd;">je</span> <span style="color: #51afef;">ax</span>_is_four  <span style="color: #525252;">; </span><span style="color: #525252;">do something (by jumping to that label)</span>
<span style="color: #c678dd;">jmp</span> <span style="color: #51afef;">else</span>       <span style="color: #525252;">; </span><span style="color: #525252;">else, do another thing</span>
<span style="color: #c678dd;">jmp</span> <span style="color: #51afef;">endif</span>      <span style="color: #525252;">; </span><span style="color: #525252;">finally, resume the normal flow</span>

<span style="color: #c678dd;">ax_is_four</span>:
    .....
    <span style="color: #51afef;">jmp</span> endif

<span style="color: #c678dd;">else</span>:
    .....
    <span style="color: #51afef;">jmp</span> endif  <span style="color: #525252;">; </span><span style="color: #525252;">not actually necessary but printed here for completeness</span>

<span style="color: #c678dd;">endif</span>:
</pre>
</div>

<p>
函数调用也属于简单的跳转指令, 例如
</p>
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #c678dd;">mov</span> <span style="color: #51afef;">al</span>, 'X'
<span style="color: #c678dd;">jmp</span> <span style="color: #51afef;">print</span>
<span style="color: #c678dd;">endprint</span>:

<span style="color: #c678dd;">print</span>:
    <span style="color: #51afef;">mov</span> ah, 0x0e                <span style="color: #525252;">; </span><span style="color: #525252;">tty code</span>
    <span style="color: #51afef;">int</span> 0x10                    <span style="color: #525252;">; </span><span style="color: #525252;">&#25171;&#21360; al &#30340;&#23383;&#31526;</span>
    <span style="color: #51afef;">jmp</span> endprint                <span style="color: #525252;">; </span><span style="color: #525252;">&#36820;&#22238;</span>
</pre>
</div>

<p>
由于函数调用非常常见, 会有一些指令来简化函数调用实现过程
</p>
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #c678dd;">mov</span> <span style="color: #51afef;">al</span>, 'X'
<span style="color: #c678dd;">call</span> <span style="color: #51afef;">print</span>

<span style="color: #c678dd;">print</span>:
    <span style="color: #51afef;">mov</span> ah, 0x0e                <span style="color: #525252;">; </span><span style="color: #525252;">tty code</span>
    <span style="color: #51afef;">int</span> 0x10                    <span style="color: #525252;">; </span><span style="color: #525252;">&#25171;&#21360; al &#30340;&#23383;&#31526;</span>
    <span style="color: #51afef;">ret</span>
</pre>
</div>
</div>
</li>

<li><a id="orge120cac"></a>分段<br />
<div class="outline-text-5" id="text-1-1-3-5">
<p>
8086 寄存器是 16 位的, 真实地址 = 段地址 &lt;&lt; 4 + address
</p>
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #525252;">;;; </span><span style="color: #525252;">&#35774;&#32622; ds &#27573;&#23492;&#23384;&#22120;</span>
<span style="color: #c678dd;">mov</span> <span style="color: #51afef;">bx</span>, 0x7c0
<span style="color: #c678dd;">mov</span> <span style="color: #51afef;">ds</span>, bx
<span style="color: #525252;">;;; </span><span style="color: #525252;">&#40664;&#35748;&#20351;&#29992; ds &#27573;&#23492;&#23384;&#22120;&#20316;&#20026;&#22522;&#22320;&#22336;</span>
<span style="color: #c678dd;">mov</span> <span style="color: #51afef;">al</span>, [msg]
<span style="color: #c678dd;">int</span> <span style="color: #51afef;">0x10</span>

<span style="color: #525252;">;;; </span><span style="color: #525252;">&#20351;&#29992; es &#27573;&#23492;&#23384;&#22120;&#36827;&#34892;&#23547;&#22336;</span>
<span style="color: #c678dd;">mov</span> <span style="color: #51afef;">bx</span>, 0x7c0
<span style="color: #c678dd;">mov</span> <span style="color: #51afef;">es</span>, bx
<span style="color: #c678dd;">mov</span> <span style="color: #51afef;">al</span>, [es:the_secret]
<span style="color: #c678dd;">int</span> <span style="color: #51afef;">0x10</span>
</pre>
</div>
</div>
</li>

<li><a id="org042c294"></a>磁盘<br />
<div class="outline-text-5" id="text-1-1-3-6">
<p>
磁盘加载数据到内存采用 CHS 的寻址方式 (cylinder-head-sector), 读取磁盘的指令需要
将 <code>al</code> 设置成 <code>0x02</code> , 通过寄存器传入起始 CHS 地址和需要读取到的扇区数量，然后
调用中断 <code>int 0x13</code>, 其中详细的中断参数见 <a href="https://stanislavs.org/helppc/int_13-2.html">link</a>
</p>

<div class="org-src-container">
<pre class="src src-text">AH = 02                                        &#35835;&#21462;&#25805;&#20316;&#30340;&#32534;&#30721;
AL = number of sectors to read  (1-128 dec.)
CH = track/cylinder number  (0-1023 dec., see below)
CL = sector number  (1-17 dec.)
DH = head number  (0-15 dec.)
DL = drive number (0=A:, 1=2nd floppy, 80h=drive 0, 81h=drive 1)
ES:BX = pointer to buffer                      &#25968;&#25454;&#35013;&#36733;&#30340;&#20869;&#23384;&#36215;&#22987;&#22320;&#22336;


on return:
AH = status  (see INT 13,STATUS)
AL = number of sectors read
CF = 0 if successful
   = 1 if error


- BIOS disk reads should be retried at least three times and the
  controller should be reset upon error detection
- be sure ES:BX does not cross a 64K segment boundary or a
  DMA boundary error will occur
- many programming references list only floppy disk register values
- only the disk number is checked for validity
- the parameters in CX change depending on the number of cylinders;
  the track/cylinder number is a 10 bit value taken from the 2 high
  order bits of CL and the 8 bits in CH (low order 8 bits of track):

  |F|E|D|C|B|A|9|8|7|6|5-0|  CX
   | | | | | | | | | |  `-----  sector number
   | | | | | | | | `---------  high order 2 bits of track/cylinder
   `------------------------  low order 8 bits of track/cyl number
</pre>
</div>

<p>
<code>carry bit</code> 是用来记录操作是否溢出，例如
</p>
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #c678dd;">mov</span> <span style="color: #51afef;">ax</span>, 0xFFFF
<span style="color: #c678dd;">add</span> <span style="color: #51afef;">ax</span>, 1                       <span style="color: #525252;">; </span><span style="color: #525252;">ax = 0x0000 and carry = 1, &#35774;&#32622;&#20102;&#28322;&#20986;&#20301;</span>
<span style="color: #c678dd;">jc</span> <span style="color: #51afef;">label</span>                        <span style="color: #525252;">; </span><span style="color: #525252;">&#22914;&#26524;&#28322;&#20986;&#20301;&#35774;&#32622;&#20102;&#21017;&#36339;&#36716;</span>
</pre>
</div>

<p>
加载磁盘数据的汇编代码
</p>
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #525252;">; </span><span style="color: #525252;">load 'dh' sectors from drive 'dl' into ES:BX</span>
<span style="color: #c678dd;">disk_load</span>:
    <span style="color: #51afef;">pusha</span>
    <span style="color: #525252;">; </span><span style="color: #525252;">reading from disk requires setting specific values in all registers</span>
    <span style="color: #525252;">; </span><span style="color: #525252;">so we will overwrite our input parameters from 'dx'. Let's save it</span>
    <span style="color: #525252;">; </span><span style="color: #525252;">to the stack for later use.</span>
    <span style="color: #51afef;">push</span> dx

    <span style="color: #51afef;">mov</span> ah, 0x02 <span style="color: #525252;">; </span><span style="color: #525252;">ah &lt;- int 0x13 function. 0x02 = 'read'</span>
    <span style="color: #51afef;">mov</span> al, dh   <span style="color: #525252;">; </span><span style="color: #525252;">al &lt;- number of sectors to read (0x01 .. 0x80)</span>
    <span style="color: #51afef;">mov</span> cl, 0x02 <span style="color: #525252;">; </span><span style="color: #525252;">cl &lt;- sector (0x01 .. 0x11)</span>
                 <span style="color: #525252;">; </span><span style="color: #525252;">0x01 is our boot sector, 0x02 is the first 'available' sector</span>
    <span style="color: #51afef;">mov</span> ch, 0x00 <span style="color: #525252;">; </span><span style="color: #525252;">ch &lt;- cylinder (0x0 .. 0x3FF, upper 2 bits in 'cl')</span>
    <span style="color: #525252;">; </span><span style="color: #525252;">dl &lt;- drive number. Our caller sets it as a parameter and gets it from BIOS</span>
    <span style="color: #525252;">; </span><span style="color: #525252;">(0 = floppy, 1 = floppy2, 0x80 = hdd, 0x81 = hdd2)</span>
    <span style="color: #51afef;">mov</span> dh, 0x00 <span style="color: #525252;">; </span><span style="color: #525252;">dh &lt;- head number (0x0 .. 0xF)</span>

    <span style="color: #525252;">; </span><span style="color: #525252;">[es:bx] &lt;- pointer to buffer where the data will be stored</span>
    <span style="color: #525252;">; </span><span style="color: #525252;">caller sets it up for us, and it is actually the standard location for int 13h</span>
    <span style="color: #51afef;">int</span> 0x13      <span style="color: #525252;">; </span><span style="color: #525252;">BIOS interrupt</span>
    <span style="color: #51afef;">jc</span> disk_error <span style="color: #525252;">; </span><span style="color: #525252;">if error (stored in the carry bit)</span>

    <span style="color: #51afef;">pop</span> dx
    <span style="color: #51afef;">cmp</span> al, dh    <span style="color: #525252;">; </span><span style="color: #525252;">BIOS also sets 'al' to the # of sectors read. Compare it.</span>
    <span style="color: #51afef;">jne</span> sectors_error
    <span style="color: #51afef;">popa</span>
    <span style="color: #51afef;">ret</span>


<span style="color: #c678dd;">disk_error</span>:
    <span style="color: #51afef;">mov</span> bx, DISK_ERROR
    <span style="color: #51afef;">call</span> print
    <span style="color: #51afef;">call</span> print_nl
    <span style="color: #51afef;">mov</span> dh, ah <span style="color: #525252;">; </span><span style="color: #525252;">ah = error code, dl = disk drive that dropped the error</span>
    <span style="color: #51afef;">call</span> print_hex <span style="color: #525252;">; </span><span style="color: #525252;">check out the code at http://stanislavs.org/helppc/int_13-1.html</span>
    <span style="color: #51afef;">jmp</span> disk_loop

<span style="color: #c678dd;">sectors_error</span>:
    <span style="color: #51afef;">mov</span> bx, SECTORS_ERROR
    <span style="color: #51afef;">call</span> print

<span style="color: #c678dd;">disk_loop</span>:
    <span style="color: #51afef;">jmp</span> $

<span style="color: #c678dd;">DISK_ERROR</span>: <span style="color: #51afef;">db</span> <span style="color: #99bb66;">"Disk read error"</span>, 0
<span style="color: #c678dd;">SECTORS_ERROR</span>: <span style="color: #51afef;">db</span> <span style="color: #99bb66;">"Incorrect number of sectors read"</span>, 0
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org20c290f" class="outline-4">
<h4 id="org20c290f"><span class="section-number-4">1.1.4.</span> 保护模式</h4>
<div class="outline-text-4" id="text-1-1-4">
</div>
<ol class="org-ol">
<li><a id="org3f678f5"></a>保护模式下的字符显示<br />
<div class="outline-text-5" id="text-1-1-4-1">
<ol class="org-ol">
<li>保护模式是 32 位运行的</li>
<li>可以直接通过显存写入数据来显示字符
<ul class="org-ul">
<li>显存地址 0xb8000</li>
<li>一次显示需要两个参数，低 16 位传入字符, 高 16 位传入显示模式</li>
</ul></li>
</ol>

<div class="org-src-container">
<pre class="src src-asm">[bits 32] <span style="color: #525252;">; </span><span style="color: #525252;">using 32-bit protected mode</span>

<span style="color: #525252;">; </span><span style="color: #525252;">this is how constants are defined</span>
<span style="color: #c678dd;">VIDEO_MEMORY</span> <span style="color: #51afef;">equ</span> 0xb8000
<span style="color: #c678dd;">WHITE_ON_BLACK</span> <span style="color: #51afef;">equ</span> 0x0f <span style="color: #525252;">; </span><span style="color: #525252;">the color byte for each character</span>

<span style="color: #c678dd;">print_string_pm</span>:
    <span style="color: #51afef;">pusha</span>
    <span style="color: #51afef;">mov</span> edx, VIDEO_MEMORY

<span style="color: #c678dd;">print_string_pm_loop</span>:
    <span style="color: #51afef;">mov</span> al, [ebx] <span style="color: #525252;">; </span><span style="color: #525252;">[ebx] is the address of our character</span>
    <span style="color: #51afef;">mov</span> ah, WHITE_ON_BLACK

    <span style="color: #51afef;">cmp</span> al, 0 <span style="color: #525252;">; </span><span style="color: #525252;">check if end of string</span>
    <span style="color: #51afef;">je</span> print_string_pm_done

    <span style="color: #51afef;">mov</span> [edx], ax <span style="color: #525252;">; </span><span style="color: #525252;">store character + attribute in video memory</span>
    <span style="color: #51afef;">add</span> ebx, 1 <span style="color: #525252;">; </span><span style="color: #525252;">next char</span>
    <span style="color: #51afef;">add</span> edx, 2 <span style="color: #525252;">; </span><span style="color: #525252;">next video memory position</span>

    <span style="color: #51afef;">jmp</span> print_string_pm_loop

<span style="color: #c678dd;">print_string_pm_done</span>:
    <span style="color: #51afef;">popa</span>
    <span style="color: #51afef;">ret</span>
</pre>
</div>
</div>
</li>

<li><a id="org7caebc4"></a>保护模式下的 GDT<br />
<div class="outline-text-5" id="text-1-1-4-2">
<ol class="org-ol">
<li>GDT 主要保护以下信息, 总共 64 位, <a href="https://files.osdev.org/mirrors/geezer/os/pm.htm">link</a>
<ul class="org-ul">
<li>base  = low(16) + middle(8) + high(8)</li>
<li>limit = low(16) + high(4)</li>
<li>flags = (12)</li>
</ul></li>
<li>GDT 的第一项必须全是 <code>0x00</code></li>
<li>GDT 加载通过 <code>lgdt</code> 指令</li>
</ol>

<p>
下面是一个初始化的 gdt 内存定义，这里先将代码段和数据段合并在一起
</p>
<div class="org-src-container">
<pre class="src src-asm"><span style="color: #c678dd;">gdt_start</span>: <span style="color: #525252;">; </span><span style="color: #525252;">don't remove the labels, they're needed to compute sizes and jumps</span>
    <span style="color: #525252;">; </span><span style="color: #525252;">the GDT starts with a null 8-byte</span>
    <span style="color: #51afef;">dd</span> 0x0 <span style="color: #525252;">; </span><span style="color: #525252;">4 byte</span>
    <span style="color: #51afef;">dd</span> 0x0 <span style="color: #525252;">; </span><span style="color: #525252;">4 byte</span>

<span style="color: #525252;">; </span><span style="color: #525252;">GDT for code segment. base = 0x00000000, length = 0xfffff</span>
<span style="color: #c678dd;">gdt_code</span>:
    <span style="color: #51afef;">dw</span> 0xffff    <span style="color: #525252;">; </span><span style="color: #525252;">segment length, bits 0-15                    | limit_low(16)</span>
    <span style="color: #51afef;">dw</span> 0x0       <span style="color: #525252;">; </span><span style="color: #525252;">segment base, bits 0-15                      | base_low(16)</span>
    <span style="color: #51afef;">db</span> 0x0       <span style="color: #525252;">; </span><span style="color: #525252;">segment base, bits 16-23                     | base_middle(8)</span>
    <span style="color: #51afef;">db</span> 10011010b <span style="color: #525252;">; </span><span style="color: #525252;">flags (8 bits)                               | flags1(8)</span>
    <span style="color: #51afef;">db</span> 11001111b <span style="color: #525252;">; </span><span style="color: #525252;">flags (4 bits) + segment length, bits 16-19  | limit_high(4), flags2(4)</span>
    <span style="color: #51afef;">db</span> 0x0       <span style="color: #525252;">; </span><span style="color: #525252;">segment base, bits 24-31                     | base_high(8)</span>

<span style="color: #c678dd;">gdt_data</span>:
    <span style="color: #51afef;">dw</span> 0xffff
    <span style="color: #51afef;">dw</span> 0x0
    <span style="color: #51afef;">db</span> 0x0
    <span style="color: #51afef;">db</span> 10010010b
    <span style="color: #51afef;">db</span> 11001111b
    <span style="color: #51afef;">db</span> 0x0

<span style="color: #c678dd;">gdt_end</span>:

<span style="color: #525252;">; </span><span style="color: #525252;">GDT descriptor, via lgdt [gdt_descriptor]</span>
<span style="color: #c678dd;">gdt_descriptor</span>:
    <span style="color: #51afef;">dw</span> gdt_end - gdt_start - 1 <span style="color: #525252;">; </span><span style="color: #525252;">size (16 bit), always one less of its true size</span>
    <span style="color: #51afef;">dd</span> gdt_start               <span style="color: #525252;">; </span><span style="color: #525252;">address (32 bit)</span>

<span style="color: #525252;">; </span><span style="color: #525252;">define some constants for later use</span>
<span style="color: #c678dd;">CODE_SEG</span> <span style="color: #51afef;">equ</span> gdt_code - gdt_start
<span style="color: #c678dd;">DATA_SEG</span> <span style="color: #51afef;">equ</span> gdt_data - gdt_start
</pre>
</div>
</div>
</li>

<li><a id="org9f6589a"></a>实模式到 32 位保护模式切换过程<br />
<div class="outline-text-5" id="text-1-1-4-3">
<ol class="org-ol">
<li>关闭中断</li>
<li>加载 gdt</li>
<li>设置控制寄存器 <code>cr0</code></li>
<li>通过远程调整来 flush 流水线</li>
<li>更新所以的段寄存器</li>
<li>更新系统栈</li>
<li>跳转到 32 位指令出执行</li>
</ol>

<div class="org-src-container">
<pre class="src src-asm"><span style="color: #525252;">;;; </span><span style="color: #525252;">real mode</span>
[bits 16]
<span style="color: #c678dd;">switch_to_pm</span>:
    <span style="color: #51afef;">cli</span>                         <span style="color: #525252;">; </span><span style="color: #525252;">1. disable interrupts</span>
    <span style="color: #51afef;">lgdt</span> [gdt_descriptor]       <span style="color: #525252;">; </span><span style="color: #525252;">2. load the GDT descriptor</span>
    <span style="color: #51afef;">mov</span> eax, cr0
    <span style="color: #51afef;">or</span> eax, 0x1                 <span style="color: #525252;">; </span><span style="color: #525252;">3. set 32-bit mode bit in cr0</span>
    <span style="color: #51afef;">mov</span> cr0, eax
    <span style="color: #51afef;">jmp</span> CODE_SEG:init_pm        <span style="color: #525252;">; </span><span style="color: #525252;">4. far jump by using a different segment</span>

<span style="color: #525252;">;;; </span><span style="color: #525252;">protected mode is enabled</span>
[bits 32]
<span style="color: #c678dd;">init_pm</span>:
    <span style="color: #51afef;">mov</span> ax, DATA_SEG            <span style="color: #525252;">; </span><span style="color: #525252;">5. update the segment registers</span>
    <span style="color: #51afef;">mov</span> ds, ax
    <span style="color: #51afef;">mov</span> ss, ax
    <span style="color: #51afef;">mov</span> es, ax
    <span style="color: #51afef;">mov</span> fs, ax
    <span style="color: #51afef;">mov</span> gs, ax

    <span style="color: #51afef;">mov</span> ebp, 0x90000    <span style="color: #525252;">; </span><span style="color: #525252;">6. update the stack right at the top of the free space</span>
    <span style="color: #51afef;">mov</span> esp, ebp

    <span style="color: #51afef;">call</span> BEGIN_PM               <span style="color: #525252;">; </span><span style="color: #525252;">7. Call a well-known label with useful code</span>
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org628a63e" class="outline-4">
<h4 id="org628a63e"><span class="section-number-4">1.1.5.</span> Minix</h4>
<div class="outline-text-4" id="text-1-1-5">
</div>
<ol class="org-ol">
<li><a id="orgc0a8e9f"></a>配置环境<br />
<div class="outline-text-5" id="text-1-1-5-1">
<p>
<a href="https://wiki.minix3.org/doku.php?id=developersguide:crosscompiling">交叉编译文档</a>
</p>

<p>
下载代码
</p>
<div class="org-src-container">
<pre class="src src-sh">mkdir minix
<span style="color: #c678dd;">cd</span> minix
git clone git://git.minix3.org/minix src
<span style="color: #c678dd;">cd</span> src
</pre>
</div>

<p>
安装依赖
</p>
<div class="org-src-container">
<pre class="src src-sql">sudo apt-<span style="color: #51afef;">get</span> install build-essential curl git zlibc zlib1g zlib1g-dev g++
</pre>
</div>

<p>
编译内存镜像
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #dcaeea;">JOBS</span>=8 ./releasetools/x86_hdimage.sh
</pre>
</div>

<p>
启动镜像
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">cd</span> ../obj.i386/destdir.i386/boot/minix/.temp

qemu-system-i386 -display none <span style="color: #99bb66;">\</span>
                 -serial stdio <span style="color: #99bb66;">\</span>
                 -kernel kernel <span style="color: #99bb66;">\</span>
                 -append <span style="color: #99bb66;">"console=tty00 rootdevname=c0d0p1"</span> <span style="color: #99bb66;">\</span>
                 -initrd <span style="color: #99bb66;">"mod01_ds,mod02_rs,mod03_pm,mod04_sched,mod05_vfs,mod06_memory,mod07_tty,mod08_mfs,mod09_vm,mod10_pfs,mod11_init"</span> <span style="color: #99bb66;">\</span>
                 -hda /opt/local/hack/minix/src/minix_x86.img --enable-kvm
</pre>
</div>


<div id="orgc8a99d4" class="figure">
<p><img src="../static/image/2023/0315/112736.png" alt="112736.png" />
</p>
</div>
</div>
</li>

<li><a id="org3dc81c5"></a>安装 Minix 操作系统<br />
<div class="outline-text-5" id="text-1-1-5-2">
<p>
操作系统安装 <a href="https://wiki.minix3.org/doku.php?id=usersguide:runningonqemu">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#35299;&#21387;</span>
bzip2 -d minix_R3.3.0-588a35b.iso.bz2
<span style="color: #525252;"># </span><span style="color: #525252;">&#26032;&#24314;&#30828;&#30424;&#38236;&#20687;</span>
qemu-img create minix.img 8G
<span style="color: #525252;"># </span><span style="color: #525252;">&#23433;&#35013;&#21551;&#21160;</span>
qemu-system-x86_64 -net user -net nic -m 256 -cdrom minix_R3.3.0-588a35b.iso -hda minix.img -boot d
<span style="color: #525252;"># </span><span style="color: #525252;">&#21551;&#21160;</span>
qemu-system-x86_64 -net user -net nic -m 256 -hda minix.img
</pre>
</div>

<p>
安装后设置 <a href="https://wiki.minix3.org/doku.php?id=usersguide:postinstallation">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">hostname minix3

pkgin update
pkgin install openssh
cp /usr/pkg/etc/rc.d/sshd /etc/rc.d/
printf <span style="color: #99bb66;">'sshd=YES\n'</span> &gt;&gt; /etc/rc.conf
/etc/rc.d/sshd start
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org3d585a2" class="outline-4">
<h4 id="org3d585a2"><span class="section-number-4">1.1.6.</span> 实验环境准备</h4>
<div class="outline-text-4" id="text-1-1-6">
<ol class="org-ol">
<li><p>
AUR 编译说明文档 <a href="https://wiki.manjaro.org/index.php/Arch_User_Repository/zh-cn">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">clone build repository</span>
git clone https://aur.archlinux.org/i386-elf-binutils.git
<span style="color: #525252;"># </span><span style="color: #525252;">make binary package</span>
makepkg -s
<span style="color: #525252;"># </span><span style="color: #525252;">install package</span>
sudo pacman -U i386-elf-binutils-2.40-1-x86_64.pkg.tar.zst
</pre>
</div></li>

<li><p>
c 语言交叉编译
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#20132;&#21449;&#32534;&#35793;, -ffreestanding &#19981;&#38656;&#35201;&#26631;&#20934;&#24211;&#25903;&#25345;&#65292;&#29983;&#25104;&#30446;&#26631;&#26159;&#19968;&#20010;&#29420;&#31435;&#29615;&#22659;</span>
i386-elf-gcc -ffreestanding -c function.c -o function.o
<span style="color: #525252;"># </span><span style="color: #525252;">&#21453;&#27719;&#32534;</span>
i386-elf-objdump -d function.o

<span style="color: #525252;"># </span><span style="color: #525252;">&#38142;&#25509;, -Ttext 0x0 &#34920;&#31034;&#20195;&#30721;&#27573;&#30340;&#36215;&#22987;&#22320;&#22336;</span>
i386-elf-ld -o function.bin -Ttext 0x0 --oformat binary function.o

<span style="color: #525252;"># </span><span style="color: #525252;">&#21453;&#27719;&#32534;&#27979;&#35797;&#29983;&#25104;&#30340;&#20108;&#36827;&#21046;&#25991;&#20214;</span>
ndisasm -b 32 function.bin
</pre>
</div></li>

<li><p>
gdb 调试内核
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">-s &#35753; qemu &#20572;&#27490;&#24182;&#30417;&#21548; 1234 &#31471;&#21475;&#31561;&#24453;&#35843;&#35797;</span>
qemu-system-i386 -s -fda os-image.bin &amp;
<span style="color: #525252;"># </span><span style="color: #525252;">&#21019;&#24314;&#36830;&#25509;&#31526;&#21495;&#25991;&#20214;</span>
i386-elf-ld -o kernel.elf -Ttext 0x1000 kernel.o obj1.o obj2.o
<span style="color: #525252;"># </span><span style="color: #525252;">gdb &#25191;&#34892;&#21629;&#20196;&#36827;&#34892;&#35843;&#35797;</span>
i386-elf-gdb -ex <span style="color: #99bb66;">"target remote localhost:1234"</span> -ex <span style="color: #99bb66;">"symbol-file kernel.elf"</span>
</pre>
</div></li>
</ol>
</div>
</div>

<div id="outline-container-org9eee3f5" class="outline-4">
<h4 id="org9eee3f5"><span class="section-number-4">1.1.7.</span> 自制操作系统</h4>
<div class="outline-text-4" id="text-1-1-7">
<ol class="org-ol">
<li>nasm 手册 <a href="https://www.nasm.us/doc/nasmdoc2.html">link</a></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-orge4b7b57" class="outline-3">
<h3 id="orge4b7b57"><span class="section-number-3">1.2.</span> Linux</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-org4cd37a9" class="outline-4">
<h4 id="org4cd37a9"><span class="section-number-4">1.2.1.</span> Linux 资源链接</h4>
<div class="outline-text-4" id="text-1-2-1">
<ol class="org-ol">
<li>Linux 源码在线导读 bootlin <a href="https://elixir.bootlin.com/linux/0.12/source/kernel/fork.c">link</a></li>
<li>Linux 内核完全注释 <a href="http://www.oldlinux.org/download/CLK-5.0-WithCover.pdf">book</a></li>
<li>linux inside <a href="https://0xax.gitbooks.io/linux-insides/content/Booting/linux-bootstrap-1.html">link</a></li>
<li>Linux Documentation Project Guides <a href="https://tldp.org/guides.html">TLDP</a> | <a href="https://tldp.org/LDP/khg/HyperNews/get/khg.html">Linux Kernel Hackers' Guide</a></li>
<li>Linux From Scratch <a href="https://www.linuxfromscratch.org/">LFS</a></li>
<li>老版本 Linux 研究网站 <a href="http://www.oldlinux.org/">oldlinux</a></li>
</ol>
</div>
</div>
<div id="outline-container-org3e38d7b" class="outline-4">
<h4 id="org3e38d7b"><span class="section-number-4">1.2.2.</span> 编译内核示例</h4>
<div class="outline-text-4" id="text-1-2-2">
<ol class="org-ol">
<li><p>
一些依赖安装
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo apt install ncurses-dev flex bison libelf-dev libssl-dev dwarves
</pre>
</div></li>

<li>定制内核 <a href="https://wiki.centos.org/HowTos/Custom_Kernel">CentOS Wiki</a></li>
</ol>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#19979;&#36733;&#28304;&#30721;</span>
wget -c https://mirrors.tuna.tsinghua.edu.cn/kernel/v5.x/linux-5.15.115.tar.gz
tar xvzf linux-5.15.115.tar.gz
<span style="color: #c678dd;">cd</span> linux-5.15.115

<span style="color: #525252;"># </span><span style="color: #525252;">&#20934;&#22791;&#37197;&#32622;&#25991;&#20214;</span>
cp /boot/config-<span style="color: #51afef; font-weight: bold;">`uname -r`</span> .config
<span style="color: #525252;"># </span><span style="color: #525252;">&#24320;&#21551;&#25110;&#20851;&#38381;&#37197;&#32622;&#36873;&#39033;</span>
make menuconfig

<span style="color: #525252;"># </span><span style="color: #525252;">&#30830;&#20445; CONFIG_SYSTEM_TRUSTED_KEYS &#20026;&#31354;</span>
<span style="color: #525252;"># </span><span style="color: #525252;">cat .config | grep CONFIG_SYSTEM_TRUSTED_KEYS</span>
<span style="color: #525252;"># </span><span style="color: #525252;">CONFIG_SYSTEM_TRUSTED_KEYS=""</span>

<span style="color: #525252;"># </span><span style="color: #525252;">&#32534;&#35793;&#20869;&#26680;</span>
make -j12

<span style="color: #525252;"># </span><span style="color: #525252;">&#23433;&#35013;&#27169;&#22359;</span>
sudo make modules_install

<span style="color: #525252;"># </span><span style="color: #525252;">&#23433;&#35013;&#20869;&#26680;</span>
sudo make install

<span style="color: #525252;"># </span><span style="color: #525252;">&#37325;&#21551;&#31995;&#32479;, &#26597;&#30475;&#20869;&#26680;&#26159;&#21542;&#36816;&#34892;&#27491;&#24120;</span>
reboot
uname -r
</pre>
</div>

<p>
修改 grub 代码
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#26597;&#30475;&#40664;&#35748;&#30340; grub &#36873;&#39033;</span>
grub2-editenv list
<span style="color: #525252;"># </span><span style="color: #525252;">&#26356;&#25913;&#40664;&#35748;&#21551;&#21160;&#36873;&#39033;</span>
grub2-set-default <span style="color: #99bb66;">'5.16.0-1.el7.elrepo.x86_64) 7 (Core)'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org44aa3b4" class="outline-4">
<h4 id="org44aa3b4"><span class="section-number-4">1.2.3.</span> 编译 Linux 0.11 需要的工具</h4>
<div class="outline-text-4" id="text-1-2-3">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">as86 ld86</span>
sudo yum install -y dev86
sudo apt install bin86
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9b0f5e" class="outline-4">
<h4 id="orgf9b0f5e"><span class="section-number-4">1.2.4.</span> <span class="todo TODO">TODO</span> 内存检测工具 valgrind</h4>
</div>
</div>

<div id="outline-container-org494b87a" class="outline-3">
<h3 id="org494b87a"><span class="section-number-3">1.3.</span> Rust</h3>
<div class="outline-text-3" id="text-1-3">
</div>
<div id="outline-container-org1fc079e" class="outline-4">
<h4 id="org1fc079e"><span class="section-number-4">1.3.1.</span> 资源链接</h4>
<div class="outline-text-4" id="text-1-3-1">
<ol class="org-ol">
<li class="on"><code>[X]</code> The Rust Programming Language 视频教程 | <a href="https://www.bilibili.com/video/BV1K34y1x7F9">BTV</a> | <a href="https://rust-book.cs.brown.edu/">link</a></li>
<li class="on"><code>[X]</code> Rust by Example | <a href="https://doc.rust-lang.org/rust-by-example/index.html">link</a></li>
<li class="on"><code>[X]</code> 如何快速掌握新的 crates | <a href="https://www.bilibili.com/video/BV12K4y1X7qw/">BTV</a></li>
<li class="off"><code>[&#xa0;]</code> CIS 198: Rust Programming | <a href="http://cis198-2016s.github.io/schedule/">Schedule</a></li>
<li class="off"><code>[&#xa0;]</code> Rust by Practice | <a href="https://zh.practice.rs/why-exercise.html">ZH</a></li>
<li class="off"><code>[&#xa0;]</code> 极客 <a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E9%99%88%E5%A4%A9%20%C2%B7%20Rust%20%E7%BC%96%E7%A8%8B%E7%AC%AC%E4%B8%80%E8%AF%BE">Rust 编程第一课</a></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org622ebd9" class="outline-3">
<h3 id="org622ebd9"><span class="section-number-3">1.4.</span> 极客时光</h3>
<div class="outline-text-3" id="text-1-4">
</div>
<div id="outline-container-org9601523" class="outline-4">
<h4 id="org9601523"><span class="section-number-4">1.4.1.</span> 专栏 <a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/22%20%E8%AE%B2%E9%80%9A%E5%85%B3%20Go%20%E8%AF%AD%E8%A8%80-%E5%AE%8C">22 讲通关 Go 语言</a></h4>
</div>
<div id="outline-container-org7b7ed51" class="outline-4">
<h4 id="org7b7ed51"><span class="section-number-4">1.4.2.</span> 专栏 <a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/24%E8%AE%B2%E5%90%83%E9%80%8F%E5%88%86%E5%B8%83%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%AE%8C">24 讲吃透分布式数据库</a></h4>
</div>
<div id="outline-container-org8104b36" class="outline-4">
<h4 id="org8104b36"><span class="section-number-4">1.4.3.</span> 专栏 <a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E9%AB%98%E6%89%8B%E8%AF%BE">消息队列高手课</a></h4>
<div class="outline-text-4" id="text-1-4-3">
</div>
<ol class="org-ol">
<li><a id="org7aca283"></a>分布式事务<br />
<div class="outline-text-5" id="text-1-4-3-1">
<ol class="org-ol">
<li>订单系统在消息队列上开启一个事务</li>
<li>然后订单系统给消息服务器发送一个 <b>半消息</b></li>
<li>这个半消息不是说消息内容不完整，它包含的内容就是完整的消息内容，半消息和普通
消息的唯一区别是，在事务提交之前，对于消费者来说，这个消息是不可见的</li>
<li>半消息发送成功后，订单系统就可以执行本地事务</li>
</ol>


<div id="orgee5e3ae" class="figure">
<p><img src="../static/image/2023/0308/224741.png" alt="224741.png" />
</p>
</div>

<p>
如果 <b>半消息</b> 提交失败，不同队列会有不同处理方式
</p>
<ol class="org-ol">
<li>Kafka 的解决方案比较简单粗暴，直接抛出异常，让用户自行处理。我们可以在业务代
码中反复重试提交，直到提交成功，或者删除之前创建的订单进行补偿</li>
<li><p>
RocketMQ 中的事务实现中，增加了事务反查的机制来解决事务消息提交失败的问题
</p>


<div id="orga8a00ca" class="figure">
<p><img src="../static/image/2023/0308/225054.png" alt="225054.png" />
</p>
</div>

<p>
为了支撑这个事务反查机制，我们的业务代码需要实现一个反查本地事务状态的接口，
告知 RocketMQ 本地事务是成功还是失败
</p></li>
</ol>
</div>
</li>
<li><a id="org34f7e44"></a>重复消费<br />
<div class="outline-text-5" id="text-1-4-3-2">
<p>
在 MQTT 协议中，给出了三种传递消息时能够提供的服务质量标准，这三种服务质量从低到
高依次是：
</p>

<ol class="org-ol">
<li>At most once: 至多一次。消息在传递时，最多会被送达一次。换一个说法就是，没什
么消息可靠性保证，允许丢消息。一般都是一些对消息可靠性要求不太高的监控场景使
用，比如每分钟上报一次机房温度数据，可以接受数据少量丢失。</li>
<li>At least once: 至少一次。消息在传递时，至少会被送达一次。也就是说，不允许丢消
息，但是允许有少量重复消息出现。</li>
<li>Exactly once：恰好一次。消息在传递时，只会被送达一次，不允许丢失也不允许重复，
这个是最高的等级。</li>
</ol>

<p>
用幂等性解决重复消息问题
</p>
<ol class="org-ol">
<li>利用数据库的唯一约束实现幂等</li>
<li>为更新的数据设置前置条件</li>
<li>记录并检查操作</li>
</ol>
</div>
</li>

<li><a id="org87f427b"></a>消息积压<br />
<div class="outline-text-5" id="text-1-4-3-3">
<ol class="org-ol">
<li>优化消息收发性能，预防消息积压的方法有两种，
<ul class="org-ul">
<li>增加批量或者是增加并发，在发送端这两种方法都可以使用</li>
<li>在消费端需要注意的是，增加并发需要同步扩容分区数量，否则是起不到效果的</li>
</ul></li>
<li>对于系统发生消息积压的情况，需要先解决积压，再分析原因
<ul class="org-ul">
<li>快速解决积压的方法就是通过水平扩容增加 Consumer 的实例数量</li>
</ul></li>
</ol>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org07366a2" class="outline-3">
<h3 id="org07366a2"><span class="section-number-3">1.5.</span> 数据结构</h3>
<div class="outline-text-3" id="text-1-5">
<ol class="org-ol">
<li>Leetcode 刷题 <a href="https://github.com/jeanhwea/golang_tutor">golang</a> | <a href="https://github.com/jeanhwea/annotry">java</a></li>
<li>红黑树 <a href="https://www.cs.usfca.edu/~galles/visualization/RedBlack.html">rbtree</a></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org9cbfbc9" class="outline-2">
<h2 id="org9cbfbc9"><span class="section-number-2">2.</span> 编程工具</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org6584410" class="outline-3">
<h3 id="org6584410"><span class="section-number-3">2.1.</span> Tool Chain</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-org49b1f59" class="outline-4">
<h4 id="org49b1f59"><span class="section-number-4">2.1.1.</span> ohmyzsh</h4>
<div class="outline-text-4" id="text-2-1-1">
<ol class="org-ol">
<li><p>
源码安装 <a href="https://ohmyz.sh">ohmyz.sh</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">git clone https://githubfast.com/ohmyzsh/ohmyzsh.git
./tools/install.sh
</pre>
</div></li>
<li><p>
一些配置备忘
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">source</span> ~/code/jeanhwea/dome/env/env.sh
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-org124e701" class="outline-4">
<h4 id="org124e701"><span class="section-number-4">2.1.2.</span> HomeBrew</h4>
<div class="outline-text-4" id="text-2-1-2">
<ol class="org-ol">
<li><p>
安装 <a href="https://brew.sh">brew.sh</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#26041;&#26696;&#19968;</span>
/bin/bash -c <span style="color: #99bb66;">"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"</span>
<span style="color: #525252;"># </span><span style="color: #525252;">&#26041;&#26696;&#20108;</span>
git clone https://github.com/Homebrew/install.git
./install/install.sh
</pre>
</div></li>
<li><p>
清华镜像 <a href="https://mirrors.tuna.tsinghua.edu.cn/help/homebrew-bottles/">tuna</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">HOMEBREW_BOTTLE_DOMAIN</span>=<span style="color: #99bb66;">"https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles"</span>
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-org49eaee6" class="outline-4">
<h4 id="org49eaee6"><span class="section-number-4">2.1.3.</span> LSP</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
Java LSP 服务
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#23433;&#35013; jdtls</span>
git clone https://github.com/eruizc-dev/jdtls-launcher.git
./install.sh

<span style="color: #525252;"># </span><span style="color: #525252;">&#26356;&#26032; jdtls</span>
jdtls --update
jdtls --version

<span style="color: #525252;"># </span><span style="color: #525252;">&#28165;&#29702; jdtls &#32531;&#23384;&#30446;&#24405;</span>
rm -rvf ~/.cache/jdtls-workspace
</pre>
</div>

<p>
Python LSP 服务
</p>
<div class="org-src-container">
<pre class="src src-sh">pip install --user yapf
pip install --user <span style="color: #99bb66;">"python-lsp-server[yapf]"</span>
<span style="color: #525252;"># </span><span style="color: #525252;">&#19968;&#27425;&#23433;&#35013;&#25152;&#26377;&#30340; LSP &#20381;&#36182;</span>
pip install --user <span style="color: #99bb66;">"python-lsp-server[all]"</span>
<span style="color: #525252;"># </span><span style="color: #525252;">&#25991;&#20214;&#26684;&#24335;&#21270;</span>
pip install --user black
pip install --user isort
</pre>
</div>

<p>
MacOS 上安装过后出现一些诡异问题, pylsp 命令找不到，发现是 brew install python3
时对应的 bin 文件夹在一个奇怪的位置
</p>
<div class="org-src-container">
<pre class="src src-sh">$ pylsp
zsh: command not found: pylsp
$ pip uninstall  <span style="color: #99bb66;">"python-lsp-server[all]"</span>

Found existing installation: python-lsp-server 1.7.4
Uninstalling python-lsp-server-1.7.4:
  Would remove:
    /Users/hujinghui/Library/Python/3.11/bin/pylsp
    /Users/hujinghui/Library/Python/3.11/lib/python/site-packages/pylsp/*
    /Users/hujinghui/Library/Python/3.11/lib/python/site-packages/python_lsp_server-1.7.4.dist-info/*
<span style="color: #c678dd;">Proceed</span> (Y/n)? n
$ ls /Users/hujinghui/Library/Python/3.11/bin/
autopep8  flake8     get_objgraph  isort-identify-imports  pydocstyle  pylint         pylsp      symilar  yapf
epylint   get_gprof  isort         pycodestyle             pyflakes    pylint-config  pyreverse  undill   yapf-diff
$
</pre>
</div>

<p>
修改 PATH 解决
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">PATH</span>=~/Library/Python/3.11/bin:$<span style="color: #dcaeea;">PATH</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgafed681" class="outline-3">
<h3 id="orgafed681"><span class="section-number-3">2.2.</span> Cheat Sheets</h3>
<div class="outline-text-3" id="text-2-2">
<ol class="org-ol">
<li><a href="https://cheatsheets.zip/">cheatsheets.zip</a>
<ul class="org-ul">
<li>python <a href="https://cheatsheets.zip/python">link</a></li>
<li>golang <a href="https://cheatsheets.zip/go">link</a></li>
</ul></li>
<li>tldr</li>
</ol>
</div>
</div>
<div id="outline-container-org09818a6" class="outline-3">
<h3 id="org09818a6"><span class="section-number-3">2.3.</span> Java</h3>
<div class="outline-text-3" id="text-2-3">
</div>
<div id="outline-container-org6b9d9e5" class="outline-4">
<h4 id="org6b9d9e5"><span class="section-number-4">2.3.1.</span> Maven</h4>
<div class="outline-text-4" id="text-2-3-1">
</div>
<ol class="org-ol">
<li><a id="org466f772"></a>配置国内下载镜像源<br />
<div class="outline-text-5" id="text-2-3-1-1">
<p>
~/.m2/settings.xml | <a href="https://developer.aliyun.com/mvn/guide">link</a>
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #c678dd;">servers</span>&gt;
  &lt;<span style="color: #c678dd;">server</span>&gt;
    &lt;<span style="color: #c678dd;">id</span>&gt;nexus&lt;/<span style="color: #c678dd;">id</span>&gt;
    &lt;<span style="color: #c678dd;">username</span>&gt;user01&lt;/<span style="color: #c678dd;">username</span>&gt;
    &lt;<span style="color: #c678dd;">password</span>&gt;passwd&lt;/<span style="color: #c678dd;">password</span>&gt;
  &lt;/<span style="color: #c678dd;">server</span>&gt;
&lt;/<span style="color: #c678dd;">servers</span>&gt;

&lt;<span style="color: #c678dd;">mirrors</span>&gt;
  &lt;<span style="color: #c678dd;">mirror</span>&gt;
    &lt;<span style="color: #c678dd;">id</span>&gt;aliyun&lt;/<span style="color: #c678dd;">id</span>&gt;
    &lt;<span style="color: #c678dd;">mirrorOf</span>&gt;*&lt;/<span style="color: #c678dd;">mirrorOf</span>&gt;
    &lt;<span style="color: #c678dd;">name</span>&gt;Aliyun Public Repository&lt;/<span style="color: #c678dd;">name</span>&gt;
    &lt;<span style="color: #c678dd;">url</span>&gt;https://maven.aliyun.com/repository/public&lt;/<span style="color: #c678dd;">url</span>&gt;
  &lt;/<span style="color: #c678dd;">mirror</span>&gt;
&lt;/<span style="color: #c678dd;">mirrors</span>&gt;
</pre>
</div>
</div>
</li>

<li><a id="org86af5a4"></a>Nexus 依赖包上传<br />
<div class="outline-text-5" id="text-2-3-1-2">
<p>
新建一个 <code>mavenimport.sh</code> 脚本放到 repository 文件夹下
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;">#</span><span style="color: #525252;">!/bin/</span><span style="color: #51afef;">bash</span>
<span style="color: #51afef;">while </span><span style="color: #c678dd;">getopts</span> <span style="color: #99bb66;">":r:u:p:"</span> opt; <span style="color: #51afef;">do</span>
  <span style="color: #51afef;">case</span> $<span style="color: #dcaeea;">opt</span><span style="color: #51afef;"> in</span>
    <span style="color: #c678dd;">r</span>) <span style="color: #dcaeea;">REPO_URL</span>=<span style="color: #99bb66;">"$OPTARG"</span>
       ;;
    u) <span style="color: #dcaeea;">USERNAME</span>=<span style="color: #99bb66;">"$OPTARG"</span>
       ;;
    p) <span style="color: #dcaeea;">PASSWORD</span>=<span style="color: #99bb66;">"$OPTARG"</span>
       ;;
  <span style="color: #51afef;">esac</span>
<span style="color: #51afef;">done</span>

find . -type f <span style="color: #99bb66;">\</span>
     -not -path <span style="color: #99bb66;">'*/\.*'</span> <span style="color: #99bb66;">\</span>
     -not -path <span style="color: #99bb66;">'*/\^archetype\-catalog\.xml*'</span> <span style="color: #99bb66;">\</span>
     -not -path <span style="color: #99bb66;">'*/\maven\-metadata\-local**\.xml'</span> <span style="color: #99bb66;">\</span>
     -not -path <span style="color: #99bb66;">'*/\^maven\-metadata\-deployment*\.xml'</span> <span style="color: #99bb66;">\</span>
     -exec curl -u $<span style="color: #dcaeea;">USERNAME</span>:$<span style="color: #dcaeea;">PASSWORD</span> -X PUT -v -T {} $<span style="color: #dcaeea;">REPO_URL</span>{} <span style="color: #99bb66;">\;</span>

</pre>
</div>

<p>
一般需要上传 release 和 snapshot 两个仓库
</p>
<div class="org-src-container">
<pre class="src src-sh">sh mavenimport.sh -u user -p pass123 -r http://192.168.0.123:8081/repository/maven-releases/
sh mavenimport.sh -u user -p pass123 -r http://192.168.0.123:8081/repository/maven-snapshots/
</pre>
</div>
</div>
</li>
<li><a id="orgbde70da"></a>添加本地 JAR 包<br />
<div class="outline-text-5" id="text-2-3-1-3">
<p>
在 pom.xml 文件中直接添加引用
</p>
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #525252;">&lt;!-- </span><span style="color: #525252;">&#28155;&#21152;&#25968;&#25454;&#24211;&#39537;&#21160;&#23433;&#35013;&#21253;</span><span style="color: #525252;"> --&gt;</span>
&lt;<span style="color: #c678dd;">dependency</span>&gt;
  &lt;<span style="color: #c678dd;">groupId</span>&gt;com.oracle&lt;/<span style="color: #c678dd;">groupId</span>&gt;
  &lt;<span style="color: #c678dd;">artifactId</span>&gt;ojdbc6&lt;/<span style="color: #c678dd;">artifactId</span>&gt;
  &lt;<span style="color: #c678dd;">version</span>&gt;11.2.0.4.0&lt;/<span style="color: #c678dd;">version</span>&gt;
  &lt;<span style="color: #c678dd;">scope</span>&gt;system&lt;/<span style="color: #c678dd;">scope</span>&gt;
  &lt;<span style="color: #c678dd;">systemPath</span>&gt;${project.basedir}/src/main/resources/lib/ojdbc6.jar&lt;/<span style="color: #c678dd;">systemPath</span>&gt;
&lt;/<span style="color: #c678dd;">dependency</span>&gt;
</pre>
</div>
</div>
</li>

<li><a id="org1e9201f"></a>添加项目过滤<br />
<div class="outline-text-5" id="text-2-3-1-4">
<p>
在 pom.xml 文件中开启编译过滤
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #c678dd;">build</span>&gt;
  &lt;<span style="color: #c678dd;">resources</span>&gt;
    &lt;<span style="color: #c678dd;">resource</span>&gt;
      &lt;<span style="color: #c678dd;">directory</span>&gt;src/main/resources&lt;/<span style="color: #c678dd;">directory</span>&gt;
      &lt;<span style="color: #c678dd;">filtering</span>&gt;true&lt;/<span style="color: #c678dd;">filtering</span>&gt;
    &lt;/<span style="color: #c678dd;">resource</span>&gt;
  &lt;/<span style="color: #c678dd;">resources</span>&gt;
&lt;/<span style="color: #c678dd;">build</span>&gt;
</pre>
</div>

<p>
引用 pom.xml 文件中的配置
</p>
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #dcaeea;">spring</span>:
  <span style="color: #dcaeea;">application</span>:
    <span style="color: #dcaeea;">version</span>: @project.version@
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgf83211b" class="outline-4">
<h4 id="orgf83211b"><span class="section-number-4">2.3.2.</span> Spring Framework</h4>
<div class="outline-text-4" id="text-2-3-2">
<ol class="org-ol">
<li>代码 <a href="https://github.com/spring-projects/spring-framework">Source</a> | <a href="https://github.com/Jeanhwea/spring-framework/tree/jh/5.3.25">jh/5.3.25</a></li>
<li><p>
编译 <a href="https://github.com/spring-projects/spring-framework/wiki/Build-from-Source">BUILD</a> =&gt; Java8 切到 5.3 分支
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#32534;&#35793;</span>
./gradlew build
<span style="color: #525252;"># </span><span style="color: #525252;">&#36339;&#36807;&#27979;&#35797;&#29992;&#20363;</span>
./gradlew build -x test
</pre>
</div></li>
<li><p>
编译文档, 依赖 asciidoctor
</p>
<div class="org-src-container">
<pre class="src src-sh">./gradlew asciidoctor
</pre>
</div></li>
<li><p>
查看 tasks
</p>
<div class="org-src-container">
<pre class="src src-sh">./gradlew tasks
</pre>
</div></li>
<li><p>
生成代码流量跳转 TAGS
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#29983;&#25104;&#36339;&#36716;&#30340; TAG</span>
ctags -e -R --languages=c,c++ .
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-orga0ce79b" class="outline-4">
<h4 id="orga0ce79b"><span class="section-number-4">2.3.3.</span> Spring Boot</h4>
<div class="outline-text-4" id="text-2-3-3">
</div>
<ol class="org-ol">
<li><a id="org147ca0d"></a>启动传参<br />
<div class="outline-text-5" id="text-2-3-3-1">
<div class="org-src-container">
<pre class="src src-sh">mvn spring-boot:run -Dspring-boot.run.jvmArguments=<span style="color: #99bb66;">"-Xdebug -Dfile.encoding=UTF-8"</span>
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-orge9c1985" class="outline-4">
<h4 id="orge9c1985"><span class="section-number-4">2.3.4.</span> Kafka</h4>
<div class="outline-text-4" id="text-2-3-4">
<ol class="org-ol">
<li><a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/JVM%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%2032%20%E8%AE%B2%EF%BC%88%E5%AE%8C%EF%BC%89">JVM 系列</a></li>
</ol>
</div>
<ol class="org-ol">
<li><a id="org3532a1b"></a>资源链接<br />
<div class="outline-text-5" id="text-2-3-4-1">
<ol class="org-ol">
<li>说明文档 <a href="https://kafka.apache.org/documentation/">link</a></li>
</ol>
</div>
</li>
<li><a id="org2a81ac5"></a>环境配置<br />
<ol class="org-ol">
<li><a id="org2e13147"></a>官网快速使用手册<br />
<div class="outline-text-6" id="text-2-3-4-2-1">
<ol class="org-ol">
<li><a href="https://kafka.apache.org/quickstart">quickstart</a></li>
</ol>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#21551;&#21160; zk</span>
./bin/zookeeper-server-start.sh config/zookeeper.properties
<span style="color: #525252;"># </span><span style="color: #525252;">&#21551;&#21160; kafka</span>
./bin/kafka-server-start.sh config/server.properties

<span style="color: #525252;"># </span><span style="color: #525252;">&#21019;&#24314; topic</span>
./bin/kafka-topics.sh --bootstrap-server localhost:9092 --create --topic quickstart-events
<span style="color: #525252;"># </span><span style="color: #525252;">&#26174;&#31034; topic &#21015;&#34920;</span>
./bin/kafka-topics.sh --bootstrap-server localhost:9092 --list
<span style="color: #525252;"># </span><span style="color: #525252;">&#26597;&#30475;&#25351;&#23450; topic &#29366;&#24577;</span>
./bin/kafka-topics.sh --bootstrap-server localhost:9092 --describe --topic quickstart-events

<span style="color: #525252;"># </span><span style="color: #525252;">&#29983;&#20135;&#32773; &amp; &#28040;&#36153;&#32773;</span>
./bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --from-beginning --topic quickstart-events
./bin/kafka-console-producer.sh --bootstrap-server localhost:9092 --topic quickstart-events
</pre>
</div>

<p>
配置相关
</p>
<div class="org-src-container">
<pre class="src src-sh">./bin/kafka-configs.sh --zookeeper localhost:2181 --all
</pre>
</div>
</div>
</li>

<li><a id="orgd4e8a47"></a>docker 版本配置<br />
<div class="outline-text-6" id="text-2-3-4-2-2">
<ol class="org-ol">
<li><a href="https://hub.docker.com/r/bitnami/kafka/">docker hub</a></li>
<li><p>
配置文件 <a href="env-kafka/docker-compose.yaml">docker-compose.yaml</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">docker-compose up -d
</pre>
</div></li>
</ol>
</div>
</li>

<li><a id="orgbce24ce"></a>源代码<br />
<div class="outline-text-6" id="text-2-3-4-2-3">
<p>
跳过测试编译
</p>
<div class="org-src-container">
<pre class="src src-sh">./gradlew build -x test
</pre>
</div>

<p>
编译发布包
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#32534;&#35793;&#21253;</span>
./gradlew clean releaseTarGz

<span style="color: #525252;"># </span><span style="color: #525252;">&#32534;&#35793;&#20135;&#29289;</span>
ls ./core/build/distributions/
</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div id="outline-container-org2692ff0" class="outline-4">
<h4 id="org2692ff0"><span class="section-number-4">2.3.5.</span> RocketMQ</h4>
<div class="outline-text-4" id="text-2-3-5">
</div>
<ol class="org-ol">
<li><a id="org89dd3b1"></a>资源链接<br />
<div class="outline-text-5" id="text-2-3-5-1">
<ol class="org-ol">
<li>官网文档 <a href="https://rocketmq.apache.org/docs/4.x/introduction/02quickstart">link</a></li>
</ol>
</div>
</li>
</ol>
</div>
<div id="outline-container-orga347b1a" class="outline-4">
<h4 id="orga347b1a"><span class="section-number-4">2.3.6.</span> JVM</h4>
<div class="outline-text-4" id="text-2-3-6">
</div>
<ol class="org-ol">
<li><a id="org5781ca3"></a>编译 JDK<br />
<div class="outline-text-5" id="text-2-3-6-1">
<ol class="org-ol">
<li>OpenJDK 编译说明 <a href="https://openjdk.org/groups/build/">link</a></li>
<li>JDK 8 编译说明 <a href="https://hg.openjdk.org/jdk8/jdk8/raw-file/tip/README-builds.html">link</a></li>
</ol>
<div class="org-src-container">
<pre class="src src-sh">git clone git@github.com:openjdk/jdk.git
git checkout -b jh/jdk8-b99 jdk8-b99

<span style="color: #525252;"># </span><span style="color: #525252;">&#37197;&#32622; &amp; &#32534;&#35793;</span>
<span style="color: #dcaeea;">MAKE</span>=/usr/bin/make ./configure
<span style="color: #dcaeea;">JOBS</span>=12 /usr/bin/make all
</pre>
</div>
</div>
</li>
<li><a id="org611a982"></a>垃圾回收<br />
<div class="outline-text-5" id="text-2-3-6-2">
<p>
控制堆内存
</p>
<div class="org-src-container">
<pre class="src src-sh">java -Xss256M -Xms4G -Xmx4G -jar app.jar
</pre>
</div>

<p>
使用 G1 垃圾收集器 (Garbage-First)
</p>
<ul class="org-ul">
<li>MaxGCPauseMillis 回收暂停时间 300 毫秒</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh">java -XX:+UseG1GC -XX:<span style="color: #dcaeea;">MaxGCPauseMillis</span>=300 -jar app.jar
</pre>
</div>

<p>
打印 GC 日志，方便调试
</p>
<div class="org-src-container">
<pre class="src src-sh">java -Xloggc:/app/log/gc.log -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+PrintGCDetails -jar app.jar
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org208a583" class="outline-4">
<h4 id="org208a583"><span class="section-number-4">2.3.7.</span> Hive</h4>
<div class="outline-text-4" id="text-2-3-7">
<p>
配置 <a href="https://hadoop.apache.org/docs/r2.6.2/hadoop-project-dist/hadoop-common/SingleCluster.html#Standalone_Operation">hadoop</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">HADOOP_HOME</span>=/opt/local/hack/hadoop-2.6.0
<span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">PATH</span>=<span style="color: #99bb66;">"$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$PATH"</span>
<span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">HIVE_HOME</span>=/opt/local/hack/apache-hive-1.2.2-bin
<span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">PATH</span>=<span style="color: #99bb66;">"$HIVE_HOME/bin:$PATH"</span>
</pre>
</div>

<p>
配置 core-site.xml
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #c678dd;">configuration</span>&gt;
   &lt;<span style="color: #c678dd;">property</span>&gt;
      &lt;<span style="color: #c678dd;">name</span>&gt;fs.defaultFS&lt;/<span style="color: #c678dd;">name</span>&gt;
      &lt;<span style="color: #c678dd;">value</span>&gt;hdfs://localhost:9000&lt;/<span style="color: #c678dd;">value</span>&gt;
   &lt;/<span style="color: #c678dd;">property</span>&gt;
&lt;/<span style="color: #c678dd;">configuration</span>&gt;
</pre>
</div>

<p>
配置 hdfs-site.xml
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #c678dd;">configuration</span>&gt;
  &lt;<span style="color: #c678dd;">property</span>&gt;
    &lt;<span style="color: #c678dd;">name</span>&gt;dfs.replication&lt;/<span style="color: #c678dd;">name</span>&gt;
    &lt;<span style="color: #c678dd;">value</span>&gt;1&lt;/<span style="color: #c678dd;">value</span>&gt;
  &lt;/<span style="color: #c678dd;">property</span>&gt;

  &lt;<span style="color: #c678dd;">property</span>&gt;
    &lt;<span style="color: #c678dd;">name</span>&gt;dfs.namenode.name.dir&lt;/<span style="color: #c678dd;">name</span>&gt;
    &lt;<span style="color: #c678dd;">value</span>&gt;/opt/local/hdfs/namenode&lt;/<span style="color: #c678dd;">value</span>&gt;
  &lt;/<span style="color: #c678dd;">property</span>&gt;

  &lt;<span style="color: #c678dd;">property</span>&gt;
    &lt;<span style="color: #c678dd;">name</span>&gt;dfs.datanode.data.dir&lt;/<span style="color: #c678dd;">name</span>&gt;
    &lt;<span style="color: #c678dd;">value</span>&gt;/opt/local/hdfs/datanode&lt;/<span style="color: #c678dd;">value</span>&gt;
  &lt;/<span style="color: #c678dd;">property</span>&gt;
&lt;/<span style="color: #c678dd;">configuration</span>&gt;
</pre>
</div>

<p>
初始化命令
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#26684;&#24335;&#21270; namenode</span>
hdfs namenode -format
<span style="color: #525252;"># </span><span style="color: #525252;">&#21551;&#21160;/&#20851;&#38381; dfs</span>
start-dfs.sh
stop-dfs.sh
</pre>
</div>

<p>
<a href="https://cwiki.apache.org/confluence/display/Hive/GettingStarted#GettingStarted-InstallationandConfiguration">hive</a> 需要有 /tmp, /user/hive/warehouse 目录, 并且配置 g+w 权限
</p>
<ul class="org-ul">
<li>配置元数据存放目录 hive.metastore.warehouse.dir</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh">hadoop fs -mkdir       /tmp
hadoop fs -mkdir -p    /user/hive/warehouse
hadoop fs -chmod g+w   /tmp
hadoop fs -chmod g+w   /user/hive/warehouse
</pre>
</div>

<p>
解决 [ERROR] Terminal initialization failed; falling back to unsupported 问题
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">HADOOP_USER_CLASSPATH_FIRST</span>=true
</pre>
</div>
</div>
</div>
<div id="outline-container-org48f571e" class="outline-4">
<h4 id="org48f571e"><span class="section-number-4">2.3.8.</span> SDK Man</h4>
<div class="outline-text-4" id="text-2-3-8">
<ol class="org-ol">
<li>官网 <a href="https://sdkman.io/">link</a></li>
</ol>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#23433;&#35013; SDK Man</span>
curl -s <span style="color: #99bb66;">"https://get.sdkman.io"</span> | bash

<span style="color: #525252;"># </span><span style="color: #525252;">&#23433;&#35013; JDK</span>
sdk list java
sdk install java 11.0.19-tem
sdk install java 8.0.372-tem
sdk install java 17.0.7-tem

<span style="color: #525252;"># </span><span style="color: #525252;">&#31163;&#32447;&#23433;&#35013;, &#21019;&#24314; SDK &#21253;&#20026; 8.0.191-online</span>
sdk install java 8.0.191-online /opt/admin/java
<span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">JAVA_HOME</span>=/opt/admin/java

<span style="color: #525252;"># </span><span style="color: #525252;">&#20462;&#25913;&#40664;&#35748; SDK &#29256;&#26412;</span>
sdk list java | grep installed
sdk default java 11.0.19-zulu

<span style="color: #525252;"># </span><span style="color: #525252;">&#29615;&#22659;</span>
<span style="color: #525252;"># </span><span style="color: #525252;">&#21021;&#22987;&#21270;&#29615;&#22659;, &#29983;&#25104; .sdkmanrc</span>
sdk env init
<span style="color: #525252;"># </span><span style="color: #525252;">&#23433;&#35013;&#29615;&#22659;</span>
sdk env install
<span style="color: #525252;"># </span><span style="color: #525252;">&#20999;&#25442;&#29615;&#22659;</span>
sdk env
<span style="color: #525252;"># </span><span style="color: #525252;">&#28165;&#38500;&#29615;&#22659;</span>
sdk env clear


<span style="color: #525252;"># </span><span style="color: #525252;">&#23433;&#35013;&#20854;&#20182; SDK &#24037;&#20855;</span>
sdk install gradle
sdk install java
sdk install hadoop
sdk install ant

<span style="color: #525252;"># </span><span style="color: #525252;">&#24378;&#21046;&#26356;&#26032; SDK Man</span>
sdk selfupdate force
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org75c230b" class="outline-3">
<h3 id="org75c230b"><span class="section-number-3">2.4.</span> Golang</h3>
<div class="outline-text-3" id="text-2-4">
</div>
<div id="outline-container-org435354d" class="outline-4">
<h4 id="org435354d"><span class="section-number-4">2.4.1.</span> go module 初始化项目</h4>
<div class="outline-text-4" id="text-2-4-1">
<div class="org-src-container">
<pre class="src src-sh">mkdir genco
<span style="color: #c678dd;">cd</span> genco
go mod init genco
</pre>
</div>
</div>
</div>

<div id="outline-container-orga41a4a4" class="outline-4">
<h4 id="orga41a4a4"><span class="section-number-4">2.4.2.</span> 使用私有仓库</h4>
<div class="outline-text-4" id="text-2-4-2">
<p>
配置私有仓库环境变量
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">GOINSECURE</span>=<span style="color: #99bb66;">"gitana.jeanhwea.io"</span>
<span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">GOPRIVATE</span>=<span style="color: #99bb66;">"*.jeanhwea.io"</span>
</pre>
</div>

<p>
配置 ~/.gitconfig
</p>
<div class="org-src-container">
<pre class="src src-conf">[url <span style="color: #99bb66;">"ssh://git@gitana.jeanhwea.io/"</span>]
    <span style="color: #dcaeea;">insteadOf</span> = http://gitana.jeanhwea.io/
</pre>
</div>

<p>
获取对应的包
</p>
<div class="org-src-container">
<pre class="src src-sh">go get gitana.jeanhwea.io/stock/common
</pre>
</div>
</div>
</div>

<div id="outline-container-org28100c3" class="outline-4">
<h4 id="org28100c3"><span class="section-number-4">2.4.3.</span> 使用本地仓库</h4>
<div class="outline-text-4" id="text-2-4-3">
<p>
参考官网介绍 <a href="https://go.dev/doc/modules/managing-dependencies#local_directory">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">go mod edit -replace=example.com/theirmodule@v0.0.0-unpublished=../theirmodule
</pre>
</div>

<p>
或者直接在 go.mod 文件中添加
</p>
<div class="org-src-container">
<pre class="src src-text">replace gitana.jeanhwea.io/stock/common =&gt; ../common
</pre>
</div>
</div>
</div>

<div id="outline-container-org46177f7" class="outline-4">
<h4 id="org46177f7"><span class="section-number-4">2.4.4.</span> IDL</h4>
<div class="outline-text-4" id="text-2-4-4">
<p>
定义的结果如下
</p>
<ol class="org-ol">
<li><a href="https://thrift.apache.org/">Apache Thrift</a></li>
<li><a href="https://diwakergupta.github.io/thrift-missing-guide/">Thrift: The Missing Guide</a></li>
</ol>

<p>
格式化工具 <a href="https://github.com/thrift-labs/thrift-fmt">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">pip install thrift-fmt
</pre>
</div>
</div>
</div>
<div id="outline-container-org0658409" class="outline-4">
<h4 id="org0658409"><span class="section-number-4">2.4.5.</span> hertz</h4>
<div class="outline-text-4" id="text-2-4-5">
<p>
操作手册 <a href="https://www.cloudwego.io/docs/hertz/">hertz</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">hz new -module github.com/jeanhwea/appname -idl idl/appname.thrift
hz update -idl idl/appname.thrift
go mod edit -replace github.com/apache/thrift=github.com/apache/thrift@v0.13.0
</pre>
</div>
</div>
</div>

<div id="outline-container-org553508c" class="outline-4">
<h4 id="org553508c"><span class="section-number-4">2.4.6.</span> kitex</h4>
<div class="outline-text-4" id="text-2-4-6">
<p>
Kitex 微服务架构工具 <a href="https://www.cloudwego.io/zh/docs/kitex/">kitex</a>
</p>
</div>
</div>
<div id="outline-container-orgedf4bb8" class="outline-4">
<h4 id="orgedf4bb8"><span class="section-number-4">2.4.7.</span> profile 性能分析</h4>
<div class="outline-text-4" id="text-2-4-7">
<p>
通过如下命令生成分析文件，官网工具介绍 <a href="https://go.dev/doc/diagnostics">diagnostics</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">cpu &#24615;&#33021;&#20998;&#26512;</span>
go test -cpuprofile ./output/cpu.prof -run TestSched01 ./app/sched
<span style="color: #525252;"># </span><span style="color: #525252;">&#20869;&#23384; &#24615;&#33021;&#20998;&#26512;</span>
go test -memprofile ./output/mem.prof -run TestSched01 ./app/sched
<span style="color: #525252;"># </span><span style="color: #525252;">cpu &#20869;&#23384;&#24615;&#33021;&#20998;&#26512;</span>
go test -cpuprofile ./output/cpu.prof -memprofile ./output/mem.prof -run TestSched01 ./app/sched
</pre>
</div>

<p>
使用 go tool 查看文件
</p>
<div class="org-src-container">
<pre class="src src-sh">go tool pprof ./output/cpu.prof
</pre>
</div>

<p>
查看 cpu 性能分析结果
</p>
<pre class="example" id="orgfa8190b">
$ go tool pprof ./output/cpu.prof
File: sched.test
Type: cpu
Time: Aug 30, 2023 at 8:51am (CST)
Duration: 201.60ms, Total samples = 70ms (34.72%)
Entering interactive mode (type "help" for commands, "o" for options)
(pprof) top 5
Showing nodes accounting for 70ms, 100% of 70ms total
Showing top 5 nodes out of 32
      flat  flat%   sum%        cum   cum%
      40ms 57.14% 57.14%       40ms 57.14%  runtime/internal/syscall.Syscall6
      10ms 14.29% 71.43%       10ms 14.29%  github.com/sirupsen/logrus.(*TextFormatter).Format
      10ms 14.29% 85.71%       10ms 14.29%  runtime.heapBitsSetType
      10ms 14.29%   100%       10ms 14.29%  time.Now
         0     0%   100%       60ms 85.71%  github.com/sirupsen/logrus.(*Entry).Info
(pprof) top 5 -cum
Showing nodes accounting for 0, 0% of 70ms total
Showing top 5 nodes out of 32
      flat  flat%   sum%        cum   cum%
         0     0%     0%       70ms   100%  mtiisl.cn/gitlab/xifei/patok/app/sched.(*Sched).StartSched
         0     0%     0%       70ms   100%  mtiisl.cn/gitlab/xifei/patok/app/sched.TestSched01
         0     0%     0%       70ms   100%  testing.tRunner
         0     0%     0%       60ms 85.71%  github.com/sirupsen/logrus.(*Entry).Info (inline)
         0     0%     0%       60ms 85.71%  github.com/sirupsen/logrus.(*Entry).Log
(pprof)
</pre>

<p>
查看内存性能分析结果
</p>
<pre class="example" id="org0b0100b">
$ go tool pprof ./output/mem.prof
File: sched.test
Type: alloc_space
Time: Aug 30, 2023 at 8:47am (CST)
Entering interactive mode (type "help" for commands, "o" for options)
(pprof) top
Showing nodes accounting for 3693.94kB, 100% of 3693.94kB total
Showing top 10 nodes out of 29
      flat  flat%   sum%        cum   cum%
 1184.27kB 32.06% 32.06%  1184.27kB 32.06%  runtime/pprof.StartCPUProfile
  902.59kB 24.43% 56.49%  1485.59kB 40.22%  compress/flate.NewWriter (inline)
  583.01kB 15.78% 72.28%   583.01kB 15.78%  compress/flate.newDeflateFast (inline)
  512.07kB 13.86% 86.14%   512.07kB 13.86%  fmt.Sprintf
  512.01kB 13.86%   100%   512.01kB 13.86%  fmt.Sprint
         0     0%   100%   583.01kB 15.78%  compress/flate.(*compressor).init
         0     0%   100%  1485.59kB 40.22%  compress/gzip.(*Writer).Write
         0     0%   100%  1024.08kB 27.72%  github.com/sirupsen/logrus.(*Entry).Info
         0     0%   100%  1024.08kB 27.72%  github.com/sirupsen/logrus.(*Entry).Log
         0     0%   100%   512.07kB 13.86%  github.com/sirupsen/logrus.(*Entry).log
(pprof) top -cum
Showing nodes accounting for 2086.86kB, 56.49% of 3693.94kB total
Showing top 10 nodes out of 29
      flat  flat%   sum%        cum   cum%
  902.59kB 24.43% 24.43%  1485.59kB 40.22%  compress/flate.NewWriter (inline)
         0     0% 24.43%  1485.59kB 40.22%  compress/gzip.(*Writer).Write
         0     0% 24.43%  1485.59kB 40.22%  runtime/pprof.(*profileBuilder).build
         0     0% 24.43%  1485.59kB 40.22%  runtime/pprof.profileWriter
         0     0% 24.43%  1184.27kB 32.06%  main.main
         0     0% 24.43%  1184.27kB 32.06%  runtime.main
 1184.27kB 32.06% 56.49%  1184.27kB 32.06%  runtime/pprof.StartCPUProfile
         0     0% 56.49%  1184.27kB 32.06%  testing.(*M).Run
         0     0% 56.49%  1184.27kB 32.06%  testing.(*M).before
         0     0% 56.49%  1184.27kB 32.06%  testing/internal/testdeps.TestDeps.StartCPUProfile
(pprof)
</pre>

<p>
产出 PDF 性能分析报告
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#23433;&#35013;&#22270;&#20687;&#29983;&#25104;&#24037;&#20855;</span>
sudo apt install graphviz
sudo brew install graphviz
<span style="color: #525252;"># </span><span style="color: #525252;">&#29983;&#25104; PDF &#25253;&#21578;</span>
go tool pprof --pdf ./output/cpu.prof &gt; cpu.pdf
go tool pprof --pdf ./output/mem.prof &gt; mem.pdf
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb166926" class="outline-4">
<h4 id="orgb166926"><span class="section-number-4">2.4.8.</span> 泛型写法</h4>
<div class="outline-text-4" id="text-2-4-8">
<div class="org-src-container">
<pre class="src src-go"><span style="color: #51afef;">import</span> <span style="color: #8d5649;">(</span>
        <span style="color: #99bb66;">"sort"</span>
<span style="color: #8d5649;">)</span>

<span style="color: #525252;">// </span><span style="color: #525252;">~string &#34920;&#31034;&#24213;&#23618;&#26102; string &#31867;&#22411;&#30340;&#38598;&#21512;</span>
<span style="color: #51afef;">func</span> <span style="color: #c678dd;">IterMap</span><span style="color: #8d5649;">[</span>K ~string, V <span style="color: #ECBE7B;">any</span><span style="color: #8d5649;">](</span>m <span style="color: #51afef;">map</span><span style="color: #d8241f;">[</span><span style="color: #ECBE7B;">K</span><span style="color: #d8241f;">]</span><span style="color: #ECBE7B;">V</span>, fn <span style="color: #51afef;">func</span><span style="color: #d8241f;">(</span><span style="color: #dcaeea;">k</span> <span style="color: #ECBE7B;">K</span>, <span style="color: #dcaeea;">v</span> <span style="color: #ECBE7B;">V</span><span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span> <span style="color: #8d5649;">{</span>
        <span style="color: #dcaeea;">keys</span> := <span style="color: #c678dd;">make</span><span style="color: #d8241f;">(</span><span style="color: #9564bf;">[]</span><span style="color: #ECBE7B;">string</span>, 0, <span style="color: #c678dd;">len</span><span style="color: #9564bf;">(</span>m<span style="color: #9564bf;">)</span><span style="color: #d8241f;">)</span>
        <span style="color: #51afef;">for</span> <span style="color: #dcaeea;">k</span> := <span style="color: #51afef;">range</span> m <span style="color: #d8241f;">{</span>
                keys = <span style="color: #c678dd;">append</span><span style="color: #9564bf;">(</span>keys, <span style="color: #c678dd;">string</span><span style="color: #24a222;">(</span>k<span style="color: #24a222;">)</span><span style="color: #9564bf;">)</span>
        <span style="color: #d8241f;">}</span>
        sort.<span style="color: #c678dd;">Strings</span><span style="color: #d8241f;">(</span>keys<span style="color: #d8241f;">)</span>
        <span style="color: #51afef;">for</span> <span style="color: #dcaeea;">_</span>, <span style="color: #dcaeea;">k</span> := <span style="color: #51afef;">range</span> keys <span style="color: #d8241f;">{</span>
                <span style="color: #c678dd;">fn</span><span style="color: #9564bf;">(</span><span style="color: #c678dd;">K</span><span style="color: #24a222;">(</span>k<span style="color: #24a222;">)</span>, m<span style="color: #24a222;">[</span><span style="color: #c678dd;">K</span><span style="color: #ff7f00;">(</span>k<span style="color: #ff7f00;">)</span><span style="color: #24a222;">]</span><span style="color: #9564bf;">)</span>
        <span style="color: #d8241f;">}</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org41751a4" class="outline-4">
<h4 id="org41751a4"><span class="section-number-4">2.4.9.</span> 垃圾回收</h4>
<div class="outline-text-4" id="text-2-4-9">
<p>
通过环境变量来开启打印 gc
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #dcaeea;">GODEBUG</span>=<span style="color: #99bb66;">'gctrace=1'</span> ./app
</pre>
</div>

<p>
日志样例
</p>
<pre class="example" id="org07e7c45">
gc 7 @722.445s 0%: 0.099+2.3+0.017 ms clock, 0.79+0/4.5/0+0.13 ms cpu, 1-&gt;1-&gt;1 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 8 P
GC forced
gc 8 @842.465s 0%: 0.084+1.7+0.006 ms clock, 0.67+0/3.3/0+0.049 ms cpu, 1-&gt;1-&gt;1 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 8 P
GC forced
gc 9 @962.486s 0%: 0.10+2.3+0.008 ms clock, 0.84+0/4.4/0+0.065 ms cpu, 1-&gt;1-&gt;1 MB, 4 MB goal, 0 MB stacks, 0 MB globals, 8 P
GC forced
</pre>
</div>
</div>
</div>

<div id="outline-container-org294a0a8" class="outline-3">
<h3 id="org294a0a8"><span class="section-number-3">2.5.</span> Perl</h3>
<div class="outline-text-3" id="text-2-5">
</div>
<div id="outline-container-orgdbe06e6" class="outline-4">
<h4 id="orgdbe06e6"><span class="section-number-4">2.5.1.</span> 环境配置</h4>
<div class="outline-text-4" id="text-2-5-1">
</div>
<ol class="org-ol">
<li><a id="org4239a44"></a>包管理工具配置 CPAN<br />
<div class="outline-text-5" id="text-2-5-1-1">
<ol class="org-ol">
<li>官网 <a href="https://metacpan.org/">CPAN</a></li>
<li><p>
镜像 <a href="https://mirrors.tuna.tsinghua.edu.cn/help/CPAN/">TUNA</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #dcaeea;">PERL_MM_USE_DEFAULT</span>=1 perl -MCPAN -e <span style="color: #99bb66;">'CPAN::HandleConfig-&gt;edit("pushy_https", 0); CPAN::HandleConfig-&gt;edit("urllist", "unshift", "https://mirrors.tuna.tsinghua.edu.cn/CPAN/"); mkmyconfig'</span>
</pre>
</div></li>
<li>CPAN 的配置文件: <code>~/.cpan/CPAN/MyConfig.pm</code></li>
</ol>
</div>
</li>
<li><a id="orgab64ec1"></a>包管理命令<br />
<div class="outline-text-5" id="text-2-5-1-2">
<div class="org-src-container">
<pre class="src src-sh">perl -MCPAN -e <span style="color: #99bb66;">'install Excel::Writer::XLSX'</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-orga158394" class="outline-4">
<h4 id="orga158394"><span class="section-number-4">2.5.2.</span> 基本使用</h4>
<div class="outline-text-4" id="text-2-5-2">
</div>
<ol class="org-ol">
<li><a id="org93b550c"></a>Hello world<br />
<div class="outline-text-5" id="text-2-5-2-1">
<p>
创建 <code>hello.pl</code> 文件写以下代码
</p>
<div class="org-src-container">
<pre class="src src-perl">print(<span style="color: #99bb66;">"hello world\n"</span>);
</pre>
</div>

<p>
使用 perl 命令运行代码
</p>
<div class="org-src-container">
<pre class="src src-sh">perl hello.pl
</pre>
</div>
</div>
</li>

<li><a id="org40e5c0e"></a>过滤 MySQL trace 日志<br />
<div class="outline-text-5" id="text-2-5-2-2">
<div class="org-src-container">
<pre class="src src-perl"><span style="color: #51afef;">use</span> <span style="color: #a9a1e1;">strict</span>;
<span style="color: #51afef;">use</span> <span style="color: #a9a1e1;">warnings</span>;

<span style="color: #51afef;">my</span> $<span style="color: #dcaeea;">cid</span> = 8;
<span style="color: #51afef;">my</span> $<span style="color: #dcaeea;">fout</span> = <span style="color: #99bb66;">"/tmp/mysqld-thd-$cid.txt"</span>;
open(FIN, <span style="color: #99bb66;">'&lt;:encoding(UTF-8)'</span>, <span style="color: #99bb66;">"/tmp/mysqld.trace"</span>) or <span style="color: #51afef;">die</span>;
open(FOUT, <span style="color: #99bb66;">'&gt;'</span>, $<span style="color: #dcaeea;">fout</span>) or <span style="color: #51afef;">die</span>;

<span style="color: #51afef;">while</span> (<span style="color: #51afef;">my</span> $<span style="color: #dcaeea;">line</span> = &lt;<span style="color: #a9a1e1;">FIN</span>&gt;) {
    <span style="color: #51afef;">if</span> ($<span style="color: #dcaeea;">line</span> =~ <span style="color: #99bb66;">/^T\@$cid/</span>) {
        print FOUT $<span style="color: #dcaeea;">line</span>;
    }
}

close(FOUT);
$<span style="color: #dcaeea;">fout</span>;
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org51dc02f" class="outline-3">
<h3 id="org51dc02f"><span class="section-number-3">2.6.</span> Python</h3>
<div class="outline-text-3" id="text-2-6">
</div>
<div id="outline-container-orgc91d991" class="outline-4">
<h4 id="orgc91d991"><span class="section-number-4">2.6.1.</span> 安装 python 的开发包</h4>
<div class="outline-text-4" id="text-2-6-1">
<div class="org-src-container">
<pre class="src src-sh">pip install --user pandas
pip install --user sqlalchemy
pip install --user pymysql
</pre>
</div>

<p>
源码编译安装
</p>
<div class="org-src-container">
<pre class="src src-sh">wget -c https://www.python.org/ftp/python/3.11.5/Python-3.11.5.tgz
tar xzvf ~/Python-3.11.5.tgz

sudo yum install openssl openssl-devel
sudo yum install libffi libffi-devel

./configure <span style="color: #dcaeea;">prefix</span>=/opt/python3
make
sudo make install
</pre>
</div>

<p>
配置国内下载源地址 <a href="https://mirrors.tuna.tsinghua.edu.cn/help/pypi/">tuna</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">pip install pip -U -i https://pypi.tuna.tsinghua.edu.cn/simple
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
pip config set install.trusted-host pypi.tuna.tsinghua.edu.cn
</pre>
</div>
</div>
</div>

<div id="outline-container-org8a682c3" class="outline-4">
<h4 id="org8a682c3"><span class="section-number-4">2.6.2.</span> pyenv 管理 python 版本</h4>
<div class="outline-text-4" id="text-2-6-2">
<p>
安装如下
</p>
<div class="org-src-container">
<pre class="src src-sh">git clone https://github.com/pyenv/pyenv.git ~/.pyenv
</pre>
</div>

<p>
配置环境变量
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">PYTHON_BUILD_MIRROR_URL</span>=<span style="color: #99bb66;">"https://registry.npmmirror.com/-/binary/python"</span>
<span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">PYTHON_BUILD_MIRROR_URL_SKIP_CHECKSUM</span>=1

<span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">PYENV_ROOT</span>=<span style="color: #99bb66;">"$HOME/.pyenv"</span>
command -v pyenv &gt;/dev/null || <span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">PATH</span>=<span style="color: #99bb66;">"$PYENV_ROOT/bin:$PATH"</span>
<span style="color: #c678dd;">eval</span> <span style="color: #99bb66;">"$(pyenv init -)"</span>
</pre>
</div>

<p>
centos7 指定 openssl 安装路径后编译安装 <a href="https://github.com/pyenv/pyenv/wiki/Common-build-problems#error-the-python-ssl-extension-was-not-compiled-missing-the-openssl-lib">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #dcaeea;">CPPFLAGS</span>=<span style="color: #99bb66;">"$(pkg-config --cflags openssl11)"</span> <span style="color: #99bb66;">\</span>
<span style="color: #dcaeea;">LDFLAGS</span>=<span style="color: #99bb66;">"$(pkg-config --libs openssl11)"</span> <span style="color: #99bb66;">\</span>
pyenv install -v 3.10

pyenv global 3.10
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1942e9a" class="outline-3">
<h3 id="org1942e9a"><span class="section-number-3">2.7.</span> Ruby</h3>
<div class="outline-text-3" id="text-2-7">
<ol class="org-ol">
<li>配置国内 GEM 镜像 <a href="https://gems.ruby-china.com/">Ruby China</a></li>
</ol>
</div>
</div>
<div id="outline-container-org160c6ee" class="outline-3">
<h3 id="org160c6ee"><span class="section-number-3">2.8.</span> Rust</h3>
<div class="outline-text-3" id="text-2-8">
</div>
<div id="outline-container-org13d4c58" class="outline-4">
<h4 id="org13d4c58"><span class="section-number-4">2.8.1.</span> 安装配置</h4>
<div class="outline-text-4" id="text-2-8-1">
<ol class="org-ol">
<li><p>
安装页面 <a href="https://www.rust-lang.org/tools/install">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">curl --proto <span style="color: #99bb66;">'=https'</span> --tlsv1.2 -sSf https://sh.rustup.rs | sh
<span style="color: #525252;"># </span><span style="color: #525252;">&#23433;&#35013;&#24037;&#20855;&#38142;</span>
rustup component add rust-src
</pre>
</div></li>
</ol>
</div>
</div>

<div id="outline-container-orgde93c19" class="outline-4">
<h4 id="orgde93c19"><span class="section-number-4">2.8.2.</span> 使用笔记</h4>
<div class="outline-text-4" id="text-2-8-2">
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #51afef; font-weight: bold;">#![allow(dead_code)]</span>
<span style="color: #51afef; font-weight: bold;">#![allow(unused_variables)]</span>
</pre>
</div>

<p>
结构体
</p>
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">Point</span> {
    <span style="color: #dcaeea;">x</span>: <span style="color: #ECBE7B;">f64</span>,
    <span style="color: #dcaeea;">y</span>: <span style="color: #ECBE7B;">f64</span>,
}

<span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">Line</span> {
    <span style="color: #dcaeea;">beg</span>: <span style="color: #ECBE7B;">Point</span>,
    <span style="color: #dcaeea;">end</span>: <span style="color: #ECBE7B;">Point</span>,
}

<span style="color: #51afef;">impl</span> <span style="color: #ECBE7B;">Line</span> {
    <span style="color: #525252;">// </span><span style="color: #525252;">&#26041;&#27861;</span>
    <span style="color: #51afef;">fn</span> <span style="color: #c678dd;">len</span>(<span style="color: #bfbfbf; background-color: #000000;">&amp;</span><span style="color: #51afef;">self</span>) -&gt; <span style="color: #ECBE7B;">f64</span> {
        <span style="color: #51afef;">let</span> <span style="color: #dcaeea;">dx</span> = <span style="color: #51afef;">self</span>.end.x - <span style="color: #51afef;">self</span>.beg.x;
        <span style="color: #51afef;">let</span> <span style="color: #dcaeea;">dy</span> = <span style="color: #51afef;">self</span>.end.y - <span style="color: #51afef;">self</span>.beg.y;
        (dx * dx + dy * dy).sqrt()
    }
}
</pre>
</div>

<p>
匿名函数及闭包
</p>
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #51afef;">fn</span> <span style="color: #c678dd;">use_closure</span>() {
    <span style="color: #51afef;">let</span> <span style="color: #dcaeea;">plus_one</span> = |x| -&gt; <span style="color: #ECBE7B;">i32</span> { x + 1 };
    <span style="color: #51afef;">let</span> <span style="color: #dcaeea;">x</span> = 1;
    <span style="color: #c678dd;">println!</span>(<span style="color: #99bb66;">"</span><span style="color: #99bb66; font-style: italic;">{}</span><span style="color: #99bb66;"> + 1 = </span><span style="color: #99bb66; font-style: italic;">{}</span><span style="color: #99bb66;">"</span>, x, plus_one(x));
}
</pre>
</div>

<p>
match 关键字
</p>
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #51afef;">fn</span> <span style="color: #c678dd;">match_statement</span>(<span style="color: #dcaeea;">x</span>: <span style="color: #ECBE7B;">i32</span>) -&gt; <span style="color: #bfbfbf; background-color: #000000;">&amp;</span>'<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">str</span> {
    <span style="color: #51afef;">return</span> <span style="color: #51afef;">match</span> x {
        8 =&gt; <span style="color: #99bb66;">"China"</span>,
        1..=10 =&gt; <span style="color: #99bb66;">"VALID"</span>,
        _ =&gt; <span style="color: #99bb66;">"INVALID"</span>,
    };
}
</pre>
</div>

<p>
使用 trait
</p>
<div class="org-src-container">
<pre class="src src-rust"><span style="color: #51afef;">trait</span> <span style="color: #ECBE7B;">Animal</span> {
    <span style="color: #51afef;">fn</span> <span style="color: #c678dd;">name</span>(<span style="color: #bfbfbf; background-color: #000000;">&amp;</span><span style="color: #51afef;">self</span>) -&gt; <span style="color: #bfbfbf; background-color: #000000;">&amp;</span>'<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">str</span>;

    <span style="color: #51afef;">fn</span> <span style="color: #c678dd;">talk</span>(<span style="color: #bfbfbf; background-color: #000000;">&amp;</span><span style="color: #51afef;">self</span>) {
        <span style="color: #c678dd;">println!</span>(<span style="color: #99bb66;">"</span><span style="color: #99bb66; font-style: italic;">{}</span><span style="color: #99bb66;"> cannot talk!"</span>, <span style="color: #51afef;">self</span>.name());
    }
}

<span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">Cat</span> {
    <span style="color: #dcaeea;">name</span>: <span style="color: #bfbfbf; background-color: #000000;">&amp;</span>'<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">str</span>,
}

<span style="color: #51afef;">struct</span> <span style="color: #ECBE7B;">Human</span> {
    <span style="color: #dcaeea;">name</span>: <span style="color: #bfbfbf; background-color: #000000;">&amp;</span>'<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">str</span>,
}

<span style="color: #51afef;">impl</span> <span style="color: #ECBE7B;">Animal</span> <span style="color: #51afef;">for</span> <span style="color: #ECBE7B;">Cat</span> {
    <span style="color: #51afef;">fn</span> <span style="color: #c678dd;">name</span>(<span style="color: #bfbfbf; background-color: #000000;">&amp;</span><span style="color: #51afef;">self</span>) -&gt; <span style="color: #bfbfbf; background-color: #000000;">&amp;</span>'<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">str</span> {
        <span style="color: #51afef;">self</span>.name
    }
}

<span style="color: #51afef;">impl</span> <span style="color: #ECBE7B;">Animal</span> <span style="color: #51afef;">for</span> <span style="color: #ECBE7B;">Human</span> {
    <span style="color: #51afef;">fn</span> <span style="color: #c678dd;">name</span>(<span style="color: #bfbfbf; background-color: #000000;">&amp;</span><span style="color: #51afef;">self</span>) -&gt; <span style="color: #bfbfbf; background-color: #000000;">&amp;</span>'<span style="color: #51afef;">static</span> <span style="color: #ECBE7B;">str</span> {
        <span style="color: #51afef;">self</span>.name
    }

    <span style="color: #51afef;">fn</span> <span style="color: #c678dd;">talk</span>(<span style="color: #bfbfbf; background-color: #000000;">&amp;</span><span style="color: #51afef;">self</span>) {
        <span style="color: #c678dd;">println!</span>(<span style="color: #99bb66;">"</span><span style="color: #99bb66; font-style: italic;">{}</span><span style="color: #99bb66;"> says hello."</span>, <span style="color: #51afef;">self</span>.name());
    }
}

<span style="color: #51afef;">fn</span> <span style="color: #c678dd;">use_trait</span>() {
    <span style="color: #51afef;">let</span> <span style="color: #dcaeea;">john</span> = <span style="color: #ECBE7B;">Human</span> { <span style="color: #dcaeea;">name</span>: <span style="color: #99bb66;">"John"</span> };
    john.talk();

    <span style="color: #51afef;">let</span> <span style="color: #dcaeea;">pet</span> = <span style="color: #ECBE7B;">Cat</span> { <span style="color: #dcaeea;">name</span>: <span style="color: #99bb66;">"MiMi"</span> };
    pet.talk();
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d0879e" class="outline-4">
<h4 id="org7d0879e"><span class="section-number-4">2.8.3.</span> cargo</h4>
<div class="outline-text-4" id="text-2-8-3">
<p>
创建项目
</p>
<div class="org-src-container">
<pre class="src src-sh">cargo new myapp
cargo new --lib mylib
</pre>
</div>

<p>
添加包
</p>
<div class="org-src-container">
<pre class="src src-sh">cargo add config
cargo add clap --features derive
</pre>
</div>

<p>
编译运行
</p>
<div class="org-src-container">
<pre class="src src-sh">cargo build
cargo build --release
cargo run -- -h
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9d2c557" class="outline-3">
<h3 id="org9d2c557"><span class="section-number-3">2.9.</span> GDB &amp; LLDB</h3>
<div class="outline-text-3" id="text-2-9">
</div>
<div id="outline-container-orga9a6656" class="outline-4">
<h4 id="orga9a6656"><span class="section-number-4">2.9.1.</span> 参考资料及链接</h4>
<div class="outline-text-4" id="text-2-9-1">
<ol class="org-ol">
<li><a href="https://lldb.llvm.org/use/map.html">LLDB &lt;-&gt; GDB</a></li>
<li><a href="https://github.com/hellogcc/100-gdb-tips">GDB 小技巧</a> | <a href="https://sourceware.org/gdb/onlinedocs/gdb/">GDB 在线手册</a></li>
<li>视频 <a href="https://www.youtube.com/watch?v=svG6OPyKsrw">GDB Tutorial</a></li>
</ol>
</div>
</div>
<div id="outline-container-org8b11787" class="outline-4">
<h4 id="org8b11787"><span class="section-number-4">2.9.2.</span> TUI</h4>
<div class="outline-text-4" id="text-2-9-2">
<ol class="org-ol">
<li>开启汇编窗口 layout asm</li>
<li>开启寄存器窗口 layout regs</li>
<li>布局循环 layout next/prev</li>
<li>打印 32 个汇编指令 x/32i $pc</li>
</ol>
</div>
</div>
<div id="outline-container-org10bfe4c" class="outline-4">
<h4 id="org10bfe4c"><span class="section-number-4">2.9.3.</span> 进程启动: run &amp; attach</h4>
<div class="outline-text-4" id="text-2-9-3">
<p>
直接在命令行参数 attach 进程
</p>
<div class="org-src-container">
<pre class="src src-sh">gdb -p pid
</pre>
</div>

<p>
方法一：使用 attach 模式调试。首先正常启动重新，然后使用 attach 命令附属到进程上
</p>
<div class="org-src-container">
<pre class="src src-sh">(lldb) attach -p 18616
(gdb) attach 18616
</pre>
</div>

<p>
方法二：直接 run 启动进程
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#25351;&#23450;&#21551;&#21160;&#25991;&#20214;</span>
(lldb/gdb) file &lt;binary&gt;

<span style="color: #525252;"># </span><span style="color: #525252;">&#30452;&#25509; run &#21551;&#21160;&#36827;&#31243;</span>
(lldb/gdb) <span style="color: #c678dd;">r</span>
<span style="color: #525252;"># </span><span style="color: #525252;">&#28155;&#21152;&#21551;&#21160;&#21442;&#25968;</span>
(lldb/gdb) <span style="color: #c678dd;">r</span> args1 args2 ...
<span style="color: #525252;"># </span><span style="color: #525252;">&#26597;&#30475;&#21442;&#25968;</span>
(gdb) show args
(lldb) settings show target.run-args
</pre>
</div>

<div id="orge166b28" class="figure">
<p><img src="../static/image/2023/0205/131917.png" alt="131917.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgb5da469" class="outline-4">
<h4 id="orgb5da469"><span class="section-number-4">2.9.4.</span> 调试流程控制</h4>
<div class="outline-text-4" id="text-2-9-4">
</div>
<ol class="org-ol">
<li><a id="org45caaae"></a>设置断点 breakpoint<br />
<div class="outline-text-5" id="text-2-9-4-1">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#26222;&#36890;&#26029;&#28857;</span>
b main
b main.cc:12
b 12
<span style="color: #525252;"># </span><span style="color: #525252;">&#26465;&#20214;&#26029;&#28857;</span>
(gdb) b 34 if <span style="color: #dcaeea;">i</span> = 10
(gdb) <span style="color: #51afef;">break</span> foo if strcmp(y,<span style="color: #99bb66;">"hello"</span>) == 0
(lldb) breakpoint set --name foo --condition <span style="color: #99bb66;">'(int)strcmp(y,"hello") == 0'</span>
(lldb) br s -n foo -c <span style="color: #99bb66;">'(int)strcmp(y,"hello") == 0'</span>
(lldb) br s -n read_page -c <span style="color: #99bb66;">'m_page_id.space()==56'</span>
<span style="color: #525252;"># </span><span style="color: #525252;">&#20020;&#26102;&#26029;&#28857;: &#20020;&#26102;&#26029;&#28857;&#25191;&#34892;&#19968;&#27425;&#21518;&#33258;&#21160;&#38144;&#27585;</span>
tb main
</pre>
</div>

<p>
启用/禁用断点 disable/enable
</p>
<pre class="example" id="orga7f5684">
(gdb) info b
Num     Type           Disp Enb Address            What
1       breakpoint     keep y   0x000000000331276b in dispatch_command(THD*, COM_DATA const*, enum_server_command)
(gdb) dis 1 # 禁用断点
(gdb) info b
Num     Type           Disp Enb Address            What
1       breakpoint     keep n   0x000000000331276b in dispatch_command(THD*, COM_DATA const*, enum_server_command)
(gdb) ena 1 # 启用断点
(gdb) i b
Num     Type           Disp Enb Address            What
1       breakpoint     keep y   0x000000000331276b in dispatch_command(THD*, COM_DATA const*, enum_server_command)
</pre>
</div>
</li>

<li><a id="org95956ac"></a>流程控制 step &amp; next &amp; continue<br />
<div class="outline-text-5" id="text-2-9-4-2">
<ol class="org-ol">
<li>step 单步调试，不进入函数</li>
<li>next 单步调试，进入函数</li>
<li><p>
continue 继续执行
</p>
<div class="org-src-container">
<pre class="src src-sh">s <span style="color: #525252;"># </span><span style="color: #525252;">step</span>
n <span style="color: #525252;"># </span><span style="color: #525252;">next</span>
c <span style="color: #525252;"># </span><span style="color: #525252;">continue</span>

<span style="color: #525252;"># </span><span style="color: #525252;">until &#30452;&#25509;&#25191;&#34892;&#21040;&#34892;&#25968;</span>
(gdb) <span style="color: #51afef;">until</span> 12
(lldb) thread until 12
</pre>
</div></li>
<li>跳转到指定行
<ul class="org-ul">
<li>条件断点 <code>tb</code> temp breakpoint</li>
<li>until <code>until &lt;line&gt;</code></li>
</ul></li>
<li><p>
返回当前值
</p>
<div class="org-src-container">
<pre class="src src-sh">(gdb) <span style="color: #51afef;">return</span> &lt;return expression&gt;
(lldb) thread return &lt;return expression&gt;
</pre>
</div></li>
</ol>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgb1050bb" class="outline-4">
<h4 id="orgb1050bb"><span class="section-number-4">2.9.5.</span> 保持断点 &amp; 现场恢复</h4>
<div class="outline-text-4" id="text-2-9-5">
<p>
GDB 保存断点的方式比较方便，直接保持成一个文本文件后，再应用代码
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#20445;&#25345;&#26029;&#28857;&#21040;&#25991;&#20214;&#20013;</span>
(gdb) save breakpoint mybreak.txt
<span style="color: #525252;"># </span><span style="color: #525252;">&#37325;&#26032;&#21152;&#36733;&#20445;&#23384;&#30340;&#26029;&#28857;</span>
(gdb) <span style="color: #c678dd;">source</span> mybreak.txt
</pre>
</div>

<p>
LLDB 保存断点也有类似的命令，但是保存结果是一个 JSON
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#20445;&#23384;&#26029;&#28857;&#21040; json &#26684;&#24335;&#25991;&#20214;</span>
(lldb) breakpoint write -f dbg001
<span style="color: #525252;"># </span><span style="color: #525252;">&#35835;&#21462;&#26029;&#28857;&#21040; json &#26684;&#24335;&#25991;&#20214;</span>
(lldb) breakpoint read -f dbg001
</pre>
</div>

<p>
也可以参考这个答案优化流程 <a href="https://stackoverflow.com/questions/24638515/save-breakpoints-in-lldb">SO</a>
</p>


<div id="orgcd3893a" class="figure">
<p><img src="../static/image/2023/0205/100837.png" alt="100837.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgb272553" class="outline-4">
<h4 id="orgb272553"><span class="section-number-4">2.9.6.</span> 查看/修改变量和内存数据</h4>
<div class="outline-text-4" id="text-2-9-6">
<ol class="org-ol">
<li><p>
打印变量 print / <a href="https://visualgdb.com/gdbreference/commands/x%20">x-command</a>
</p>
<div class="org-src-container">
<pre class="src src-text">(lldb) p thd-&gt;m_thread_id
(my_thread_id) $1 = 10
(lldb) x/w &amp;$1
0x7fbdc1240188: 0x0000000a
(lldb)
</pre>
</div>
<ul class="org-ul">
<li>o octal</li>
<li>x hexadecimal</li>
<li>d decimal</li>
<li>u unsigned decimal</li>
<li>t binary</li>
<li>f floating point</li>
<li>a address</li>
<li>c char</li>
<li>s string</li>
<li>i instruction</li>
<li>b byte</li>
<li>h halfword (16-bit value)</li>
<li>w word (32-bit value)</li>
<li>g giant word (64-bit value)</li>
</ul></li>
<li><p>
查看内存地址中的数据
</p>
<div class="org-src-container">
<pre class="src src-sh">(lldb) x/8w $<span style="color: #dcaeea;">0</span> =&gt; &#25171;&#21360;&#22320;&#22336;&#30340;&#25968;&#25454;, &#25171;&#21360; 8 &#26465;&#25968;&#25454;, [w, b] &#34920;&#31034;&#19981;&#21516;&#30340;&#25171;&#21360;&#26041;&#24335;
0x7fbdc123dc00: 0x0916f4d8 0x00000001 0x0916f548 0x00000001
0x7fbdc123dc10: 0x00000000 0x00000000 0xc1240440 0x00007fbd
(lldb) x/8b $<span style="color: #dcaeea;">0</span>
0x7fbdc123dc00: 0xd8 0xf4 0x16 0x09 0x01 0x00 0x00 0x00
(lldb) x/8x $<span style="color: #dcaeea;">0</span>
0x7fbdc123dc00: 0xd8 0xf4 0x16 0x09 0x01 0x00 0x00 0x00
</pre>
</div></li>
<li><p>
查看 frame 中变量
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#26597;&#30475;&#23616;&#37096;&#21464;&#37327;</span>
(lldb) frame variable
(lldb) fr v
<span style="color: #525252;"># </span><span style="color: #525252;">&#26597;&#30475;&#20840;&#23616;&#21464;&#37327;</span>
(lldb) target variable
(lldb) ta v
<span style="color: #525252;"># </span><span style="color: #525252;">&#26597;&#30475;&#35843;&#29992;&#26632; thread backtrace</span>
(lldb/gdb) bt
</pre>
</div></li>
</ol>
</div>
</div>

<div id="outline-container-org323e40b" class="outline-4">
<h4 id="org323e40b"><span class="section-number-4">2.9.7.</span> 调试时显示下一条汇编</h4>
<div class="outline-text-4" id="text-2-9-7">
<p>
开启显示下一条汇编
</p>
<pre class="example" id="org860da9a">
set disassemble-next-line on
</pre>

<p>
查看是否开启成功
</p>
<pre class="example" id="org1dcd5b2">
show disassemble-next-line
</pre>
</div>
</div>

<div id="outline-container-org904c471" class="outline-4">
<h4 id="org904c471"><span class="section-number-4">2.9.8.</span> 命令行启动时执行命令 -ex</h4>
<div class="outline-text-4" id="text-2-9-8">
<div class="org-src-container">
<pre class="src src-sh">gdb -ex <span style="color: #99bb66;">"target remote :1234"</span> -ex <span style="color: #99bb66;">"b *0x7c00"</span> -ex <span style="color: #99bb66;">"c"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8db1f0b" class="outline-3">
<h3 id="org8db1f0b"><span class="section-number-3">2.10.</span> Git</h3>
<div class="outline-text-3" id="text-2-10">
<ol class="org-ol">
<li>taobao git 下载 <a href="https://registry.npmmirror.com/binary.html?path=git-for-windows/">git-for-windows</a></li>
<li>taobao 二进制下载 <a href="https://registry.npmmirror.com/binary.html">taobao binary</a></li>
<li><p>
github 加速
</p>
<ul class="org-ul">
<li><a href="https://githubfast.com/Jeanhwea/jeanhwea.github.io.git">githubfast</a></li>
<li><a href="https://github.com/Jeanhwea/jeanhwea.github.io.git">ghproxy</a></li>
</ul>
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #525252;"># </span><span style="color: #525252;">~/.gitconfig</span>
[url <span style="color: #99bb66;">"https://githubfast.com/"</span>]
        <span style="color: #dcaeea;">insteadOf</span> = https://github.com/
</pre>
</div></li>
</ol>
</div>
<div id="outline-container-org4bbbb7e" class="outline-4">
<h4 id="org4bbbb7e"><span class="section-number-4">2.10.1.</span> 配置用户信息</h4>
<div class="outline-text-4" id="text-2-10-1">
<div class="org-src-container">
<pre class="src src-sh">git config --global user.email <span style="color: #99bb66;">"hujinghui@buaa.edu.cn"</span>
git config --global user.name <span style="color: #99bb66;">"Jinghui Hu"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2a9ed9c" class="outline-4">
<h4 id="org2a9ed9c"><span class="section-number-4">2.10.2.</span> 递归克隆子模块</h4>
<div class="outline-text-4" id="text-2-10-2">
<div class="org-src-container">
<pre class="src src-sh">git clone --recurse-submodules url
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f1ae1e" class="outline-4">
<h4 id="org8f1ae1e"><span class="section-number-4">2.10.3.</span> 忽略换行符 ^M</h4>
<div class="outline-text-4" id="text-2-10-3">
<div class="org-src-container">
<pre class="src src-sh">git config core.autocrlf true
</pre>
</div>
</div>
</div>

<div id="outline-container-org572c6e2" class="outline-4">
<h4 id="org572c6e2"><span class="section-number-4">2.10.4.</span> 代码发布相关</h4>
<div class="outline-text-4" id="text-2-10-4">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#21160;&#24577;&#29983;&#25104;&#26631;&#31614;</span>
git describe --tags --always --dirty=<span style="color: #99bb66;">'-dev'</span>
<span style="color: #525252;"># </span><span style="color: #525252;">&#21019;&#24314;&#20195;&#30721;&#21253;</span>
git archive -o output.tgz HEAD
</pre>
</div>
</div>
</div>

<div id="outline-container-org107ff65" class="outline-4">
<h4 id="org107ff65"><span class="section-number-4">2.10.5.</span> 添加添加生成 TAGS 的 git-hooks</h4>
<div class="outline-text-4" id="text-2-10-5">
<div class="org-src-container">
<pre class="src src-sh">cp .git/hooks/pre-commit.sample .git/hooks/pre-commit
<span style="color: #c678dd;">echo</span> <span style="color: #99bb66;">'ctags -e -R . &gt;/dev/null 2&gt;&amp;1 &amp;'</span> &gt; .git/hooks/pre-commit
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge49e59a" class="outline-3">
<h3 id="orge49e59a"><span class="section-number-3">2.11.</span> SSH</h3>
<div class="outline-text-3" id="text-2-11">
</div>
<div id="outline-container-orgd1e7244" class="outline-4">
<h4 id="orgd1e7244"><span class="section-number-4">2.11.1.</span> ~/.ssh/config</h4>
<div class="outline-text-4" id="text-2-11-1">
<p>
创建配置文件
</p>
<div class="org-src-container">
<pre class="src src-sh">touch ~/.ssh/config
chmod 600 ~/.ssh/config
</pre>
</div>

<p>
查看配置文件
</p>
<div class="org-src-container">
<pre class="src src-sh">man ssh_config 5
</pre>
</div>

<p>
基本配置
</p>
<ul class="org-ul">
<li>ServerAliveInterval 心跳时间</li>
</ul>
<div class="org-src-container">
<pre class="src src-conf">Host *
    ServerAliveInterval 0
</pre>
</div>

<p>
解决 ssh 一段时间后自动断线
</p>
<div class="org-src-container">
<pre class="src src-sh">Host *
    ServerAliveInterval 60
    ServerAliveCountMax 1
</pre>
</div>
</div>
</div>

<div id="outline-container-org9817898" class="outline-4">
<h4 id="org9817898"><span class="section-number-4">2.11.2.</span> 配置 host 别名</h4>
<div class="outline-text-4" id="text-2-11-2">
<p>
在配置文件 ~/.ssh/config 方便后续直接在 ssh 命令中使用
</p>
<div class="org-src-container">
<pre class="src src-conf">Host gitana
    Hostname gitana.jeanhwea.io
    Port 2222
    User admin

<span style="color: #525252;"># </span><span style="color: #525252;">match 123, 212 etc</span>
Host 1?? 2??
    Hostname 192.168.0.%h
    Port 22
    User admin

<span style="color: #525252;"># </span><span style="color: #525252;">match all</span>
Host *
    Hostname 192.168.0.%h
    Port 22
    User admin
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcc3f22f" class="outline-4">
<h4 id="orgcc3f22f"><span class="section-number-4">2.11.3.</span> 直接转发远端流量</h4>
<div class="outline-text-4" id="text-2-11-3">
<p>
通过 ssh<sub>config</sub> 的配置来转发远端 5432
</p>
<div class="org-src-container">
<pre class="src src-conf">Host db
    HostName db.example.com
    LocalForward 5433 localhost:5432
</pre>
</div>

<p>
登录到远端, 然后就可以在本地连接
</p>
<ul class="org-ul">
<li>-f 后台运行命令</li>
<li>-C 传输启用压缩</li>
<li>-N 不登录主机</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh">ssh -fCN db
psql -h localhost -p 5433 orders
</pre>
</div>
</div>
</div>

<div id="outline-container-org94b78a7" class="outline-4">
<h4 id="org94b78a7"><span class="section-number-4">2.11.4.</span> 暴露本机服务配置, 两跳登录</h4>
<div class="outline-text-4" id="text-2-11-4">
<div class="org-src-container">
<pre class="src src-conf">Host hoppin
    Hostname remote-server
    Port 22
    User root
    RemoteForward 2222 localhost:22
</pre>
</div>

<p>
两跳登录配置
</p>
<div class="org-src-container">
<pre class="src src-conf">Host gitana
    Hostname 127.0.0.1
    Port 2222
    User admin
    IdentityFile ~/.ssh/id_rsa
    ProxyCommand ssh -W %h:%p proxy-host
</pre>
</div>

<p>
使用 ProxyJump 实现两条登录
</p>
<div class="org-src-container">
<pre class="src src-conf">Host target
    Hostname target-server
    User admin
    ProxyJump proxy-server
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfc09731" class="outline-4">
<h4 id="orgfc09731"><span class="section-number-4">2.11.5.</span> 代理登录</h4>
<div class="outline-text-4" id="text-2-11-5">
<p>
添加代理登录的配置, 需要通过 ProxyCommand 来设置代理命令
</p>
<div class="org-src-container">
<pre class="src src-conf">Host gateway
    HostName proxy.example.com
    User root
Host db
    HostName db.internal.example.com                  <span style="color: #525252;"># </span><span style="color: #525252;">&#30446;&#26631;&#26381;&#21153;&#22120;&#22320;&#22336;</span>
    User root                                         <span style="color: #525252;"># </span><span style="color: #525252;">&#29992;&#25143;&#21517;</span>
    <span style="color: #525252;"># </span><span style="color: #525252;">IdentityFile ~/.ssh/id_ecdsa                    # &#35748;&#35777;&#25991;&#20214;</span>
    ProxyCommand ssh gateway netcat -q 600 %h %p      <span style="color: #525252;"># </span><span style="color: #525252;">&#20195;&#29702;&#21629;&#20196;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5e3c1a3" class="outline-4">
<h4 id="org5e3c1a3"><span class="section-number-4">2.11.6.</span> 连接 socket 重用</h4>
<div class="outline-text-4" id="text-2-11-6">
<div class="org-src-container">
<pre class="src src-conf">Host example.org
  ControlMaster    auto
  ControlPath      ~/.ssh/cp-%r@%h:%p.sock
  ControlPersist   yes
</pre>
</div>
</div>
</div>

<div id="outline-container-org590b05a" class="outline-4">
<h4 id="org590b05a"><span class="section-number-4">2.11.7.</span> forward 端口转发</h4>
<div class="outline-text-4" id="text-2-11-7">
<p>
本地转发
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">-N &#19981;&#25191;&#34892;&#21629;&#20196;, -L local &#36716;&#21457; &lt;remote-port&gt;:&lt;local-host&gt;:&lt;local-port&gt;</span>
ssh -N -L 9092:127.0.0.1:9092 user@host
</pre>
</div>

<p>
远端转发
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">-N &#19981;&#25191;&#34892;&#21629;&#20196;, -R remote &#36716;&#21457; &lt;local-port&gt;:&lt;remote-host&gt;:&lt;remote-port&gt;</span>
ssh -N -R 9092:127.0.0.1:9092 user@host
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbb62a8f" class="outline-4">
<h4 id="orgbb62a8f"><span class="section-number-4">2.11.8.</span> ssh 双跳登录</h4>
<div class="outline-text-4" id="text-2-11-8">
<div class="org-src-container">
<pre class="src src-sh">ssh -p9998 -i ~/.ssh/id_s1 user1@175.0.0.20 -t ssh -p9999 -i ~/.ssh/id_s2 user2@213.0.0.30
</pre>
</div>
</div>
</div>

<div id="outline-container-org8cd36f9" class="outline-4">
<h4 id="org8cd36f9"><span class="section-number-4">2.11.9.</span> scp 双跳传输</h4>
<div class="outline-text-4" id="text-2-11-9">
<div class="org-src-container">
<pre class="src src-sh">scp -o <span style="color: #dcaeea;">ProxyCommand</span>=<span style="color: #99bb66;">"ssh -p9998 user1@175.0.0.20 nc 213.0.0.30 9999"</span> <span style="color: #99bb66;">\</span>
    -o <span style="color: #dcaeea;">IdentityFile</span>=<span style="color: #99bb66;">"~/.ssh/id_s2"</span> /opt/file user2@213.0.0.30:/tmp/file
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb0f2202" class="outline-3">
<h3 id="orgb0f2202"><span class="section-number-3">2.12.</span> Shell</h3>
<div class="outline-text-3" id="text-2-12">
</div>
<div id="outline-container-orgdea8715" class="outline-4">
<h4 id="orgdea8715"><span class="section-number-4">2.12.1.</span> 后台运行命令 cmd</h4>
<div class="outline-text-4" id="text-2-12-1">
<div class="org-src-container">
<pre class="src src-sh">nohup cmd &gt;/dev/null 2&gt;&amp;1 &amp;
</pre>
</div>
</div>
</div>

<div id="outline-container-org6e0c6c6" class="outline-4">
<h4 id="org6e0c6c6"><span class="section-number-4">2.12.2.</span> 比较 semver 版本号</h4>
<div class="outline-text-4" id="text-2-12-2">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">vge</span>() {
    <span style="color: #c678dd;">local</span> <span style="color: #dcaeea;">v1</span>=$<span style="color: #dcaeea;">1</span>
    <span style="color: #c678dd;">local</span> <span style="color: #dcaeea;">v2</span>=$<span style="color: #dcaeea;">2</span>
    <span style="color: #c678dd;">local</span> <span style="color: #dcaeea;">small</span>=$(printf <span style="color: #99bb66;">"%s\n"</span>, $<span style="color: #dcaeea;">1</span>, $<span style="color: #dcaeea;">2</span> | sort -V | head -n 1)
    <span style="color: #51afef;">if</span> [ <span style="color: #99bb66;">"$v1"</span> == <span style="color: #99bb66;">"$small"</span> ]; <span style="color: #51afef;">then</span>
        <span style="color: #c678dd;">echo</span> <span style="color: #99bb66;">"true"</span>
    <span style="color: #51afef;">else</span>
        <span style="color: #c678dd;">echo</span> <span style="color: #99bb66;">"false"</span>
    <span style="color: #51afef;">fi</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdc770b1" class="outline-4">
<h4 id="orgdc770b1"><span class="section-number-4">2.12.3.</span> heredoc 定义变量</h4>
<div class="outline-text-4" id="text-2-12-3">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">read</span> -d <span style="color: #99bb66;">''</span> TEXT &lt;&lt;EOF
<span style="color: #99bb66;">this is a</span>
<span style="color: #99bb66;">multiple line</span>
<span style="color: #99bb66;">text</span>
<span style="color: #99bb66;">EOF</span>

<span style="color: #c678dd;">echo</span> $<span style="color: #dcaeea;">TEXT</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org000d821" class="outline-4">
<h4 id="org000d821"><span class="section-number-4">2.12.4.</span> 检测命令返回值是否正确</h4>
<div class="outline-text-4" id="text-2-12-4">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">run a command or ./run.sh</span>
<span style="color: #51afef;">if</span> [ <span style="color: #99bb66;">"$?"</span> != <span style="color: #99bb66;">"0"</span> ]; <span style="color: #51afef;">then</span>
  <span style="color: #51afef;">exit</span> $<span style="color: #dcaeea;">?</span>
<span style="color: #51afef;">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc2b56a2" class="outline-4">
<h4 id="orgc2b56a2"><span class="section-number-4">2.12.5.</span> 检测当前是否 root 用户</h4>
<div class="outline-text-4" id="text-2-12-5">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #51afef;">if</span> [ $<span style="color: #dcaeea;">UID</span> -ne 0 ]; <span style="color: #51afef;">then</span>
    <span style="color: #c678dd;">echo</span> <span style="color: #99bb66;">"permission deny, sudo ..."</span>
    <span style="color: #51afef;">exit</span> 13 <span style="color: #525252;"># </span><span style="color: #525252;">EACCES</span>
<span style="color: #51afef;">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org209268b" class="outline-4">
<h4 id="org209268b"><span class="section-number-4">2.12.6.</span> 临时提权设置目录权限</h4>
<div class="outline-text-4" id="text-2-12-6">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">echo</span> <span style="color: #99bb66;">'password'</span> | sudo -S chmod -R a+rX dist
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org3ec36db" class="outline-2">
<h2 id="org3ec36db"><span class="section-number-2">3.</span> 研发效率</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org066e0bd" class="outline-3">
<h3 id="org066e0bd"><span class="section-number-3">3.1.</span> 交叉编译环境配置</h3>
<div class="outline-text-3" id="text-3-1">
<p>
安装前置依赖项目
</p>
<div class="org-src-container">
<pre class="src src-sh">yum install -y texinfo
</pre>
</div>

<p>
下载所需的依赖
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#19979;&#36733;&#25152;&#38656;&#30340;&#23433;&#35013;&#21253;</span>
wget -c https://mirrors.tuna.tsinghua.edu.cn/gnu/gcc/gcc-11.4.0/gcc-11.4.0.tar.gz
wget -c https://mirrors.tuna.tsinghua.edu.cn/gnu/binutils/binutils-2.40.tar.gz
wget -c https://mirrors.tuna.tsinghua.edu.cn/gnu/gdb/gdb-11.2.tar.gz

tar xzvf binutils-2.40.tar.gz
tar xzvf gcc-11.4.0.tar.gz
tar xzvf gdb-11.2.tar.gz

<span style="color: #525252;"># </span><span style="color: #525252;">gcc &#38656;&#35201;&#20381;&#36182; gmp mpfr libmpc &#24211;, &#21487;&#20197;&#30452;&#25509;&#20351;&#29992; gcc &#37324;&#38754;&#30340;&#36741;&#21161;&#33050;&#26412;&#19979;&#36733;</span>
<span style="color: #c678dd;">cd</span> gcc-11.4.0
./contrib/download_prerequisites
</pre>
</div>

<p>
保存脚本开始编译
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">PREFIX</span>=<span style="color: #99bb66;">"/opt/i386-elf-toolchain"</span>
<span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">TARGET</span>=i386-elf
<span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">PATH</span>=<span style="color: #99bb66;">"$PREFIX/bin:$PATH"</span>

<span style="color: #dcaeea;">DIR</span>=$<span style="color: #dcaeea;">PWD</span>

<span style="color: #525252;"># </span><span style="color: #525252;">rm -rf $DIR/build-binutils</span>
mkdir -p $<span style="color: #dcaeea;">DIR</span>/build-binutils
<span style="color: #c678dd;">cd</span> $<span style="color: #dcaeea;">DIR</span>/build-binutils
../binutils-2.40/configure --target=$<span style="color: #dcaeea;">TARGET</span> --prefix=$<span style="color: #dcaeea;">PREFIX</span> --enable-interwork --enable-multilib --disable-nls --disable-werror |&amp; tee configure.log
make all -j4 |&amp; tee make.log
sudo make install |&amp; tee install.log


<span style="color: #525252;"># </span><span style="color: #525252;">rm -rf $DIR/build-gcc</span>
mkdir -p $<span style="color: #dcaeea;">DIR</span>/build-gcc
<span style="color: #c678dd;">cd</span> $<span style="color: #dcaeea;">DIR</span>/build-gcc
../gcc-11.4.0/configure --target=$<span style="color: #dcaeea;">TARGET</span> --prefix=$<span style="color: #dcaeea;">PREFIX</span> --disable-nls --disable-libssp --enable-languages=c --without-headers |&amp; tee configure.log
make all-gcc -j4 |&amp; tee make-all-gcc.log
make all-target-libgcc -j4 |&amp; tee make-all-target-libgcc.log
sudo make install-gcc |&amp; tee make-install-gcc.log
sudo make install-target-libgcc |&amp; tee make-install-target-libgcc.log


<span style="color: #525252;"># </span><span style="color: #525252;">rm -rf $DIR/build-gdb</span>
mkdir -p $<span style="color: #dcaeea;">DIR</span>/build-gdb
<span style="color: #c678dd;">cd</span> $<span style="color: #dcaeea;">DIR</span>/build-gdb
../gdb-11.2/configure --target=$<span style="color: #dcaeea;">TARGET</span> --prefix=$<span style="color: #dcaeea;">PREFIX</span> --program-prefix=i386-elf-
make -j4 |&amp; tee make.log
sudo make install |&amp; tee install.log
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf129c27" class="outline-3">
<h3 id="orgf129c27"><span class="section-number-3">3.2.</span> Tmux 管理终端会话</h3>
<div class="outline-text-3" id="text-3-2">
<p>
基本配置 ~/.tmux.conf
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">set</span> -g mouse on
<span style="color: #c678dd;">set</span> -g default-terminal <span style="color: #99bb66;">"xterm-256color"</span>
<span style="color: #c678dd;">set</span> -g escape-time 0
</pre>
</div>

<p>
使用 <code>Ctrl-b :</code> 可以进入命令模式执行命令
使用 <code>Ctrl-b ?</code> 可以进入查看快捷键绑定
</p>
</div>
</div>

<div id="outline-container-orgcc5ec3f" class="outline-3">
<h3 id="orgcc5ec3f"><span class="section-number-3">3.3.</span> 处理 json 字符串</h3>
<div class="outline-text-3" id="text-3-3">
<ul class="org-ul">
<li>fromjson 字符串 =&gt; 对象</li>
<li>tojson 对象 =&gt; 字符串</li>
</ul>
<div class="org-src-container">
<pre class="src src-sh">cat a.json | jq <span style="color: #99bb66;">'.str | fromjson | .[0] | tojson'</span>
</pre>
</div>

<p>
unqoute string, jq 使用 <code>-r</code> 选项可以去掉字符串中的双引号, <a href="https://github.com/jqlang/jq/issues/1735">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">echo</span> <span style="color: #99bb66;">'{"a": "val01", "b": 1}'</span> | jq <span style="color: #99bb66;">'.a'</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">echo</span> <span style="color: #99bb66;">'{"a": "val01", "b": 1}'</span> | jq -r <span style="color: #99bb66;">'.a'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5e7c6ae" class="outline-3">
<h3 id="org5e7c6ae"><span class="section-number-3">3.4.</span> qemu</h3>
<div class="outline-text-3" id="text-3-4">
<ul class="org-ul">
<li>qemu 使用示例教程 <a href="https://www.poftut.com/qemu-tutorial/">link</a></li>
</ul>

<p>
安装 qemu
</p>
<div class="org-src-container">
<pre class="src src-sh">apt install -y qemu-system
</pre>
</div>

<p>
创建硬盘镜像文件
</p>
<div class="org-src-container">
<pre class="src src-sh">qemu-img create myvm.qcow2 16G
</pre>
</div>

<p>
安装 minix 系统
</p>
<div class="org-src-container">
<pre class="src src-sh">qemu-system-x86_64 -boot d -cdrom minix_R3.3.0-588a35b.iso -m 1024 -hda myvm.qcow2
<span style="color: #525252;"># </span><span style="color: #525252;">Ctrl-A x &#36864;&#20986; QEMU &#30028;&#38754;</span>
qemu-system-x86_64 -nographic -boot d -cdrom minix_R3.3.0-588a35b.iso -m 1024 -hda myvm.qcow2
</pre>
</div>
</div>
</div>

<div id="outline-container-org694ad8f" class="outline-3">
<h3 id="org694ad8f"><span class="section-number-3">3.5.</span> bochs</h3>
<div class="outline-text-3" id="text-3-5">
</div>
<div id="outline-container-org065462a" class="outline-4">
<h4 id="org065462a"><span class="section-number-4">3.5.1.</span> bochs 安装及配置</h4>
<div class="outline-text-4" id="text-3-5-1">
<p>
源码编译安装 <a href="https://wiki.osdev.org/Bochs">OSDev link</a> | <a href="https://github.com/bochs-emu/Bochs">Github</a> | <a href="https://sourceforge.net/projects/bochs/files/bochs/2.7/">bochs 2.7</a>
官方编译手册 <a href="https://bochs.sourceforge.io/doc/docbook/user/compiling.html">Compiling Bochs</a> | <a href="https://rayanfam.com/topics/bochs-config-and-build-on-windows-and-os-x/">build on macosx</a>
</p>

<p>
ubuntu 下编译
</p>
<div class="org-src-container">
<pre class="src src-sh">wget -c https://jaist.dl.sourceforge.net/project/bochs/bochs/2.7/bochs-2.7.tar.gz

sudo apt-get install libsdl2-dev

./configure --prefix=/opt/bochs <span style="color: #99bb66;">\</span>
            --enable-smp <span style="color: #99bb66;">\</span>
            --enable-cpu-level=6 <span style="color: #99bb66;">\</span>
            --enable-all-optimizations <span style="color: #99bb66;">\</span>
            --enable-x86-64 <span style="color: #99bb66;">\</span>
            --enable-pci <span style="color: #99bb66;">\</span>
            --enable-vmx <span style="color: #99bb66;">\</span>
            --enable-debugger <span style="color: #99bb66;">\</span>
            --enable-debugger-gui <span style="color: #99bb66;">\</span>
            --enable-logging <span style="color: #99bb66;">\</span>
            --enable-fpu <span style="color: #99bb66;">\</span>
            --enable-3dnow <span style="color: #99bb66;">\</span>
            --enable-sb16=dummy <span style="color: #99bb66;">\</span>
            --enable-ne2000 <span style="color: #99bb66;">\</span>
            --enable-cdrom <span style="color: #99bb66;">\</span>
            --enable-x86-debugger <span style="color: #99bb66;">\</span>
            --enable-iodebug <span style="color: #99bb66;">\</span>
            --disable-plugins <span style="color: #99bb66;">\</span>
            --disable-docbook <span style="color: #99bb66;">\</span>
            --with-x --with-x11 --with-term

make

sudo make install
</pre>
</div>

<p>
macos 下编译
</p>
<div class="org-src-container">
<pre class="src src-sh">wget -c https://jaist.dl.sourceforge.net/project/bochs/bochs/2.7/bochs-2.7.tar.gz

brew install sdl2

./configure --prefix=/opt/bochs <span style="color: #99bb66;">\</span>
            --enable-smp <span style="color: #99bb66;">\</span>
            --enable-cpu-level=6 <span style="color: #99bb66;">\</span>
            --enable-all-optimizations <span style="color: #99bb66;">\</span>
            --enable-x86-64 <span style="color: #99bb66;">\</span>
            --enable-pci <span style="color: #99bb66;">\</span>
            --enable-vmx <span style="color: #99bb66;">\</span>
            --enable-debugger <span style="color: #99bb66;">\</span>
            --enable-debugger-gui <span style="color: #99bb66;">\</span>
            --enable-logging <span style="color: #99bb66;">\</span>
            --enable-fpu <span style="color: #99bb66;">\</span>
            --enable-3dnow <span style="color: #99bb66;">\</span>
            --enable-sb16=dummy <span style="color: #99bb66;">\</span>
            --enable-cdrom <span style="color: #99bb66;">\</span>
            --enable-x86-debugger <span style="color: #99bb66;">\</span>
            --enable-iodebug <span style="color: #99bb66;">\</span>
            --disable-plugins <span style="color: #99bb66;">\</span>
            --disable-docbook <span style="color: #99bb66;">\</span>
            --with-term --with-sdl2

make
sudo make install
</pre>
</div>

<p>
添加共享配置
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">BXSHARE</span>=<span style="color: #99bb66;">"/opt/bochs/share/bochs"</span>
</pre>
</div>

<p>
bochsrc 配置文件, 设置启动未 1.44 存软盘, 启动镜像名称为 Image
</p>
<div class="org-src-container">
<pre class="src src-text">boot: floppy
floppy_bootsig_check: disabled=0
floppya: 1_44=Image, status=inserted
</pre>
</div>

<p>
全部的配置文件参考如下说明
</p>
<div class="org-src-container">
<pre class="src src-sh">vim /opt/bochs/share/doc/bochs/bochsrc-sample.txt
</pre>
</div>
</div>
</div>

<div id="outline-container-org58b6611" class="outline-4">
<h4 id="org58b6611"><span class="section-number-4">3.5.2.</span> 开启图形调试器</h4>
<div class="outline-text-4" id="text-3-5-2">
<p>
修改配置文件 bochsrc.bxrc
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">Linux</span>
display_library: x, <span style="color: #dcaeea;">options</span>=<span style="color: #99bb66;">"gui_debug"</span>
<span style="color: #525252;"># </span><span style="color: #525252;">Windows</span>
display_library: win32, <span style="color: #dcaeea;">options</span>=<span style="color: #99bb66;">"gui_debug"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgad12e3a" class="outline-4">
<h4 id="orgad12e3a"><span class="section-number-4">3.5.3.</span> 提取系统文件</h4>
<div class="outline-text-4" id="text-3-5-3">
<div class="org-src-container">
<pre class="src src-text">[/root]# mdir b:
 Volume in drive B has no label
 Directory for B:/

FIND-3X2 TAZ      218243    2-24-105   2:49p
COMPRESS           74756    2-27-105   2:54p
BOOT     S           335    2-27-105   3:20p
PS012    TAZ       75393    2-28-105  10:15p
HELLO    C            74    7-23-123  12:18a
       5 File(s)     1086976 bytes free
[/root]# mcopy hello.c b:
File "HELLO.C" exists, overwrite (y/n) ? y
Copying HELLO.C
[/root]#
</pre>
</div>

<p>
挂载文件镜像
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo mount -t msdos -o loop diskb.img /mnt
sudo mount -t minix -o loop rootimage-hd.img /mnt
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org213a9b5" class="outline-3">
<h3 id="org213a9b5"><span class="section-number-3">3.6.</span> pandoc 文档格式转换</h3>
<div class="outline-text-3" id="text-3-6">
<div class="org-src-container">
<pre class="src src-sh">pandoc --pdf-engine=xelatex <span style="color: #99bb66;">\</span>
       --toc --number-sections <span style="color: #99bb66;">\</span>
       -V <span style="color: #dcaeea;">date</span>=<span style="color: #99bb66;">"$(date +'%Y-%m-%d %H:%M:%S')"</span> <span style="color: #99bb66;">\</span>
       -V <span style="color: #dcaeea;">author</span>=<span style="color: #99bb66;">"Jinghui Hu"</span> <span style="color: #99bb66;">\</span>
       -V <span style="color: #dcaeea;">mainfont</span>=<span style="color: #99bb66;">"SimSun"</span> <span style="color: #99bb66;">\</span>
       -V <span style="color: #dcaeea;">documentclass</span>=ctexart <span style="color: #99bb66;">\</span>
       -V geometry:<span style="color: #dcaeea;">margin</span>=<span style="color: #99bb66;">'1in'</span> <span style="color: #99bb66;">\</span>
       -o tech.pdf tech.org
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org85427bd" class="outline-2">
<h2 id="org85427bd"><span class="section-number-2">4.</span> 后端研发</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org4a19c87" class="outline-3">
<h3 id="org4a19c87"><span class="section-number-3">4.1.</span> Oracle</h3>
<div class="outline-text-3" id="text-4-1">
</div>
<div id="outline-container-org2692840" class="outline-4">
<h4 id="org2692840"><span class="section-number-4">4.1.1.</span> 参考资料</h4>
<div class="outline-text-4" id="text-4-1-1">
<ol class="org-ol">
<li>Oracle 关系数据库 <a href="../database/oracle.html#MissingReference">参考链接</a></li>
</ol>
</div>
</div>
<div id="outline-container-org3d4cd76" class="outline-4">
<h4 id="org3d4cd76"><span class="section-number-4">4.1.2.</span> 开发环境配置</h4>
<div class="outline-text-4" id="text-4-1-2">
</div>
<ol class="org-ol">
<li><a id="orga22b0a5"></a>CentOS 7 镜像启动<br />
<div class="outline-text-5" id="text-4-1-2-1">
<ol class="org-ol">
<li><a href="https://hub.docker.com/_/centos/">docker container</a></li>
<li><p>
启动 centos7 镜像
</p>
<div class="org-src-container">
<pre class="src src-sh">docker run -d -it --restart always <span style="color: #99bb66;">\</span>
       -v ~/srv/pence/data:/data <span style="color: #99bb66;">\</span>
       --hostname pence --name pence centos:7
</pre>
</div></li>
<li><p>
重新进入进行容器
</p>
<div class="org-src-container">
<pre class="src src-sh">docker exec -it pence bash
</pre>
</div></li>
<li><p>
删除容器
</p>
<div class="org-src-container">
<pre class="src src-sh">docker rm -f pence
</pre>
</div></li>
</ol>
</div>
</li>
<li><a id="org5274bd0"></a>配置主机开发环境<br />
<div class="outline-text-5" id="text-4-1-2-2">
<p>
安装一波系统依赖库
</p>
<div class="org-src-container">
<pre class="src src-sh">yum update

<span style="color: #525252;"># </span><span style="color: #525252;">common tools</span>
yum install -y net-tools vim tmux tree kernel-devel kernel-doc kernel-headers <span style="color: #99bb66;">\</span>
    samba samba-client ntp rsync curl git

<span style="color: #525252;"># </span><span style="color: #525252;">for oracle 11g install</span>
yum install -y binutils compat-libcap1 compat-libstdc++-33 gcc gcc-c++ glibc <span style="color: #99bb66;">\</span>
    glibc-devel ksh libgcc libstdc++ libstdc++-devel libaio libaio-devel libXi <span style="color: #99bb66;">\</span>
    libXtst make sysstat unixODBC unixODBC-devel oracleasm-support

yum install -y gcc gcc-c++ cmake automake zip unzip python3 python3-devel <span style="color: #99bb66;">\</span>
    python-devel python rpm-build redhat-rpm-config asciidoc hmaccalc <span style="color: #99bb66;">\</span>
    perl-ExtUtils-Embed pesign xmlto audit-libs-devel binutils-devel <span style="color: #99bb66;">\</span>
    elfutils-devel elfutils-libelf-devel ncurses-devel bison-devel newt-devel <span style="color: #99bb66;">\</span>
    numactl-devel pciutils-devel python-devel zlib-devel readline-devel

<span style="color: #525252;"># </span><span style="color: #525252;">for mysql</span>
yum install -y cmake ncurses ncurses-devel bison bison-devel openssl openssl-devel

<span style="color: #525252;"># </span><span style="color: #525252;">for openGauss</span>
yum install -y libaio-devel flex bison bison-devel ncurses-devel glibc-devel <span style="color: #99bb66;">\</span>
    patch redhat-lsb-core readline-devel

</pre>
</div>
</div>
</li>

<li><a id="orgd1449a7"></a>设置时区<br />
<div class="outline-text-5" id="text-4-1-2-3">
<div class="org-src-container">
<pre class="src src-sh">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</pre>
</div>
</div>
</li>

<li><a id="org5546c86"></a>安装数据库的前置准备<br />
<div class="outline-text-5" id="text-4-1-2-4">
<ol class="org-ol">
<li><a href="../article/install-oracle-11g-on-linux.html">安装 Oracle 11g</a></li>
<li>配置系统内存以及 swap</li>
</ol>
</div>
</li>
</ol>
</div>

<div id="outline-container-org40e48e8" class="outline-4">
<h4 id="org40e48e8"><span class="section-number-4">4.1.3.</span> 运维相关</h4>
<div class="outline-text-4" id="text-4-1-3">
</div>
<ol class="org-ol">
<li><a id="orgcc80841"></a>表空间及数据文件<br />
<div class="outline-text-5" id="text-4-1-3-1">
<p>
查看数据
</p>
<div class="org-src-container">
<pre class="src src-sh">
</pre>
</div>

<p>
修改数据
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #525252;">-- </span><span style="color: #525252;">&#28155;&#21152;&#25968;&#25454;&#25991;&#20214;&#21040;&#34920;&#31354;&#38388;</span>
<span style="color: #51afef;">alter</span> tablespace TBS_PART01 <span style="color: #51afef;">add</span> datafile <span style="color: #99bb66;">'/u01/part01.dbf'</span> <span style="color: #51afef;">size</span> 4G;
<span style="color: #525252;">-- </span><span style="color: #525252;">&#20462;&#25913;&#25968;&#25454;&#25991;&#20214;&#23646;&#24615;</span>
<span style="color: #51afef;">alter</span> database datafile <span style="color: #99bb66;">'/u01/part01.dbf'</span> autoextend <span style="color: #51afef;">off</span>;
<span style="color: #51afef;">alter</span> database datafile <span style="color: #99bb66;">'/u01/part01.dbf'</span> autoextend <span style="color: #51afef;">on</span> <span style="color: #51afef;">next</span> 100M maxsize 10G;
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org64e68d2" class="outline-3">
<h3 id="org64e68d2"><span class="section-number-3">4.2.</span> MySQL</h3>
<div class="outline-text-3" id="text-4-2">
</div>
<div id="outline-container-org92df610" class="outline-4">
<h4 id="org92df610"><span class="section-number-4">4.2.1.</span> 参考资料</h4>
<div class="outline-text-4" id="text-4-2-1">
<ol class="org-ol">
<li>MySQL 开发文档 8.0.30  <a href="https://dev.mysql.com/doc/dev/mysql-server/8.0.30/PAGE_GET_STARTED.html#start_source">Source Code Documents</a></li>
<li>MySQL 使用文档 <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html">InnoDB Storage Engine</a></li>
<li>专栏 <a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/MySQL%E5%AE%9E%E6%88%9845%E8%AE%B2">MySQL 实战 45 讲</a></li>
<li>三方库 <a href="https://gorm.io/docs/index.html">GORM</a> | <a href="https://docs.spring.io/spring-data/jpa/docs/2.7.7/reference/html/">JPA</a> | <a href="https://github.com/mybatis/mybatis-3">mybatis-3</a></li>
</ol>
</div>
</div>

<div id="outline-container-org9ee7d11" class="outline-4">
<h4 id="org9ee7d11"><span class="section-number-4">4.2.2.</span> 主从架构实验环境</h4>
<div class="outline-text-4" id="text-4-2-2">
</div>
<ol class="org-ol">
<li><a id="org2efef28"></a>配置 Docker 环境<br />
<div class="outline-text-5" id="text-4-2-2-1">
<ol class="org-ol">
<li>安装 Docker Server</li>
<li>参考文档 <a href="https://docs.docker.com/compose/install/other">Install the Compose standalone</a> 安装 docker-compose</li>
<li>编写启动配置文件 <a href="env-mysql/">MySQL 主备配置</a></li>
<li>docker hub <a href="https://hub.docker.com/_/mysql">mysql 镜像</a></li>
<li>启动服务</li>
</ol>
<div class="org-src-container">
<pre class="src src-sh">docker-compose up -d
</pre>
</div>
</div>
</li>

<li><a id="org9f2e08b"></a>配置主备环境<br />
<ol class="org-ol">
<li><a id="org009553c"></a>查看主备网络配置<br />
<div class="outline-text-6" id="text-4-2-2-2-1">
<div class="org-src-container">
<pre class="src src-sh">docker inspect mysql-master | jq <span style="color: #99bb66;">'.[0].NetworkSettings.Networks.dbnet.IPAddress'</span>
docker inspect mysql-slave  | jq <span style="color: #99bb66;">'.[0].NetworkSettings.Networks.dbnet.IPAddress'</span>
</pre>
</div>

<p>
查看主机网络
</p>
<div class="org-src-container">
<pre class="src src-sh">docker network ls
</pre>
</div>
</div>
</li>

<li><a id="orgdb6625f"></a>主库配置备库用户的访问权限<br />
<div class="outline-text-6" id="text-4-2-2-2-2">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #51afef;">create</span> <span style="color: #c678dd;">user</span> "user02"@"%" identified <span style="color: #51afef;">by</span> "user02";
<span style="color: #51afef;">grant</span> replication slave <span style="color: #51afef;">on</span> *.* <span style="color: #51afef;">to</span> "user02"@"%";
flush <span style="color: #51afef;">privileges</span>;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql">show master status
</pre>
</div>
</div>
</li>

<li><a id="orgde26e54"></a>备库同步配置<br />
<div class="outline-text-6" id="text-4-2-2-2-3">
<div class="org-src-container">
<pre class="src src-sql"># &#36825;&#37324;&#30340; <span style="color: #51afef;">host</span> &#31561;&#21442;&#25968;&#38656;&#35201;&#26681;&#25454;&#20027;&#24211;&#30340;&#37197;&#32622;&#20462;&#25913;
<span style="color: #525252;">-- </span><span style="color: #525252;">change master to master_host='172.20.0.100', master_user='user02', master_password='user02', master_log_file='1.000003', master_log_pos=823;</span>
<span style="color: #525252;">-- </span><span style="color: #525252;">change master to master_host='mysql-master', master_user='user02', master_password='user02', master_log_file='mysql-bin.000003', master_log_pos=0;</span>
change master <span style="color: #51afef;">to</span> master_host=<span style="color: #99bb66;">'mysql-master'</span>, master_user=<span style="color: #99bb66;">'user02'</span>, master_password=<span style="color: #99bb66;">'user02'</span>, master_log_file=<span style="color: #99bb66;">'mysql-bin.000003'</span>, master_log_pos=841;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #51afef;">start</span> slave;
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql">show slave status\G
</pre>
</div>

<p>
如果出现这样的两行表示结果是正确的
</p>
<blockquote>
<p>
Slave<sub>IO</sub><sub>Running</sub>: Yes
Slave<sub>SQL</sub><sub>Running</sub>: Yes
</p>
</blockquote>

<p>
重置 slave
</p>
<div class="org-src-container">
<pre class="src src-sql">stop slave;
reset slave;
</pre>
</div>
</div>
</li>

<li><a id="org7b3f312"></a>主库建表<br />
<div class="outline-text-6" id="text-4-2-2-2-4">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #51afef;">create</span> <span style="color: #51afef;">table</span> <span style="color: #c678dd;">t</span> (
  id <span style="color: #ECBE7B;">int</span> <span style="color: #51afef;">primary</span> <span style="color: #51afef;">key</span> auto_increment,
  c <span style="color: #ECBE7B;">int</span>
);
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #51afef;">insert</span> <span style="color: #51afef;">into</span> t(c) <span style="color: #51afef;">values</span> (1), (2), (3);
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sql"><span style="color: #51afef;">delete</span> <span style="color: #51afef;">from</span> t <span style="color: #51afef;">where</span> id &lt; 10;
</pre>
</div>
</div>
</li>

<li><a id="orgae79b61"></a>备库查询<br />
<div class="outline-text-6" id="text-4-2-2-2-5">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #51afef;">select</span> * <span style="color: #51afef;">from</span> t;
</pre>
</div>
</div>
</li>
</ol>
</li>

<li><a id="org44b7cb7"></a>设置登录别名<br />
<div class="outline-text-5" id="text-4-2-2-3">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">alias</span> <span style="color: #dcaeea;">my1</span>=<span style="color: #99bb66;">"MYSQL_PWD=p111   mysql -h127.0.0.1 -uroot -P9001"</span>
<span style="color: #c678dd;">alias</span> <span style="color: #dcaeea;">my2</span>=<span style="color: #99bb66;">"MYSQL_PWD=p222   mysql -h127.0.0.1 -uroot -P9002"</span>
<span style="color: #c678dd;">alias</span> <span style="color: #dcaeea;">u01</span>=<span style="color: #99bb66;">"MYSQL_PWD=user01 mysql -h127.0.0.1 -uuser01 -P9001 test01"</span>
<span style="color: #c678dd;">alias</span> <span style="color: #dcaeea;">u02</span>=<span style="color: #99bb66;">"MYSQL_PWD=user02 mysql -h127.0.0.1 -uuser02 -P9002 test01"</span>
<span style="color: #c678dd;">alias</span> <span style="color: #dcaeea;">m100</span>=<span style="color: #99bb66;">'docker exec -it mysql-master /bin/bash'</span>
<span style="color: #c678dd;">alias</span> <span style="color: #dcaeea;">m101</span>=<span style="color: #99bb66;">'docker exec -it mysql-slave /bin/bash'</span>
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgdd7cbfe" class="outline-4">
<h4 id="orgdd7cbfe"><span class="section-number-4">4.2.3.</span> 运维主题</h4>
<div class="outline-text-4" id="text-4-2-3">
</div>
<ol class="org-ol">
<li><a id="org1f29456"></a>创建用户 &amp; 授权访问数据库<br />
<div class="outline-text-5" id="text-4-2-3-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #51afef;">create</span> <span style="color: #c678dd;">user</span> <span style="color: #99bb66;">'jeffrey'</span>@<span style="color: #99bb66;">'%'</span> identified <span style="color: #51afef;">by</span> <span style="color: #99bb66;">'hello'</span>;
<span style="color: #51afef;">grant</span> <span style="color: #51afef;">all</span> <span style="color: #51afef;">privileges</span> <span style="color: #51afef;">on</span> employees.* <span style="color: #51afef;">to</span> <span style="color: #99bb66;">'jeffrey'</span>@<span style="color: #99bb66;">'%'</span>;
flush <span style="color: #51afef;">privileges</span>;
</pre>
</div>
</div>
</li>

<li><a id="org41c09e7"></a>查看当前用户权限<br />
<div class="outline-text-5" id="text-4-2-3-2">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #51afef;">select</span> <span style="color: #c678dd;">user</span>, <span style="color: #51afef;">host</span> <span style="color: #51afef;">from</span> mysql.<span style="color: #c678dd;">user</span>;
</pre>
</div>
</div>
</li>
<li><a id="org2ea9787"></a>修改用户密码<br />
<div class="outline-text-5" id="text-4-2-3-3">
<div class="org-src-container">
<pre class="src src-sql">use mysql;
<span style="color: #51afef;">set</span> password <span style="color: #51afef;">for</span> <span style="color: #99bb66;">'jeffrey'</span>@<span style="color: #99bb66;">'%'</span> = password(<span style="color: #99bb66;">'root'</span>);
<span style="color: #51afef;">update</span> <span style="color: #c678dd;">user</span> <span style="color: #51afef;">set</span> password = password(<span style="color: #99bb66;">'new.password'</span>) <span style="color: #51afef;">where</span> <span style="color: #c678dd;">user</span> = <span style="color: #99bb66;">'jeffrey'</span> <span style="color: #51afef;">and</span> <span style="color: #51afef;">host</span> = <span style="color: #99bb66;">'%'</span>;
<span style="color: #51afef;">update</span> <span style="color: #c678dd;">user</span> <span style="color: #51afef;">set</span> <span style="color: #51afef;">host</span> = <span style="color: #99bb66;">'%'</span> <span style="color: #51afef;">where</span> <span style="color: #c678dd;">user</span> = <span style="color: #99bb66;">'root'</span>;
flush <span style="color: #51afef;">privileges</span>;

<span style="color: #51afef;">alter</span> <span style="color: #c678dd;">user</span> <span style="color: #99bb66;">'jeffrey'</span>@<span style="color: #99bb66;">'%'</span> identified <span style="color: #51afef;">by</span> <span style="color: #99bb66;">'mypass'</span>;
</pre>
</div>
</div>
</li>
<li><a id="org3f24bc2"></a>重建表<br />
<div class="outline-text-5" id="text-4-2-3-4">
<p>
InnoDB 不支持直接优化表
</p>
<pre class="example" id="org25b73bc">
mysql&gt; optimize table price_daily;
+-----------------------------+----------+----------+-------------------------------------------------------------------+
| Table                       | Op       | Msg_type | Msg_text                                                          |
+-----------------------------+----------+----------+-------------------------------------------------------------------+
| prod_alpen_dict.price_daily | optimize | note     | Table does not support optimize, doing recreate + analyze instead |
| prod_alpen_dict.price_daily | optimize | status   | OK                                                                |
+-----------------------------+----------+----------+-------------------------------------------------------------------+
</pre>

<p>
InnoDB 需要重建后分析来优化表，对应 SQL 如下
</p>
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #525252;">-- </span><span style="color: #525252;">recreate</span>
<span style="color: #51afef;">alter</span> <span style="color: #51afef;">table</span> <span style="color: #c678dd;">price_daily</span> engine=innodb;
<span style="color: #525252;">-- </span><span style="color: #525252;">analyze</span>
analyze <span style="color: #51afef;">table</span> price_daily;
</pre>
</div>

<pre class="example" id="org12a53c6">
mysql&gt; alter table price_daily engine=innodb;
Query OK, 0 rows affected (3 min 2.06 sec)
Records: 0  Duplicates: 0  Warnings: 0
mysql&gt; analyze table price_daily;
+-----------------------------+---------+----------+----------+
| Table                       | Op      | Msg_type | Msg_text |
+-----------------------------+---------+----------+----------+
| prod_alpen_dict.price_daily | analyze | status   | OK       |
+-----------------------------+---------+----------+----------+
1 row in set (0.04 sec)
</pre>
</div>
</li>

<li><a id="org7673eed"></a>高可用部署方案<br />
<div class="outline-text-5" id="text-4-2-3-5">
<ol class="org-ol">
<li>全同步复制 5.7.17 后版本
<ul class="org-ul">
<li>GTID 模式下运行</li>
<li>日志为 row 格式</li>
</ul></li>
<li>MGR
<ul class="org-ul">
<li>基于 raft 算法自动选主</li>
<li>保证 N/2 + 1 节点可用</li>
<li>基于 MySQL 插件实现，部分方便</li>
</ul></li>
</ol>
</div>
</li>
</ol>
</div>

<div id="outline-container-org336e6a7" class="outline-4">
<h4 id="org336e6a7"><span class="section-number-4">4.2.4.</span> 源码研究</h4>
<div class="outline-text-4" id="text-4-2-4">
<ol class="org-ol">
<li>专栏 <a href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/MySQL%E5%AE%9E%E6%88%9845%E8%AE%B2">MySQL45</a> | <a href="https://blog.jcole.us/innodb/">Data Structure</a> | <a href="http://www.unofficialmysqlguide.com/introduction.html">Unofficial Optimizer Guide</a></li>
<li><a href="mysql-source-code.html">MySQL 源码笔记</a></li>
<li>示例数据库 <a href="https://dev.mysql.com/doc/employee/en/employees-installation.html">Employees Sample Database</a> | <a href="https://github.com/datacharmer/test_db">Github</a> | <a href="https://dev.mysql.com/doc/index-other.html">Example DB: world, sakila</a></li>
<li>代码阅读分享
<ul class="org-ul">
<li><a href="../mysql/share-01-mysql-group-by-analysis.html">GroupBy 语句实现原理探索</a></li>
<li><a href="../mysql/share-02-mysql-optimize.html">MySQL 优化器实现原理探索</a></li>
</ul></li>
</ol>
</div>
<ol class="org-ol">
<li><a id="org8d56a3d"></a>安装编译调试环境<br />
<div class="outline-text-5" id="text-4-2-4-1">
<ol class="org-ol">
<li><p>
系统依赖安装
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#23433;&#35013;&#20381;&#36182;&#21253;</span>
yum update

yum install -y net-tools vim tmux tree kernel-devel kernel-doc kernel-headers <span style="color: #99bb66;">\</span>
    samba samba-client ntp rsync curl git wget

yum install -y binutils compat-libcap1 compat-libstdc++-33 gcc gcc-c++ glibc <span style="color: #99bb66;">\</span>
    glibc-devel ksh libgcc libstdc++ libstdc++-devel libaio libaio-devel libXi <span style="color: #99bb66;">\</span>
    libXtst make sysstat unixODBC unixODBC-devel oracleasm-support zip unzip <span style="color: #99bb66;">\</span>
    python-devel python rpm-build redhat-rpm-config asciidoc hmaccalc <span style="color: #99bb66;">\</span>
    perl-ExtUtils-Embed pesign xmlto audit-libs-devel binutils-devel <span style="color: #99bb66;">\</span>
    elfutils-devel elfutils-libelf-devel ncurses-devel bison-devel newt-devel <span style="color: #99bb66;">\</span>
    python3 python3-devel <span style="color: #99bb66;">\</span>
    numactl-devel pciutils-devel python-devel zlib-devel readline-devel
</pre>
</div></li>
<li><p>
编译工具安装 <a href="https://gcc.gnu.org/install/">GCC</a> | <a href="https://www.sourceware.org/gdb/">GDB</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">gcc</span>
wget https://mirrors.tuna.tsinghua.edu.cn/gnu/gcc/gcc-12.1.0/gcc-12.1.0.tar.gz
<span style="color: #525252;"># </span><span style="color: #525252;">&#19979;&#36733; gcc &#30340;&#20381;&#36182;</span>
./contrib/download_prerequisites
<span style="color: #525252;"># </span><span style="color: #525252;">--enable-multilib &#24320;&#21551; 32 &#20301;&#24211;&#25903;&#25345;</span>
./configure --prefix=/usr/local/gcc --disable-multilib
make
make install

<span style="color: #525252;"># </span><span style="color: #525252;">gdb</span>
wget https://mirrors.tuna.tsinghua.edu.cn/gnu/gdb/gdb-12.1.tar.gz
./configure --prefix=/usr/local/gdb
make
make install
</pre>
</div>
<p>
添加环境变量
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">PATH</span>=/usr/local/gcc/bin:$<span style="color: #dcaeea;">PATH</span>
<span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">LD_LIBRARY_PATH</span>=/usr/local/gcc/lib64:$<span style="color: #dcaeea;">LD_LIBRARY_PATH</span>
<span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">PATH</span>=/usr/local/gdb/bin:$<span style="color: #dcaeea;">PATH</span>
</pre>
</div></li>
<li><p>
cmake 安装 <a href="https://cmake.org/install/">CMake Install</a>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#19979;&#36733;&#20195;&#30721;</span>
curl -OL https://github.com/Kitware/CMake/releases/download/v3.25.2/cmake-3.25.2.tar.gz
<span style="color: #525252;"># </span><span style="color: #525252;">&#32534;&#35793;&#23433;&#35013;</span>
./bootstrap --prefix=/usr/local/cmake
make
make install
</pre>
</div>
<p>
添加环境变量
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">PATH</span>=/usr/local/cmake/bin:$<span style="color: #dcaeea;">PATH</span>
</pre>
</div></li>
<li><p>
boost 下载并安装
</p>
<div class="org-src-container">
<pre class="src src-sh">wget -c https://boostorg.jfrog.io/artifactory/main/release/1.77.0/source/boost_1_77_0.tar.bz2
tar xjvf boost_1_77_0.tar.bz2
</pre>
</div></li>
</ol>
</div>
</li>
<li><a id="org01d3cc8"></a>编译代码及初始数据库<br />
<div class="outline-text-5" id="text-4-2-4-2">
<ol class="org-ol">
<li>参考资料 <a href="https://dev.mysql.com/doc/refman/8.0/en/source-installation.html">源代码安装文档</a> | <a href="https://dev.mysql.com/doc/refman/8.0/en/making-trace-files.html">TRACE 文件</a> | <a href="https://dev.mysql.com/doc/refman/8.0/en/using-gdb-on-mysqld.html">&#x2013;gdb</a> | <a href="https://dev.mysql.com/doc/dev/mysql-server/8.0.30/PAGE_OPT_TRACE.html">The Optimizer Trace</a></li>
<li><p>
配置文件 <code>/etc/my.cnf</code>
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #525252;"># </span><span style="color: #525252;">-*- mode: conf; -*-</span>

[<span style="color: #ECBE7B;">mysqld</span>]
<span style="color: #dcaeea;">basedir</span>=/opt/local/mysql
<span style="color: #dcaeea;">datadir</span>=/opt/local/mysql/data
<span style="color: #dcaeea;">log-error</span>=/tmp/mysql-error.log
<span style="color: #dcaeea;">pid-file</span>=/tmp/mysql.pid
<span style="color: #525252;"># </span><span style="color: #525252;">debug=d,info,error,query,general,where:O,/tmp/mysqld.trace</span>
<span style="color: #525252;"># </span><span style="color: #525252;">debug=+d,info,error,query,general,enter,where:O,/tmp/mysqld.trace</span>
debug

<span style="color: #525252;"># </span><span style="color: #525252;">autocommit=0</span>
<span style="color: #dcaeea;">innodb_lock_wait_timeout</span>=3600
<span style="color: #525252;"># </span><span style="color: #525252;">long_query_time = 0</span>
<span style="color: #dcaeea;">slow_query_log</span> = on
<span style="color: #dcaeea;">slow_query_log_file</span> = /tmp/mysql-slow.log
<span style="color: #525252;"># </span><span style="color: #525252;">secure_file_priv = /tmp</span>

[<span style="color: #ECBE7B;">client</span>]
<span style="color: #dcaeea;">user</span>=root
</pre>
</div></li>
<li><p>
编译源代码
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#20934;&#22791;&#20195;&#30721;&#32534;&#35793;&#30446;&#24405;, &#36755;&#20986;&#30446;&#24405;&#20026; out</span>
mkdir out
<span style="color: #c678dd;">cd</span> out
cmake -DCMAKE_INSTALL_PREFIX=/opt/local/mysql -DWITH_BOOST=../../boost/boost_1_77_0 -DWITH_DEBUG=1 -DWITH_UNIT_TESTS=0 ..
<span style="color: #525252;"># </span><span style="color: #525252;">&#32534;&#35793;&#20195;&#30721;</span>
<span style="color: #c678dd;">cd</span> out
make -j8
make install
</pre>
</div></li>
<li><p>
初始化数据库
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#21021;&#22987;&#21270;&#25968;&#25454;&#24211;</span>
mysqld --defaults-file=/etc/my.cnf --initialize-insecure

<span style="color: #525252;"># </span><span style="color: #525252;">https://dev.mysql.com/doc/refman/8.0/en/starting-server.html</span>
<span style="color: #525252;"># </span><span style="color: #525252;">&#21551;&#21160;&#25968;&#25454;&#24211;&#25968;&#25454;&#24211;, --gdb &#26159;&#24320;&#21551; gdb &#35843;&#35797;&#25903;&#25345;</span>
<span style="color: #525252;"># </span><span style="color: #525252;">--debug=d,info,error,query,general,where:O,/tmp/mysqld.trace</span>
mysqld --gdb &gt;/dev/null 2&gt;&amp;1 &amp;

<span style="color: #525252;"># </span><span style="color: #525252;">&#38142;&#25509;&#25968;&#25454;&#24211;</span>
mysql
<span style="color: #525252;"># </span><span style="color: #525252;">&#20851;&#38381;&#25968;&#25454;&#24211;</span>
mysqladmin shutdown
</pre>
</div></li>
</ol>
</div>
</li>
<li><a id="orgc7cabc2"></a>代码阅读配置<br />
<div class="outline-text-5" id="text-4-2-4-3">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#29983;&#25104;&#36339;&#36716;&#30340; TAG</span>
ctags -e -R --languages=c,c++ .
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>

<div id="outline-container-org142e32c" class="outline-3">
<h3 id="org142e32c"><span class="section-number-3">4.3.</span> Postgres</h3>
<div class="outline-text-3" id="text-4-3">
</div>
<div id="outline-container-orgfff4a08" class="outline-4">
<h4 id="orgfff4a08"><span class="section-number-4">4.3.1.</span> 前置环境变量</h4>
<div class="outline-text-4" id="text-4-3-1">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">PGDATA</span>=/opt/local/pgsql/data
</pre>
</div>
</div>
</div>
<div id="outline-container-org244795d" class="outline-4">
<h4 id="org244795d"><span class="section-number-4">4.3.2.</span> 编译调试 &amp; 初始化数据</h4>
<div class="outline-text-4" id="text-4-3-2">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#37197;&#32622;&#35843;&#35797;&#29615;&#22659;</span>
./configure --prefix=/opt/local/pgsql --enable-cassert --enable-debug <span style="color: #dcaeea;">CFLAGS</span>=<span style="color: #99bb66;">"-ggdb -O0 -fno-omit-frame-pointer"</span>
<span style="color: #525252;"># </span><span style="color: #525252;">&#32534;&#35793;, &#23433;&#35013;</span>
make -j8
make install
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#21021;&#22987;&#21270;&#25968;&#25454;&#24211;</span>
initdb -D /opt/local/pgsql/data
<span style="color: #525252;"># </span><span style="color: #525252;">&#21551;&#21160;&#25968;&#25454;&#24211;</span>
pg_ctl -D /opt/local/pgsql/data -l logfile start
<span style="color: #525252;"># </span><span style="color: #525252;">&#21019;&#24314;&#24211;</span>
createdb test01
<span style="color: #525252;"># </span><span style="color: #525252;">&#38142;&#25509;&#24211;</span>
psql test01
</pre>
</div>
</div>
</div>
<div id="outline-container-org21728b2" class="outline-4">
<h4 id="org21728b2"><span class="section-number-4">4.3.3.</span> 调试命令</h4>
<div class="outline-text-4" id="text-4-3-3">
<p>
找到对应的进程
</p>
<div class="org-src-container">
<pre class="src src-sh">$ ps aux | grep postgres
jinghuihu        87208   0.0  0.0 34130524    676 s006  S+   12:13PM   0:00.00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn --exclude-dir=.idea --exclude-dir=.tox postgres
jinghuihu        82329   0.0  0.2 34313316  36860   ??  Ss   10:51AM   0:00.16 postgres: jinghuihu test01 [local] idle
jinghuihu        82278   0.0  0.0 34309036   1792   ??  Ss   10:51AM   0:00.00 postgres: logical replication launcher
jinghuihu        82277   0.0  0.0 34310060   2136   ??  Ss   10:51AM   0:00.02 postgres: autovacuum launcher
jinghuihu        82276   0.0  0.0 34307820   5152   ??  Ss   10:51AM   0:00.04 postgres: walwriter
jinghuihu        82275   0.0  0.0 34307820   2212   ??  Ss   10:51AM   0:00.06 postgres: background writer
jinghuihu        82274   0.0  0.0 34307820   2788   ??  Ss   10:51AM   0:00.01 postgres: checkpointer
jinghuihu        80299   0.0  0.1 34309108  14920   ??  Ss   10:41AM   0:00.13 /opt/local/pgsql/bin/postgres -D /opt/local/pgsql/data
</pre>
</div>

<p>
找到对应的进程，然后使用 lldb attach 上，打断点
</p>
<div class="org-src-container">
<pre class="src src-text">(lldb) attach -p 82329
Process 82329 stopped
* thread #1, queue = 'com.apple.main-thread', stop reason = signal SIGSTOP
    frame #0: 0x00007ff810e892fe libsystem_kernel.dylib`kevent + 10
libsystem_kernel.dylib`kevent:
-&gt;  0x7ff810e892fe &lt;+10&gt;: jae    0x7ff810e89308            ; &lt;+20&gt;
    0x7ff810e89300 &lt;+12&gt;: movq   %rax, %rdi
    0x7ff810e89303 &lt;+15&gt;: jmp    0x7ff810e84dc2            ; cerror_nocancel
    0x7ff810e89308 &lt;+20&gt;: retq
Target 0: (postgres) stopped.
Executable module set to "/opt/local/pgsql/bin/postgres".
Architecture set to: x86_64h-apple-macosx-.
(lldb) b exec_simple_query
Breakpoint 1: where = postgres`exec_simple_query + 29 at postgres.c:994:21, address = 0x000000010f17af6d
(lldb) c
Process 82329 resuming
Process 82329 stopped
* thread #1, queue = 'com.apple.main-thread', stop reason = breakpoint 1.1
    frame #0: 0x000000010f17af6d postgres`exec_simple_query + 29 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/tcop/postgres.c:994
   991  static void
   992  exec_simple_query(const char *query_string)
   993  {
-&gt; 994      CommandDest dest = whereToSendOutput;
                               ^
   995      MemoryContext oldcontext;
   996      List           *parsetree_list;
   997      ListCell   *parsetree_item;
Target 0: (postgres) stopped.
(lldb)  bt
* thread #1, queue = 'com.apple.main-thread', stop reason = breakpoint 1.1
  * frame #0: 0x000000010f17af6d postgres`exec_simple_query + 29 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/tcop/postgres.c:994
    frame #1: 0x000000010f17a633 postgres`PostgresMain + 2243 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/tcop/postgres.c:4593
    frame #2: 0x000000010f08d0d2 postgres`BackendRun + 50 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/postmaster/postmaster.c:4511
    frame #3: 0x000000010f08c6bc postgres`BackendStartup + 524 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/postmaster/postmaster.c:4239
    frame #4: 0x000000010f08b4ec postgres`ServerLoop + 716 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/postmaster/postmaster.c:1806
    frame #5: 0x000000010f088dc7 postgres`PostmasterMain + 6471 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/postmaster/postmaster.c:1478
    frame #6: 0x000000010ef6eda0 postgres`main + 816 at /Users/jinghuihu/code/jeanhwea/postgres/src/backend/main/main.c:202
    frame #7: 0x00007ff810b92310 dyld`start + 2432
(lldb) c
Process 82329 resuming
(lldb) detach
Process 82329 detached
(lldb)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org877e6fa" class="outline-3">
<h3 id="org877e6fa"><span class="section-number-3">4.4.</span> ClickHouse</h3>
<div class="outline-text-3" id="text-4-4">
</div>
<div id="outline-container-org9a1ba0e" class="outline-4">
<h4 id="org9a1ba0e"><span class="section-number-4">4.4.1.</span> 安装步骤</h4>
<div class="outline-text-4" id="text-4-4-1">
<ol class="org-ol">
<li>官方文档 <a href="https://clickhouse.com/docs/en/install">doc</a></li>
</ol>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">https://clickhouse.com/docs/en/development/build-osx</span>
cmake -G Ninja -DCMAKE_BUILD_TYPE=RelWithDebInfo -S . -B build
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd05430e" class="outline-3">
<h3 id="orgd05430e"><span class="section-number-3">4.5.</span> nginx</h3>
<div class="outline-text-3" id="text-4-5">
</div>
<div id="outline-container-orga526d1b" class="outline-4">
<h4 id="orga526d1b"><span class="section-number-4">4.5.1.</span> 文件配置</h4>
<div class="outline-text-4" id="text-4-5-1">
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #ECBE7B;">location /api</span> {
  client_max_body_size 30000M;
  client_body_buffer_size 200000k;
  proxy_pass  http://api/supercap/pipe;
  client_body_temp_path /media/ss/synology_office/server_Seq-Cap/tmp_nginx;
}
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org4308766" class="outline-2">
<h2 id="org4308766"><span class="section-number-2">5.</span> 系统运维</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org4c51e36" class="outline-3">
<h3 id="org4c51e36"><span class="section-number-3">5.1.</span> Docker</h3>
<div class="outline-text-3" id="text-5-1">
</div>
<div id="outline-container-org8fe89a4" class="outline-4">
<h4 id="org8fe89a4"><span class="section-number-4">5.1.1.</span> Docker 安装过程</h4>
<div class="outline-text-4" id="text-5-1-1">
<p>
安装参考链接 <a href="https://docs.docker.com/engine/install/centos/#install-using-the-repository">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">yum install -y yum-utils
yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo

yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb0b6d4a" class="outline-4">
<h4 id="orgb0b6d4a"><span class="section-number-4">5.1.2.</span> Engine 配置</h4>
<div class="outline-text-4" id="text-5-1-2">
<p>
安装文档 <a href="https://docs.docker.com/engine/install/ubuntu/">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">vim /etc/docker/daemon.json
systemctl restart docker
</pre>
</div>

<p>
daemon.json 配置
</p>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #8d5649;">{</span>
  <span style="color: #51afef;">"insecure-registries"</span>: <span style="color: #d8241f;">[</span>
    <span style="color: #99bb66;">"gitana.jeanhwea.io:5000"</span>
  <span style="color: #d8241f;">]</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9a44386" class="outline-4">
<h4 id="org9a44386"><span class="section-number-4">5.1.3.</span> 国内镜像</h4>
<div class="outline-text-4" id="text-5-1-3">
<p>
daemon.json 配置
</p>
<div class="org-src-container">
<pre class="src src-json"><span style="color: #8d5649;">{</span>
  <span style="color: #51afef;">"registry-mirrors"</span>: <span style="color: #d8241f;">[</span>
    <span style="color: #99bb66;">"https://registry.docker-cn.com"</span>,
    <span style="color: #99bb66;">"https://docker.mirrors.ustc.edu.cn"</span>,
    <span style="color: #99bb66;">"http://hub-mirror.c.163.com"</span>
  <span style="color: #d8241f;">]</span>
<span style="color: #8d5649;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8763d14" class="outline-4">
<h4 id="org8763d14"><span class="section-number-4">5.1.4.</span> 配置代理</h4>
<div class="outline-text-4" id="text-5-1-4">
<p>
docker proxy <a href="https://docs.docker.com/network/proxy/">link</a>
</p>

<p>
设置客户端代理 ~/.docker/config.json
</p>
<div class="org-src-container">
<pre class="src src-conf">{
 <span style="color: #99bb66;">"proxies"</span>: {
   <span style="color: #99bb66;">"default"</span>: {
     <span style="color: #99bb66;">"httpProxy"</span>: <span style="color: #99bb66;">"http://proxy.example.com:3128"</span>,
     <span style="color: #99bb66;">"httpsProxy"</span>: <span style="color: #99bb66;">"https://proxy.example.com:3129"</span>,
     <span style="color: #99bb66;">"noProxy"</span>: <span style="color: #99bb66;">"*.test.example.com,.example.org,127.0.0.0/8"</span>
   }
 }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0824e17" class="outline-3">
<h3 id="org0824e17"><span class="section-number-3">5.2.</span> Kubernetes</h3>
<div class="outline-text-3" id="text-5-2">
</div>
<div id="outline-container-orgac9f135" class="outline-4">
<h4 id="orgac9f135"><span class="section-number-4">5.2.1.</span> minikube</h4>
<div class="outline-text-4" id="text-5-2-1">
<ol class="org-ol">
<li><a href="https://minikube.sigs.k8s.io/docs/">文档中心</a></li>
</ol>
<p>
配置
</p>
<div class="org-src-container">
<pre class="src src-sh">brew install minikube
minikube start
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">minikube dashboard
</pre>
</div>
</div>
</div>
<div id="outline-container-orga33cf2b" class="outline-4">
<h4 id="orga33cf2b"><span class="section-number-4">5.2.2.</span> kubeadm</h4>
<div class="outline-text-4" id="text-5-2-2">
<p>
系统安装
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#21019;&#24314; master &#38598;&#32676;</span>
kubeadm init --apiserver-advertise-address=192.168.0.210 <span style="color: #99bb66;">\</span>
        --pod-network-cidr=10.244.0.0/16 <span style="color: #99bb66;">\</span>
        --kubernetes-version 1.27.2 <span style="color: #99bb66;">\</span>
        --image-repository registry.aliyuncs.com/google_containers

<span style="color: #525252;"># </span><span style="color: #525252;">&#36935;&#21040;&#38169;&#35823;&#37325;&#32622;</span>
kubeadm reset
</pre>
</div>

<p>
查看使用到的镜像
</p>
<div class="org-src-container">
<pre class="src src-sh">kubeadm config images list
kubeadm config images pull --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers
kubeadm config images pull --image-repository registry.aliyuncs.com/google_containers
</pre>
</div>

<p>
新增 node 节点
</p>
<div class="org-src-container">
<pre class="src src-sh">kubeadm token create --print-join-command
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe90fc5" class="outline-4">
<h4 id="orgbe90fc5"><span class="section-number-4">5.2.3.</span> kubectl</h4>
<div class="outline-text-4" id="text-5-2-3">
</div>
<ol class="org-ol">
<li><a id="org103a29e"></a>快速开始<br />
<div class="outline-text-5" id="text-5-2-3-1">
<p>
快速启动一个测试服务
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#21019;&#24314;&#37096;&#32626;</span>
kubectl create deployment sayhello --image=jeanhwea/sayhello:v1.0.0
kubectl create deployment sayhello --image=jeanhwea/sayhello:v1.0.0 -r 4

<span style="color: #525252;"># </span><span style="color: #525252;">&#36890;&#36807; NodePort &#26292;&#38706;&#26381;&#21153;</span>
kubectl expose deployment sayhello --port=80 --type=NodePort

<span style="color: #525252;"># </span><span style="color: #525252;">&#21160;&#24577;&#25193;&#23481;</span>
kubectl scale  deployment sayhello --replicas=4
</pre>
</div>

<p>
获取启动的 Service
</p>
<div class="org-src-container">
<pre class="src src-sh">kubectl get svc
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#30331;&#24405;&#21040; minikube shell</span>
minikube ssh
<span style="color: #525252;"># </span><span style="color: #525252;">&#22312; NameNode &#20013;&#33719;&#21462;&#39029;&#38754;</span>
curl http://0.0.0.0:31151
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">Service &#23545;&#35937;&#30340;&#22495;&#21517;&#23436;&#20840;&#24418;&#24335;&#26159; "&#23545;&#35937;.&#21517;&#23383;&#31354;&#38388;.svc.cluster.local"</span>
wget -qO- sayhello.default.svc.cluster.local
</pre>
</div>
</div>
</li>
<li><a id="org493d86e"></a>配置 DashBoard<br />
<div class="outline-text-5" id="text-5-2-3-2">
<div class="org-src-container">
<pre class="src src-sh">wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml
<span style="color: #525252;"># </span><span style="color: #525252;">&#23433;&#35013; dashboard</span>
kubectl apply -f recommended.yaml
<span style="color: #525252;"># </span><span style="color: #525252;">&#21368;&#36733; dashboard</span>
kubectl delete -f recommended.yaml
kubectl get pods,svc -n kubernetes-dashboard
</pre>
</div>
</div>
</li>

<li><a id="orgee97087"></a>查看 Pod<br />
<div class="outline-text-5" id="text-5-2-3-3">
<div class="org-src-container">
<pre class="src src-sh">kubectl get pods -A
<span style="color: #525252;"># </span><span style="color: #525252;">&#30331;&#24405;&#21040; pod &#19978;&#25490;&#26597;&#38382;&#39064;</span>
kubectl exec -it sayhello-847d5df547-4bk9z -- /bin/bash
</pre>
</div>
</div>
</li>

<li><a id="org8b895db"></a>创建 Job<br />
<div class="outline-text-5" id="text-5-2-3-4">
<p>
获取一个基础的 yaml
</p>
<div class="org-src-container">
<pre class="src src-sh">kubectl create job echo-job --image=busybox --dry-run=client -o yaml
</pre>
</div>

<p>
修改得到配置
</p>
<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #dcaeea;">apiVersion</span>: batch/v1
<span style="color: #dcaeea;">kind</span>: Job
<span style="color: #dcaeea;">metadata</span>:
  <span style="color: #dcaeea;">name</span>: echo-job

<span style="color: #dcaeea;">spec</span>:
  <span style="color: #dcaeea;">template</span>:
   <span style="color: #dcaeea;">spec</span>:
      <span style="color: #dcaeea;">restartPolicy</span>: OnFailure
      <span style="color: #dcaeea;">containers</span>:
      - <span style="color: #dcaeea;">image</span>: busybox
        <span style="color: #dcaeea;">name</span>: echo-job
        <span style="color: #dcaeea;">imagePullPolicy</span>: IfNotPresent
        <span style="color: #dcaeea;">command</span>: [<span style="color: #99bb66;">"/bin/echo"</span>]
        <span style="color: #dcaeea;">args</span>: [<span style="color: #99bb66;">"hello"</span>, <span style="color: #99bb66;">"world"</span>]
</pre>
</div>
</div>
</li>

<li><a id="org4f30057"></a>配置 ConfigMap<br />
<div class="outline-text-5" id="text-5-2-3-5">
<div class="org-src-container">
<pre class="src src-sh">kubectl get cm
kubectl describe cm config01
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-org9a8bf1d" class="outline-4">
<h4 id="org9a8bf1d"><span class="section-number-4">5.2.4.</span> 包管理工具 helm</h4>
<div class="outline-text-4" id="text-5-2-4">
<ol class="org-ol">
<li><p>
k8s 包管理器: helm <a href="https://helm.sh/">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update
helm install bitnami/mysql --generate-name
helm show all bitnami/mysql
helm list
helm uninstall mysql-1686374196
</pre>
</div></li>
</ol>
</div>
</div>
</div>

<div id="outline-container-orgaab1999" class="outline-3">
<h3 id="orgaab1999"><span class="section-number-3">5.3.</span> 磁盘管理</h3>
<div class="outline-text-3" id="text-5-3">
</div>
<div id="outline-container-orga84942a" class="outline-4">
<h4 id="orga84942a"><span class="section-number-4">5.3.1.</span> 启动盘制作</h4>
<div class="outline-text-4" id="text-5-3-1">
<ol class="org-ol">
<li>启动盘制作工具 rufus <a href="https://rufus.ie/zh/">link</a> | <a href="https://github.com/pbatard/rufus">code</a></li>
<li>光盘提取工具 InfraRecorder <a href="http://infrarecorder.org/">link</a> | <a href="https://github.com/kindahl/infrarecorder">code</a></li>
</ol>
</div>
</div>
<div id="outline-container-org31668fa" class="outline-4">
<h4 id="org31668fa"><span class="section-number-4">5.3.2.</span> Ubuntu 磁盘分区扩容</h4>
<div class="outline-text-4" id="text-5-3-2">
<p>
使用 parted, resize2fs 命令行工具进行操作
</p>
<div class="org-src-container">
<pre class="src src-sh">root@ubuntu201:/home/ubuntu# parted
GNU Parted 3.4
Using /dev/sda
Welcome to GNU Parted! Type <span style="color: #99bb66;">'help'</span> to view a list of commands.
(parted) <span style="color: #c678dd;">print</span>                 <span style="color: #525252;"># </span><span style="color: #525252;">==&gt; &#26597;&#30475;&#24403;&#21069;&#30913;&#30424;&#20998;&#21306;&#20449;&#24687;</span>
Model: VMware Virtual disk (scsi)
Disk /dev/sda: 215GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system  Name  Flags
 1      1049kB  2097kB  1049kB                     bios_grub
 2      2097kB  53.7GB  53.7GB  ext4

(parted) resizepart            <span style="color: #525252;"># </span><span style="color: #525252;">==&gt; &#25193;&#23481;&#20998;&#21306; 2</span>
Partition number? 2
Warning: Partition /dev/sda2 is being used. Are you sure you want to continue?
Yes/No? Yes
End?  [53.7GB]? 215GB          <span style="color: #525252;"># </span><span style="color: #525252;">==&gt; &#36825;&#37324;&#25193;&#23481;&#21040;&#26368;&#22823;&#21487;&#35265;&#20998;&#21306;</span>
(parted) <span style="color: #c678dd;">print</span>                 <span style="color: #525252;"># </span><span style="color: #525252;">==&gt; &#25193;&#23481;&#21518;&#30340;&#20998;&#21306; 2 &#21464;&#25104; 215G</span>
Model: VMware Virtual disk (scsi)
Disk /dev/sda: 215GB
Sector size (logical/physical): 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system  Name  Flags
 1      1049kB  2097kB  1049kB                     bios_grub
 2      2097kB  215GB   215GB   ext4

(parted)

Information: You may need to update /etc/fstab.

root@ubuntu201:/home/ubuntu# df -h <span style="color: #525252;"># </span><span style="color: #525252;">==&gt; &#25991;&#20214;&#31995;&#32479;&#24182;&#26410;&#25193;&#23481;</span>
Filesystem      Size  Used Avail Use% Mounted on
tmpfs           1.6G  1.2M  1.6G   1% /run
/dev/sda2        49G   44G  3.1G  94% /
tmpfs           7.8G     0  7.8G   0% /dev/shm
tmpfs           5.0M     0  5.0M   0% /run/lock
tmpfs           1.6G  4.0K  1.6G   1% /run/user/1000
root@ubuntu201:/home/ubuntu# resize2fs /dev/sda2 <span style="color: #525252;"># </span><span style="color: #525252;">==&gt; &#35843;&#25972;&#25991;&#20214;&#31995;&#32479;&#22823;&#23567;</span>
resize2fs 1.46.5 (30-Dec-2021)
Filesystem at /dev/sda2 is mounted on /; on-line resizing required
<span style="color: #dcaeea;">old_desc_blocks</span> = 7, <span style="color: #dcaeea;">new_desc_blocks</span> = 25
The filesystem on /dev/sda2 is now 52428283 (4k) blocks long.

root@ubuntu201:/home/ubuntu# df -h
Filesystem      Size  Used Avail Use% Mounted on
tmpfs           1.6G  1.2M  1.6G   1% /run
/dev/sda2       197G   44G  145G  24% /
tmpfs           7.8G     0  7.8G   0% /dev/shm
tmpfs           5.0M     0  5.0M   0% /run/lock
tmpfs           1.6G  4.0K  1.6G   1% /run/user/1000
root@ubuntu201:/home/ubuntu# reboot
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgdd1f90c" class="outline-3">
<h3 id="orgdd1f90c"><span class="section-number-3">5.4.</span> 压缩/解压</h3>
<div class="outline-text-3" id="text-5-4">
<p>
解压
</p>
<div class="org-src-container">
<pre class="src src-sh">tar xjvf node-v18.16.1-linux-x64.tar.bz2
tar xzvf node-v18.16.1-linux-x64.tar.gz
tar xJvf node-v18.16.1-linux-x64.tar.xz
gzip -d app.log.2023-07-07.0.gz
</pre>
</div>

<p>
压缩
</p>
<div class="org-src-container">
<pre class="src src-sh">tar czvf pack.tar.gz pack
gzip app.log.2023-07-07.0
</pre>
</div>
</div>
</div>
<div id="outline-container-org012880a" class="outline-3">
<h3 id="org012880a"><span class="section-number-3">5.5.</span> Prometheus</h3>
<div class="outline-text-3" id="text-5-5">
<p>
<a href="https://prometheus.io/docs/introduction/overview/">link</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org811836f" class="outline-2">
<h2 id="org811836f"><span class="section-number-2">6.</span> 前端研发</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org9c77ecb" class="outline-3">
<h3 id="org9c77ecb"><span class="section-number-3">6.1.</span> Node</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">
<pre class="src src-sh">sudo apt install nodejs npm
mkdir ~/.local/node_modules
npm config set prefix <span style="color: #99bb66;">'~/.local/node_modules'</span>
</pre>
</div>

<p>
使用 nvm 管理 node
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">PATH</span>=$<span style="color: #dcaeea;">HOME</span>/.local/node_modules/bin:$<span style="color: #dcaeea;">PATH</span>
npm i -g nvm
nvm install node
<span style="color: #525252;"># </span><span style="color: #525252;">-s &#28304;&#30721;&#32534;&#35793;</span>
nvm install -s node
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb6836cb" class="outline-3">
<h3 id="orgb6836cb"><span class="section-number-3">6.2.</span> Node Windows 配置</h3>
<div class="outline-text-3" id="text-6-2">
<ul class="org-ul">
<li>安装 node-v14.21.3-x64.msi <a href="https://npmmirror.com/mirrors/node/">link</a></li>
<li><p>
配置环境变量
</p>
<div class="org-src-container">
<pre class="src src-sh">npm config set prefix <span style="color: #99bb66;">"X:\Program Files\nodejs\node_global"</span>
npm config set cache  <span style="color: #99bb66;">"X:\Program Files\nodejs\node_cache"</span>
</pre>
</div></li>
<li><p>
安装 yarn
</p>
<div class="org-src-container">
<pre class="src src-sh">npm i -g yarn
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org502d024" class="outline-3">
<h3 id="org502d024"><span class="section-number-3">6.3.</span> 国内镜像</h3>
<div class="outline-text-3" id="text-6-3">
<p>
配置 taobao 镜像
</p>
<ul class="org-ul">
<li>旧版 <a href="https://registry.npm.taobao.org">https://registry.npm.taobao.org</a></li>
<li>新版 <a href="http://registry.npmmirror.com">http://registry.npmmirror.com</a></li>
<li>NPM MIRROR 镜像站 <a href="https://npmmirror.com/">link</a></li>
</ul>
<div class="org-src-container">
<pre class="src src-shell">npm config set registry http://registry.npmmirror.com
yarn config set registry http://registry.npmmirror.com
</pre>
</div>

<p>
设置 electron 地址
</p>
<div class="org-src-container">
<pre class="src src-sh">yarn config set <span style="color: #dcaeea;">electron_mirror</span>=https://npm.taobao.org/mirrors/electron/
yarn config set <span style="color: #dcaeea;">electron_builder_binaries_mirror</span>=https://npm.taobao.org/mirrors/electron-builder-binaries/
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">yarn config set electron_mirror https://mirrors.huaweicloud.com/electron/
yarn config set electron_builder_binaries_mirror https://mirrors.huaweicloud.com/electron-builder-binaries/
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb78344a" class="outline-3">
<h3 id="orgb78344a"><span class="section-number-3">6.4.</span> UI 库</h3>
<div class="outline-text-3" id="text-6-4">
<ol class="org-ol">
<li><p>
<a href="https://pro.ant.design/zh-CN/docs/getting-started/">Ant Design Pro</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">npm i @ant-design/pro-cli -g
pro create myapp
</pre>
</div></li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org7e0c915" class="outline-2">
<h2 id="org7e0c915"><span class="section-number-2">7.</span> 日常使用</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org3c39661" class="outline-3">
<h3 id="org3c39661"><span class="section-number-3">7.1.</span> 使用体验</h3>
<div class="outline-text-3" id="text-7-1">
</div>
<div id="outline-container-orgd39a170" class="outline-4">
<h4 id="orgd39a170"><span class="section-number-4">7.1.1.</span> Esc 键有延迟</h4>
<div class="outline-text-4" id="text-7-1-1">
<p>
问题说明 <a href="https://www.johnhawthorn.com/2012/09/vi-escape-delays/">Eliminating delays on ESC in vim and zsh</a>
尝试按照以下思路解决这个问题
vim
</p>
<div class="org-src-container">
<pre class="src src-text">set timeoutlen=1000 ttimeoutlen=0
</pre>
</div>
<p>
zsh
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">10ms for key sequences</span>
<span style="color: #dcaeea;">KEYTIMEOUT</span>=1
</pre>
</div>
<p>
tmux
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">.tmux.conf</span>
<span style="color: #c678dd;">set</span> -s escape-time 0
<span style="color: #c678dd;">echo</span> <span style="color: #99bb66;">'set -s escape-time 0'</span> &gt;&gt; ~/.tmux.conf
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgedbd96f" class="outline-3">
<h3 id="orgedbd96f"><span class="section-number-3">7.2.</span> WSL</h3>
<div class="outline-text-3" id="text-7-2">
</div>
<div id="outline-container-org592ad6b" class="outline-4">
<h4 id="org592ad6b"><span class="section-number-4">7.2.1.</span> Ubuntu 安装并迁移到其他盘</h4>
<div class="outline-text-4" id="text-7-2-1">
<ol class="org-ol">
<li>安装说明 <a href="https://learn.microsoft.com/zh-cn/windows/wsl/install-manual">link</a></li>
<li><p>
移动数据文件到非系统盘
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#26597;&#30475;&#24403;&#21069;&#30340; wsl &#23481;&#22120;</span>
wsl -l -v

wsl --export Ubuntu ubuntu2204.tar
wsl --unregister Ubuntu

mkdir data
wsl --import Ubuntu-22.04 data ubuntu2204.tar
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-org86b6f14" class="outline-4">
<h4 id="org86b6f14"><span class="section-number-4">7.2.2.</span> Docker 无法启动</h4>
<div class="outline-text-4" id="text-7-2-2">
<p>
/usr/sbin/iptables-nft 网络管理 WSL2 不支持，需要修改一下
</p>
<div class="org-src-container">
<pre class="src src-sh">$ sudo update-alternatives --config iptables
There are 2 choices for the alternative iptables (providing /usr/sbin/iptables).

  Selection    Path                       Priority   Status
------------------------------------------------------------
* 0            /usr/sbin/iptables-nft      20        auto mode
  1            /usr/sbin/iptables-legacy   10        manual mode
  2            /usr/sbin/iptables-nft      20        manual mode

Press &lt;enter&gt; to keep the current choice[*], or type selection number: 1
update-alternatives: using /usr/sbin/iptables-legacy to provide /usr/sbin/iptables (iptables) <span style="color: #51afef;">in</span> manual mode
$ sudo service docker start
 * Starting Docker: docker                                                                                                                                            [ OK ]
$ docker ps
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</pre>
</div>
</div>
</div>
<div id="outline-container-org205620c" class="outline-4">
<h4 id="org205620c"><span class="section-number-4">7.2.3.</span> 缺失字体</h4>
<div class="outline-text-4" id="text-7-2-3">
<p>
默认添加 Windows 自带的字体来显示缺失字体
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo ln -s /mnt/c/Windows/Fonts /usr/share/fonts/host
fc-cache -fv
</pre>
</div>
</div>
</div>

<div id="outline-container-org32c7fce" class="outline-4">
<h4 id="org32c7fce"><span class="section-number-4">7.2.4.</span> 挂载共享服务器</h4>
<div class="outline-text-4" id="text-7-2-4">
<div class="org-src-container">
<pre class="src src-sh">sudo mount -t drvfs <span style="color: #99bb66;">'\\192.168.0.201\&#24320;&#21457;&#26381;&#21153;&#22120;&#20849;&#20139;'</span> /mnt/share
</pre>
</div>
</div>
</div>
<div id="outline-container-org669fb4a" class="outline-4">
<h4 id="org669fb4a"><span class="section-number-4">7.2.5.</span> 解决提示符错误</h4>
<div class="outline-text-4" id="text-7-2-5">
<p>
Windows Terminal 在安装 zsh-autosuggestions 时会显示的有问题，这里修改一下 <code>PS1</code>
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #dcaeea;">ZSH_THEME</span>=<span style="color: #99bb66;">"none"</span>
<span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">PS1</span>=<span style="color: #99bb66;">'WSL(%3~)%# '</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orga2b1d63" class="outline-4">
<h4 id="orga2b1d63"><span class="section-number-4">7.2.6.</span> 下载 firefox</h4>
<div class="outline-text-4" id="text-7-2-6">
<p>
删除 snap 组件
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo snap remove firefox
sudo apt remove firefox
sudo add-apt-repository ppa:mozillateam/ppa
</pre>
</div>

<p>
配置下载 firefox 的配置
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">Create a new file, it should be empty as it opens:</span>
sudo vi /etc/apt/preferences.d/mozillateamppa

<span style="color: #525252;"># </span><span style="color: #525252;">Insert these lines, then save and exit</span>
Package: firefox*
Pin: release <span style="color: #dcaeea;">o</span>=LP-PPA-mozillateam
Pin-Priority: 501
</pre>
</div>

<p>
下载 firefox
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo apt update
sudo apt install firefox <span style="color: #525252;"># </span><span style="color: #525252;">or firefox-esr</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9f16ab0" class="outline-3">
<h3 id="org9f16ab0"><span class="section-number-3">7.3.</span> CentOS</h3>
<div class="outline-text-3" id="text-7-3">
</div>
<div id="outline-container-orgff960b1" class="outline-4">
<h4 id="orgff960b1"><span class="section-number-4">7.3.1.</span> SCL (Software Collection)</h4>
<div class="outline-text-4" id="text-7-3-1">
<p>
SCL 提供一下较新的工具集 <a href="https://wiki.centos.org/AdditionalResources/Repositories/SCL">link</a>
</p>
<div class="org-src-container">
<pre class="src src-sql">yum install centos-release-scl

yum makecache
yum repolist
</pre>
</div>
</div>
</div>

<div id="outline-container-org6fdb77b" class="outline-4">
<h4 id="org6fdb77b"><span class="section-number-4">7.3.2.</span> Red Hat Developer Toolset</h4>
<div class="outline-text-4" id="text-7-3-2">
<ol class="org-ol">
<li><p>
使用手册 <a href="https://access.redhat.com/documentation/en-us/red_hat_developer_toolset/11/html-single/user_guide/index#doc-wrapper">User Guide</a>
</p>
<div class="org-src-container">
<pre class="src src-sh">yum install scl-utils centos-release-scl

yum list all --enablerepo=<span style="color: #99bb66;">'centos-sclo-rh'</span> | grep <span style="color: #99bb66;">"devtoolset"</span>
yum install devtoolset-11-toolchain
</pre>
</div></li>
<li><p>
配置并启用 scl 工具集
</p>
<div class="org-src-container">
<pre class="src src-sh">scl --list
scl enable devtoolset-11 bash
</pre>
</div></li>
</ol>
</div>
</div>

<div id="outline-container-org6c05799" class="outline-4">
<h4 id="org6c05799"><span class="section-number-4">7.3.3.</span> yum 代理</h4>
<div class="outline-text-4" id="text-7-3-3">
<p>
在配置文件中直接添加代理到对应发服务器中
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #525252;"># </span><span style="color: #525252;">/etc/yum.conf</span>
[<span style="color: #ECBE7B;">main</span>]
<span style="color: #dcaeea;">proxy</span>=http://192.168.0.100:3128
</pre>
</div>
</div>
</div>

<div id="outline-container-org137115b" class="outline-4">
<h4 id="org137115b"><span class="section-number-4">7.3.4.</span> nodejs</h4>
<div class="outline-text-4" id="text-7-3-4">
<p>
centos 7 中编译安装 nodejs
</p>
<div class="org-src-container">
<pre class="src src-sh">wget -c https://registry.npmmirror.com/-/binary/node/v18.17.1/node-v18.17.1.tar.gz

tar xzvf ~/down/node-v18.17.1.tar.gz

scl enable devtoolset-11 bash

<span style="color: #c678dd;">cd</span> node-v18.17.1
<span style="color: #dcaeea;">PREFIX</span>=/opt/node ./configure
make -j4
sudo make install
</pre>
</div>
</div>
</div>

<div id="outline-container-org609c95e" class="outline-4">
<h4 id="org609c95e"><span class="section-number-4">7.3.5.</span> 编译安装 openssl</h4>
<div class="outline-text-4" id="text-7-3-5">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">&#32534;&#35793;&#23433;&#35013;</span>
wget -c https://www.openssl.org/source/openssl-1.1.1w.tar.gz
tar xzvf ~/down/openssl-1.1.1w.tar.gz
<span style="color: #c678dd;">cd</span> openssl-1.1.1w/
./config --prefix=/usr/local/openssl --openssldir=/usr/local/openssl
make
sudo make install

<span style="color: #525252;"># </span><span style="color: #525252;">&#37197;&#32622; ldconfig</span>
sudo echo <span style="color: #99bb66;">"/usr/local/openssl/lib"</span> &gt; /etc/ld.so.conf.d/openssl.conf
sudo ldconfig
</pre>
</div>

<p>
配置环境变量
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">PATH</span>=/usr/local/openssl/bin:$<span style="color: #dcaeea;">PATH</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc71309b" class="outline-4">
<h4 id="orgc71309b"><span class="section-number-4">7.3.6.</span> 代理服务器 squid</h4>
<div class="outline-text-4" id="text-7-3-6">
<p>
http proxy server
其配置文件 /etc/squid/squid.conf
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #525252;"># </span><span style="color: #525252;">Squid normally listens to port 3128</span>
http_port 3128

<span style="color: #525252;"># </span><span style="color: #525252;">Example rule allowing access from your local networks.</span>
<span style="color: #525252;"># </span><span style="color: #525252;">Adapt to list your (internal) IP networks from where browsing</span>
<span style="color: #525252;"># </span><span style="color: #525252;">should be allowed</span>
acl localnet src 10.0.0.0/8             <span style="color: #525252;"># </span><span style="color: #525252;">RFC 1918 local private network (LAN)</span>
acl localnet src 100.64.0.0/10          <span style="color: #525252;"># </span><span style="color: #525252;">RFC 6598 shared address space (CGN)</span>
acl localnet src 192.168.0.0/16         <span style="color: #525252;"># </span><span style="color: #525252;">RFC 1918 local private network (LAN)</span>
</pre>
</div>

<p>
在宿主机进行代理设置
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">proxy</span>=http://0.0.0.0:3128
<span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">http_proxy</span>=http://0.0.0.0:3128
<span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">https_proxy</span>=http://0.0.0.0:3128
</pre>
</div>
</div>
</div>

<div id="outline-container-orgccacfca" class="outline-4">
<h4 id="orgccacfca"><span class="section-number-4">7.3.7.</span> DNS Server 配置 dnsmasq</h4>
<div class="outline-text-4" id="text-7-3-7">
<p>
配置上游的 DNS 服务器
</p>
<div class="org-src-container">
<pre class="src src-conf"><span style="color: #525252;"># </span><span style="color: #525252;">/etc/dnsmasq.conf</span>
<span style="color: #dcaeea;">server</span>=/localnet/192.168.1.1
</pre>
</div>

<p>
开启服务
</p>
<div class="org-src-container">
<pre class="src src-sh">systemctl enable dnsmasq
systemctl restart dnsmasq
</pre>
</div>
</div>
</div>

<div id="outline-container-orga262aa8" class="outline-4">
<h4 id="orga262aa8"><span class="section-number-4">7.3.8.</span> NTP 时间服务器设置</h4>
<div class="outline-text-4" id="text-7-3-8">
<p>
配置自动同步时间
</p>
<div class="org-src-container">
<pre class="src src-sh">timedatectl set-timezone <span style="color: #99bb66;">'Asia/Shanghai'</span>
timedatectl set-ntp yes

timedatectl
<span style="color: #525252;"># </span><span style="color: #525252;">ntpq -p</span>
</pre>
</div>

<p>
离线手工同步时间
</p>
<div class="org-src-container">
<pre class="src src-sh">timedatectl set-ntp no
timedatectl set-time <span style="color: #99bb66;">'08:12:21'</span>

hwclock -w
</pre>
</div>
</div>
</div>

<div id="outline-container-org50a51f4" class="outline-4">
<h4 id="org50a51f4"><span class="section-number-4">7.3.9.</span> 硬件时钟 hwclock</h4>
<div class="outline-text-4" id="text-7-3-9">
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #525252;"># </span><span style="color: #525252;">Display hwclock</span>
hwclock --show

<span style="color: #525252;"># </span><span style="color: #525252;">Sync hwclock to system</span>
hwclock --hctosys

<span style="color: #525252;"># </span><span style="color: #525252;">Save clock, for reboot</span>
clock -w
hwclock -w
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdb35cc4" class="outline-4">
<h4 id="orgdb35cc4"><span class="section-number-4">7.3.10.</span> 安装中文字体</h4>
<div class="outline-text-4" id="text-7-3-10">
<p>
修改配置文件
</p>
<div class="org-src-container">
<pre class="src src-sh">vim /etc/fonts/fonts.conf
</pre>
</div>

<p>
添加字体文件目录配置
</p>
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #525252;">&lt;!-- </span><span style="color: #525252;">Font directory list</span><span style="color: #525252;"> --&gt;</span>

        &lt;<span style="color: #c678dd;">dir</span>&gt;/usr/share/fonts&lt;/<span style="color: #c678dd;">dir</span>&gt;
        &lt;<span style="color: #c678dd;">dir</span>&gt;/usr/share/fonts/Fonts/&lt;/<span style="color: #c678dd;">dir</span>&gt;
        &lt;<span style="color: #c678dd;">dir</span>&gt;/usr/share/X11/fonts/Type1&lt;/<span style="color: #c678dd;">dir</span>&gt;
        &lt;<span style="color: #c678dd;">dir</span>&gt;/usr/share/X11/fonts/TTF&lt;/<span style="color: #c678dd;">dir</span>&gt;
        &lt;<span style="color: #c678dd;">dir</span>&gt;/usr/local/share/fonts&lt;/<span style="color: #c678dd;">dir</span>&gt;
        &lt;<span style="color: #c678dd;">dir</span> <span style="color: #dcaeea;">prefix</span>=<span style="color: #99bb66;">"xdg"</span>&gt;fonts&lt;/<span style="color: #c678dd;">dir</span>&gt;
        <span style="color: #525252;">&lt;!-- </span><span style="color: #525252;">the following element will be removed in the future</span><span style="color: #525252;"> --&gt;</span>
        &lt;<span style="color: #c678dd;">dir</span>&gt;~/.fonts&lt;/<span style="color: #c678dd;">dir</span>&gt;
</pre>
</div>

<p>
使用命令刷新字体缓存
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">cd</span> /usr/share/fonts
tar xzvf fonts.tar.gz
fc-cache -fv
<span style="color: #525252;"># </span><span style="color: #525252;">&#26597;&#30475;&#20013;&#25991;&#23383;&#20307;</span>
fc-list :<span style="color: #dcaeea;">lang</span>=zh
</pre>
</div>

<p>
如果发现找不到字体配置文件，需要手工添加环境变量
Fontconfig error: Cannot load default config file
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">FONTCONFIG_PATH</span>=/etc/fonts
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3c81fd7" class="outline-3">
<h3 id="org3c81fd7"><span class="section-number-3">7.4.</span> Manjaro</h3>
</div>
<div id="outline-container-orgb199fd6" class="outline-3">
<h3 id="orgb199fd6"><span class="section-number-3">7.5.</span> Emacs</h3>
<div class="outline-text-3" id="text-7-5">
</div>
<div id="outline-container-orgdde174c" class="outline-4">
<h4 id="orgdde174c"><span class="section-number-4">7.5.1.</span> 参考资料</h4>
<div class="outline-text-4" id="text-7-5-1">
<ol class="org-ol">
<li>精选插件列表 <a href="https://github.com/emacs-tw/awesome-emacs">Awesome Emcas</a></li>
<li>Emacs Windows Binary <a href="http://mirrors.ustc.edu.cn/gnu/emacs/windows/">emacs-windows</a></li>
</ol>
</div>
</div>
<div id="outline-container-org774c6f3" class="outline-4">
<h4 id="org774c6f3"><span class="section-number-4">7.5.2.</span> 任务管理</h4>
<div class="outline-text-4" id="text-7-5-2">
<ol class="org-ol">
<li>表格 <a href="https://www.gnu.org/software/emacs/manual/html_mono/org.html#The-Spreadsheet">org#The Spreadsheet</a>
<ul class="org-ul">
<li>单元格公式: 输入 <code>:=</code> 后在单元格中直接编辑公式，或者 <code>C-u C-c =</code></li>
<li>列公式: 输入 <code>=</code> 后在单元格中直接编辑公式，或者 <code>C-c =</code></li>
<li>显示坐标: <code>C-c }</code></li>
</ul></li>
<li>绘图 <a href="https://www.gnu.org/software/emacs/manual/html_mono/org.html#Org-Plot">org#Org Plot</a></li>
<li>待办实现管理 <a href="https://www.gnu.org/software/emacs/manual/html_mono/org.html#TODO-dependencies">org#TODO dependencies</a></li>
<li>标签系统 <a href="https://www.gnu.org/software/emacs/manual/html_mono/org.html#Tags">org#Tags</a></li>
<li>代码管理 <a href="https://www.gnu.org/software/emacs/manual/html_mono/org.html#Working-with-Source-Code">org#Working with Source Code</a></li>
<li>buffer 设置 <a href="https://www.gnu.org/software/emacs/manual/html_mono/org.html#In_002dbuffer-Settings">org#In-buffer Settings</a>
<ul class="org-ul">
<li><p>
#+STARTUP: 启动设置
</p>
<blockquote>
</blockquote></li>
</ul></li>
</ol>
</div>
</div>
<div id="outline-container-org5c57df6" class="outline-4">
<h4 id="org5c57df6"><span class="section-number-4">7.5.3.</span> 绘图</h4>
<div class="outline-text-4" id="text-7-5-3">
</div>
<ol class="org-ol">
<li><a id="org6d84632"></a>graphviz<br />
<ol class="org-ol">
<li><a id="org099e6d9"></a>参考连接<br />
<div class="outline-text-6" id="text-7-5-3-1-1">
<ol class="org-ol">
<li>图库 <a href="http://graphviz.org/gallery/">Gallery</a></li>
<li><a href="../article/drawing-graphs-with-dot.html#MissingReference">文章</a> | 快速入门 <a href="https://www.graphviz.org/pdf/dotguide.pdf">Drawing graphs with dot</a></li>
<li>属性参考文档 <a href="http://www.graphviz.org/doc/info/attrs.html">Attrs</a></li>
</ol>
</div>
</li>
<li><a id="orgb3fbdae"></a>无向图<br />
<div class="outline-text-6" id="text-7-5-3-1-2">

<div id="orgcf77008" class="figure">
<p><img src="../static/image/2023/0201/000024.png" alt="000024.png" />
</p>
</div>
</div>
</li>

<li><a id="org7b55698"></a>有向图<br />
<div class="outline-text-6" id="text-7-5-3-1-3">

<div id="org85efaaf" class="figure">
<p><img src="../static/image/2023/0201/000219.png" alt="000219.png" />
</p>
</div>
</div>
</li>

<li><a id="orgf54a59c"></a>支持中文<br />
<div class="outline-text-6" id="text-7-5-3-1-4">

<div id="org436a912" class="figure">
<p><img src="../static/image/2023/0201/001233.png" alt="001233.png" />
</p>
</div>
</div>
</li>

<li><a id="org3c7d4e3"></a>系统交互图<br />
<div class="outline-text-6" id="text-7-5-3-1-5">

<div id="orge6cec02" class="figure">
<p><img src="../static/image/2023/0201/001954.png" alt="001954.png" />
</p>
</div>
</div>
</li>
</ol>
</li>
<li><a id="org094c0f3"></a>plantuml<br />
<div class="outline-text-5" id="text-7-5-3-2">
<ol class="org-ol">
<li><a href="http://eschulte.github.io/babel-dev/DONE-integrate-plantuml-support.html">Tutor</a> | <a href="https://orgmode.org/worg/org-contrib/babel/languages/ob-doc-plantuml.html">Official</a></li>
</ol>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgbc5f7b6" class="outline-4">
<h4 id="orgbc5f7b6"><span class="section-number-4">7.5.4.</span> 批量删除 ^M 方法</h4>
<div class="outline-text-4" id="text-7-5-4">
<pre class="example" id="org7cd18b4">
M-x replace-string RET C-q C-m RET RET
</pre>
</div>
</div>
<div id="outline-container-orged8d648" class="outline-4">
<h4 id="orged8d648"><span class="section-number-4">7.5.5.</span> tramp ssh 到远程</h4>
<div class="outline-text-4" id="text-7-5-5">
<p>
配置远端 ~/.ssh/config, 添加别名
</p>
<div class="org-src-container">
<pre class="src src-text">Host gitana
    Hostname gitana.jeanhwea.io
    Port 2222
    User admin
</pre>
</div>

<p>
或者使用如下的 scheme 来访问, <a href="https://www.gnu.org/software/emacs/manual/html_mono/tramp.html#File-name-syntax">tramp#File name syntax</a>
</p>
<pre class="example" id="org1eb1c9f">
M-x find-file /sshx:user@host#port:/path
</pre>
</div>
</div>

<div id="outline-container-orgd05c39b" class="outline-4">
<h4 id="orgd05c39b"><span class="section-number-4">7.5.6.</span> 设置文件类型</h4>
<div class="outline-text-4" id="text-7-5-6">
<div class="org-src-container">
<pre class="src src-text"># -*- mode: conf; -*-
</pre>
</div>
</div>
</div>

<div id="outline-container-org6a1308f" class="outline-4">
<h4 id="org6a1308f"><span class="section-number-4">7.5.7.</span> 设置本地文件配置</h4>
<div class="outline-text-4" id="text-7-5-7">
<p>
.dir-locals.el
</p>
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #8d5649;">(</span><span style="color: #d8241f;">(</span>java-mode . <span style="color: #9564bf;">(</span><span style="color: #24a222;">(</span>eval . <span style="color: #ff7f00;">(</span>eglot-ensure<span style="color: #ff7f00;">)</span><span style="color: #24a222;">)</span><span style="color: #9564bf;">)</span><span style="color: #d8241f;">)</span><span style="color: #8d5649;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org82ede84" class="outline-4">
<h4 id="org82ede84"><span class="section-number-4">7.5.8.</span> 编辑二进制文件</h4>
<div class="outline-text-4" id="text-7-5-8">
<pre class="example" id="org87bffe3">
M-x hexl-mode
</pre>
</div>
</div>

<div id="outline-container-org3f5dd55" class="outline-4">
<h4 id="org3f5dd55"><span class="section-number-4">7.5.9.</span> elisp 函数增强</h4>
<div class="outline-text-4" id="text-7-5-9">
<ol class="org-ol">
<li>增强 defadvice <a href="https://www.gnu.org/software/emacs/manual/html_mono/elisp.html#Advising-Functions">elisp#Advising Functions</a></li>
<li>闭包 <a href="https://www.gnu.org/software/emacs/manual/html_mono/elisp.html#Closures">elisp#Closures</a></li>
</ol>
</div>
</div>

<div id="outline-container-org1edd398" class="outline-4">
<h4 id="org1edd398"><span class="section-number-4">7.5.10.</span> 设置文件显示自动换行</h4>
<div class="outline-text-4" id="text-7-5-10">
<pre class="example" id="org9ef9514">
M-x toggle-truncate-lines
</pre>
</div>
</div>

<div id="outline-container-org1b39b9f" class="outline-4">
<h4 id="org1b39b9f"><span class="section-number-4">7.5.11.</span> libvterm 编译失败</h4>
<div class="outline-text-4" id="text-7-5-11">
<pre class="example" id="org47dedf5">
-- System libvterm not found: libvterm will be downloaded and compiled as part of the build process
CMake Error at CMakeLists.txt:71 (message):
  libtool not found.  Please install libtool


-- Configuring incomplete, errors occurred!
See also "/home/jeffrey/.emacs.d/elpa/vterm-20230417.424/build/CMakeFiles/CMakeOutput.log".
make: *** No targets specified and no makefile found.  Stop.
/home/jeffrey/.emacs.d/elpa/vterm-20230417.424
</pre>

<p>
解决方法，安装对应库
</p>
<div class="org-src-container">
<pre class="src src-sh">sudo apt install cmake libtool libtool-bin
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfde032e" class="outline-4">
<h4 id="orgfde032e"><span class="section-number-4">7.5.12.</span> profiler 启动性能分析</h4>
<div class="outline-text-4" id="text-7-5-12">
<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #525252;">;; </span><span style="color: #525252;">~/.emacs.d/init.el &#24320;&#22987;</span>
<span style="color: #8d5649;">(</span>profiler-start 'cpu<span style="color: #8d5649;">)</span>

<span style="color: #525252;">;; </span><span style="color: #525252;">~/.emacs.d/init.el &#32467;&#26463;</span>
<span style="color: #8d5649;">(</span>profiler-stop<span style="color: #8d5649;">)</span>
<span style="color: #8d5649;">(</span>profiler-report<span style="color: #8d5649;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org952a3c1" class="outline-3">
<h3 id="org952a3c1"><span class="section-number-3">7.6.</span> Linux</h3>
<div class="outline-text-3" id="text-7-6">
</div>
<div id="outline-container-org68f5279" class="outline-4">
<h4 id="org68f5279"><span class="section-number-4">7.6.1.</span> tar: time stamp XXX in the future</h4>
<div class="outline-text-4" id="text-7-6-1">
<p>
如果解压时发现待解压的机器的时间戳较慢，会出现如下报错
</p>
<pre class="example" id="orgcdc781d">
tar: ./app.jar: time stamp 2023-08-21 08:17:50 is 223.674040911 s in the future
tar: ./version: time stamp 2023-08-21 08:17:50 is 223.673692569 s in the future
</pre>

<p>
可以在 tar 命令中添加 -m 来忽略时间戳问题
</p>
<div class="org-src-container">
<pre class="src src-sh">tar xzmf file.tar.gz
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgee85f21" class="outline-3">
<h3 id="orgee85f21"><span class="section-number-3">7.7.</span> 前端</h3>
<div class="outline-text-3" id="text-7-7">
</div>
<div id="outline-container-orgc83ed5c" class="outline-4">
<h4 id="orgc83ed5c"><span class="section-number-4">7.7.1.</span> digital envelope routines::unsupported</h4>
<div class="outline-text-4" id="text-7-7-1">
<p>
OpenSSL3.0 对允许算法和密钥大小增加了严格的限制，可能会对生态系统造成一些影响
</p>
<div class="org-src-container">
<pre class="src src-text">node:internal/crypto/hash:67
  this[kHandle] = new _Hash(algorithm, xofLen);
                  ^

Error: error:0308010C:digital envelope routines::unsupported
    at new Hash (node:internal/crypto/hash:67:19)
    at Object.createHash (node:crypto:130:10)
</pre>
</div>

<p>
解决方法
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #c678dd;">export</span> <span style="color: #dcaeea;">NODE_OPTIONS</span>=--openssl-legacy-provider
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge90b7ed" class="outline-3">
<h3 id="orge90b7ed"><span class="section-number-3">7.8.</span> 后端</h3>
<div class="outline-text-3" id="text-7-8">
</div>
<div id="outline-container-orgbe99835" class="outline-4">
<h4 id="orgbe99835"><span class="section-number-4">7.8.1.</span> RuntimeError: 'cryptography' package is required for sha256<sub>password</sub> or caching<sub>sha2</sub><sub>password</sub> auth methods</h4>
<div class="outline-text-4" id="text-7-8-1">
<pre class="example" id="org6777997">
  File "/usr/local/lib/python3.11/site-packages/pymysql/_auth.py", line 143, in sha2_rsa_encrypt
    raise RuntimeError(
RuntimeError: 'cryptography' package is required for sha256_password or caching_sha2_password auth methods
</pre>

<p>
缺少 cryptography 包，安装一下
</p>
<div class="org-src-container">
<pre class="src src-sh">pip install cryptography
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org41469d2" class="outline-3">
<h3 id="org41469d2"><span class="section-number-3">7.9.</span> 科学上网</h3>
<div class="outline-text-3" id="text-7-9">
</div>
<div id="outline-container-orga707d56" class="outline-4">
<h4 id="orga707d56"><span class="section-number-4">7.9.1.</span> githubusercontent 链接失败</h4>
<div class="outline-text-4" id="text-7-9-1">
<p>
/etc/hosts
</p>
<div class="org-src-container">
<pre class="src src-sh">185.199.108.133 raw.githubusercontent.com
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org02dcf04" class="outline-3">
<h3 id="org02dcf04"><span class="section-number-3">7.10.</span> MySQL</h3>
<div class="outline-text-3" id="text-7-10">
</div>
<div id="outline-container-orgfb5b29c" class="outline-4">
<h4 id="orgfb5b29c"><span class="section-number-4">7.10.1.</span> Public Key Retrieval is not allowed</h4>
<div class="outline-text-4" id="text-7-10-1">
<p>
在设置数据库添加如下的链接选项
</p>
<div class="org-src-container">
<pre class="src src-text">allowPublicKeyRetrieval=true
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc96762f" class="outline-3">
<h3 id="orgc96762f"><span class="section-number-3">7.11.</span> Docker</h3>
<div class="outline-text-3" id="text-7-11">
</div>
<div id="outline-container-org53caa1c" class="outline-4">
<h4 id="org53caa1c"><span class="section-number-4">7.11.1.</span> 文件夹递归复制</h4>
<div class="outline-text-4" id="text-7-11-1">
<div class="org-src-container">
<pre class="src src-dockerfile"><span style="color: #525252;"># </span><span style="color: #525252;">&#27491;&#30830;&#22320;&#36882;&#24402;&#22797;&#21046;&#25991;&#20214;&#22841;&#26041;&#26696;</span>
<span style="color: #51afef;">COPY</span> src/  target/

<span style="color: #525252;"># </span><span style="color: #525252;">&#20197;&#19979;&#20004;&#31181;&#19981;&#21644;&#36882;&#24402;&#22797;&#21046;</span>
<span style="color: #51afef;">COPY</span> src/* target
<span style="color: #51afef;">COPY</span> src   target
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org62d9b5b" class="outline-3">
<h3 id="org62d9b5b"><span class="section-number-3">7.12.</span> GDB</h3>
<div class="outline-text-3" id="text-7-12">
</div>
<div id="outline-container-orgc4b10bc" class="outline-4">
<h4 id="orgc4b10bc"><span class="section-number-4">7.12.1.</span> MacOS: 证书错误问题 <a href="https://timnash.co.uk/getting-gdb-to-semi-reliably-work-on-mojave-macos/">(^-^)</a></h4>
<div class="outline-text-4" id="text-7-12-1">
<blockquote>
<p>
please check gdb is codesigned - see taskgated(8)
</p>
</blockquote>
<p>
手工编写 gdb.xml
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #51afef;">?xml</span> <span style="color: #dcaeea;">version</span>="1.0" <span style="color: #dcaeea;">encoding</span>="UTF-8"?&gt;
&lt;<span style="color: #51afef;">!DOCTYPE</span> plist PUBLIC "-//Apple//DTD PLIST 1.0//EN"
"http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;<span style="color: #c678dd;">plist</span> <span style="color: #dcaeea;">version</span>=<span style="color: #99bb66;">"1.0"</span>&gt;
&lt;<span style="color: #c678dd;">dict</span>&gt;
    &lt;<span style="color: #c678dd;">key</span>&gt;com.apple.security.cs.allow-jit&lt;/<span style="color: #c678dd;">key</span>&gt;
    &lt;<span style="color: #c678dd;">true</span>/&gt;
    &lt;<span style="color: #c678dd;">key</span>&gt;com.apple.security.cs.allow-unsigned-executable-memory&lt;/<span style="color: #c678dd;">key</span>&gt;
    &lt;<span style="color: #c678dd;">true</span>/&gt;
    &lt;<span style="color: #c678dd;">key</span>&gt;com.apple.security.cs.allow-dyld-environment-variables&lt;/<span style="color: #c678dd;">key</span>&gt;
    &lt;<span style="color: #c678dd;">true</span>/&gt;
    &lt;<span style="color: #c678dd;">key</span>&gt;com.apple.security.cs.disable-library-validation&lt;/<span style="color: #c678dd;">key</span>&gt;
    &lt;<span style="color: #c678dd;">true</span>/&gt;
    &lt;<span style="color: #c678dd;">key</span>&gt;com.apple.security.cs.disable-executable-page-protection&lt;/<span style="color: #c678dd;">key</span>&gt;
    &lt;<span style="color: #c678dd;">true</span>/&gt;
    &lt;<span style="color: #c678dd;">key</span>&gt;com.apple.security.cs.debugger&lt;/<span style="color: #c678dd;">key</span>&gt;
    &lt;<span style="color: #c678dd;">true</span>/&gt;
    &lt;<span style="color: #c678dd;">key</span>&gt;com.apple.security.get-task-allow&lt;/<span style="color: #c678dd;">key</span>&gt;
    &lt;<span style="color: #c678dd;">true</span>/&gt;
&lt;/<span style="color: #c678dd;">dict</span>&gt;
&lt;/<span style="color: #c678dd;">plist</span>&gt;
</pre>
</div>
<p>
使用命令给 gdb 添加证书
</p>
<div class="org-src-container">
<pre class="src src-sh">codesign --entitlements gdb.xml -fs gdb-cert /usr/local/bin/gdb
</pre>
</div>

<p>
官网说明 <a href="https://sourceware.org/gdb/wiki/PermissionsDarwin">gdb permission</a>
</p>
</div>
</div>

<div id="outline-container-orgd9cc5a2" class="outline-4">
<h4 id="orgd9cc5a2"><span class="section-number-4">7.12.2.</span> Remote 'g' packet reply is too long</h4>
<div class="outline-text-4" id="text-7-12-2">
<p>
解决方法参考 <a href="https://wiki.osdev.org/QEMU_and_GDB_in_long_mode#:~:text=When%20the%20break%20point%20is%20hit%20and%20the,architecture%20names%20in%20those%20two%20%22set%20arch%22%20commands.">link</a>
</p>

<p>
方案一，启动时配置
</p>
<div class="org-src-container">
<pre class="src src-sh">$ gdb
(gdb) <span style="color: #c678dd;">set</span> arch i386:x86-64:intel
(gdb) target remote localhost:1234
(gdb) symbol-file YOUR_KERNEL_FILE
(gdb) <span style="color: #51afef;">break</span> SOME_FUNCTION_IN_LONG_MODE
(gdb) <span style="color: #51afef;">continue</span>
</pre>
</div>

<p>
方案二，修补源码, 修改 gdb/remote.c 的代码后重新编译
</p>
<div class="org-src-container">
<pre class="src src-text">--- gdb/remote.c        2016-04-14 11:13:49.962628700 +0300
+++ gdb/remote.c        2016-04-14 11:15:38.257783400 +0300
@@ -7181,8 +7181,28 @@
   buf_len = strlen (rs-&gt;buf);

   /* Further sanity checks, with knowledge of the architecture.  */
+// HACKFIX for changing architectures for qemu. It's ugly. Don't use, unless you have to.
+  // Just a tiny modification of the patch of Matias Vara (http://forum.osdev.org/viewtopic.php?f=13&amp;p=177644)
   if (buf_len &gt; 2 * rsa-&gt;sizeof_g_packet)
-    error (_("Remote 'g' packet reply is too long: %s"), rs-&gt;buf);
+    {
+      warning (_("Assuming long-mode change. [Remote 'g' packet reply is too long: %s]"), rs-&gt;buf);
+      rsa-&gt;sizeof_g_packet = buf_len ;
+
+      for (i = 0; i &lt; gdbarch_num_regs (gdbarch); i++)
+        {
+          if (rsa-&gt;regs[i].pnum == -1)
+            continue;
+
+          if (rsa-&gt;regs[i].offset &gt;= rsa-&gt;sizeof_g_packet)
+            rsa-&gt;regs[i].in_g_packet = 0;
+          else
+            rsa-&gt;regs[i].in_g_packet = 1;
+        }
+
+      // HACKFIX: Make sure at least the lower half of EIP is set correctly, so the proper
+      // breakpoint is recognized (and triggered).
+      rsa-&gt;regs[8].offset = 16*8;
+    }

   /* Save the size of the packet sent to us by the target.  It is used
      as a heuristic when determining the max size of packets that the
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Last Updated 2023-09-21 Thu 12:46. Created by Jinghui Hu at 2023-01-29 Sun 10:55.</p>
</div>
</body>
</html>